<script>
import VueMultiselect from 'vue-multiselect';
// Import the stores.
import { useSkillsStore } from '../../stores/SkillsStore.js';
import { useUserDetailsStore } from '../../stores/UserDetailsStore.js';
import WaitLoadingModal from './share-components/WaitLoadingModal.vue';
import SuccessModal from './share-components/SuccessModal.vue';
import FailsModal from './share-components/FailsModal.vue';

export default {
    setup() {
        const skillsStore = useSkillsStore();
        const userDetailsStore = useUserDetailsStore();

        return {
            skillsStore,
            userDetailsStore
        };
    },
    components: { VueMultiselect, WaitLoadingModal, SuccessModal, FailsModal },
    data() {
        return {
            skill: {
                name: '',
                // Set as default, though can be changed.
                parent: 0,
                description: '',
                icon: '',
                icon_image: '',
                mastery_requirements: '',
                type: 'regular',
                level: 'grade_school'
            },
            iconImage: '',
            bannerImage: '',
            skills: [],
            superSkills: [],
            levels: [
                {
                    id: 'grade_school',
                    name: 'Grade school'
                },
                {
                    id: 'middle_school',
                    name: 'Middle school'
                },
                {
                    id: 'high_school',
                    name: 'High school'
                },
                {
                    id: 'college',
                    name: 'College'
                },
                {
                    id: 'phd',
                    name: 'PhD'
                }
            ],
            filters: [],
            // Below are data for various input function and data
            parentInput: {
                inputText: '',
                suggestSkills: []
            },
            clusterParentInput: {
                inputText: '',
                suggestSuperSkills: []
            },
            showDropDown: false,
            // we want show the name instead of id
            showLevel: 'Grade School',
            // validate obj
            validate: {
                violated: false,
                name: false,
                description: false,
                orphan: false
            },
            isAnotherInstanceOfExistingSkill: false,
            skillToBeCopied: null,
            parentOfNewInstance: null,
            showCopiedSkillModal: false,
            showSkillTypeModal: false,
            parentLevel: '',
            showLoadModal: false,
            showSuccessModal: false,
            showFailsModal: false,
            message: ''
        };
    },
    computed: {
        skillsThatCanBeCopied() {
            let skillsThatCanBeCopied = this.skillsStore.skillsList.filter(
                function (obj) {
                    return obj.type !== 'domain' && obj.type !== 'super';
                }
            );
            return skillsThatCanBeCopied;
        }
    },
    async created() {
        if (this.skillsStore.skillsList.length == 0) {
            await this.skillsStore.getSkillsList();
        }
        if (this.skills.length == 0) await this.getParentSkills();
    },
    async mounted() {
        $('#summernote').summernote({
            disableDragAndDrop: true,
            placeholder: '',
            tabsize: 2,
            height: 120,
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'underline', 'clear']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['table', ['table']],
                ['insert', ['link']],
                ['view', ['fullscreen', 'codeview', 'help']]
            ],
            maximumImageFileSize: 2048 * 1024, // 2 MB
            callbacks: {
                onImageUploadError: function (msg) {
                    alert('Max image size is 2MB.');
                }
            }
        });
        $('.note-editor .note-editable').css('background-color', '#ffffff');

        // Modals
        // Close modal by clicking outside it.
        document.getElementById('myModal1').addEventListener('click', (e) => {
            if (!e.target.classList.contains('modal-content')) {
                this.showCopiedSkillModal = false;
            }
        });
        // The above should not work on the modal content.
        document.getElementById('modal-content1').addEventListener(
            'click',
            function (e) {
                e.stopPropagation();
            },
            false
        );
        document.getElementById('myModal2').addEventListener('click', (e) => {
            if (!e.target.classList.contains('modal-content')) {
                this.showSkillTypeModal = false;
            }
        });
        // The above should not work on the modal content.
        document.getElementById('modal-content2').addEventListener(
            'click',
            function (e) {
                e.stopPropagation();
            },
            false
        );
    },
    methods: {
        async getParentSkills() {
            for (let i = 0; i < this.skillsStore.skillsList.length; i++) {
                if (this.skillsStore.skillsList[i].type == 'super') {
                    this.superSkills.push(this.skillsStore.skillsList[i]);
                }
                if (
                    this.skillsStore.skillsList[i].id != this.skillId &&
                    this.skillsStore.skillsList[i].type != 'sub'
                ) {
                    this.skills.push(this.skillsStore.skillsList[i]);
                }
            }
        },
        // For image upload.
        onFileChange(e, type) {
            var files = e.target.files || e.dataTransfer.files;
            if (!files.length) return;
            this.createImage(files[0], type);
        },
        createImage(file, type) {
            var image = new Image();
            var reader = new FileReader();
            var vm = this;

            reader.onload = (e) => {
                vm.image = e.target.result;
                if (type == 'icon') {
                    this.iconImage = e.target.result;
                    this.skill.icon_image = this.iconImage;
                }
            };
            reader.readAsDataURL(file);
        },
        deleteImage(type) {
            if (type == 'icon') {
                this.iconImage = '';
            }
        },
        validateSkill() {
            // Check if skill name already exists.
            for (let i = 0; i < this.skillsStore.skillsList.length; i++) {
                if (this.skill.name == this.skillsStore.skillsList[i].name) {
                    alert('This skill already exists.');
                    return;
                }
            }
            // Check sub skills have a parent skill.
            if (this.skill.type == 'sub' && this.skill.parent == 0) {
                alert('cluster nodes must have a parent');
                this.validate.orphan = true;
                // turn on the violated flag
                this.validate.violated = true;
            }
            // Check skill has a name.
            if (this.skill.name === '' || this.skill.name === null) {
                alert('please enter a skill name');
                this.validate.name = true;
                this.validate.description = true;
            }
            // Assign levels of subskills automatically.
            if (this.skill.type == 'sub') {
                for (let i = 0; i < this.skillsStore.skillsList.length; i++) {
                    if (
                        this.skill.parent == this.skillsStore.skillsList[i].id
                    ) {
                        this.skill.level = this.skillsStore.skillsList[i].level;
                    }
                }
            }

            // if any of the validate is violated we end the method here
            if (this.validate.violated) {
                return;
            }

            if (this.userDetailsStore.role == 'platform_admin') {
                this.Submit();
            } else {
                this.submitNewSkillForReview();
            }
        },
        async submitNewSkillForReview() {
            this.showLoadModal = true;
            let url =
                '/new-skills-awaiting-approval/submit-new-skill-for-review';

            // Get the Summernote HTML.
            this.skill.mastery_requirements =
                $('#summernote').summernote('code');

            await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: this.userDetailsStore.userId,
                    name: this.skill.name,
                    parent: this.skill.parent,
                    icon_image: this.skill.icon_image,
                    mastery_requirements: this.skill.mastery_requirements,
                    type: this.skill.type,
                    level: this.skill.level
                })
            }).then(() => {
                this.showLoadModal = false;
                this.showSuccessModal = true;
                this.message = 'New skill submitted for approval.';
            });
        },
        async Submit() {
            this.showLoadModal = true;
            let url = '/skills/add';

            // Function to help compare level of parent and new skill.
            // Constraint: Parent cannot be higher level than new skill
            function levelToNumber(level) {
                if (level == 'grade_school') return 1;
                else if (level == 'middle_school') return 2;
                else if (level == 'high_school') return 3;
                else if (level == 'college') return 4;
                else if (level == 'phd') return 5;
            }
            // Determine parent level.
            let parentLevel = levelToNumber(this.parentLevel);
            // Determine new node level.
            let skillLevel = levelToNumber(this.skill.level);
            if (parentLevel > skillLevel) {
                this.message =
                    'Child nodes cannot have a lower grade level than parent nodes.';
                this.showLoadModal = false;
                this.showFailsModal = true;
                return;
            }

            // Get the Summernote HTML.
            this.skill.mastery_requirements =
                $('#summernote').summernote('code');

            await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name: this.skill.name,
                    parent: this.skill.parent,
                    description: this.skill.description,
                    icon_image: this.skill.icon_image,
                    mastery_requirements: this.skill.mastery_requirements,
                    type: this.skill.type,
                    level: this.skill.level,
                    filters: this.filters
                })
            })
                .then(function (response) {
                    return response.json();
                })
                .then((data) => {
                    // Check if skill exists already.
                    if (data.result == 'This skill already exists.') {
                        this.showFailsModal = true;
                        this.message = data.result;
                        return;
                    } else if (
                        data.result ==
                        'This skill was deleted, but has now been undeleted. Please find it and edit it.'
                    ) {
                        this.showLoadModal = false;
                        this.showFailsModal = true;
                        this.message = data.result;
                        return;
                    }
                })
                .then(() => {
                    this.skillsStore.getNestedSkillsList();
                })
                .then(() => {
                    this.showLoadModal = false;
                    this.showSuccessModal = true;
                    this.message = 'Adding Skill Successfully';
                });
        },
        async CreateNewInstance() {
            var url = '/skills/add/new-instance';
            await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    skillToBeCopied: this.skillToBeCopied,
                    parentOfNewInstance: this.parentOfNewInstance
                })
            })
                .then(() => {
                    this.skillsStore.getNestedSkillsList();
                })
                .then(() => {
                    this.showLoadModal = false;
                    this.message = 'Successfully created new instance';
                    this.showSuccessModal = true;
                });
        },
        // 2 Method that handle parent dropdown
        getReferenceSkill() {
            // Only show the suggestion if the user type in 2 word
            if (this.parentInput.inputText.length < 2) {
                this.parentInput.suggestSkills = [];
            } else {
                this.parentInput.suggestSkills = this.skills.filter((skill) => {
                    // Lower case so the result wont be case sensitive
                    return skill.name
                        .toLowerCase()
                        .includes(this.parentInput.inputText.toLowerCase());
                });
            }
        },
        // For selecting parent
        handleChooseSuggestSkill(skill) {
            //turn off the suggestion drop down
            this.parentInput.suggestSkills = [];
            // set form data
            this.skill.parent = skill.id;

            // Need to make sure skill level is not higher than parent level.
            this.parentLevel = skill.level;

            // set input text
            this.parentInput.inputText = skill.name;
        },
        // -----------------------------------------
        // 2 method for cluster outer skill type input
        getSuperSkillSuggestion() {
            // Only show the suggestion if the user type in 2 word
            if (this.clusterParentInput.inputText.length < 2) {
                this.clusterParentInput.suggestSuperSkills = [];
            } else {
                this.clusterParentInput.suggestSuperSkills =
                    this.superSkills.filter((skill) => {
                        // Lower case so the result wont be case sensitive
                        return skill.name
                            .toLowerCase()
                            .includes(
                                this.clusterParentInput.inputText.toLowerCase()
                            );
                    });
            }
        },
        handleChooseSuperSkill(skill) {
            this.clusterParentInput.suggestSuperSkills = [];
            this.skill.parent = skill.id;
            this.clusterParentInput.inputText = skill.name;
        },
        // -------------------------------------------
        handleChooseSkillLevel(level) {
            this.showLevel = level.name;
            this.skill.level = level.id;
            this.showDropDown = false;
        },
        openImage(elName) {
            // find the file input base on id and manually click them
            const input = document.getElementById(elName);
            input.click();
        },
        handleOkBtnClick() {
            this.showSuccessModal = false;
            this.$router.push('/skills');
        },
        handleFailsOkClick() {
            this.showFailsModal = false;
        }
    }
};
</script>

<template>
    <div class="container mt-3 bg-light rounded p-2">
        <!-- Page Heading -->
        <h1 class="heading">
            <span v-if="skill.type != 'domain'">Add Skill</span>
            <span v-else>Add Category</span>
        </h1>
        <!-- If making another instance of an existing skill on the tree -->
        <div class="row">
            <div class="col-12 mt-2">
                <div class="row p-0 m-0 d-flex">
                    <div class="form-check my-2 col-10">
                        <label class="control control-checkbox">
                            <span class="my-auto ms-2 secondary-text"
                                >Is this an existing skill that needs to appear
                                again in the tree?</span
                            >
                            <input
                                type="checkbox"
                                value="true"
                                v-model="isAnotherInstanceOfExistingSkill"
                            />
                            <div class="control_indicator"></div>
                        </label>
                    </div>
                    <!-- Information button -->
                    <div class="col-2">
                        <button
                            class="btn primary-btn mt-2"
                            @click="showCopiedSkillModal = 'true'"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 192 512"
                                width="18"
                                height="18"
                                fill="white"
                            >
                                <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc. -->
                                <path
                                    d="M48 80a48 48 0 1 1 96 0A48 48 0 1 1 48 80zM0 224c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224 32 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0 0-192-32 0c-17.7 0-32-14.3-32-32z"
                                />
                            </svg>
                        </button>
                    </div>
                </div>
                <div v-if="isAnotherInstanceOfExistingSkill" class="mb-3">
                    <div class="row mt-3">
                        <h2 class="secondary-heading h4">Original Skill</h2>
                        <select v-model="skillToBeCopied">
                            <option
                                v-for="skill in skillsThatCanBeCopied"
                                :value="skill"
                            >
                                {{ skill.name }}
                            </option>
                        </select>
                    </div>
                    <div class="row mt-3">
                        <h2 class="secondary-heading h4">Parent</h2>
                        <select v-model="parentOfNewInstance">
                            <option v-for="skill in skills" :value="skill">
                                {{ skill.name }}
                            </option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <!-- If making a new skill -->
        <div v-if="!isAnotherInstanceOfExistingSkill">
            <!-- Skill Name -->
            <div class="row mt-2">
                <div class="col-12 col-md-8 col-lg-5 mt-2">
                    <div class="mb-3">
                        <h2 class="secondary-heading h4">Name</h2>
                        <input
                            v-model="skill.name"
                            class="form-control"
                            type="text"
                            placeholder="name"
                        />
                        <div
                            v-if="
                                validate.name &&
                                (skill.name == '' || skill.name == null)
                            "
                            class="form-validate"
                        >
                            please enter a skill name
                        </div>
                    </div>
                </div>
            </div>
            <!-- Parent -->
            <div class="row">
                <div class="col-12 col-md-8 col-lg-5 mt-2">
                    <div v-if="skill.type != 'sub'" class="mb-3">
                        <h2 class="secondary-heading h4">Parent</h2>
                        <div class="row mt-3">
                            <div class="col position-relative">
                                <input
                                    id="skill-input"
                                    v-model="parentInput.inputText"
                                    @input="getReferenceSkill"
                                    placeholder="type skill name"
                                />
                                <div
                                    v-if="parentInput.suggestSkills.length > 0"
                                    id="suggest-skills"
                                    class="flex flex-column position-absolute"
                                >
                                    <div
                                        class="suggest-option"
                                        v-for="skill in parentInput.suggestSkills"
                                        @click="handleChooseSuggestSkill(skill)"
                                    >
                                        {{ skill.name }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div
                            v-if="
                                validate.orphan &&
                                (skill.parent == '' || skill.parent == null)
                            "
                            class="form-validate"
                        >
                            cluster nodes must have a parent
                        </div>
                    </div>
                    <!-- -------------------------------------------------- -->
                    <div v-else class="mb-3">
                        <h2 class="secondary-heading h4">
                            Cluster node center
                        </h2>
                        <!-- <select class="form-select" v-model="skill.parent">
                        <option
                            v-for="superSkill in superSkills"
                            :value="superSkill.id"
                        >
                            {{ superSkill.name }}
                        </option>
                    </select> -->
                        <!-- ==================== -->
                        <div class="row mt-3">
                            <div class="col position-relative">
                                <input
                                    id="skill-input"
                                    v-model="clusterParentInput.inputText"
                                    @input="getSuperSkillSuggestion"
                                    placeholder="type skill name"
                                />
                                <div
                                    v-if="
                                        clusterParentInput.suggestSuperSkills
                                            .length > 0
                                    "
                                    id="suggest-skills"
                                    class="flex flex-column position-absolute"
                                >
                                    <div
                                        class="suggest-option"
                                        v-for="skill in clusterParentInput.suggestSuperSkills"
                                        @click="handleChooseSuggestSkill(skill)"
                                    >
                                        {{ skill.name }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Skill level -->
            <div class="row">
                <div v-if="skill.type != 'sub'">
                    <div class="col col-md-8 col-lg-5 mt-2">
                        <!-- Custom Dropdown -->
                        <h2 class="secondary-heading h4">Level</h2>
                        <div class="d-flex flex-column position-relative">
                            <div
                                :class="[
                                    showDropDown
                                        ? 'custom-select-button-focus '
                                        : 'custom-select-button '
                                ]"
                                @click="showDropDown = !showDropDown"
                            >
                                {{ showLevel }}
                                <span>
                                    <svg
                                        width="20"
                                        height="20"
                                        viewBox="0 0 20 20"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                    >
                                        <path
                                            d="M14.2929 8.70711C14.9229 8.07714 14.4767 7 13.5858 7H6.41421C5.52331 7 5.07714 8.07714 5.70711 8.70711L9.29289 12.2929C9.68342 12.6834 10.3166 12.6834 10.7071 12.2929L14.2929 8.70711Z"
                                            fill="#344054"
                                        />
                                    </svg>
                                </span>
                            </div>
                            <div
                                v-if="showDropDown"
                                class="custom-dropdown-base"
                            >
                                <div
                                    v-for="level in levels"
                                    class="custom-dropdown-option"
                                    @click="handleChooseSkillLevel(level)"
                                >
                                    {{ level.name }}
                                </div>
                            </div>
                        </div>
                        <!-- End of custom dropdown -->
                    </div>
                </div>
            </div>
            <!-- Skill Type -->
            <div class="row">
                <div class="col-10 mt-2">
                    <h2 class="secondary-heading h4">Node Type</h2>
                    <div class="row p-0 m-0">
                        <div class="form-check col-6 col-md-5 my-2">
                            <label class="control control-checkbox">
                                <span class="my-auto mx-2 me-4 secondary-text"
                                    >Regular</span
                                >
                                <input
                                    type="radio"
                                    name="nodeType"
                                    id="regularSkillRadio"
                                    value="regular"
                                    v-model="skill.type"
                                />
                                <div class="control_indicator"></div>
                            </label>
                        </div>
                        <div class="form-check col-6 col-md-5 my-2">
                            <label class="control control-checkbox">
                                <span class="my-auto mx-2 me-4 secondary-text"
                                    >Category</span
                                >
                                <input
                                    type="radio"
                                    name="nodeType"
                                    id="domainSkillRadio"
                                    value="domain"
                                    v-model="skill.type"
                                />
                                <div class="control_indicator"></div>
                            </label>
                        </div>
                        <div class="form-check col-6 col-md-5 my-2">
                            <label class="control control-checkbox">
                                <span class="my-auto mx-2 me-4 secondary-text"
                                    >Cluster node center</span
                                >
                                <input
                                    type="radio"
                                    name="nodeType"
                                    id="superSkillRadio"
                                    value="super"
                                    v-model="skill.type"
                                />
                                <div class="control_indicator"></div>
                            </label>
                        </div>
                        <div class="form-check col-6 col-md-5 my-2">
                            <label class="control control-checkbox">
                                <span class="my-auto mx-2 me-4 secondary-text"
                                    >Cluster node outer</span
                                >
                                <input
                                    type="radio"
                                    name="nodeType"
                                    id="regularSkillRadio"
                                    value="sub"
                                    v-model="skill.type"
                                />
                                <div class="control_indicator"></div>
                            </label>
                        </div>
                    </div>
                </div>
                <div
                    v-if="
                        validate.orphan &&
                        this.skill.type == 'sub' &&
                        this.skill.parent == 0
                    "
                    class="form-validate"
                >
                    please choose a parent for this skill
                </div>
                <!-- Information button -->
                <div class="col-2">
                    <button
                        class="btn primary-btn mt-2"
                        @click="showSkillTypeModal = true"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 192 512"
                            width="18"
                            height="18"
                            fill="white"
                        >
                            <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc. -->
                            <path
                                d="M48 80a48 48 0 1 1 96 0A48 48 0 1 1 48 80zM0 224c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224 32 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0 0-192-32 0c-17.7 0-32-14.3-32-32z"
                            />
                        </svg>
                    </button>
                </div>
            </div>
            <!-- Icon -->
            <div class="row">
                <!-- Icon chooser -->
                <div class="col-6 col-md-3 col-lg-2 mt-2">
                    <div
                        class="mb-3 row d-flex justify-content-center justify-content-md-start"
                    >
                        <h2 class="secondary-heading h4">Icon</h2>
                        <div v-if="!iconImage">
                            <input
                                class="form-control d-none"
                                type="file"
                                accept="image/*"
                                @change="onFileChange($event, 'icon')"
                                id="iconFileChoose"
                            />
                            <div class="default-no-img">
                                <div
                                    class="plus-svg"
                                    @click="openImage('iconFileChoose')"
                                >
                                    <!-- The plus Icon On Top Of the avatar -->
                                    <svg
                                        width="33"
                                        height="33"
                                        viewBox="0 0 53 53"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                    >
                                        <circle
                                            cx="26.5"
                                            cy="26.5"
                                            r="26.5"
                                            fill="#D9D9D9"
                                        />
                                        <g clip-path="url(#clip0_372_11959)">
                                            <path
                                                d="M19.7439 45.0784L19.7439 33.2515L7.93354 33.268C7.40615 33.2671 6.90063 33.0572 6.52771 32.6843C6.15479 32.3114 5.94488 31.8059 5.94396 31.2785L5.93291 21.7174C5.93382 21.1901 6.14373 20.6845 6.51665 20.3116C6.88957 19.9387 7.3951 19.7288 7.92249 19.7279L19.7439 19.7334L19.7439 7.90646C19.7411 7.64223 19.7911 7.38009 19.8909 7.13543C19.9907 6.89076 20.1384 6.66849 20.3252 6.48164C20.5121 6.29479 20.7344 6.14713 20.979 6.0473C21.2237 5.94747 21.4858 5.8975 21.75 5.9003L31.2779 5.92241C31.8053 5.92332 32.3108 6.13322 32.6838 6.50615C33.0567 6.87907 33.2666 7.38459 33.2675 7.91198L33.262 19.7334L45.0889 19.7334C45.615 19.7337 46.1195 19.9428 46.4915 20.3148C46.8635 20.6869 47.0726 21.1913 47.073 21.7174L47.0951 31.2453C47.0948 31.7714 46.8856 32.2759 46.5136 32.6479C46.1416 33.0199 45.6371 33.229 45.111 33.2294L33.262 33.2515L33.2786 45.0618C33.2776 45.5892 33.0677 46.0947 32.6948 46.4677C32.3219 46.8406 31.8164 47.0505 31.289 47.0514L21.7501 47.0846C21.4858 47.0874 21.2237 47.0374 20.979 46.9376C20.7344 46.8377 20.5121 46.6901 20.3252 46.5032C20.1384 46.3164 19.9907 46.0941 19.8909 45.8494C19.7911 45.6048 19.7411 45.3426 19.7439 45.0784Z"
                                                fill="white"
                                            />
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_372_11959">
                                                <rect
                                                    width="37"
                                                    height="37"
                                                    fill="white"
                                                    transform="translate(8 8)"
                                                />
                                            </clipPath>
                                        </defs>
                                    </svg>
                                </div>
                            </div>
                            <p style="font-size: 14px">
                                <em class="secondary-text"
                                    >Maximum file size 15mb</em
                                >
                            </p>
                        </div>
                        <div v-else>
                            <p>
                                <img
                                    :src="iconImage"
                                    height="158"
                                    width="158"
                                    style="background-color: lightgrey"
                                />
                            </p>
                            <p>
                                <button
                                    class="btn red-btn"
                                    @click="deleteImage('icon')"
                                >
                                    Remove &nbsp;&nbsp;
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 448 512"
                                        width="20"
                                        height="20"
                                        fill="white"
                                    >
                                        <path
                                            d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"
                                        />
                                    </svg>
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Description  -->
            <div class="row" v-if="userDetailsStore.role == 'platform_admin'">
                <div class="col">
                    <div class="mb-3">
                        <h2 class="secondary-heading h4">Description</h2>
                        <textarea
                            v-model="skill.description"
                            class="form-control"
                            placeholder="description"
                            rows="2"
                        ></textarea>
                    </div>
                    <div>
                        <div v-if="validate.description" class="form-validate">
                            please enter description for skill
                        </div>
                    </div>
                </div>
            </div>
            <!-- Mastery Requirements with summernote -->
            <div class="row" v-if="skill.type != 'domain'">
                <div class="col">
                    <div class="mb-3">
                        <h2 class="secondary-heading h4">
                            Mastery Requirements
                        </h2>
                        <textarea
                            v-model="skill.mastery_requirements"
                            class="form-control"
                            id="summernote"
                            rows="3"
                        ></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit and cancel button -->
        <div class="row">
            <div class="col">
                <div class="d-flex justify-content-end gap-4">
                    <router-link class="btn red-btn" to="/skills">
                        Cancel
                    </router-link>
                    <button
                        v-if="
                            userDetailsStore.role == 'platform_admin' &&
                            isAnotherInstanceOfExistingSkill
                        "
                        class="btn primary-btn"
                        @click="CreateNewInstance()"
                    >
                        Create New Instance
                    </button>
                    <button
                        v-else
                        class="btn primary-btn"
                        @click="validateSkill()"
                    >
                        <span
                            v-if="
                                userDetailsStore.role == 'platform_admin' &&
                                !isAnotherInstanceOfExistingSkill
                            "
                            >Submit</span
                        ><span v-else>Submit New Skill For Review</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- The Skill Copy Info Modal -->
    <div v-show="showCopiedSkillModal">
        <div id="myModal1" class="modal">
            <!-- Modal content -->
            <div
                id="modal-content1"
                class="modal-content contact-modal-content"
            >
                <button
                    type="button"
                    @click="showCopiedSkillModal = false"
                    class="close closeBtn"
                    aria-label="Close"
                >
                    <span aria-hidden="true">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 384 512"
                            width="25"
                            height="25"
                        >
                            <path
                                d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"
                                fill="black"
                            />
                        </svg>
                    </span>
                </button>
                <section>
                    This is for skills that need to appear in more than one
                    place.
                </section>
            </div>
        </div>
    </div>
    <!-- The Skill Type Info Modal -->
    <div v-show="showSkillTypeModal">
        <div id="myModal2" class="modal">
            <!-- Modal content -->
            <div
                id="modal-content2"
                class="modal-content contact-modal-content"
            >
                <button
                    type="button"
                    @click="showSkillTypeModal = false"
                    class="close closeBtn"
                    aria-label="Close"
                >
                    <span aria-hidden="true">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 384 512"
                            width="25"
                            height="25"
                        >
                            <path
                                d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"
                                fill="black"
                            />
                        </svg>
                    </span>
                </button>
                <section>
                    <ul>
                        <li>
                            <strong>Regular nodes</strong> are the most standard
                            type
                        </li>
                        <li>
                            <strong>Categories</strong> do not have assessments,
                            and are used to organise the skills
                        </li>
                        <li>
                            <strong>Cluster node centers</strong> are skills
                            that are comprised of multiple outer skills
                        </li>
                        <li>
                            <strong>Cluster node outer skills</strong> are
                            skills that make up a cluster node center skill
                        </li>
                    </ul>
                </section>
            </div>
        </div>
    </div>
    <!-- Loading Modal show up when user interact with sever -->
    <WaitLoadingModal v-if="showLoadModal" />
    <SuccessModal
        v-if="showSuccessModal"
        :message="message"
        :handleOkClick="handleOkBtnClick"
    />
    <FailsModal
        v-if="showFailsModal"
        :message="message"
        :handleOkClick="handleFailsOkClick"
    />
</template>

<style scoped>
#page-tile {
    font-family: 'Poppins' sans-serif;
    font-size: 38px;
    font-weight: 900;
    line-height: 28px;
    letter-spacing: 0em;
    text-align: left;
    color: #667085;
}

.form-label {
    font-family: 'Poppins' sans-serif;
    font-size: 14px;
    font-weight: 600;
    line-height: 20px;
    letter-spacing: 0em;
    text-align: left;
}

.form-control {
    padding: 10px 0px 10px 14px;
    border-radius: 8px;
    border: 1px;
    gap: 8px;
    box-shadow: 0px 1px 2px 0px #1018280d;
    border: 1px solid #f2f4f7;
}

/* ----------------- a lot of css style for all the various input style ----------------------------  */

/* Parent skill input dropdown elements */
#skill-input {
    width: 100%;
    height: 42px;
    padding: 10px 0px 10px 14px;
    border-radius: 8px;
    border: 1px;
    gap: 8px;
    box-shadow: 0px 1px 2px 0px #1018280d;
    border: 1px solid #f2f4f7;
    gap: 8px;
    background: linear-gradient(0deg, #ffffff, #ffffff),
        linear-gradient(0deg, #f2f4f7, #f2f4f7);
    color: #667085;
    box-shadow: 0px 1px 2px 0px #1018280d;
    font-family: 'Poppins' sans-serif;
}

#skill-input:focus {
    outline-color: #667085;
}

#suggest-skills {
    z-index: 10;
    width: 95.5%;
    margin-right: 0px;
    margin-left: auto;
    border-radius: 6.63px;
    border: 0.83px;
    background: linear-gradient(0deg, #ffffff, #ffffff),
        linear-gradient(0deg, #65e0a5, #65e0a5);
    border: 1px solid #f2f4f7;
    border: 0.83px solid #65e0a5;
    box-shadow: 0px 3.317408561706543px 4.9761128425598145px -1.6587042808532715px
        #10182808;
    box-shadow: 0px 9.952225685119629px 13.269634246826172px -3.317408561706543px
        #10182814;
}

.suggest-option {
    height: 36.59px;
    padding: 8.29px 11px 8px 12px;
    gap: 6.63px;
    color: #344054;
}
.suggest-option:hover {
    background: #65e0a51a;
    cursor: pointer;
}
/* End of skill input and suggestion style */

/* =========================== */

/* Style For The Custom Select */
.custom-select-button {
    width: 100%;
    height: 42px;
    padding: 10px 0px 10px 14px;
    border-radius: 8px;
    gap: 8px;
    background: linear-gradient(0deg, #ffffff, #ffffff),
        linear-gradient(0deg, #f2f4f7, #f2f4f7);
    border: 1px solid #f2f4f7;
    box-shadow: 0px 1px 2px 0px #1018280d;
    font-family: 'Poppins' sans-serif;
    font-size: 1rem;
    font-weight: 400;
    line-height: 22px;
    letter-spacing: 0.03em;
    text-align: left;
    display: flex;
}

.custom-select-button-focus {
    width: 100%;
    height: 42px;
    padding: 10px 0px 10px 14px;
    border-radius: 8px;
    gap: 8px;
    background: linear-gradient(0deg, #ffffff, #ffffff),
        linear-gradient(0deg, #f2f4f7, #f2f4f7);
    border: 1px solid #9c7eec;
    box-shadow: 0px 0px 0px 4px #bca3ff4d;
    font-family: 'Poppins' sans-serif;
    font-size: 1rem;
    font-weight: 400;
    line-height: 22px;
    letter-spacing: 0.03em;
    text-align: left;
    display: flex;
}

.custom-select-button:hover {
    cursor: pointer;
    border: 1px solid #9c7eec;
}

.custom-select-button > span {
    margin-right: 2px;
    margin-left: auto;
    animation: rotationBack 0.52s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
    transform: translate3d(0, 0, 0);
}

.custom-select-button-focus > span {
    margin-right: 2px;
    margin-left: auto;
    animation: rotation 0.52s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
    transform: translate3d(0, 0, 0);
}

.form-validate {
    font-size: 0.75rem;
    color: red;
    font-weight: 300;
}

/* The animation key frame */
@keyframes rotation {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(180deg);
    }
}

@keyframes rotationBack {
    from {
        transform: rotate(180deg);
    }
    to {
        transform: rotate(0deg);
    }
}

.custom-select-button-focus:hover {
    cursor: pointer;
}
.custom-dropdown-base {
    border-radius: 8px;
    border: 1px;
    background: linear-gradient(0deg, #ffffff, #ffffff);
    border: 1px solid #9c7eec;
    box-shadow: 0px 4px 6px -2px #10182808;
    box-shadow: 0px 12px 16px -4px #10182814;
    position: absolute;
    z-index: 10;
    width: 100%;
    top: 42px;
}

.custom-dropdown-option {
    padding: 10px 14px 10px 14px;
    gap: 8px;
    color: #344054;
}

.custom-dropdown-option:hover {
    cursor: pointer;
    background: #bca3ff1a;
}
/* End of CSS style for Custom Select */

/**-------------------------------------  */
/* A lot of CSS to styling two check box */
.control {
    font-family: 'Poppins' sans-serif;
    display: block;
    position: relative;
    padding-left: 30px;
    margin-bottom: 5px;
    padding-top: 3px;
    cursor: pointer;
}

.control > span {
    font-weight: 500;
    font-size: 0.938rem;
    color: #667085;
    text-align: center;
}
.control input {
    position: absolute;
    z-index: -1;
    opacity: 0;
}
.control_indicator {
    position: absolute;
    top: 2px;
    left: 0;
    height: 29.09px;
    width: 29.09px;
    background: #f9f5ff;
    border: 1.45px solid #9c7eec;
    border-radius: 8.73px;
}
.control:hover input ~ .control_indicator,
.control input:focus ~ .control_indicator {
    background: #e7ddf6;
}

.plus-svg:hover {
    cursor: pointer;
}
.control input:checked ~ .control_indicator {
    background: #f9f5ff;
}
.control:hover input:not([disabled]):checked ~ .control_indicator,
.control input:checked:focus ~ .control_indicator {
    background: #f9f5ff;
}
.control input:disabled ~ .control_indicator {
    background: #e6e6e6;
    opacity: 0.6;
    pointer-events: none;
}
.control_indicator:after {
    box-sizing: unset;
    content: '';
    position: absolute;
    display: none;
}
.control input:checked ~ .control_indicator:after {
    display: block;
}
.control-checkbox .control_indicator:after {
    left: 4px;
    top: 5px;
    width: 13.58px;
    height: 9.33px;
    border: solid #9c7eec;
    border-width: 0px 0px 2.9px 2.9px;
    transform: rotate(-45deg);
}
.control-checkbox input:disabled ~ .control_indicator:after {
    border-color: #7b7b7b;
}
.control-checkbox .control_indicator::before {
    content: '';
    display: block;
    position: absolute;
    left: 0;
    top: 0;
    width: 4.5rem;
    height: 4.5rem;
    margin-left: -1.3rem;
    margin-top: -1.3rem;
    background: #9c7eec;
    border-radius: 3rem;
    opacity: 0.6;
    z-index: 99999;
    transform: scale(0);
}

.control-checkbox input + .control_indicator::before {
    animation: s-ripple 250ms ease-out;
}
.control-checkbox input:checked + .control_indicator::before {
    animation-name: s-ripple-dup;
}
/* End of check box styling */

/* ------------------------------------------------------------- */
.form-check {
    margin: 0px;
    padding: 0px;
}

/* ================ */
/* Styling for default image */
.default-no-img {
    width: 100%;
    height: 158px;
    background-color: #e6e6e6;
    border-radius: 12px;
    border: #e7ddf6;
}
.plus-svg {
    display: flex;
    justify-content: end;
    padding-right: 10px;
    padding-left: auto;
    padding-bottom: auto;
    padding-top: 10px;
}

/* ================== */
.form-validate {
    font-size: 0.75rem;
    color: red;
    font-weight: 300;
}

/* Style specific for phone view */
@media (max-width: 767px) {
    .default-no-img {
        height: 100px;
        width: auto;
    }
    #page-tile {
        font-size: 32px;
    }
}

.closeBtn {
    position: absolute;
    top: 5px;
    right: 5px;
}

/* The Warning Modal */
.modal {
    display: block;
    /* Hidden by default */
    position: fixed;
    /* Stay in place */
    z-index: 1;
    /* Sit on top */
    left: 0;
    top: 0;
    width: 100%;
    /* Full width */
    height: 100%;
    /* Full height */
    overflow: hidden;
    /* Enable scroll if needed */
    background-color: rgb(0, 0, 0);
    /* Fallback color */
    background-color: rgba(0, 0, 0, 0.4);
    /* Black w/ opacity */
}

/* Modal Content/Box */
.contact-modal-content {
    background-color: #fefefe;
    padding: 20px;
    border: 1px solid #888;
    width: 600px !important;
    font-size: 18px;
    /* Could be more or less, depending on screen size */
}

/* Mobile */
@media (max-width: 480px) {
    .contact-modal-content {
        margin: 30% auto !important;
        width: 90% !important;
    }
}

/* Tablets */
@media (min-width: 481px) and (max-width: 1024px) {
    .contact-modal-content {
        margin: 15% auto !important;
        width: 90% !important;
    }
}

/* Desktops/laptops */
@media (min-width: 1025px) {
    .contact-modal-content {
        margin: 10% auto;
    }
}
</style>
