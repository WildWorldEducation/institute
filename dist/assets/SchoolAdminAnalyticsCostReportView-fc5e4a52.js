import"./transform-4d0f7c8f.js";import{_ as g,o as p,c as m,e as L,r as T,a as s,b as D,j as f,k as w}from"./main-c88d736d.js";import{l as v,a as b,b as x,c as P}from"./linear-d9b6cbf2.js";import{m as _}from"./continuous-93813e6c.js";import{b as S}from"./band-2263c9e7.js";import{s as C}from"./sort-fcaf8f38.js";import{s as u}from"./string-c67ea49d.js";import{u as M,l as A}from"./line-d122782f.js";import{e as B}from"./time-3c9385c3.js";import{u as z}from"./AnalyticsStore-ba0e01a9.js";import"./point-ea70dc51.js";const $={name:"TenantAvgTokensToMasterSkillsHorizontalBarChart",props:["data","colour"],data(){return{padding:60}},mounted(){u("#tenant-avg-tokens-to-master-skills-chart-container");const a=25,t=0,l=0,n=10,h=200,o=1e3,i=Math.ceil((this.data.length+.1)*a)+t+n,r=v().domain([0,_(this.data,e=>e.quantity)]).range([h,o-l]),c=S().domain(C(this.data,e=>-e.quantity).map(e=>e.name)).rangeRound([t,i-n]).padding(.1),d=r.tickFormat(20),k=u("#tenant-avg-tokens-to-master-skills-chart-container").append("svg").attr("width",o).attr("height",i).attr("viewBox",[0,0,o,i]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");k.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",r(0)).attr("y",e=>c(e.name)).attr("width",e=>r(e.quantity)-r(0)).attr("height",c.bandwidth()),k.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",e=>r(e.quantity)).attr("y",e=>c(e.name)+c.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(e=>d(e.quantity)).call(e=>e.filter(y=>r(y.quantity)-r(0)<20).attr("dx",4).attr("fill","black").attr("text-anchor","start")),k.append("g").attr("transform",`translate(0,${t})`).call(b(r).ticks(0)).call(e=>e.select(".domain").remove()),k.append("g").attr("transform",`translate(${h},0)`).call(x(c).tickSizeOuter(0))},computed:{}},j={id:"tenant-avg-tokens-to-master-skills-chart-container"};function q(a,t,l,n,h,o){return p(),m("div",j)}const H=g($,[["render",q],["__scopeId","data-v-32411240"]]);const I={name:"TenantTokensPerSkillHorizontalBarChart",props:["data","colour"],data(){return{padding:60}},mounted(){u("#tenant-tokens-per-skill-chart-container");const a=25,t=0,l=0,n=10,h=200,o=1e3,i=Math.ceil((this.data.length+.1)*a)+t+n,r=v().domain([0,_(this.data,e=>e.quantity)]).range([h,o-l]),c=S().domain(C(this.data,e=>-e.quantity).map(e=>e.name)).rangeRound([t,i-n]).padding(.1),d=r.tickFormat(20),k=u("#tenant-tokens-per-skill-chart-container").append("svg").attr("width",o).attr("height",i).attr("viewBox",[0,0,o,i]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");k.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",r(0)).attr("y",e=>c(e.name)).attr("width",e=>r(e.quantity)-r(0)).attr("height",c.bandwidth()),k.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",e=>r(e.quantity)).attr("y",e=>c(e.name)+c.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(e=>d(e.quantity)).call(e=>e.filter(y=>r(y.quantity)-r(0)<20).attr("dx",4).attr("fill","black").attr("text-anchor","start")),k.append("g").attr("transform",`translate(0,${t})`).call(b(r).ticks(0)).call(e=>e.select(".domain").remove()),k.append("g").attr("transform",`translate(${h},0)`).call(x(c).tickSizeOuter(0))},computed:{}},R={id:"tenant-tokens-per-skill-chart-container"};function E(a,t,l,n,h,o){return p(),m("div",R)}const O=g(I,[["render",E],["__scopeId","data-v-75290b27"]]),N={name:"TenantTokensPerDayLineChart",props:["data","colour"],data(){return{padding:60}},mounted(){const a=this.data;u("#tenant-tokens-per-day-chart-container");const t=928,l=500,n=20,h=30,o=30,i=40,r=M(B(a,e=>e.date),[i,t-h]),c=v([0,_(a,e=>e.quantity)],[l-o,n]),d=A().x(e=>r(e.date)).y(e=>c(e.quantity)),k=u("#tenant-tokens-per-day-chart-container").append("svg").attr("width",t).attr("height",l).attr("viewBox",[0,0,t,l]).attr("style","max-width: 100%; height: auto; height: intrinsic;");k.append("g").attr("transform",`translate(0,${l-o})`).call(P(r).ticks(a.length/2).tickSizeOuter(0)),k.append("g").attr("transform",`translate(${i},0)`).call(x(c).ticks(l/80)).call(e=>e.selectAll(".tick line").clone().attr("x2",t-i-h).attr("stroke-opacity",.1)).call(e=>e.append("text").attr("x",-i).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text("â†‘ Tokens")),k.append("path").attr("fill","none").attr("stroke","#5f31dd").attr("stroke-width",1.5).attr("d",d(a))}},V={id:"tenant-tokens-per-day-chart-container"};function W(a,t,l,n,h,o){return p(),m("div",V)}const F=g(N,[["render",W]]);const U={setup(){const a=L(),t=z();return{userDetailsStore:a,analyticsStore:t}},components:{TenantAvgTokensToMasterSkillsHorizontalBarChart:H,TenantTokensPerSkillHorizontalBarChart:O,TenantTokensPerDayLineChart:F},data(){return{tenantId:this.userDetailsStore.tenantId,isDataWeekly:!1,isTutorialComplete:!1,showTutorialTip1:!1,dataMode:"total"}},async created(){await this.checkIfTutorialComplete(),await this.getAvgTokensToMasterSkills(),await this.getTotalTokensPerSkill(),await this.getTotalTokensPerDay()},methods:{async checkIfTutorialComplete(){const t=await(await fetch(`/users/check-tutorial-progress/school-report/${this.userDetailsStore.userId}`)).json();t==0?(this.isTutorialComplete=!1,this.showTutorialTip1=!0):t==1&&(this.isTutorialComplete=!0)},progressTutorial(a){a==1&&(this.showTutorialTip1=!1,this.markTutorialComplete())},restartTutorial(){this.isTutorialComplete=!1,this.showTutorialTip1=!0},markTutorialComplete(){let a="/users/mark-tutorial-complete/school-report/"+this.userDetailsStore.userId;fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"}})},async getAvgTokensToMasterSkills(){try{const a=await fetch(`/student-analytics/avg-tokens-to-master-skills/tenant/${this.tenantId}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const t=await a.json();this.analyticsStore.avgTokensToMasterSkills=Array.isArray(t)?t:[]}catch(a){console.error("Error fetching cohort mastered assessments:",a),this.analyticsStore.avgTokensToMasterSkills=[]}},async getTotalTokensPerSkill(){try{const a=await fetch(`/student-analytics/total-tokens-per-skill/tenant/${this.tenantId}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const t=await a.json();this.analyticsStore.totalTokensPerSkill=Array.isArray(t)?t:[]}catch(a){console.error("Error fetching cohort mastered assessments:",a),this.analyticsStore.totalTokensPerSkill=[]}},async getTotalTokensPerDay(){this.analyticsStore.totalTokensPerDay=[],fetch(`/student-analytics/tenant-tokens-per-day/${this.dataMode}/${this.tenantId}`).then(a=>a.json()).then(a=>{for(let t=0;t<a.length;t++)a[t].date=new Date(a[t].date);a.sort((t,l)=>t.date-l.date),this.analyticsStore.totalTokensPerDay=a}).catch(a=>{console.error("Error fetching student progress:",a)})},downloadData(a,t){const l=Object.keys(a[0]);console.log(l);const n=[];n.push(l.join(","));for(const r of a){const c=l.map(d=>{const k=r[d];return`"${String(k).replace(/"/g,'""')}"`});n.push(c.join(","))}const h=n.join(`
`),o=new Blob([h],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(o),i.download=t+".csv",i.click()},async toggleWeeklyCumulativeData(){this.dataMode=="total"?this.dataMode="weekly":this.dataMode="total",await this.getTotalTokensPerDay()}}},G={class:"container"},J={class:"d-flex justify-content-between w-100"},K={class:"btn-group d-flex d-sm-inline-flex mt-2",role:"group"},Q={key:0,class:"modal"},X={class:"modal-content"},Y={class:"d-flex justify-content-between"},Z={class:"row"},tt={class:"h4 heading d-flex justify-content-between"},et={key:1},at={class:"row"},st={class:"h4 heading d-flex justify-content-between"},ot={key:1},nt={class:"row"},rt={class:"h4 heading d-flex justify-content-between"},lt={key:1,class:"mb-5"};function it(a,t,l,n,h,o){const i=T("TenantTokensPerDayLineChart"),r=T("TenantAvgTokensToMasterSkillsHorizontalBarChart"),c=T("TenantTokensPerSkillHorizontalBarChart");return p(),m("div",G,[s("span",J,[t[10]||(t[10]=s("h1",{class:"heading"},"Cost Report",-1)),s("span",null,[s("div",K,[s("input",{type:"radio",class:"btn-check",name:"timeFilter1",id:"total1",onClick:t[0]||(t[0]=(...d)=>o.toggleWeeklyCumulativeData&&o.toggleWeeklyCumulativeData(...d)),checked:""}),t[7]||(t[7]=s("label",{class:"btn btn-outline-dark btn-sm filter-btn",for:"total1"},"Total",-1)),s("input",{type:"radio",class:"btn-check",name:"timeFilter1",id:"week1",onClick:t[1]||(t[1]=(...d)=>o.toggleWeeklyCumulativeData&&o.toggleWeeklyCumulativeData(...d))}),t[8]||(t[8]=s("label",{class:"btn btn-outline-dark btn-sm filter-btn",for:"week1"},"This week",-1))]),s("button",{class:"btn me-1",onClick:t[2]||(t[2]=(...d)=>o.restartTutorial&&o.restartTutorial(...d)),"aria-label":"info"},t[9]||(t[9]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 192 512",width:"20",height:"23",class:"primary-icon"},[s("path",{d:"M48 80a48 48 0 1 1 96 0A48 48 0 1 1 48 80zM0 224c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224 32 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0 0-192-32 0c-17.7 0-32-14.3-32-32z"})],-1)]))])]),h.showTutorialTip1?(p(),m("div",Q,[s("div",X,[t[11]||(t[11]=s("p",{class:"modal-text"}," The Cost Report provides comprehensive analytics on AI token usage and associated costs across your school. Track daily token consumption, average tokens required to master each skill, and total tokens spent per skill. All chart data can be downloaded as CSV files using the download buttons, and you can toggle between total (cumulative) and weekly data views using the filter buttons at the top right. ",-1)),s("div",Y,[s("button",{class:"btn primary-btn",onClick:t[3]||(t[3]=d=>o.progressTutorial(1))}," close ")])])])):D("",!0),s("div",Z,[s("h2",tt,[t[13]||(t[13]=f(" Tokens spent per day ",-1)),s("button",{class:"btn",onClick:t[4]||(t[4]=d=>o.downloadData(n.analyticsStore.totalTokensPerDay,"Tokens-per-day"))},t[12]||(t[12]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"18",height:"18"},[s("path",{d:"M0 64C0 28.7 28.7 0 64 0L213.5 0c17 0 33.3 6.7 45.3 18.7L365.3 125.3c12 12 18.7 28.3 18.7 45.3L384 448c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zm208-5.5l0 93.5c0 13.3 10.7 24 24 24L325.5 176 208 58.5zM175 441c9.4 9.4 24.6 9.4 33.9 0l64-64c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-23 23 0-86.1c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 86.1-23-23c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64z"})],-1)]))]),n.analyticsStore.totalTokensPerDay.length>0?(p(),w(i,{key:0,data:n.analyticsStore.totalTokensPerDay,colour:"#5f31dd",class:"mb-5"},null,8,["data"])):(p(),m("p",et,"No data yet")),t[14]||(t[14]=s("p",null,[s("em",null,"Please note recording of tokens per skill stops after student mastery of that skill")],-1))]),t[19]||(t[19]=s("hr",{class:"mt-5 mb-5"},null,-1)),s("div",at,[s("h2",st,[t[16]||(t[16]=f(" Average number of tokens spent to master a skill ",-1)),s("button",{class:"btn",onClick:t[5]||(t[5]=d=>o.downloadData(n.analyticsStore.avgTokensToMasterSkills,"Avg-tokens-to-master-skill"))},t[15]||(t[15]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"18",height:"18"},[s("path",{d:"M0 64C0 28.7 28.7 0 64 0L213.5 0c17 0 33.3 6.7 45.3 18.7L365.3 125.3c12 12 18.7 28.3 18.7 45.3L384 448c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zm208-5.5l0 93.5c0 13.3 10.7 24 24 24L325.5 176 208 58.5zM175 441c9.4 9.4 24.6 9.4 33.9 0l64-64c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-23 23 0-86.1c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 86.1-23-23c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64z"})],-1)]))]),n.analyticsStore.avgTokensToMasterSkills.length>0?(p(),w(r,{key:0,data:n.analyticsStore.avgTokensToMasterSkills,colour:"darkgreen"},null,8,["data"])):(p(),m("p",ot,"No data yet"))]),t[20]||(t[20]=s("hr",{class:"mt-5 mb-5"},null,-1)),s("div",nt,[s("h2",rt,[t[18]||(t[18]=f(" Tokens spent per skill ",-1)),s("button",{class:"btn",onClick:t[6]||(t[6]=d=>o.downloadData(n.analyticsStore.totalTokensPerSkill,"Tokens-per-skill"))},t[17]||(t[17]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"18",height:"18"},[s("path",{d:"M0 64C0 28.7 28.7 0 64 0L213.5 0c17 0 33.3 6.7 45.3 18.7L365.3 125.3c12 12 18.7 28.3 18.7 45.3L384 448c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zm208-5.5l0 93.5c0 13.3 10.7 24 24 24L325.5 176 208 58.5zM175 441c9.4 9.4 24.6 9.4 33.9 0l64-64c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-23 23 0-86.1c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 86.1-23-23c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64z"})],-1)]))]),n.analyticsStore.totalTokensPerSkill.length>0?(p(),w(c,{key:0,data:n.analyticsStore.totalTokensPerSkill,colour:"#5f31dd",class:"mb-5"},null,8,["data"])):(p(),m("p",lt,"No data yet"))])])}const wt=g(U,[["render",it],["__scopeId","data-v-dfc31171"]]);export{wt as default};
