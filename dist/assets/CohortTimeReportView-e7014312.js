import{u as q}from"./CohortsStore-1aaea8df.js";import{_ as w,o as h,c as m,e as A,r as p,a as u,t as b,j as f,f as g,k as S,b as $}from"./main-c88d736d.js";import{D as v}from"./downloadCSVBtn-21d059b9.js";import{C as j}from"./CohortDurationPerDayLineChart-f81ae37c.js";import"./transform-4d0f7c8f.js";import{l as k,a as C,b as _}from"./linear-d9b6cbf2.js";import{m as x}from"./continuous-93813e6c.js";import{b as T}from"./band-2263c9e7.js";import{s as P}from"./sort-fcaf8f38.js";import{s as D}from"./string-c67ea49d.js";import"./line-d122782f.js";import"./time-3c9385c3.js";import"./point-ea70dc51.js";const M={name:"CohortCompareDurationHorizontalChart",props:["data","colour"],data(){return{padding:60}},mounted(){D("#cohort-compare-duration-chart-container");const e=25,t=0,r=0,c=10,a=200,d=1e3,i=Math.ceil((this.data.length+.1)*e)+t+c,n=k().domain([0,x(this.data,o=>o.quantity)]).range([a,d-r]),s=T().domain(P(this.data,o=>-o.quantity).map(o=>o.name)).rangeRound([t,i-c]).padding(.1);n.tickFormat(20);const l=D("#cohort-compare-duration-chart-container").append("svg").attr("width",d).attr("height",i).attr("viewBox",[0,0,d,i]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");l.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",n(0)).attr("y",o=>s(o.name)).attr("width",o=>n(o.quantity)-n(0)).attr("height",s.bandwidth()),l.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",o=>n(o.quantity)).attr("y",o=>s(o.name)+s.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(o=>o.formattedQuantity).call(o=>o.filter(y=>n(y.quantity)-n(0)<20).attr("dx",4).attr("fill","black").attr("text-anchor","start")),l.append("g").attr("transform",`translate(0,${t})`).call(C(n).ticks(0)).call(o=>o.select(".domain").remove()),l.append("g").attr("transform",`translate(${a},0)`).call(_(s).tickSizeOuter(0))}},B={id:"cohort-compare-duration-chart-container"};function N(e,t,r,c,a,d){return h(),m("div",B)}const I=w(M,[["render",N]]),z={name:"CohortDurationPerSkillHorizontalBarChart",props:["data","colour"],data(){return{padding:60}},mounted(){D("#cohort-duration-per-skill-chart-container");const e=25,t=0,r=0,c=10,a=200,d=1e3,i=Math.ceil((this.data.length+.1)*e)+t+c,n=k().domain([0,x(this.data,o=>o.quantity)]).range([a,d-r]),s=T().domain(P(this.data,o=>-o.quantity).map(o=>o.name)).rangeRound([t,i-c]).padding(.1);n.tickFormat(20);const l=D("#cohort-duration-per-skill-chart-container").append("svg").attr("width",d).attr("height",i).attr("viewBox",[0,0,d,i]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");l.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",n(0)).attr("y",o=>s(o.name)).attr("width",o=>n(o.quantity)-n(0)).attr("height",s.bandwidth()),l.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",o=>n(o.quantity)).attr("y",o=>s(o.name)+s.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(o=>o.formattedQuantity).call(o=>o.filter(y=>n(y.quantity)-n(0)<40).attr("dx",4).attr("fill","black").attr("text-anchor","start")),l.append("g").attr("transform",`translate(0,${t})`).call(C(n).ticks(0)).call(o=>o.select(".domain").remove()),l.append("g").attr("transform",`translate(${a},0)`).call(_(s).tickSizeOuter(0))},computed:{}},H={id:"cohort-duration-per-skill-chart-container"};function L(e,t,r,c,a,d){return h(),m("div",H)}const Q=w(z,[["render",L]]),V={setup(){const e=q(),t=A();return{cohortsStore:e,userDetailsStore:t}},components:{CohortDurationPerDayLineChart:j,CohortCompareDurationHorizontalChart:I,CohortDurationPerSkillHorizontalBarChart:Q,DownloadCSVBtn:v},data(){return{cohortId:this.$route.params.cohortId,cohortName:"",durationsPerDay:[],studentTotalDurations:[],studentDurationsPerSkill:[],durationsPerDayDownloadData:[],studentTotalDurationsDownloadData:[],studentDurationsPerSkillDownloadData:[]}},async created(){this.cohortsStore.cohorts.length<1&&await this.cohortsStore.getCohorts(this.userDetailsStore.userId);const e=this.cohortsStore.cohorts.find(t=>t.id==this.cohortId);e&&(this.cohortName=e.name),this.cohortId!="all-students"?(await this.getCohortDurationPerDay(),await this.getCohortStudentTotalDurations(),await this.getCohortDurationsPerSkill()):(await this.getAllStudentsDurationPerDay(),await this.getAllStudentsStudentTotalDurations(),await this.getAllStudentsDurationsPerSkill())},methods:{async getCohortDurationPerDay(){fetch(`/student-analytics/cohort-duration-per-day/${this.cohortId}`).then(e=>e.json()).then(e=>{for(let t=0;t<e.length;t++)e[t].formattedQuantity=e[t].quantity/(1e3*60),e[t].date=new Date(e[t].date);e.sort((t,r)=>t.date-r.date),this.durationsPerDay=e,this.durationsPerDayDownloadData=e.map(t=>({date:new Date(t.date).toLocaleDateString(),minutesSpent:this.millisToMinutesAndSeconds(t.quantity)}))}).catch(e=>{console.error("Error fetching student duration per day:",e)})},async getAllStudentsDurationPerDay(){fetch(`/student-analytics/all-students-duration-per-day/${this.userDetailsStore.userId}`).then(e=>e.json()).then(e=>{for(let t=0;t<e.length;t++)e[t].formattedQuantity=e[t].quantity/(1e3*60),e[t].date=new Date(e[t].date);e.sort((t,r)=>t.date-r.date),this.durationsPerDay=e,this.durationsPerDayDownloadData=e.map(t=>({date:new Date(t.date).toLocaleDateString(),minutesSpent:this.millisToMinutesAndSeconds(t.quantity)}))}).catch(e=>{console.error("Error fetching student duration per day:",e)})},async getCohortStudentTotalDurations(){fetch(`/student-analytics/cohort-total-durations/${this.cohortId}`).then(e=>e.json()).then(e=>{for(let t=0;t<e.length;t++)e[t].formattedQuantity=this.millisToMinutesAndSeconds(e[t].quantity),e[t].date=new Date(e[t].date);e.sort((t,r)=>t.date-r.date),this.studentTotalDurations=e,this.studentTotalDurationsDownloadData=e.map(t=>({studentName:t.name,minutesSpent:this.millisToMinutesAndSeconds(t.quantity)}))}).catch(e=>{console.error("Error fetching student duration per day:",e)})},async getAllStudentsStudentTotalDurations(){fetch(`/student-analytics/all-students-total-durations/${this.userDetailsStore.userId}`).then(e=>e.json()).then(e=>{for(let t=0;t<e.length;t++)e[t].formattedQuantity=this.millisToMinutesAndSeconds(e[t].quantity),e[t].date=new Date(e[t].date);e.sort((t,r)=>t.date-r.date),this.studentTotalDurations=e,this.studentTotalDurationsDownloadData=e.map(t=>({studentName:t.name,minutesSpent:this.millisToMinutesAndSeconds(t.quantity)}))}).catch(e=>{console.error("Error fetching student duration per day:",e)})},async getCohortDurationsPerSkill(){fetch(`/student-analytics/cohort-student-durations-per-skill/${this.cohortId}`).then(e=>e.json()).then(e=>{for(let t=0;t<e.length;t++)e[t].formattedQuantity=this.millisToMinutesAndSeconds(e[t].quantity);this.studentDurationsPerSkill=e,this.studentDurationsPerSkillDownloadData=e.map(t=>({skill:t.name,minutesSpent:this.millisToMinutesAndSeconds(t.quantity)}))}).catch(e=>{console.error("Error fetching student durations per skill:",e)})},async getAllStudentsDurationsPerSkill(){fetch(`/student-analytics/all-students-student-durations-per-skill/${this.userDetailsStore.userId}`).then(e=>e.json()).then(e=>{for(let t=0;t<e.length;t++)e[t].formattedQuantity=this.millisToMinutesAndSeconds(e[t].quantity);this.studentDurationsPerSkill=e,this.studentDurationsPerSkillDownloadData=e.map(t=>({skill:t.name,minutesSpent:this.millisToMinutesAndSeconds(t.quantity)}))}).catch(e=>{console.error("Error fetching student durations per skill:",e)})},millisToMinutesAndSeconds(e){var t=Math.floor(e/6e4),r=(e%6e4/1e3).toFixed(0);return t+":"+(r<10?"0":"")+r}}},E={class:"container"},R={class:"d-flex justify-content-between w-100"},F={class:"secondary-heading h3"},O={class:"secondary-heading d-flex justify-content-between"},U={key:1},G={class:"secondary-heading mt-4 d-flex justify-content-between"},J={key:1},K={class:"secondary-heading mt-4 d-flex justify-content-between"};function W(e,t,r,c,a,d){const i=p("DownloadCSVBtn"),n=p("CohortDurationPerDayLineChart"),s=p("CohortCompareDurationHorizontalChart"),l=p("CohortDurationPerSkillHorizontalBarChart");return h(),m("div",E,[u("span",R,[t[0]||(t[0]=u("h1",{class:"heading"},"Time Report",-1)),u("h2",F,b(a.cohortName),1)]),u("div",null,[u("h4",O,[t[1]||(t[1]=f(" Total time on platform per day ",-1)),g(i,{data:a.durationsPerDayDownloadData,fileName:"Total time on platform per day"},null,8,["data"])]),a.durationsPerDay.length>0?(h(),S(n,{key:0,data:a.durationsPerDay,class:"mb-5"},null,8,["data"])):(h(),m("p",U,"No time recorded yet"))]),u("div",null,[u("h4",G,[t[2]||(t[2]=f(" Total time on platform, comparing students ",-1)),g(i,{data:a.studentTotalDurationsDownloadData,fileName:"Total time on platform, comparing students"},null,8,["data"])]),a.studentTotalDurations.length>0?(h(),S(s,{key:0,data:a.studentTotalDurations,colour:"#5f31dd",class:"mb-5"},null,8,["data"])):(h(),m("p",J,"No time recorded yet"))]),u("div",null,[u("h4",K,[t[3]||(t[3]=f(" Minutes per skill ",-1)),g(i,{data:a.studentDurationsPerSkillDownloadData,fileName:"Minutes per skill"},null,8,["data"])]),a.studentDurationsPerSkill.length>0?(h(),S(l,{key:0,data:a.studentDurationsPerSkill,class:"mb-5",colour:"#5f31dd"},null,8,["data"])):$("",!0)])])}const ut=w(V,[["render",W]]);export{ut as default};
