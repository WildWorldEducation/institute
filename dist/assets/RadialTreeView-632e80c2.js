import{_ as F,a as O,u as U,r as z,o as p,c as f,b as C,w as b,v as V,d as r,e as j,n as q,F as S,p as E,f as W,i as P,j as M,k as I,l as X,m as L,S as Z,q as D}from"./main-c97150b9.js";import{S as G,z as Y,s as y,t as R,h as N,a as J,b as A,c as K,i as $}from"./zoom-b36126a2.js";const Q={setup(){const t=O(),e=U();return{userDetailsStore:t,skillTreeStore:e}},data(){return{width:6e3,height:null,radius:0,radiusMultiplier:96,skill:{id:null,children:[],isMastered:null,isUnlocked:null,container:null,name:null,description:null,tagIDs:[],sprite:null,type:null,subskills:[]},tree:{},root:{},context:{},hiddenCanvasContext:{},scaleMultiplier:.8,startDragOffset:{x:0,y:0},mouseDown:!1,nodes:[],nextCol:1,colToNode:{},isSkillInfoPanelShown:!1,scale:1,panX:0,panY:0,d3Zoom:null,data:{},isLoading:!0,xPos:0,yPos:0,showAnimation:!1,showSkillPanel:!1,userAvatarImg:null,currentZoom:1,resultNode:null}},components:{SkillPanel:G},async mounted(){this.skillTreeStore.userSkillsSubSkillsSeparate.length==0&&await this.skillTreeStore.getUserSkillsSubSkillsSeparate(),this.width=window.innerWidth,this.height=window.innerHeight,this.radius=Math.min(this.width,this.height)/2-30,this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkillsSubSkillsSeparate.skills},this.userAvatarImg=new Image,this.userAvatarImg.src=this.userDetailsStore.avatar,this.userAvatarImg.onload=()=>{this.getAlgorithm(),this.d3Zoom=Y().scaleExtent([.05,8]).on("zoom",({transform:t})=>{this.currentZoom=t.k,this.zoomed(t)}),y(this.context.canvas).call(this.d3Zoom),this.defaultPosition()},canvas.addEventListener("click",async t=>{this.nodes;var e=t.layerX,n=t.layerY;this.xPos=e,this.yPos=n,this.showAnimation=!0,setTimeout(()=>{this.showAnimation=!1},500);var o=this.hiddenCanvasContext,l=o.getImageData(e,n,1,1).data,s="rgb("+l[0]+","+l[1]+","+l[2]+")",h=this.colToNode[s];if(h){h.renderCol=h.__pickColor,this.skill.name=h.data.skill_name,this.skill.id=h.data.id,this.skill.type=h.data.type,this.skill.subskills=h.data.subskills;const i=await(await fetch("/skills/mastery-requirements-and-url/"+this.skill.id)).json();this.skill.masteryRequirements=i.mastery_requirements,this.skill.url=i.url,this.showSkillPanel=!0}}),this.isLoading=!1},methods:{getAlgorithm(){var t=[];t=JSON.parse(JSON.stringify(this.skill.children)),this.data={skill_name:"",children:t};const e=this.skillTreeStore.userSkillsSubSkillsSeparate.count;e>2e3?this.radiusMultiplier=96:e>1e3?this.radiusMultiplier=32:this.radiusMultiplier=6;const n=R().size([2*Math.PI,this.radius*this.radiusMultiplier]).separation((s,h)=>(s.parent==h.parent?1:2)/s.depth);this.root=n(N(this.data).sort((s,h)=>J(s.data.name,h.data.name)));var o=document.getElementById("canvas");o.width=this.width,o.height=this.height,this.context=o.getContext("2d"),this.context.fillStyle="#1e293b",this.context.fillRect(0,0,this.width,this.height);let l=document.getElementById("hidden-canvas");this.hiddenCanvasContext=l.getContext("2d",{willReadFrequently:!0}),l.style.display="none",this.context.translate(this.width/2,this.height/2),this.hiddenCanvasContext.translate(this.width/2,this.height/2),this.drawTree()},drawTree(){this.nodes=this.root.descendants();const t=this.root.links();this.context.beginPath();for(const e of t)this.drawLink(e);this.context.beginPath();for(const e of this.nodes)e.renderCol?this.context.fillStyle=e.renderCol:this.context.fillStyle="RGBA(105, 105, 105, 0.8)",e.__pickColor===void 0&&(e.__pickColor=this.genColor(),this.colToNode[e.__pickColor]=e),this.hiddenCanvasContext.fillStyle=e.__pickColor,this.drawNode(e);this.context.fillStyle="transparent",this.context.save(),this.context.beginPath(),this.context.moveTo(0,0),this.context.arc(0,0,20,0,2*Math.PI),this.context.stroke(),this.context.clip(),this.context.drawImage(this.userAvatarImg,-20,-20,40,40),this.context.restore()},rotateNode(t,e,n,o,l){var s=Math.PI/180*l,h=Math.cos(s),a=Math.sin(s),i=h*(n-t)+a*(o-e)+t,d=h*(o-e)-a*(n-t)+e;return[i,d]},drawNode(t){var v;let e=this.context,n=this.hiddenCanvasContext,o=Math.cos(t.x)*t.y,l=Math.sin(t.x)*t.y,s=h(0,0,o,l,90);function h(c,u,g,_,x){var m=Math.PI/180*x,k=Math.cos(m),T=Math.sin(m),H=k*(g-c)+T*(_-u)+c,B=k*(_-u)-T*(g-c)+u;return[H,B]}let a;t.data.type=="domain"?a="black":t.data.level=="grade_school"?a="#40E0D0":t.data.level=="middle_school"?a="#33A133":t.data.level=="high_school"?a="#FFD700":t.data.level=="college"?a="#FFA500":t.data.level=="phd"&&(a="#FF0000");let i;t.depth==1?i=20:i=10,t.data.type!=="domain"&&(e.beginPath(),e.moveTo(s[0],s[1]),e.arc(s[0],s[1],i,0,2*Math.PI),e.fillStyle=a,e.fill());function d(c,u,g,_){var x=_-u,m=g-c,k=Math.atan2(x,m);return k}var d=d(0,0,s[0],s[1]);if(this.scale>.6){e.save(),e.translate(s[0],s[1]),e.rotate(d);let c=0,u=0;2*Math.PI/3>Math.abs(d)>=Math.PI/3?(u=s[0]>0?15:-15,c=0):(c=s[0]>0?15:-15,u=0);let g=t.data.skill_name;t.data.skill_name===((v=this.resultNode)==null?void 0:v.data.skill_name)&&(g="▶ "+g+" ◀"),s[0]<0?(e.textAlign=t.data.level!=="domain"?"end":"start",e.rotate(Math.PI)):e.textAlign=t.data.level!=="domain"?"start":"end",e.strokeStyle="#1e293b",e.lineWidth=4,e.strokeText(t.data.skill_name,c,u),e.fillStyle=this.textFillColor(t.data.skill_name,t.data.level),e.fillText(g,c,u),e.restore()}if(n.beginPath(),n.moveTo(s[0],s[1]),n.arc(s[0],s[1],i,0,2*Math.PI),n.fill(),t.data.type=="super")for(let c=0;c<t.data.subskills.length;c++){let x=360/t.data.subskills.length*c*Math.PI/180,m=20*Math.cos(x),k=20*Math.sin(x);e.beginPath(),e.moveTo(s[0],s[1]),e.arc(s[0]+m,s[1]+k,5,0,2*Math.PI),e.fillStyle=a,e.fill(),n.beginPath(),n.moveTo(s[0],s[1]),n.arc(s[0]+m,s[1]+k,5,0,2*Math.PI),n.fill()}},textFillColor(t,e){var n;return t===((n=this.resultNode)==null?void 0:n.data.skill_name)?"#FFAE00":e==="domain"?"#FFF":"#afb9c9"},drawLink(t){const e=A().angle(o=>o.x).radius(o=>o.y).context(this.context);let n="#71717a";t.target.data.is_mastered==1?(this.context.lineWidth=4+parseInt(3*(1/this.currentZoom)),n="#ffffff"):this.context.lineWidth=parseInt(3*(1/this.currentZoom)),this.context.beginPath(),e(t),this.context.strokeStyle=n,this.context.stroke()},genColor(){var t=[];this.nextCol<16777215&&(t.push(this.nextCol&255),t.push((this.nextCol&65280)>>8),t.push((this.nextCol&16711680)>>16),this.nextCol+=100);var e="rgb("+t.join(",")+")";return e},zoomed(t){this.scale=t.k,this.context.save(),this.hiddenCanvasContext.save(),this.context.fillStyle="#1e293b",this.context.fillRect(this.width/2*-1,this.height/2*-1,this.width,this.height),this.hiddenCanvasContext.clearRect(this.width/2*-1,this.height/2*-1,this.width,this.height),this.context.translate(t.x-this.width/2,t.y-this.height/2),this.context.scale(t.k,t.k),this.hiddenCanvasContext.translate(t.x-this.width/2,t.y-this.height/2),this.hiddenCanvasContext.scale(t.k,t.k),this.drawTree(),this.context.fill(),this.context.restore(),this.hiddenCanvasContext.fill(),this.hiddenCanvasContext.restore()},async printPDF(){await this.getPrintAlgorithm();var t=document.getElementById("radialTree"),e=y(t),n=e.node(),o=new XMLSerializer,l=o.serializeToString(n),s={svg:l,treeType:"radial"},h=JSON.stringify(s),a=new XMLHttpRequest;a.responseType="arraybuffer",a.open("POST","/skilltree/print-pdf",!0),a.setRequestHeader("Content-type","application/json;charset=UTF-8"),a.setRequestHeader("Accept","application/json, text/plain, */*"),a.send(h),a.onload=function(){if(this.readyState==4&&this.status==200){let d=new Blob([a.response],{type:"application/pdf"});const v=window.URL.createObjectURL(d);var i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=v,i.download="My-Skill-Tree.pdf",i.click(),window.URL.revokeObjectURL(v)}}},async getPrintAlgorithm(){await this.skillTreeStore.getUserSkills();const t={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills};var e=[];e=JSON.parse(JSON.stringify(t.children));function n(l){for(var s=l.length;s--;){if(l[s].type=="super"&&l[s].position!="end"){var h=[],a=[];for(let d=0;d<l[s].children.length;d++)l[s].children[d].type=="sub"?h.push(l[s].children[d]):a.push(l[s].children[d]);var i={skill_name:l[s].skill_name,type:"super",position:"end",children:h};l[s].children=[],l[s].children.push(i);for(let d=0;d<a.length;d++)l[s].children.push(a[d])}typeof l[s]<"u"&&l[s].children&&Array.isArray(l[s].children)&&l[s].children.length>0&&n(l[s].children)}}n(e);const o={skill_name:"My skills",children:e};await this.createSVGTree(o)},async createSVGTree(t){const o=13200.000000000002,l=24e3*.59,h=R().size([2*Math.PI,this.radius*50]).separation((i,d)=>(i.parent==d.parent?1:2)/i.depth)(N(t));let a=K("svg").attr("id","radialTree").attr("width",24e3).attr("height",24e3).attr("viewBox",[-o,-l,24e3,24e3]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");a.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(h.links()).join("path").attr("d",A().angle(i=>i.x).radius(i=>i.y)).attr("stroke",function(i){return"#000"}).attr("stroke-width",function(i){return i.target.data.is_mastered==1?4:1.5}).style("stroke-dasharray",function(i){if(i.source.data.type=="super"&&i.target.data.position=="end"||i.target.data.type=="sub")return 5}),a.append("g").selectAll().data(h.descendants()).join("circle").attr("transform",i=>`rotate(${i.x*180/Math.PI-90}) translate(${i.y},0)`).attr("fill","#000").attr("r",2.5),a.append("g").attr("stroke-linejoin","round").attr("stroke-width",1).selectAll().data(h.descendants()).join("text").attr("transform",i=>`rotate(${i.x*180/Math.PI-90}) translate(${i.y},0) rotate(${i.x>=Math.PI?180:0})`).attr("dy","0.31em").attr("x",i=>i.x<Math.PI==!i.children?6:-6).attr("text-anchor",i=>i.x<Math.PI==!i.children?"start":"end").style("font-weight",function(i){return i.data.type=="super"?"700":"400"}).style("font-style",function(i){if(i.data.type=="sub")return"italic"}).style("paint-order",function(i){return"stroke"}).clone(!0).lower().style("stroke-width",function(i){return"1px"}).text(function(i){return i.data.position=="end"?"":i.data.skill_name}),document.querySelector("#SVGskilltree").append(a.node())},defaultPosition(){y(this.context.canvas).transition().duration(300).call(this.d3Zoom.transform,$.translate(this.width/2,this.height/2).scale(.5))},findNodeWithName(t){let e=[];return this.root.each(function(n){t.length<3?n.data.skill_name.toLowerCase().substring(0,t.length)===t&&e.push(n):n.data.skill_name.toLowerCase().includes(t)&&e.push(n)}),e},goToLocation(t){const e=this.$refs.wrapper.clientHeight,n=this.$refs.wrapper.clientWidth,o=n>480?1.75:1.45,l=n>480?2:2.3,s=2;this.resultNode=t;let h=Math.cos(t.x)*t.y,a=Math.sin(t.x)*t.y,i=this.rotateNode(0,0,h,a,90);const d=-i[0]*o+n/s,v=-i[1]*o+e/l;y(this.context.canvas).transition().duration(2e3).call(this.d3Zoom.transform,$.translate(d,v).scale(o))}}},w=t=>(E("data-v-550c2d4e"),t=t(),W(),t),tt={key:0,class:"loading-animation d-flex justify-content-center align-items-center py-4"},et=w(()=>r("span",{class:"loader"},null,-1)),st=[et],it={id:"wrapper",ref:"wrapper"},lt=w(()=>r("canvas",{id:"canvas",width:"1500",height:"1500"},null,-1)),at=w(()=>r("canvas",{id:"hidden-canvas",width:"1500",height:"1500"},null,-1)),nt=w(()=>r("div",{id:"SVGskilltree"},null,-1)),ot=w(()=>r("div",{id:"sidepanel-backdrop"},null,-1));function rt(t,e,n,o,l,s){const h=z("SkillPanel");return p(),f(S,null,[l.isLoading==!0?(p(),f("div",tt,st)):C("",!0),b(r("div",it,[j(h,{skill:l.skill,showSkillPanel:l.showSkillPanel},null,8,["skill","showSkillPanel"]),l.showAnimation?(p(),f("div",{key:0,style:q({top:`${l.yPos}px`,left:`${l.xPos}px`}),class:"click-animation"},null,4)):C("",!0),lt,at,nt,ot],512),[[V,l.isLoading==!1]])],64)}const ht=F(Q,[["render",rt],["__scopeId","data-v-550c2d4e"]]);const dt={setup(){},data(){return{searchText:"",lastChooseResult:""}},components:{RadialTree:ht},methods:{handleChooseResult(t){this.searchText=t.data.skill_name,this.lastChooseResult=t.data.skill_name,this.$refs.childComponent.goToLocation(t)}},computed:{findNodeResults(){if(this.lastChooseResult===this.searchText)return[];if(this.searchText.length>0){this.$refs.childComponent.showSkillPanel=!1;const t=this.$refs.childComponent.findNodeWithName(this.searchText.toLocaleLowerCase()),e=(o,l)=>o&&o.slice(0,l)+o[l].toUpperCase()+o.slice(l+1);return t.map(o=>{const l=o.data.skill_name.toLocaleLowerCase().replace(this.searchText.toLocaleLowerCase(),`<span class="hightLight">${this.searchText}</span>`),s=l[0]==="<"?25:0;return{...o,highlightedResult:e(l,s)}})}else return[]}},watch:{searchText:{handler(t){t===""&&(this.$refs.childComponent.showSkillPanel=!1,this.$refs.childComponent.defaultPosition())}}}},ct={id:"legend",class:"collapsible-tree-legend container-fluid p-2 position-relative"},ut={class:"position-absolute legend-div"},pt={class:"mobile-legend"},ft={class:"legend row"},gt=D('<div class="col-8"><div class="col"><span class="grade-school"></span>Grade school </div><div class="col"><span class="middle-school"></span> Middle school </div><div class="col"><span class="high-school"></span> High school </div><div class="col"><span class="college"></span> College </div><div class="col"><span class="phd"></span> PHD</div></div>',1),vt={class:"col-4 d-flex flex-column align-items-end"},mt={class:"search-mobile-row"},kt={class:"d-flex align-items-center p-1"},xt=r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"15",height:"15",fill:"#5f6368",class:"me-2"},[r("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"})],-1),_t={class:"position-relative"},wt={key:0,class:"search-results"},yt=["onClick","innerHTML"],St={class:"tablet-and-up-legend"},Ct={class:"legend row"},bt=D('<div class="col d-flex align-items-center"><span class="grade-school"></span>Grade school </div><div class="col d-flex align-items-center"><span class="middle-school"></span> Middle school </div><div class="col d-flex align-items-center"><span class="high-school"></span> High school </div><div class="col d-flex align-items-center"><span class="college"></span> College </div><div class="col d-flex align-items-center"><span class="phd"></span> PHD </div>',5),Tt={class:"col-12 col-lg-4 d-flex justify-content-end align-items-center gap-2 mt-0 mt-md-2 mt-lg-0"},Pt={class:"d-flex align-items-center p-1"},Mt=r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"15",height:"15",fill:"#5f6368",class:"me-2"},[r("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"})],-1),It={class:"position-relative"},Lt={key:0,class:"search-results"},Rt=["onClick","innerHTML"],Nt=r("div",{id:"thin-purple-banner"},null,-1),At=r("span",null,"Loading...",-1);function $t(t,e,n,o,l,s){const h=z("RadialTree");return p(),f(S,null,[r("div",ct,[r("div",ut,[r("div",pt,[r("div",ft,[gt,r("div",vt,[r("button",{id:"print-btn",class:"btn btn-info",onClick:e[0]||(e[0]=a=>t.$refs.childComponent.printPDF())}," Print "),r("button",{id:"reset-btn",class:"btn btn-primary",onClick:e[1]||(e[1]=a=>t.resetPos())}," Reset ")])]),r("div",mt,[r("div",{class:P(["search-bar mt-2 ms-2 pe-3",s.findNodeResults.length>0&&"have-results"])},[r("div",kt,[xt,b(r("input",{id:"skill-tree-search-text",type:"text",class:"skill-tree-input",placeholder:"Skill Name","onUpdate:modelValue":e[2]||(e[2]=a=>l.searchText=a)},null,512),[[M,l.searchText]])]),r("div",_t,[s.findNodeResults.length?(p(),f("div",wt,[(p(!0),f(S,null,I(s.findNodeResults,a=>(p(),f("button",{onClick:i=>s.handleChooseResult(a),class:"result-row",innerHTML:a.highlightedResult},null,8,yt))),256))])):C("",!0)])],2)])]),r("div",St,[r("div",Ct,[bt,r("div",Tt,[r("div",{class:P(["search-bar w-100",s.findNodeResults.length>0&&"have-results"])},[r("div",Pt,[Mt,b(r("input",{id:"skill-tree-search-text",type:"text",class:"skill-tree-input",placeholder:"Skill Name","onUpdate:modelValue":e[3]||(e[3]=a=>l.searchText=a)},null,512),[[M,l.searchText]])]),r("div",It,[s.findNodeResults.length?(p(),f("div",Lt,[(p(!0),f(S,null,I(s.findNodeResults,a=>(p(),f("button",{onClick:i=>s.handleChooseResult(a),class:"result-row",innerHTML:a.highlightedResult},null,8,Rt))),256))])):C("",!0)])],2),r("button",{id:"print-btn",class:"btn btn-info me-3",onClick:e[4]||(e[4]=a=>t.$refs.childComponent.printPDF())}," Print ")])])])])]),Nt,(p(),X(Z,null,{default:L(()=>[j(h,{ref:"childComponent"},null,512)]),fallback:L(()=>[At]),_:1}))],64)}const jt=F(dt,[["render",$t]]);export{jt as default};
