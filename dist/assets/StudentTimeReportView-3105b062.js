import{_ as f,y as S,e as g,r as u,o as h,c as p,a as r,t as y,f as m,j as v,p as D}from"./main-617fe1f8.js";import{u as _}from"./TeacherAnalyticsStore-6d9f7780.js";import{u as w}from"./AnalyticsStore-06d39a3a.js";import"./transform-af9a74a2.js";import{b as A,m as b}from"./continuous-7328829e.js";import{l as x,b as k}from"./linear-5b188edc.js";import{s as C}from"./string-dd82ab4a.js";import{S as N}from"./StudentDurationPerDayLineChart-d79a96e8.js";import{D as P}from"./downloadCSVBtn-27304e1b.js";import"./line-85f04100.js";import"./time-0457d93b.js";import"./point-ea70dc51.js";const T={name:"StudentSkillActivityChart",methods:{createChart(a){if(!a||a.length===0){console.warn("No data available for the chart");return}const e=20,s=document.getElementById("activity-chart-container").clientWidth,i=e*a.length+50,t={top:20,right:0,bottom:20,left:200},o=C("#activity-chart-container").append("svg").attr("width","100%").attr("height","100%").attr("viewBox",[0,0,s,i]).attr("preserveAspectRatio","xMinYMin").append("g").attr("transform",`translate(${t.left},${t.top})`),l=A().domain(a.map(n=>n.name)).range([0,i-35]).padding(.2),c=x().domain([0,b(a,n=>n.quantity)]).range([0,s]);o.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",0).attr("y",n=>l(n.name)).attr("width",n=>n.quantity>0?c(n.quantity/2):c(1)).attr("height",n=>n.quantity>0?l.bandwidth():1).attr("fill","#5f31dd"),o.append("g").attr("class","axis").call(k(l)),o.append("text").attr("class","axis-label").style("font-size","16px").attr("transform",`translate(${s/2},${i+35})`).style("text-anchor","middle").text("Duration (minutes)"),o.selectAll(".bar-label").data(a).enter().append("text").attr("class","bar-label").attr("x",n=>c(n.quantity/2)+5).attr("y",n=>l(n.name)+l.bandwidth()/2).attr("dy","0.35em").style("font-size","14px").text(n=>n.formattedQuantity)}}};function $(a,e,s,i,t,d){return null}const I=f(T,[["render",$]]);const V={setup(){const a=S(),e=_(),s=g(),i=w();return{usersStore:a,teacherAnalyticsStore:e,userDetailsStore:s,analyticsStore:i}},components:{StudentDurationPerDayLineChart:N,StudentSkillActivityChart:I,DownloadCSVBtn:P},data(){return{studentId:this.$route.params.studentId,studentName:null,durationsPerDay:[],totalTimeOnPlatformDownloadData:[],minutesPerSkillDownloadData:[],averageDurationsPerDay:[]}},async created(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const a=this.usersStore.users.find(e=>e.id===this.studentId);a&&(this.studentName=a.username),await this.getStudentDurationPerDay(),await this.getStudentActivity()},methods:{async getStudentDurationPerDay(){let a=`/student-analytics/student-duration-per-day-class/${this.studentId}/${this.userDetailsStore.userId}`;this.userDetailsStore.role==="school_admin"&&(a=`/student-analytics/student-duration-per-day-tenant/${this.studentId}/${this.userDetailsStore.tenantId}`),console.log(a),fetch(a).then(e=>e.json()).then(e=>{console.log(e);const s=e.studentTime;for(let t=0;t<s.length;t++)s[t].formattedQuantity=s[t].quantity/(1e3*60),s[t].date=new Date(s[t].date);s.sort((t,d)=>t.date-d.date),this.durationsPerDay=s,this.totalTimeOnPlatformDownloadData=this.durationsPerDay.map(t=>({date:t.date,minutes:t.formattedQuantity}));const i=e.averageTime;for(let t=0;t<i.length;t++)i[t].formattedQuantity=i[t].quantity/(1e3*60),i[t].date=new Date(i[t].date);i.sort((t,d)=>t.date-d.date),this.averageDurationsPerDay=i}).catch(e=>{console.error("Error fetching student duration per day:",e)})},async getStudentActivity(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const a=this.usersStore.users.find(e=>e.id===this.studentId);a&&(this.studentName=a.username),this.teacherAnalyticsStore.skillActivities.length==0&&await this.teacherAnalyticsStore.getSkillActivityReport(this.studentId),!this.teacherAnalyticsStore.skillActivities.error&&(this.teacherAnalyticsStore.skillActivities=this.teacherAnalyticsStore.skillActivities.map(e=>({...e,formattedQuantity:this.millisToMinutesAndSeconds(e.quantity)})),this.$nextTick(()=>{this.$refs.activityChart&&this.$refs.activityChart.createChart(this.teacherAnalyticsStore.skillActivities)}),this.downloadData=this.teacherAnalyticsStore.skillActivities.map(e=>({skill:e.name,minutes:e.formattedQuantity})))},millisToMinutesAndSeconds(a){var e=Math.floor(a/6e4),s=(a%6e4/1e3).toFixed(0);return e+":"+(s<10?"0":"")+s}}},B={class:"container-fluid chart-page"},q={class:"d-flex justify-content-between w-100"},O={class:"tertiary-heading h4"},j={class:"chart-row row"},M={class:"col-lg chart-col position-relative h-100"},Q={id:"time-chart-container"},R={key:1},E={class:"position-absolute"},L={style:{color:"purple"}},U={class:"chart-row row"},z={class:"col-lg chart-col position-relative overflow-auto"},F={id:"activity-chart-container"};function H(a,e,s,i,t,d){const o=u("DownloadCSVBtn"),l=u("StudentDurationPerDayLineChart"),c=u("StudentSkillActivityChart");return h(),p("div",B,[r("span",q,[e[0]||(e[0]=r("h1",{class:"heading h4"},"Engagement",-1)),r("h2",O,y(t.studentName),1)]),r("div",j,[r("div",M,[r("div",Q,[m(o,{data:t.totalTimeOnPlatformDownloadData,fileName:`Total time on platform - ${t.studentName}`,toolTip:"Download total time on platform data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),t.durationsPerDay.length>0?(h(),v(l,{key:0,data:t.durationsPerDay,averageDuration:t.averageDurationsPerDay,userRole:i.userDetailsStore.role,studentName:t.studentName},null,8,["data","averageDuration","userRole","studentName"])):(h(),p("p",R,"There is no data to show yet."))]),r("figcaption",E,[r("span",L,y(t.studentName),1),e[1]||(e[1]=D(" vs ",-1)),e[2]||(e[2]=r("span",{style:{color:"#ff7f0e"}},"class average",-1))])])]),r("div",U,[e[3]||(e[3]=r("div",{class:"col-lg chart-col position-relative"},[r("div",{id:""},"TODO: Add time per subject bar chart")],-1)),r("div",z,[r("div",F,[m(o,{data:t.minutesPerSkillDownloadData,fileName:`Minutes per skill - ${t.studentName}`,toolTip:"Download minutes per skill data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),m(c,{ref:"activityChart"},null,512)])])])])}const nt=f(V,[["render",H],["__scopeId","data-v-07ea78b5"]]);export{nt as default};
