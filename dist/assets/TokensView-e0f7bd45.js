import{_ as y,f as _,i as f,o as l,c,a as e,q as d,t as u,s as p,b as m,F as k,z as g,p as w,d as D}from"./main-e8f01486.js";import{u as S}from"./SettingsStore-d199ebd5.js";const T={setup(){const o=_(),t=S(),r=f();return{userDetailsStore:o,settingsStore:t,sessionDetailsStore:r}},data(){return{monthlyTokenUsage:null,year:0,month:"",isAITokenLimitReached:!1,isMobileCheck:window.innerWidth,showTooltip:!1,receipts:[],isAITokenLimitReached:!1,assistantsModelPrice:{input:75,output:150},showTokensDropDown:!1,products:[{name:"200,000 tokens for $10",tokens:2e5},{name:"400,000 tokens for $20",tokens:4e5},{name:"1,000,000 tokens for $50",tokens:1e6}],chosenProduct:{}}},async created(){this.chosenProduct=this.products[0],this.settingsStore.freeTokenMonthlyLimit==0&&await this.settingsStore.getSettings(),await this.userDetailsStore.getUserDetails()},async mounted(){let o=document.createElement("script");o.setAttribute("src","https://js.stripe.com/v3/"),document.head.appendChild(o);let t=this.userDetailsStore.monthlyTokenUsage-this.settingsStore.freeTokenMonthlyLimit;this.settingsStore.freeTokenMonthlyLimit<=this.userDetailsStore.monthlyTokenUsage&&t>this.userDetailsStore.tokens&&(this.isAITokenLimitReached=!0),this.year=new Date().getFullYear();const r=["January","February","March","April","May","June","July","August","September","October","November","December"],h=new Date;this.month=r[h.getMonth()],this.userDetailsStore.stripeCustomerId&&this.userDetailsStore.stripeCustomerId!=""&&this.getReceipts()},computed:{formattedMonthlyTokenUsage(){return this.userDetailsStore.monthlyTokenUsage?this.userDetailsStore.monthlyTokenUsage.toLocaleString():"0"}},methods:{closeOnDropdownOnClickAnywhere(){const o=document.getElementById("token-dropdown");document.body.addEventListener("click",t=>{o.contains(t.target)||(this.showTokensDropDown=!1)})},async getReceipts(){const t=await(await fetch("/tokens/get-receipts/"+this.userDetailsStore.userId)).json();for(let r=0;r<t.charges.data.length;r++)this.receipts.push(t.charges.data[r])},checkout(o){fetch("/tokens/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId,numberOfTokens:o})}).then(t=>t.ok?t.json():t.json().then(r=>Promise.reject(r))).then(({url:t})=>{window.location=t}).catch(t=>{console.error(t.error)})},loadPortal(){fetch("/tokens/create-customer-portal-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId})}).then(o=>o.ok?o.json():o.json().then(t=>Promise.reject(t))).then(({url:o})=>{window.location=o}).catch(o=>{console.error(o.error)})},formattedStripeReceiptDate(o){let t=new Date(o.created*1e3);const r=t.getUTCMonth()+1,h=t.getUTCDate();return t.getUTCFullYear()+"/"+r+"/"+h},formattedStripeReceiptAmount(o){return(o.amount_captured/100).toLocaleString("en-US",{style:"currency",currency:"USD"})},openTooltip(){this.showTooltip=!0},closeTooltip(){this.showTooltip=!1}}},a=o=>(w("data-v-936ac55e"),o=o(),D(),o),b={class:"container"},v={class:"row"},C={class:"col-md"},M=a(()=>e("strong",null,"Free limit:",-1)),I=a(()=>e("strong",null,"Current token usage:",-1)),L=a(()=>e("strong",null,"Your tokens:",-1)),A={key:0,class:"modal"},x={class:"modal-content"},U=a(()=>e("p",null," It is against our policy to share accounts and each account is meant to only be used by one user. ",-1)),j=a(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 192 512",width:"20",height:"20",class:"primary-icon"},[e("path",{d:"M48 80a48 48 0 1 1 96 0A48 48 0 1 1 48 80zM0 224c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224 32 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0 0-192-32 0c-17.7 0-32-14.3-32-32z"})],-1)),P=[j],O=a(()=>e("hr",null,null,-1)),R={class:"row"},B={class:"col col-md-8 col-lg-5 mt-2"},F=a(()=>e("h2",{class:"secondary-heading h4"},"Buy Tokens",-1)),N={class:"d-flex flex-column position-relative"},J=a(()=>e("span",null,[e("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M14.2929 8.70711C14.9229 8.07714 14.4767 7 13.5858 7H6.41421C5.52331 7 5.07714 8.07714 5.70711 8.70711L9.29289 12.2929C9.68342 12.6834 10.3166 12.6834 10.7071 12.2929L14.2929 8.70711Z",fill:"#344054"})])],-1)),V={key:0,class:"custom-dropdown-base"},Y=["onClick"],z=a(()=>e("hr",null,null,-1)),E=a(()=>e("h2",{class:"secondary-heading h4"},"Receipts",-1)),q=["href"],H={key:0};function W(o,t,r,h,s,i){return l(),c("div",b,[e("div",v,[e("div",C,[e("h2",{class:d(["secondary-heading h4 mb-4",{"text-center":s.isMobileCheck<576}])}," Monthly AI usage: "+u(s.month)+" "+u(s.year),3),e("ul",null,[e("li",null,[e("p",null,[M,p(" "+u(h.settingsStore.freeTokenMonthlyLimit.toLocaleString()),1)])]),e("li",null,[e("p",null,[I,p(" "+u(i.formattedMonthlyTokenUsage),1)])]),e("li",null,[e("p",null,[L,p(" "+u(h.userDetailsStore.tokens.toLocaleString()),1)])])]),s.isAITokenLimitReached?(l(),c("div",{key:0,class:d(["alert alert-warning",{"mb-0":s.isMobileCheck>=576}]),role:"alert"}," You are over the monthly free limit. You can't use the AI features until next month. ",2)):m("",!0)]),s.showTooltip?(l(),c("div",A,[e("div",x,[e("div",null,[U,e("button",{class:"btn primary-btn",onClick:t[0]||(t[0]=(...n)=>i.closeTooltip&&i.closeTooltip(...n))}," Close ")])])])):m("",!0),e("div",{class:d(["col-md d-flex",s.isMobileCheck>576?"justify-content-end":"justify-content-center"])},[h.userDetailsStore.stripeCustomerId&&h.userDetailsStore.stripeCustomerId!=""?(l(),c("button",{key:0,class:"btn primary-btn",onClick:t[1]||(t[1]=n=>i.loadPortal())}," Manage billing ")):m("",!0),e("button",{class:"btn info-btn ms-1",onClick:t[2]||(t[2]=(...n)=>i.openTooltip&&i.openTooltip(...n))},P)],2)]),O,e("div",R,[e("div",B,[F,e("div",N,[e("div",{id:"token-dropdown",class:d([s.showTokensDropDown?"custom-select-button-focus":"custom-select-button"]),onClick:t[3]||(t[3]=n=>{s.showTokensDropDown=!s.showTokensDropDown,i.closeOnDropdownOnClickAnywhere()})},[p(u(s.chosenProduct.name)+" ",1),J],2),s.showTokensDropDown?(l(),c("div",V,[(l(!0),c(k,null,g(s.products,n=>(l(),c("div",{class:"custom-dropdown-option",onClick:Z=>{s.chosenProduct=n,s.showTokensDropDown=!1}},u(n.name),9,Y))),256))])):m("",!0)])])]),e("button",{onClick:t[4]||(t[4]=n=>i.checkout(s.chosenProduct.tokens)),class:"btn primary-btn mt-2 mb-2"}," buy "),z,e("div",{class:d({"text-center":s.isMobileCheck<576})},[E,(l(!0),c(k,null,g(s.receipts,n=>(l(),c("div",null,[e("a",{href:n.receipt_url,target:"_blank"},u(i.formattedStripeReceiptAmount(n))+" "+u(i.formattedStripeReceiptDate(n)),9,q)]))),256)),s.isMobileCheck<576?(l(),c("p",H,"Â ")):m("",!0)],2)])}const Q=y(T,[["render",W],["__scopeId","data-v-936ac55e"]]);export{Q as default};
