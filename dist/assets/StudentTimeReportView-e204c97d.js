import{_ as g,o as l,c as u,A as w,r as p,a as n,t as f,s as D,g as y,k as _,b as x,F as P}from"./main-50c82204.js";import{s as k}from"./transform-35b9fb9e.js";import{l as T,m as v,a as b,b as C}from"./linear-c968f95f.js";import{b as N}from"./band-18e9f0c1.js";import{s as B}from"./sort-855cf5d1.js";import{S as V}from"./StudentDurationPerDayLineChart-7ebc7f45.js";import{D as j}from"./downloadCSVBtn-ac9e3b18.js";import"./line-8aa3dac8.js";import"./time-962c8065.js";import"./point-ea70dc51.js";const A={name:"TimePerSkillHorizontalBarChart",props:["data","colour"],data(){return{padding:60}},mounted(){k("#time-per-skill-chart-container");const t=25,e=0,o=0,h=10,s=200,d=1e3,c=Math.ceil((this.data.length+.1)*t)+e+h,i=T().domain([0,v(this.data,a=>a.quantity)]).range([s,d-o]),r=N().domain(B(this.data,a=>-a.quantity).map(a=>a.name)).rangeRound([e,c-h]).padding(.1);i.tickFormat(20);const m=k("#time-per-skill-chart-container").append("svg").attr("width",d).attr("height",c).attr("viewBox",[0,0,d,c]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");m.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",i(0)).attr("y",a=>r(a.name)).attr("width",a=>i(a.quantity)-i(0)).attr("height",r.bandwidth()),m.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",a=>i(a.quantity)).attr("y",a=>r(a.name)+r.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(a=>a.formattedQuantity).call(a=>a.filter(S=>i(S.quantity)-i(0)<40).attr("dx",4).attr("fill","black").attr("text-anchor","start")),m.append("g").attr("transform",`translate(0,${e})`).call(b(i).ticks(0)).call(a=>a.select(".domain").remove()),m.append("g").attr("transform",`translate(${s},0)`).call(C(r).tickSizeOuter(0))},computed:{}},q={id:"time-per-skill-chart-container"};function L(t,e,o,h,s,d){return l(),u("div",q)}const $=g(A,[["render",L]]),M={setup(){return{usersStore:w()}},components:{TimePerSkillHorizontalBarChart:$,StudentDurationPerDayLineChart:V,DownloadCSVBtn:j},data(){return{studentId:this.$route.params.studentId,studentName:null,skillDurations:[],durationsPerDay:[],allSkillsDuration:0,isDataLoaded:!1,totalTimeOnPlatformDownloadData:[],minutesPerSkillDownloadData:[]}},async created(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const t=this.usersStore.users.find(e=>e.id===this.studentId);t&&(this.studentName=t.username),await this.getSkillDuration(),await this.getAllSkillsDuration(),await this.getStudentDurationPerDay(),this.isDataLoaded=!0},methods:{async getSkillDuration(){fetch(`/student-analytics/skill-durations/${this.studentId}`).then(t=>t.json()).then(t=>{this.skillDurations=t;for(let e=0;e<this.skillDurations.length;e++)this.skillDurations[e].formattedQuantity=this.millisToMinutesAndSeconds(this.skillDurations[e].quantity);this.minutesPerSkillDownloadData=this.skillDurations.map(e=>({skill:e.name,quantity:e.formattedQuantity}))}).catch(t=>{console.error("Error fetching last visited skills:",t)})},async getAllSkillsDuration(){fetch(`/student-analytics/all-skills-duration/${this.studentId}`).then(t=>t.json()).then(t=>{this.allSkillsDuration=t.duration}).catch(t=>{console.error("Error fetching last visited skills:",t)})},async getStudentDurationPerDay(){fetch(`/student-analytics/student-duration-per-day/${this.studentId}`).then(t=>t.json()).then(t=>{for(let e=0;e<t.length;e++)t[e].formattedQuantity=t[e].quantity/(1e3*60),t[e].date=new Date(t[e].date);t.sort((e,o)=>e.date-o.date),this.durationsPerDay=t,this.totalTimeOnPlatformDownloadData=this.durationsPerDay.map(e=>({date:e.date,minutes:e.formattedQuantity}))}).catch(t=>{console.error("Error fetching student duration per day:",t)})},millisToMinutesAndSeconds(t){var e=Math.floor(t/6e4),o=(t%6e4/1e3).toFixed(0);return e+":"+(o<10?"0":"")+o}}},I={class:"container"},z={class:"d-flex justify-content-between w-100"},H=n("h1",{class:"heading"},"Time Report",-1),O={class:"secondary-heading h3"},Q=n("p",null,[n("em",null," Please note that time spent on external sources (e.g. websites) related to skills is not measured.")],-1),E={key:0},F={class:"secondary-heading d-flex justify-content-between w-100 align-items-center"},R={key:1},U=n("h4",{class:"secondary-heading r"},"All skills",-1),G={class:"secondary-heading d-flex justify-content-between w-100 align-items-center"},J={key:1},K=n("p",null,"No skills visited by this student.",-1),W=[K],X=n("p",null,"Â ",-1);function Y(t,e,o,h,s,d){const c=p("DownloadCSVBtn"),i=p("StudentDurationPerDayLineChart"),r=p("TimePerSkillHorizontalBarChart");return l(),u(P,null,[n("div",I,[n("span",z,[H,n("h2",O,f(s.studentName),1)]),Q,s.isDataLoaded?(l(),u("div",E,[n("div",null,[n("h4",F,[D(" Total time on platform "),y(c,{data:s.totalTimeOnPlatformDownloadData,fileName:`Total time on platform - ${s.studentName}`,toolTip:"Download total time on platform data as CSV"},null,8,["data","fileName"])]),s.durationsPerDay.length>0?(l(),_(i,{key:0,data:s.durationsPerDay},null,8,["data"])):(l(),u("p",R,"There is no data to show yet."))]),n("div",null,[U,n("p",null,f(d.millisToMinutesAndSeconds(this.allSkillsDuration)),1),n("h4",G,[D(" Minutes per skill "),y(c,{data:s.minutesPerSkillDownloadData,fileName:`Minutes per skill - ${s.studentName}`,toolTip:"Download minutes per skill data as CSV"},null,8,["data","fileName"])]),s.skillDurations.length>0?(l(),_(r,{key:0,data:s.skillDurations,colour:"darkgreen"},null,8,["data"])):(l(),u("div",J,W))])])):x("",!0)]),X],64)}const dt=g(M,[["render",Y]]);export{dt as default};
