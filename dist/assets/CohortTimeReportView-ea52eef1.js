import{u as w}from"./CohortsStore-1038fafd.js";import{_ as f,o as l,c as p,f as C,r as g,a as m,t as T,k as _}from"./main-bf022874.js";import"./transform-23c7b39f.js";import{u as $,l as k}from"./line-551a0daf.js";import{e as v}from"./extent-4cf1c809.js";import{l as D,m as x,b as I,s as M}from"./linear-5b5f98b2.js";import{s as y}from"./select-03d56b88.js";import{h as P,b as S,a as A}from"./continuous-dd31f971.js";import"./time-d987a114.js";import"./init-77b53fdd.js";import"./array-4492e866.js";import"./point-e88f89db.js";import"./ascending-3ff63084.js";import"./ordinal-ba9b4969.js";const Q={name:"CohortDurationPerDayLineChart",props:["data","colour"],data(){return{padding:60}},mounted(){const t=this.data;y("#cohort-duration-per-day-chart-container");const o=928,e=500,i=20,n=30,d=30,c=40,a=$(v(t,s=>s.date),[c,o-n]),h=D([0,x(t,s=>s.formattedQuantity)],[e-d,i]),u=k().x(s=>a(s.date)).y(s=>h(s.formattedQuantity)),r=y("#cohort-duration-per-day-chart-container").append("svg").attr("width",o).attr("height",e).attr("viewBox",[0,0,o,e]).attr("style","max-width: 100%; height: auto; height: intrinsic;");r.append("g").attr("transform",`translate(0,${e-d})`).call(P(a).ticks(t.length/2).tickSizeOuter(0)),r.append("g").attr("transform",`translate(${c},0)`).call(S(h).ticks(e/80)).call(s=>s.selectAll(".tick line").clone().attr("x2",o-c-n).attr("stroke-opacity",.1)).call(s=>s.append("text").attr("x",-c).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text("â†‘ Duration in seconds")),r.append("path").attr("fill","none").attr("stroke","#5f31dd").attr("stroke-width",1.5).attr("d",u(t))}},N={id:"cohort-duration-per-day-chart-container"};function b(t,o,e,i,n,d){return l(),p("div",N)}const q=f(Q,[["render",b]]),B={name:"CohortCompareDurationHorizontalChart",props:["data","colour"],data(){return{padding:60}},mounted(){y("#cohort-compare-duration-chart-container");const t=25,o=0,e=0,i=10,n=200,d=1e3,c=Math.ceil((this.data.length+.1)*t)+o+i,a=D().domain([0,x(this.data,r=>r.quantity)]).range([n,d-e]),h=I().domain(M(this.data,r=>-r.quantity).map(r=>r.name)).rangeRound([o,c-i]).padding(.1);a.tickFormat(20);const u=y("#cohort-compare-duration-chart-container").append("svg").attr("width",d).attr("height",c).attr("viewBox",[0,0,d,c]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");u.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",a(0)).attr("y",r=>h(r.name)).attr("width",r=>a(r.quantity)-a(0)).attr("height",h.bandwidth()),u.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",r=>a(r.quantity)).attr("y",r=>h(r.name)+h.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(r=>r.formattedQuantity).call(r=>r.filter(s=>a(s.quantity)-a(0)<20).attr("dx",4).attr("fill","black").attr("text-anchor","start")),u.append("g").attr("transform",`translate(0,${o})`).call(A(a).ticks(0)).call(r=>r.select(".domain").remove()),u.append("g").attr("transform",`translate(${n},0)`).call(S(h).tickSizeOuter(0))}},j={id:"cohort-compare-duration-chart-container"};function E(t,o,e,i,n,d){return l(),p("div",j)}const L=f(B,[["render",E]]),z={setup(){const t=w(),o=C();return{cohortsStore:t,userDetailsStore:o}},components:{CohortDurationPerDayLineChart:q,CohortCompareDurationHorizontalChart:L},data(){return{cohortId:this.$route.params.cohortId,cohortName:"",durationsPerDay:[],studentTotalDurations:[]}},async created(){this.cohortsStore.cohorts.length<1&&await this.cohortsStore.getCohorts(this.userDetailsStore.userId);const t=this.cohortsStore.cohorts.find(o=>o.id==this.cohortId);t&&(this.cohortName=t.name),this.cohortId!="all-students"?(await this.getCohortDurationPerDay(),await this.getCohortStudentTotalDurations()):(await this.getAllStudentsDurationPerDay(),await this.getAllStudentsStudentTotalDurations())},methods:{async getCohortDurationPerDay(){fetch(`/student-analytics/cohort-duration-per-day/${this.cohortId}`).then(t=>t.json()).then(t=>{for(let o=0;o<t.length;o++)t[o].formattedQuantity=this.millisToMinutesAndSeconds(t[o].quantity),t[o].formattedQuantity=this.convertMinutesSecondsToSeconds(t[o].formattedQuantity),t[o].date=new Date(t[o].date);t.sort((o,e)=>o.date-e.date),this.durationsPerDay=t}).catch(t=>{console.error("Error fetching student duration per day:",t)})},async getAllStudentsDurationPerDay(){fetch(`/student-analytics/all-students-duration-per-day/${this.userDetailsStore.userId}`).then(t=>t.json()).then(t=>{for(let o=0;o<t.length;o++)t[o].formattedQuantity=this.millisToMinutesAndSeconds(t[o].quantity),t[o].formattedQuantity=this.convertMinutesSecondsToSeconds(t[o].formattedQuantity),t[o].date=new Date(t[o].date);t.sort((o,e)=>o.date-e.date),this.durationsPerDay=t}).catch(t=>{console.error("Error fetching student duration per day:",t)})},async getCohortStudentTotalDurations(){fetch(`/student-analytics/cohort-total-durations/${this.cohortId}`).then(t=>t.json()).then(t=>{for(let o=0;o<t.length;o++)t[o].formattedQuantity=this.millisToMinutesAndSeconds(t[o].quantity),t[o].date=new Date(t[o].date);t.sort((o,e)=>o.date-e.date),this.studentTotalDurations=t}).catch(t=>{console.error("Error fetching student duration per day:",t)})},async getAllStudentsStudentTotalDurations(){fetch(`/student-analytics/all-students-total-durations/${this.userDetailsStore.userId}`).then(t=>t.json()).then(t=>{for(let o=0;o<t.length;o++)t[o].formattedQuantity=this.millisToMinutesAndSeconds(t[o].quantity),t[o].date=new Date(t[o].date);t.sort((o,e)=>o.date-e.date),this.studentTotalDurations=t}).catch(t=>{console.error("Error fetching student duration per day:",t)})},millisToMinutesAndSeconds(t){var o=Math.floor(t/6e4),e=(t%6e4/1e3).toFixed(0);return o+":"+(e<10?"0":"")+e},convertMinutesSecondsToSeconds(t){const o=t.split(":");if(o.length!==2)throw new Error("Invalid duration format. Expected 'MM:SS'.");const e=parseInt(o[0],10),i=parseInt(o[1],10);if(isNaN(e)||isNaN(i))throw new Error("Invalid numerical values in duration string.");return e*60+i}}},H={class:"container"},R={class:"d-flex justify-content-between w-100"},O=m("h1",{class:"heading"},"Time Report",-1),F={class:"secondary-heading h3"},V=m("h2",{class:"secondary-heading"},"Total time on platform per day",-1),U={key:1},G=m("h2",{class:"secondary-heading mt-4"}," Total time on platform, comparing students ",-1),J={key:3},K=m("h2",{class:"secondary-heading mt-4"},"Minutes per skill",-1);function W(t,o,e,i,n,d){const c=g("CohortDurationPerDayLineChart"),a=g("CohortCompareDurationHorizontalChart");return l(),p("div",H,[m("span",R,[O,m("h2",F,T(n.cohortName),1)]),V,n.durationsPerDay.length>0?(l(),_(c,{key:0,data:n.durationsPerDay},null,8,["data"])):(l(),p("p",U,"No time recorded yet")),G,n.studentTotalDurations.length>0?(l(),_(a,{key:2,data:n.studentTotalDurations,colour:"#5f31dd"},null,8,["data"])):(l(),p("p",J,"No time recorded yet")),K])}const lt=f(z,[["render",W]]);export{lt as default};
