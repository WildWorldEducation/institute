import{_ as b,A as y,r as g,o as n,c as l,a as e,g as p,l as U,s as _,b as m,w as c,C as u,t as v,q as I,F as M,p as S,d as x}from"./main-3705768a.js";import{f as V,h as E}from"./theme.compact-398df36e.js";const k={setup(){return{usersStore:y()}},data(){return{userId:this.$route.params.id,user:{},originalUser:{},image:"",avatar:"",validate:{first_name:!1,last_name:!1,email:!1,emailFormat:!1,notSquareImg:!1,notCropped:!1},errorUsernameMessage:"",errorEmailMessage:"",showCropModal:!1,cropCanvas:"",cropResult:{coordinates:null,image:null},lastZoomValue:0,zoomValue:0,isImageLoading:!1}},components:{Cropper:V,Preview:E},computed:{hasFormChanges(){const s=t=>t==null||t===""?"":t;return s(this.user.first_name)!==s(this.originalUser.first_name)||s(this.user.last_name)!==s(this.originalUser.last_name)||s(this.user.username)!==s(this.originalUser.username)||s(this.user.email)!==s(this.originalUser.email)}},async mounted(){this.usersStore.users.length<1&&await this.usersStore.getUsers(),this.getUser()},methods:{getUser(){fetch("/users/show/"+this.userId).then(function(s){return s.json()}).then(s=>{this.user=s,this.originalUser={...s}}).then(()=>{this.image=this.user.avatar})},ValidateForm(){this.validate.username=!this.user.username,this.validate.username||this.Submit()},ValidateEmail(){const s=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return this.user.email&&!s.test(this.user.email)?(this.errorEmailMessage="Please enter a valid email address!",!1):!0},clearUsernameError(){this.errorUsernameMessage=""},clearEmailError(){this.errorEmailMessage=""},async Submit(){let s={};if(this.user.first_name&&(s.firstname=this.user.first_name),this.user.last_name&&(s.lastname=this.user.last_name),s.username=this.user.username,this.user.email&&this.ValidateEmail())s.email=this.user.email;else if(this.user.email&&!this.ValidateEmail())return;this.user.avatar&&(s.avatar=this.user.avatar);const t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)},h="/users/"+this.userId+"/instructor/edit";try{const d=await fetch(h,t);if(!d.ok){const r=await d.json();this.errorUsernameMessage="",this.errorEmailMessage="",r.errors&&(r.errors.username&&(this.errorUsernameMessage=r.errors.username),r.errors.email&&(this.errorEmailMessage=r.errors.email));return}await this.usersStore.getUsers(),this.originalUser={...this.user},this.$router.push("/students")}catch(d){console.error(d)}},async SubmitAvatar(){if(this.isImageLoading=!0,!this.user.avatar)return;const s={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:this.user.avatar})};var t="/users/"+this.userId+"/instructor/edit-avatar";fetch(t,s).then(()=>{this.isImageLoading=!1,this.usersStore.getUsers()})},onFileChange(s){var t=s.target.files||s.dataTransfer.files;t.length&&this.createImage(t[0])},createImage(s){var t=new Image,h=new FileReader,d=this;h.onload=r=>{d.image=r.target.result,this.image=r.target.result,this.avatar=this.image,t.src=r.target.result,this.user.avatar=this.image},t.onload=()=>{t.width/t.height!==1?(this.validate.notSquareImg=!0,this.showCropModal=!0):this.validate.notSquareImg=!1},h.readAsDataURL(s)},removeImage:function(s){this.image=""},cropImageChange({coordinates:s,canvas:t,image:h}){this.cropResult={coordinates:s,image:h},this.cropCanvas=t.toDataURL()},handleCropImage(){var s=new Image;s.src=this.cropCanvas,this.user.avatar=this.cropCanvas,this.image=this.cropCanvas,this.showCropModal=!1,this.validate.notSquareImg=!1,this.validate.notCropped=!1},handleCancelCrop(){this.showCropModal=!1},stencilSize({boundaries:s}){return{width:Math.min(s.height,s.width)-48,height:Math.min(s.height,s.width)-48}},handlePhoneCropper(){if(window.innerWidth<940){const{visibleArea:s,image:t}=this.$refs.cropper.getResult();this.zoomValue=s.height/t.height,this.lastZoomValue=this.zoomValue,this.$refs.cropper.zoom(this.zoomValue)}},cropperZoomIn(){this.$refs.cropper.visibleArea.height>30&&this.$refs.cropper.zoom(2)},cropperZoomOut(){this.$refs.cropper.visibleArea.height<3e3&&this.$refs.cropper.zoom(.5)}}},o=s=>(S("data-v-7702db2b"),s=s(),x(),s),z={class:"container p-1"},H=o(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",height:"20",width:"20",fill:"white"},[e("path",{d:"M134.1 296H436c6.6 0 12-5.4 12-12v-56c0-6.6-5.4-12-12-12H134.1v-46.1c0-21.4-25.9-32.1-41-17L7 239c-9.4 9.4-9.4 24.6 0 33.9l86.1 86.1c15.1 15.1 41 4.4 41-17V296z"})],-1)),L={class:"row"},F={class:"col-12 col-md-6 mb-3"},R={class:""},q=["src"],B={key:1,class:"loading-animation d-flex justify-content-center align-items-center py-4"},P=o(()=>e("span",{class:"loader"},null,-1)),j=[P],Z={class:"d-flex gap-1 mt-1"},A=o(()=>e("label",{class:"btn green-btn",for:"image-input"}," Change ",-1)),O=o(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"18",height:"18",fill:"white"},[e("path",{d:"M448 109.3l54.6-54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L402.7 64 160 64v64l178.7 0L128 338.7V32c0-17.7-14.3-32-32-32S64 14.3 64 32V64H32C14.3 64 0 78.3 0 96s14.3 32 32 32H64V384c0 35.3 28.7 64 64 64H352V384H173.3L384 173.3 384 480c0 17.7 14.3 32 32 32s32-14.3 32-32V448h32c17.7 0 32-14.3 32-32s-14.3-32-32-32H448l0-274.7z"})],-1)),T=["disabled"],N={class:"col-12 col-md-6 mb-2"},D={class:"mb-3"},J=o(()=>e("h2",{class:"secondary-heading h4"},"First name",-1)),W={class:"mb-3"},G=o(()=>e("h2",{class:"secondary-heading h4"},"Last name",-1)),K={class:"mb-3"},Q=o(()=>e("h2",{class:"secondary-heading h4"},"Username",-1)),X={key:0,class:"form-validate"},Y={class:"mb-2"},$=o(()=>e("h2",{class:"secondary-heading h4"},"Email address",-1)),ee={key:0,class:"form-validate"},se={class:""},te=["disabled"],re={class:"mb-3 row"},ie={class:"d-none"},ae=o(()=>e("p",{style:{"font-size":"14px"}},[e("em",null,"Maximum file size 15mb")],-1)),oe={key:0},ne={id:"myModal",class:"modal"},le={class:"modal-content d-flex flex-column"},he={id:"crop-component",ref:"cropComponent"},de={id:"crop-result"},me=o(()=>e("div",{class:"form-label"},"Result:",-1)),ce={id:"zoom-range"},ue=o(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"20",height:"20",fill:"gray"},[e("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM136 184c-13.3 0-24 10.7-24 24s10.7 24 24 24H280c13.3 0 24-10.7 24-24s-10.7-24-24-24H136z"})],-1)),ge=[ue],pe=o(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"20",height:"20",fill:"gray"},[e("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM184 296c0 13.3 10.7 24 24 24s24-10.7 24-24V232h64c13.3 0 24-10.7 24-24s-10.7-24-24-24H232V120c0-13.3-10.7-24-24-24s-24 10.7-24 24v64H120c-13.3 0-24 10.7-24 24s10.7 24 24 24h64v64z"})],-1)),_e=[pe],ve={class:"d-flex flex-row justify-content-center mt-2"},fe={class:"d-flex flex-row justify-content-between justify-content-lg-end gap-2 mt-5 pb-2 pb-lg-0"},we=o(()=>e("span",null,"Cancel",-1)),Ce=[we],be=o(()=>e("span",null,"Crop",-1)),ye=[be];function Ue(s,t,h,d,r,a){const f=g("router-link"),w=g("cropper"),C=g("preview");return n(),l(M,null,[e("div",z,[p(f,{class:"btn red-btn mb-1",to:"/students"},{default:U(()=>[H,_("  Back to Students ")]),_:1}),e("div",L,[e("div",F,[e("div",R,[r.isImageLoading?(n(),l("div",B,j)):(n(),l("img",{key:0,class:"rounded",src:r.image,height:"350",width:"350",style:{"background-color":"lightgrey"}},null,8,q)),e("div",Z,[A,r.avatar!=""?(n(),l("button",{key:0,class:"btn green-btn",onClick:t[0]||(t[0]=i=>r.showCropModal=!0)},[_(" Crop   "),O])):m("",!0)])]),e("button",{disabled:r.avatar=="",class:"btn primary-btn mt-1",onClick:t[1]||(t[1]=i=>a.SubmitAvatar())}," Update student avatar ",8,T)]),e("div",N,[e("div",D,[J,c(e("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>r.user.first_name=i),type:"text",class:"form-control"},null,512),[[u,r.user.first_name]])]),e("div",W,[G,c(e("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>r.user.last_name=i),type:"text",class:"form-control"},null,512),[[u,r.user.last_name]])]),e("div",K,[Q,c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>r.user.username=i),type:"text",class:"form-control",onInput:t[5]||(t[5]=(...i)=>a.clearUsernameError&&a.clearUsernameError(...i))},null,544),[[u,r.user.username]]),r.validate.username&&(r.user.username==""||r.user.username==null)||r.errorUsernameMessage?(n(),l("div",X,v(r.errorUsernameMessage||"Please enter a username!"),1)):m("",!0)]),e("div",Y,[$,c(e("input",{"onUpdate:modelValue":t[6]||(t[6]=i=>r.user.email=i),type:"email",class:"form-control",onInput:t[7]||(t[7]=(...i)=>a.clearEmailError&&a.clearEmailError(...i))},null,544),[[u,r.user.email]]),r.errorEmailMessage?(n(),l("div",ee,v(r.errorEmailMessage||"Please enter a valid email address!"),1)):m("",!0)]),e("div",se,[e("button",{class:"btn primary-btn",onClick:t[8]||(t[8]=i=>a.ValidateForm()),disabled:!a.hasFormChanges}," Update student details ",8,te)])])]),e("div",re,[e("div",ie,[e("input",{id:"image-input",class:"form-control",type:"file",accept:"image/*",onChange:t[9]||(t[9]=(...i)=>a.onFileChange&&a.onFileChange(...i))},null,32),ae])])]),r.showCropModal?(n(),l("div",oe,[e("div",ne,[e("div",le,[e("div",he,[p(w,{src:r.image,onChange:a.cropImageChange,onReady:a.handlePhoneCropper,"stencil-props":{movable:!0,resizable:!0,aspectRatio:1},"image-restriction":"stencil",class:"cropper",ref:"cropper",debounce:!1},null,8,["src","onChange","onReady"]),e("div",de,[me,p(C,{width:120,height:120,image:r.cropResult.image,coordinates:r.cropResult.coordinates},null,8,["image","coordinates"])])],512),e("div",ce,[e("span",{class:"mt-1 me-1 zoom-icon",onClick:t[10]||(t[10]=(...i)=>a.cropperZoomOut&&a.cropperZoomOut(...i))},ge),e("span",{class:"mt-1 ms-1 zoom-icon",onClick:t[11]||(t[11]=(...i)=>a.cropperZoomIn&&a.cropperZoomIn(...i))},_e)]),e("div",ve,[r.validate.notCropped?(n(),l("div",{key:0,id:"warning-line",class:I({shake:r.validate.notCropped})}," Please crop your image to square aspect ratio ",2)):m("",!0)]),e("div",fe,[e("button",{class:"btn red-btn",onClick:t[12]||(t[12]=(...i)=>a.handleCancelCrop&&a.handleCancelCrop(...i))},Ce),e("button",{class:"btn green-btn",onClick:t[13]||(t[13]=(...i)=>a.handleCropImage&&a.handleCropImage(...i))},ye)])])])])):m("",!0)],64)}const Se=b(k,[["render",Ue],["__scopeId","data-v-7702db2b"]]);export{Se as default};
