import{_ as y,y as f,e as S,r as c,o as u,c as m,a as o,t as p,f as h,k as g,j as D}from"./main-12fc20f1.js";import{u as v}from"./TeacherAnalyticsStore-185da4c8.js";import{u as _}from"./AnalyticsStore-4a3e4f23.js";import"./transform-af9a74a2.js";import{b as w,m as A}from"./continuous-7328829e.js";import{l as b,b as x}from"./linear-5b188edc.js";import{s as k}from"./string-dd82ab4a.js";import{S as C}from"./StudentDurationPerDayLineChart-446de868.js";import{D as N}from"./downloadCSVBtn-a7ce956d.js";import"./line-85f04100.js";import"./time-0457d93b.js";import"./point-ea70dc51.js";const P={name:"StudentSkillActivityChart",methods:{createChart(a){if(!a||a.length===0){console.warn("No data available for the chart");return}const t=document.getElementById("activity-chart-container").clientWidth,s=document.getElementById("activity-chart-container").clientHeight,n={top:20,right:0,bottom:60,left:200},r=k("#activity-chart-container").append("svg").attr("width","100%").attr("height","100%").append("g").attr("transform",`translate(${n.left},${n.top})`),l=w().domain(a.map(i=>i.name)).range([0,s-35]).padding(.2),d=b().domain([0,A(a,i=>i.quantity)]).range([0,t]);r.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",0).attr("y",i=>l(i.name)).attr("width",i=>i.quantity>0?d(i.quantity/2):d(1)).attr("height",i=>i.quantity>0?l.bandwidth():1).attr("fill","#5f31dd"),r.append("g").attr("class","axis").call(x(l)),r.append("text").attr("class","axis-label").style("font-size","16px").attr("transform",`translate(${t/2},${s+35})`).style("text-anchor","middle").text("Duration (minutes)"),r.selectAll(".bar-label").data(a).enter().append("text").attr("class","bar-label").attr("x",i=>d(i.quantity/2)+5).attr("y",i=>l(i.name)+l.bandwidth()/2).attr("dy","0.35em").style("font-size","14px").text(i=>i.formattedQuantity)}}};function T(a,t,s,n,e,r){return null}const $=y(P,[["render",T]]);const I={setup(){const a=f(),t=v(),s=S(),n=_();return{usersStore:a,teacherAnalyticsStore:t,userDetailsStore:s,analyticsStore:n}},components:{StudentDurationPerDayLineChart:C,StudentSkillActivityChart:$,DownloadCSVBtn:N},data(){return{studentId:this.$route.params.studentId,studentName:null,skillDurations:[],durationsPerDay:[],allSkillsDuration:0,totalTimeOnPlatformDownloadData:[],minutesPerSkillDownloadData:[],averageDurationsPerDay:[]}},async created(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const a=this.usersStore.users.find(t=>t.id===this.studentId);a&&(this.studentName=a.username),await this.getStudentDurationPerDay(),await this.getStudentActivity()},methods:{async getStudentDurationPerDay(){let a=`/student-analytics/student-duration-per-day-class/${this.studentId}/${this.userDetailsStore.userId}`;this.userDetailsStore.role==="school_admin"&&(a=`/student-analytics/student-duration-per-day-tenant/${this.studentId}/${this.userDetailsStore.userId}`),fetch(a).then(t=>t.json()).then(t=>{const s=t.studentTime;for(let e=0;e<s.length;e++)s[e].formattedQuantity=s[e].quantity/(1e3*60),s[e].date=new Date(s[e].date);s.sort((e,r)=>e.date-r.date),console.log("response data: "),console.log(s),this.durationsPerDay=s,this.totalTimeOnPlatformDownloadData=this.durationsPerDay.map(e=>({date:e.date,minutes:e.formattedQuantity}));const n=t.averageTime;for(let e=0;e<n.length;e++)n[e].formattedQuantity=n[e].quantity/(1e3*60),n[e].date=new Date(n[e].date);n.sort((e,r)=>e.date-r.date),this.averageDurationsPerDay=n}).catch(t=>{console.error("Error fetching student duration per day:",t)})},async getStudentActivity(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const a=this.usersStore.users.find(t=>t.id===this.studentId);a&&(this.studentName=a.username),this.teacherAnalyticsStore.skillActivities.length==0&&await this.teacherAnalyticsStore.getSkillActivityReport(this.studentId),this.teacherAnalyticsStore.skillActivities=this.teacherAnalyticsStore.skillActivities.map(t=>({...t,formattedQuantity:this.millisToMinutesAndSeconds(t.quantity)})),this.$nextTick(()=>{this.$refs.activityChart&&this.$refs.activityChart.createChart(this.teacherAnalyticsStore.skillActivities)}),this.downloadData=this.teacherAnalyticsStore.skillActivities.map(t=>({skill:t.name,minutes:t.formattedQuantity}))},millisToMinutesAndSeconds(a){var t=Math.floor(a/6e4),s=(a%6e4/1e3).toFixed(0);return t+":"+(s<10?"0":"")+s}}},V={class:"container-fluid chart-page"},B={class:"d-flex justify-content-between w-100"},q={class:"tertiary-heading h4"},O={class:"chart-row row"},j={class:"col-lg chart-col position-relative h-100"},Q={id:"time-chart-container"},E={key:1},R={class:"position-absolute"},L={style:{color:"purple"}},M={class:"chart-row row"},U={class:"col-lg chart-col position-relative"},z={id:"activity-chart-container"};function F(a,t,s,n,e,r){const l=c("DownloadCSVBtn"),d=c("StudentDurationPerDayLineChart"),i=c("StudentSkillActivityChart");return u(),m("div",V,[o("span",B,[t[0]||(t[0]=o("h1",{class:"heading h4"},"Engagement",-1)),o("h2",q,p(e.studentName),1)]),o("div",O,[o("div",j,[o("div",Q,[h(l,{data:e.totalTimeOnPlatformDownloadData,fileName:`Total time on platform - ${e.studentName}`,toolTip:"Download total time on platform data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),e.durationsPerDay.length>0?(u(),g(d,{key:0,data:e.durationsPerDay,averageDuration:e.averageDurationsPerDay,userRole:n.userDetailsStore.role,studentName:e.studentName},null,8,["data","averageDuration","userRole","studentName"])):(u(),m("p",E,"There is no data to show yet."))]),o("figcaption",R,[o("span",L,p(e.studentName),1),t[1]||(t[1]=D(" vs ",-1)),t[2]||(t[2]=o("span",{style:{color:"#ff7f0e"}},"class average",-1))])])]),o("div",M,[t[3]||(t[3]=o("div",{class:"col-lg chart-col position-relative"},[o("div",{id:""}," TODO: Add time per subject bar chart ")],-1)),o("div",U,[o("div",z,[h(l,{data:e.minutesPerSkillDownloadData,fileName:`Minutes per skill - ${e.studentName}`,toolTip:"Download minutes per skill data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),h(i,{ref:"activityChart"},null,512)])])])])}const it=y(I,[["render",F],["__scopeId","data-v-3e3d8827"]]);export{it as default};
