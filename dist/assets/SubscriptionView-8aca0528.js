import{_ as m,f,L as g,i as y,o,c as r,a as t,q as d,t as u,s as p,b as h,p as S,d as k}from"./main-8f135046.js";const T={setup(){const e=f(),s=g(),a=y();return{userDetailsStore:e,settingsStore:s,sessionDetailsStore:a}},data(){return{monthlyTokenUsage:null,year:0,month:"",isAITokenLimitReached:!1,isMobileCheck:window.innerWidth,showTooltip:!1,subscription:{},subSchedule:{},basicPlanPriceId:"price_1RCKSvFfW0WtxYZHCcfnbL5R",infinitePlanPriceId:"price_1RCKUZFfW0WtxYZHxz1ksgww",nextSubSchedulePhasePlan:"",isLoading:!1}},async created(){this.settingsStore.freePlanTokenLimit||await this.settingsStore.getSettings(),await this.userDetailsStore.getUserDetails(),await this.getSubscription()},async mounted(){let e=document.createElement("script");e.setAttribute("src","https://js.stripe.com/v3/"),document.head.appendChild(e),this.userDetailsStore.subscriptionTier=="free"?this.settingsStore.freePlanTokenLimit&&this.userDetailsStore.monthlyTokenUsage&&this.settingsStore.freePlanTokenLimit<=this.userDetailsStore.monthlyTokenUsage&&(this.isAITokenLimitReached=!0):this.userDetailsStore.subscriptionTier=="basic"&&this.settingsStore.basicPlanTokenLimit&&this.userDetailsStore.monthlyTokenUsage&&this.settingsStore.basicPlanTokenLimit<=this.userDetailsStore.monthlyTokenUsage&&(this.isAITokenLimitReached=!0),this.year=new Date().getFullYear();const s=["January","February","March","April","May","June","July","August","September","October","November","December"],a=new Date;this.month=s[a.getMonth()]},computed:{formattedStripeCurrentPeriodEndDate(){let e=new Date(this.subscription.current_period_end*1e3);const s=e.getUTCMonth()+1,a=e.getUTCDate();return e.getUTCFullYear()+"/"+s+"/"+a},formattedMonthlyTokenUsage(){return this.userDetailsStore.monthlyTokenUsage?this.userDetailsStore.monthlyTokenUsage.toLocaleString():"0"},formattedFreePlanTokenLimit(){return this.settingsStore.freePlanTokenLimit?this.settingsStore.freePlanTokenLimit.toLocaleString():"0"},formattedBasicPlanTokenLimit(){return this.settingsStore.basicPlanTokenLimit?this.settingsStore.basicPlanTokenLimit.toLocaleString():"0"},subscriptionTierFormatted(){return this.userDetailsStore.subscriptionTier?this.userDetailsStore.subscriptionTier.toLocaleString():"free"}},methods:{async getSubscription(){const s=await(await fetch("/subscriptions/get-sub/"+this.userDetailsStore.userId)).json();if(this.subscription=s.subscription,this.subSchedule=s.subSchedule,this.subSchedule){let a=this.subSchedule.phases[1].items[0].price;a==this.basicPlanPriceId?this.nextSubSchedulePhasePlan="Basic":a==this.infinitePlanPriceId&&(this.nextSubSchedulePhasePlan="Infinite")}},checkout(e){fetch("/subscriptions/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId,planType:e})}).then(s=>s.ok?s.json():s.json().then(a=>Promise.reject(a))).then(({url:s})=>{window.location=s}).catch(s=>{console.error(s.error)})},loadPortal(){fetch("/subscriptions/create-customer-portal-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId})}).then(e=>e.ok?e.json():e.json().then(s=>Promise.reject(s))).then(({url:e})=>{window.location=e}).catch(e=>{console.error(e.error)})},cancelPlan(){if(confirm("Are you sure you want to downgrade to the Free plan?"))fetch("/subscriptions/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId})}).then(function(e){return e.json()}).then(async e=>{e.status=="succeeded"?this.getSubscription():alert("Downgrade did not work. Please try again later.")});else return},downgradePlan(){if(confirm("Are you sure you want to downgrade to the Basic plan?"))this.isLoading=!0,fetch("/subscriptions/downgrade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:this.subscription.id,subScheduleId:this.subSchedule?this.subSchedule.id:null})}).then(function(e){return e.json()}).then(async e=>{e.status=="succeeded"?await this.getSubscription():alert("Downgrade did not work. Please try again later."),this.isLoading=!1});else return},upgradePlan(){if(confirm("Are you sure you want to upgrade to the Infinite plan? (You will be billed immediately)"))this.isLoading=!0,fetch("/subscriptions/upgrade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:this.subscription.id})}).then(function(e){return e.json()}).then(async e=>{e.status=="succeeded"?(await this.userDetailsStore.getUserDetails(),this.$router.push("/subscriptions/completed")):alert("Upgrade did not work. Please try again later."),this.isLoading=!1});else return},openTooltip(){this.showTooltip=!0},closeTooltip(){this.showTooltip=!1}}},l=e=>(S("data-v-110e6f5b"),e=e(),k(),e),_={class:"container"},P={class:"row mt-4"},w={class:"col-md"},D=l(()=>t("strong",null,"Your subscription tier:",-1)),C=l(()=>t("strong",null,"Current token usage:",-1)),I={key:0,class:"modal"},v={class:"modal-content"},L=l(()=>t("p",null," It is against our policy to share accounts and each account is meant to only be used by one user. ",-1)),x=l(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 192 512",width:"20",height:"20",class:"primary-icon"},[t("path",{d:"M48 80a48 48 0 1 1 96 0A48 48 0 1 1 48 80zM0 224c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224 32 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0 0-192-32 0c-17.7 0-32-14.3-32-32z"})],-1)),j=[x],M=l(()=>t("hr",null,null,-1)),U={key:0,class:"d-flex justify-content-center align-items-center py-4"},A=l(()=>t("span",{class:"subscription-loader"},null,-1)),F=[A],O={key:1,class:"row mt-4"},B=l(()=>t("h2",{class:"secondary-heading h4"},"Free",-1)),Y=l(()=>t("strong",null,"Token limit:",-1)),N={key:0,disabled:"",class:"btn primary-btn mt-1"},J=l(()=>t("h2",{class:"secondary-heading h4"},"Basic",-1)),R=l(()=>t("p",null,"Ideal for moderate use",-1)),E=l(()=>t("p",null,"$20 / month",-1)),W=l(()=>t("strong",null,"Token limit:",-1)),z={key:2,disabled:"",class:"btn primary-btn mt-1 mb-3"},V=l(()=>t("h2",{class:"secondary-heading h4"},"Infinite",-1)),Z=l(()=>t("p",null,"Ideal for daily use",-1)),H=l(()=>t("p",null,"$100 / month",-1)),K=l(()=>t("p",null,[t("strong",null,"Token limit:"),p(" Infinite ")],-1)),q={key:2,disabled:"",class:"btn primary-btn mt-1"};function G(e,s,a,b,i,n){return o(),r("div",_,[t("div",P,[t("div",w,[t("h2",{class:d(["secondary-heading h4 mb-4",{"text-center":i.isMobileCheck<576}])}," Monthly AI usage: "+u(i.month)+" "+u(i.year),3),t("ul",null,[t("li",null,[t("p",null,[D,p(" "+u(n.subscriptionTierFormatted),1)])]),t("li",null,[t("p",null,[C,p(" "+u(n.formattedMonthlyTokenUsage),1)])])]),i.isAITokenLimitReached?(o(),r("div",{key:0,class:d(["alert alert-warning",{"mb-0":i.isMobileCheck>=576}]),role:"alert"}," You are over the monthly free limit. You can't use the AI features until next month. ",2)):h("",!0),i.subscription&&i.subscription.cancel_at_period_end?(o(),r("div",{key:1,class:d(["alert alert-warning",{"mb-0":i.isMobileCheck>=576}]),role:"alert"}," Your plan will downgrade to the Free plan on "+u(n.formattedStripeCurrentPeriodEndDate),3)):h("",!0),i.nextSubSchedulePhasePlan!=""?(o(),r("div",{key:2,class:d(["alert alert-warning",{"mb-0":i.isMobileCheck>=576}]),role:"alert"}," Your plan will downgrade to the "+u(i.nextSubSchedulePhasePlan)+" plan on "+u(n.formattedStripeCurrentPeriodEndDate),3)):h("",!0)]),i.showTooltip?(o(),r("div",I,[t("div",v,[t("div",null,[L,t("button",{class:"btn primary-btn",onClick:s[0]||(s[0]=(...c)=>n.closeTooltip&&n.closeTooltip(...c))}," Close ")])])])):h("",!0),t("div",{class:d(["col-md d-flex",i.isMobileCheck>576?"justify-content-end":"justify-content-center"])},[b.userDetailsStore.subscriptionTier!="free"?(o(),r("button",{key:0,class:"btn primary-btn",onClick:s[1]||(s[1]=c=>n.loadPortal())}," Manage subscription ")):h("",!0),t("button",{class:"btn info-btn ms-1",onClick:s[2]||(s[2]=(...c)=>n.openTooltip&&n.openTooltip(...c))},j)],2)]),M,i.isLoading==!0?(o(),r("div",U,F)):(o(),r("div",O,[t("div",{class:d(["col-md mb-3",{"text-center":i.isMobileCheck<576}])},[B,t("p",null,[Y,p(" "+u(n.formattedFreePlanTokenLimit),1)]),b.userDetailsStore.subscriptionTier=="free"?(o(),r("button",N," current plan ")):i.subscription&&i.subscription.cancel_at_period_end==!1&&i.nextSubSchedulePhasePlan!="Basic"?(o(),r("button",{key:1,onClick:s[3]||(s[3]=c=>n.cancelPlan()),class:"btn primary-btn mt-1 mb-3"}," downgrade ")):h("",!0)],2),t("div",{class:d(["col-md mb-3",{"text-center":i.isMobileCheck<576}])},[J,R,E,t("p",null,[W,p(" "+u(n.formattedBasicPlanTokenLimit),1)]),b.userDetailsStore.subscriptionTier=="free"?(o(),r("button",{key:0,onClick:s[4]||(s[4]=c=>n.checkout("basic")),class:"btn primary-btn mt-1"}," buy ")):i.subscription&&b.userDetailsStore.subscriptionTier=="infinite"&&i.nextSubSchedulePhasePlan!="Basic"&&i.subscription.cancel_at_period_end==!1?(o(),r("button",{key:1,onClick:s[5]||(s[5]=c=>n.downgradePlan()),class:"btn primary-btn mt-1"}," downgrade ")):this.userDetailsStore.subscriptionTier=="basic"?(o(),r("button",z," current plan ")):h("",!0)],2),t("div",{class:d(["col-md mb-3",{"text-center":i.isMobileCheck<576}])},[V,Z,H,K,b.userDetailsStore.subscriptionTier=="free"?(o(),r("button",{key:0,onClick:s[6]||(s[6]=c=>n.checkout("infinite")),class:"btn primary-btn mt-1"}," buy ")):i.subscription&&b.userDetailsStore.subscriptionTier=="basic"&&i.subscription.cancel_at_period_end==!1?(o(),r("button",{key:1,onClick:s[7]||(s[7]=c=>n.upgradePlan()),class:"btn primary-btn mt-1"}," upgrade ")):this.userDetailsStore.subscriptionTier=="infinite"?(o(),r("button",q," current plan ")):h("",!0)],2)]))])}const X=m(T,[["render",G],["__scopeId","data-v-110e6f5b"]]);export{X as default};
