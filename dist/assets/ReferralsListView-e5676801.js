import{_,y as m,e as k,r as g,o,c as i,a as r,m as w,p as c,t as u,f as d,k as f,T as C,b as p,F as S,x as b}from"./main-dba12213.js";const v={setup(){const t=m(),e=k();return{usersStore:t,usersDetailsStore:e}},data(){return{referrals:[],copySuccess:!1,copyTimeoutId:null}},async created(){typeof this.usersDetailsStore.userId>"u"&&await this.usersDetailsStore.getUserDetails(),await this.getReferrals()},computed:{referralLink(){return`https://parrhesia.io/student-signup?ref=${this.usersDetailsStore.userName}`}},methods:{async getReferrals(){fetch(`/referrals/${this.usersDetailsStore.userId}/list`).then(function(t){return t.json()}).then(async t=>{await this.usersStore.getUsers(),this.referrals=t;for(let e=0;e<this.referrals.length;e++)for(let s=0;s<this.usersStore.users.length;s++)this.referrals[e].referred_user_id==this.usersStore.users[s].id&&(this.referrals[e].referredUser=this.usersStore.users[s].username),this.referrals[e].referrer_user_id==this.usersStore.users[s].id&&(this.referrals[e].referringUser=this.usersStore.users[s].username);console.log(this.referrals)})},async copyReferralLink(){try{await this.copyToClipboard(this.referralLink)}catch(t){console.error("Copy failed:",t)}},async copyToClipboard(t){this.copyTimeoutId&&clearTimeout(this.copyTimeoutId);let e=!1;if(navigator.clipboard&&window.isSecureContext)try{await navigator.clipboard.writeText(t),e=!0}catch{console.warn("Clipboard API failed, using fallback")}if(!e){await this.$nextTick();const s=this.$refs.referralInput;s&&(s.focus(),s.select(),e=document.execCommand("copy"))}if(e)this.showCopyFeedback();else throw new Error("Could not copy to clipboard")},showCopyFeedback(){this.copySuccess=!0,this.copyTimeoutId=setTimeout(()=>{this.copySuccess=!1,this.copyTimeoutId=null},3e3)}},beforeUnmount(){this.copyTimeoutId&&clearTimeout(this.copyTimeoutId)}},x={class:"container bg-light rounded"},T={class:"d-flex justify-content-between align-items-start"},I={key:0,class:"referral-link-section"},L={class:"d-flex align-items-center gap-2"},R={class:"referral-link-container"},V=["value"],D={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},U={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},j={key:0,class:"copy-success-message mt-2 mb-0"},N={class:"referrals-list"},B={key:0},F={key:1};function H(t,e,s,h,n,l){const y=g("router-link");return o(),i("div",x,[r("div",T,[e[4]||(e[4]=r("h1",{class:"heading"},"Referrals",-1)),h.usersDetailsStore.role=="partner"?(o(),i("div",I,[e[3]||(e[3]=r("h3",{class:"secondary-heading h5 mb-2"},"Student Referral Link",-1)),r("div",L,[r("div",R,[r("input",{ref:"referralInput",value:l.referralLink,type:"text",class:"form-control referral-input",readonly:""},null,8,V),r("button",{onClick:e[0]||(e[0]=(...a)=>l.copyReferralLink&&l.copyReferralLink(...a)),class:w(["btn primary-btn copy-btn",{"btn-success":n.copySuccess}])},[n.copySuccess?(o(),i("svg",U,e[2]||(e[2]=[r("path",{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(o(),i("svg",D,e[1]||(e[1]=[r("path",{d:"M20 9H11C9.89543 9 9 9.89543 9 11V20C9 21.1046 9.89543 22 11 22H20C21.1046 22 22 21.1046 22 20V11C22 9.89543 21.1046 9 20 9Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),r("path",{d:"M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))),c(" "+u(n.copySuccess?"Copied!":"Copy"),1)],2)])]),d(C,{name:"fade"},{default:f(()=>[n.copySuccess?(o(),i("p",j," âœ“ Referral link copied to clipboard! ")):p("",!0)]),_:1})])):p("",!0)]),r("div",N,[n.referrals.length>0?(o(),i("ul",B,[(o(!0),i(S,null,b(n.referrals,a=>(o(),i("li",{key:a.id,class:"mb-2"},[d(y,{to:"/referrals/"+a.referred_user_id},{default:f(()=>[c(u(a.referredUser),1)]),_:2},1032,["to"])]))),128))])):(o(),i("p",F," No referrals yet. Share your referral link to start earning! "))])])}const E=_(v,[["render",H],["__scopeId","data-v-e3304543"]]);export{E as default};
