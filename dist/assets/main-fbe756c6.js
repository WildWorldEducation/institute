import{S as $e,r as ht,k as dt,a as mt,s as H}from"./transform-8aa7b14f.js";import{u as gt,k as yt,t as Xe,l as Je,e as vt,m as kt}from"./time-5737df17.js";import{m as Ye}from"./linear-ebf0540e.js";import{p as bt}from"./band-682f5aee.js";function se(e){return typeof e=="string"?new $e([document.querySelectorAll(e)],[document.documentElement]):new $e([dt(e)],ht)}var at="%Y-%m-%dT%H:%M:%S.%LZ";function xt(e){return e.toISOString()}Date.prototype.toISOString||gt(at);function At(e){var t=new Date(e);return isNaN(t)?null:t}var Et=+new Date("2000-01-01T00:00:00.000Z")?At:yt(at);const It=Et,ce={second:"%Y-%m-%d %H:%M:%S",minute:"%Y-%m-%d %H:%M",hour:"%Y-%m-%d %H:00",day:"%Y-%m-%d",week:"%Y week %W",month:"%Y-%m",quarter:"%Y-Q%Q",year:"%Y"};function zt(e){function t(r,l){return a=>(l(a),r)}return Object.keys(e).reduce((r,l)=>(r[l]=t(r,e[l]),r),{})}const ve="milestones",et=ve+"__category_label",Mt=ve+"__horizontal_line",St=ve+"__vertical_line",Re=ve+"__group",_t=Re+"__bullet",ye=Re+"__label",Le=ye+"-last",Fe=ye+"-above",Pe=ye+"__text",tt=Pe+"__title",ct=Pe+"__event",nt=ct+"--hover",V={DISTRIBUTION:"top-bottom",OPTIMIZE:!1,ORIENTATION:"horizontal",SCALE_TYPE:"time",MAPPING:{category:void 0,entries:void 0,timestamp:"timestamp",value:"value",text:"text",url:"url",id:"id",textStyle:"textStyle",titleStyle:"titleStyle"},LABEL_FORMAT:"%Y-%m-%d %H:%M",USE_LABELS:!0,AGGREGATE_BY:"minute",AUTO_RESIZE:!0,URL_TARGET:"_self"};function We(e,t){let r=e%2;return t==="top"?r=!0:t==="bottom"&&(r=!1),r>0}var B="$";function Ge(){}Ge.prototype=Ne.prototype={constructor:Ge,has:function(e){return B+e in this},get:function(e){return this[B+e]},set:function(e,t){return this[B+e]=t,this},remove:function(e){var t=B+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===B&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===B&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===B&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===B&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===B&&++e;return e},empty:function(){for(var e in this)if(e[0]===B)return!1;return!0},each:function(e){for(var t in this)t[0]===B&&e(this[t],t.slice(1),this)}};function Ne(e,t){var r=new Ge;if(e instanceof Ge)e.each(function(n,c){r.set(c,n)});else if(Array.isArray(e)){var l=-1,a=e.length,s;if(t==null)for(;++l<a;)r.set(l,e[l]);else for(;++l<a;)r.set(t(s=e[l],l,e),s)}else if(e)for(var m in e)r.set(m,e[m]);return r}function qe(){var e=[],t=[],r,l,a;function s(n,c,y,h){if(c>=e.length)return r!=null&&n.sort(r),l!=null?l(n):n;for(var o=-1,d=n.length,T=e[c++],O,k,W=Ne(),I,Y=y();++o<d;)(I=W.get(O=T(k=n[o])+""))?I.push(k):W.set(O,[k]);return W.each(function(f,A){h(Y,A,s(f,c,y,h))}),Y}function m(n,c){if(++c>e.length)return n;var y,h=t[c-1];return l!=null&&c>=e.length?y=n.entries():(y=[],n.each(function(o,d){y.push({key:d,values:m(o,c)})})),h!=null?y.sort(function(o,d){return h(o.key,d.key)}):y}return a={object:function(n){return s(n,0,Ct,Tt)},map:function(n){return s(n,0,st,it)},entries:function(n){return m(s(n,0,st,it),0)},key:function(n){return e.push(n),a},sortKeys:function(n){return t[e.length-1]=n,a},sortValues:function(n){return r=n,a},rollup:function(n){return l=n,a}}}function Ct(){return{}}function Tt(e,t,r){e[t]=r}function st(){return Ne()}function it(e,t,r){e.set(t,r)}function rt(){}var ae=Ne.prototype;rt.prototype={constructor:rt,has:ae.has,add:function(e){return e+="",this[B+e]=e,this},remove:ae.remove,clear:ae.clear,values:ae.keys,size:ae.size,empty:ae.empty,each:ae.each};function ut(e,t){return parseInt(e.style[t].replace("px",""),10)}const ge=6,Ot=(e,t,r,l,a,s,m,n,c,y,h,o,d,T,O,k=!0,W="time")=>{let I=o==="horizontal"&&k?r+m:r-m,Y;do if(o==="horizontal"&&k?I+=m:I-=m,Y=d._groups[I],typeof Y>"u")break;while(n>=Y[0][h]);let f;typeof l.category>"u"?f=a[s.timelineIndex][I]:f=a[s.timelineIndex].entries[I];let A=ut(t,y);if(typeof f<"u"){const G=W==="ordinal"?f.key:e(f.key),X=O(G);o==="horizontal"&k?A=X-c-ge:o==="horizontal"&!k?A=X-ge:A=c-X-ge}else o==="horizontal"&k?A=T-c-ge:(o==="horizontal"&!k,A=c-ge);return m<0?Math.min(c,A):A},Lt=(e,t,r,l)=>e==="horizontal"?t[r+l]:t[r-l],ot=(e,t,r,l,a)=>{const m=Lt(a,r,e,t);let n=0;return typeof m<"u"&&(n=m[0][l]+3),n},lt=20,ie=(e,t)=>parseInt(e.style(t).replace("px",""),10),we=e=>e.select(function(){return this.parentNode}),wt=(e,t,r)=>{const l=e%t;return(r+l)%t!==0},Rt=(e,t,r,l,a,s,m,n,c,y,h="time")=>{const o=qe().key(W=>se(W).data()[0].timelineIndex).entries(m._groups),d=t==="top-bottom"?2:1,T=W=>{let I=0;return o.forEach(Y=>{const f=Y.values;f.forEach(A=>{const G=se(A).data()[0],X=s==="horizontal"?60:20,L=s==="horizontal"?f.length-G.index-1:G.index,te=se(f[L]).data()[0],He=h==="ordinal"?te.key:e(te.key),F=y(He),Z=f[L][0];let J=L===f.length-1;!J&&t==="top-bottom"&&(J=L===f.length-2&&n-F<60);const ze=s==="horizontal"?"offsetWidth":"offsetHeight",ue=s==="horizontal"?"width":"height",fe=ut(Z,ue),x=se(f[L]);let g=J?!0:we(x).classed(Le);const pe=s==="horizontal"?"offsetHeight":"offsetWidth",ke=s==="horizontal"?"padding-bottom":"padding-right",Me=s==="horizontal"?"padding-top":"padding-left",ee=We(L,t)?ke:Me,Se=g?F-fe<0:F+fe>n;if(W===0&&(g=J?!0:Se,x.style(ee,"0px"),we(x).classed(Le,g)),Z[ze]>fe||fe<X||g||Se){let z=null,i=0,ne=s==="horizontal"?d-1:d+1;do if(s==="horizontal"?ne++:ne--,i++,ne>0){const Q=ot(L,d,f,pe,s),j=s==="horizontal"?ot(L,d*-1,f,pe,s):Q;let M=Q<=j&&!J;!M&&!J&&(M=F<X);let v=M?Q:j;J&&(v=0);const S=M?d:d*-1;x.style(ee,v+"px"),we(x).classed(Le,!M),z=Ot(e,Z,L,l,a,G,S,v,F,ue,pe,s,m,n,y,M,h)}while(z<Z[ze]&&i<lt);s==="horizontal"&&(z=Math.min(r,z)),x.style(c,z+"px");const be=ie(x.select(".wrapper"),"width");if(be<z&&(z=be+6,x.style(c,z+"px")),W>0&&s==="horizontal"){const Q=ie(x,"width"),j=g?F-Q:F+Q;f.forEach((v,S)=>{const U=se(v).data()[0];if(U.key===te.key||wt(L,d,S))return;const he=h==="ordinal"?U.key:e(U.key);let _=y(he)-5;const w=_,de=se(f[S]),re=we(de).classed(Le);if(g&&!re){const C=ie(de,"width");_=_+C+5}if(!g&&re){const C=ie(de,"width");_=_-C-5}const xe=g?_>j:j>w,_e=g?w<F:w>F;if(xe&&_e){const C=v[0][pe];if(ie(x,ee)<C){const Ve=g?_-j:j-w,Ae=ie(x,c)-Ve-6;Ae>X?(z=Math.min(z,Ae),x.style(c,`${z}px`)):x.style(ee,`${C+5}px`),I++}}});let M=Number.POSITIVE_INFINITY;f.forEach((v,S)=>{if((We(S,t)?ke:Me)!==ee)return;const he=se(f[S]),_=ie(he,ee);M=Math.min(M,_)}),M>0&&f.forEach((v,S)=>{const U=L%d;if((S+U)%d!==0)return;const _=se(f[S]),w=ie(_,ee);_.style(ee,`${w-M}px`)})}}})}),I};let O=0,k=0;do k=T(O),O++,O===1&&(k=1);while(O<lt&&k>0)};function Ue(e){if(e==="%Y-Q%Q"){const t=Xe(ce.month);return r=>{const l=t(r),a=l.split("-")[1],s=Math.ceil(parseInt(a)/3);return l.split("-")[0]+"-Q"+s}}return Xe(e)}function De(e){if(e==="%Y-Q%Q"){const t=Je(ce.month);return r=>{if(r.search("-Q")===-1){const a=Math.ceil(parseInt(r.split("-")[1])/3)*3-2+"",s=a.length<2?"0"+a:a;return t(r.split("-")[0]+"-"+s)}else{const l=parseInt(r.split("-")[1][1])*3+"",a=l.length<2?"0"+l:l;return t(r.split("-")[0]+"-"+a)}}}return Je(e)}function Pt(e,t,r,l,a="time"){const s=function(n){return a==="ordinal"?n[r.value]:e(l(n[r.timestamp]))};if(typeof r.category<"u"&&typeof r.entries<"u")return t=t.map((n,c)=>({category:n[r.category],entries:m(n[r.entries],c)})),t;typeof t<"u"&&!Array.isArray(t[0])&&(t=[t]);function m(n,c){const y=a==="ordinal"?qe().key(s).entries(n):qe().key(s).sortKeys(mt).entries(n);if(a==="ordinal"){const h={};n.forEach((o,d)=>{const T=s(o);!h[T]&&h[T]!==0&&(h[T]=d)}),y.sort((o,d)=>(h[o.key]||0)-(h[d.key]||0))}return y.map((h,o)=>(h.index=o,h.timelineIndex=c,h.scaleType=a,h))}return t.map((n,c)=>m(n,c))}function Yt(e){let t=V.DISTRIBUTION;function r(i){t=i}let l=V.OPTIMIZE;function a(i){l=i}let s=V.ORIENTATION;function m(i){s=i,H(e).html("")}let n=V.SCALE_TYPE;function c(i){(i==="time"||i==="ordinal")&&(n=i,H(e).html(""))}let y=It;function h(i){y=De(i)}let o=Object.assign({},V.MAPPING);function d(i){o=Object.assign({},o,i)}let T;function O(i){T=Ue(i)}O(V.LABEL_FORMAT);let k;function W(i){Array.isArray(i)&&i.length==2&&(k=i)}let I;function Y(i){I=i}Y(V.USE_LABELS);let f;function A(i){typeof i=="string"&&["_blank","_self","_parent","_top"].includes(i.toLowerCase())&&(f=i)}A(V.URL_TARGET);let G;function X(i){G=i}function L(i){return typeof G=="function"&&(H(this).classed(nt,!0),G(i)),i}let te;function He(i){te=i}function F(i){return typeof G=="function"&&(H(this).classed(nt,!1),te(i)),i}let Z;function J(i){Z=i}function ze(i){return typeof Z=="function"&&Z(i),i}let ue;function fe(i){ue=i}let x=Ue(ce[V.AGGREGATE_BY]),g=De(ce[V.AGGREGATE_BY]);function pe(i){x=Ue(ce[i]),g=De(ce[i]),O(ce[i])}const ke={current:V.AUTO_RESIZE},Me=()=>{H(e).node()!==null&&window.requestAnimationFrame(()=>{ke.current&&z()})};new ResizeObserver(Me).observe(typeof e=="string"?document.querySelector(e):e);function Se(i){ke.current=i}function z(i){const ne=s==="horizontal"?"width":"height",be=s==="horizontal"?"margin-left":"margin-top",Q=s==="horizontal"?Mt:St,j=s==="horizontal"?180:100,M=H(e).selectAll("."+ve),v=typeof i<"u"?Pt(x,i,o,y,n):M.data(),S=M.data(v),U=S.enter().append("div").attr("class",ve);S.exit().remove();const he=11,_=parseFloat(H(e).style(ne))-he;typeof o.category<"u"?(U.append("div").attr("class",et).text(b=>b.category),U.append("div").attr("class","data-js-timeline").append("div").attr("class",Q)):U.append("div").attr("class",Q);const w=S.merge(U),de=[],re=w.selectAll("."+et);re.each((b,R,D)=>{de.push(D[R].offsetWidth)});const xe=Math.round(Ye(de)||0),_e=10,C=_-xe-_e;re.style("width",xe+"px"),s==="vertical"&&(re.style("margin-left","-50%"),re.style("text-align","center")),w.selectAll(".data-js-timeline").style(be,xe+_e+"px"),w.selectAll("."+Q).style(ne,C+"px");const Ce=(typeof o.category>"u"?w:w.selectAll(".data-js-timeline")).selectAll("."+Re).data(b=>typeof o.category>"u"?b:b.entries),Ae=v.reduce((b,R)=>((typeof o.category>"u"?R:R.entries).map(Te=>b.push(Te.key)),b),[]),pt=typeof k<"u"?k.map(g):vt(Ae,b=>g(b)),Ee=n==="ordinal"?bt().range([0,C]).domain(Ae):kt().rangeRound([0,C]).domain(pt),Ze=Ce.enter().append("div").attr("class",Re);Ce.exit().remove(),Ze.append("div").attr("class",_t);const Qe=Ze.merge(Ce).style(be,b=>{b.scaleType=n;const R=n==="ordinal"?b.key:g(b.key);return Ee(R)+"px"});if(I){const b=Qe.selectAll("."+ye+"-"+s).data(u=>[u]),D=b.enter().append("div").attr("class",ye+"-"+s).merge(b).classed(Fe+"-"+s,u=>We(u.index,t)).selectAll("."+Pe+"-"+s).data(u=>[u]),Te=D.enter().append("div").attr("class",Pe+"-"+s).merge(D).style(ne,u=>{u.scaleType=n;const K=n==="ordinal"?u.key:g(u.key),oe=Ee(K);let le,P,p;const N=u.index+1,$=t==="top-bottom"?2:1;typeof o.category>"u"?(le=v[u.timelineIndex][u.index+$],P=v[u.timelineIndex][u.index-$],p=v[u.timelineIndex].length):(le=v[u.timelineIndex].entries[u.index+$],P=v[u.timelineIndex].entries[u.index-$],p=v[u.timelineIndex].entries.length);let q;const E=s==="horizontal"?le:P,me=s==="horizontal"?P:le;if(typeof E<"u"){E.scaleType=n;const Be=n==="ordinal"?E.key:g(E.key),Ie=Ee(Be);q=s==="horizontal"?Ie-oe:oe-Ie,p-N===2&&(q/=2)}else if(p-N===1)q=s==="horizontal"?C-oe:oe;else if(p-N===0)if(typeof me<"u"){me.scaleType=n;const Be=n==="ordinal"?me.key:g(me.key),Ie=Ee(Be);q=s==="horizontal"?(C-Ie)/2:Ie/2}else q=C;const Ke=Math.max(0,q-6);return Math.min(s==="horizontal"?j:Ke,Ke)+"px"}).each(function(u){const K=We(u.index,t),oe=H(this);oe.html(null);const le=u.values.reduce((p,N)=>N[o.titleStyle]!==void 0?Object.assign(p,N[o.titleStyle]):p,{}),P=oe.append("div").classed("wrapper",!0);if(!K||s==="vertical"){const p=P.append("span").classed(tt,!0);n==="ordinal"?p.text(u.key):p.text(T(g(u.key))),Object.entries(le).forEach(([N,$])=>p.style(N,$)),P.append("br")}if(u.values.map((p,N)=>{N>0&&P.append("br");const $=Object.assign({},p[o.textStyle]),q=p[o.text];let E;["jpg","jpeg","gif","png","webp"].indexOf(q.split(".").pop())>-1?E=P.append("img").classed("milestones-label",!0).classed("milestones-image-label",!0).attr("height","100").attr("src",q):p[o.url]?E=P.append("a").classed("milestones-label",!0).classed("milestones-link-label",!0).attr("href",p[o.url]).attr("target",f).text(q):E=P.append("span").classed("milestones-label",!0).classed("milestones-text-label",!0).text(q),p[o.id]&&E.attr("id",p[o.id]),E.datum({text:p[o.text],timestamp:p[o.timestamp],attributes:p}),(typeof Z=="function"||typeof te=="function"||typeof G=="function")&&E.classed(ct,!0),typeof Z=="function"&&E.on("click",ze),typeof te=="function"&&E.on("mouseleave",F),typeof G=="function"&&E.on("mouseover",L),Object.entries($).forEach(([me,je])=>E.style(me,je))}),K&&s==="horizontal"){P.append("br");const p=P.append("span").classed(tt,!0);n==="ordinal"?p.text(u.key):p.text(T(g(u.key))),Object.entries(le).forEach(([N,$])=>p.style(N,$))}}),Oe=D.merge(Te);Oe.style("padding-top","0px").style("padding-bottom","0px"),l&&Rt(g,t,j,o,v,s,Oe,C,ne,Ee,n)}else Qe.selectAll("."+ye+"-"+s).remove();w.each((b,R,D)=>{const Oe=Ye(H(D[R]).selectAll("* ."+Fe+"-"+s)._groups[0],K=>K.offsetHeight),u=Ye(H(D[R]).selectAll("* :not(."+Fe+"-"+s+")")._groups[0],K=>K.offsetHeight);if(s==="horizontal")H(D[R]).style("margin-top",10+(Oe||0)+"px").style("height",10+(u||0)+"px");else{const K=typeof o.category<"u"?Math.round(100/(v.length+1))*(R+1):"50";H(D[R]).style("margin-top","50px").style("margin-left",K+"%").style("position","absolute")}}),typeof ue=="function"&&ue()}return zt({aggregateBy:pe,mapping:d,optimize:a,autoResize:Se,orientation:m,distribution:r,scaleType:c,parseTime:h,labelFormat:O,urlTarget:A,useLabels:Y,range:W,render:z,renderCallback:fe,onEventClick:J,onEventMouseLeave:He,onEventMouseOver:X})}export{Yt as m};
