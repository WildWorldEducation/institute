import{_ as f,o as p,c as _,f as F,A as M,r as u,a as l,q,F as L,z as V,t as N,b as v,g as S,l as C,k as y,p as z,d as H,E as W}from"./main-82201215.js";import{u as P}from"./AnalyticsStore-a3451954.js";import"./transform-4d0f7c8f.js";import{u as B,l as A}from"./line-4303e3e7.js";import{e as I}from"./extent-4cf1c809.js";import{l as w,c as j,b as T,a as U}from"./linear-10cdc182.js";import{m as D,b as Y}from"./continuous-9d6e1afc.js";import{s as b}from"./string-c67ea49d.js";import{s as G}from"./sort-fcaf8f38.js";import"./time-44f0df06.js";import"./point-ea70dc51.js";const J={name:"SchoolProgressChart",setup(){return{analyticsStore:P()}},data(){return{}},mounted(){},methods:{createChart(t){this.$parent.progressChartMode==="school"?(this.axisData=t.school,t.school):(this.axisData=t.teacher,t.teacher);const r=document.getElementById("progress-chart-container").clientWidth,s=document.getElementById("progress-chart-container").clientHeight,a=5,i=20,h=20,n=20,d=B(I(this.analyticsStore.progress.tenant,e=>e.date),[n,r-i]),g=w([0,D(this.analyticsStore.progress.tenant,e=>e.quantity)],[s-h,a]),o=A().x(e=>d(e.date)).y(e=>g(e.quantity)),m=b("#progress-chart-container").append("svg").attr("width",r).attr("height",s).attr("viewBox",[0,0,r,s]).attr("style","max-width: 100%; height: auto; height: intrinsic;");m.append("g").attr("transform",`translate(0,${s-20})`).call(j(d).ticks(r/100).tickSizeOuter(0)),m.append("g").attr("transform",`translate(${n},0)`).call(T(g).ticks(s/40)).call(e=>e.select(".domain").remove()).call(e=>e.selectAll(".tick line").clone().attr("x2",r-n-i).attr("stroke-opacity",.2)).call(e=>e.append("text").attr("x",-n).attr("y",10).attr("fill","currentColor").attr("text-anchor","start")),m.append("path").attr("fill","none").attr("stroke","green").attr("stroke-width",3).attr("d",o(t))}}};function K(t,r,s,a,i,h){return null}const Q=f(J,[["render",K]]),X={name:"SchoolTimeChart",setup(){return{analyticsStore:P()}},data(){return{}},mounted(){},methods:{createChart(t){const r=document.getElementById("time-chart-container").clientWidth,s=document.getElementById("time-chart-container").clientHeight,a=0,i=20,h=20,n=25,d=B(I(this.analyticsStore.time.tenant,e=>e.date),[n,r-i]),g=w([0,D(this.analyticsStore.time.tenant,e=>e.minutes)],[s-h,a]),o=A().x(e=>d(e.date)).y(e=>g(e.minutes)),m=b("#school-time-chart-container").append("svg").attr("width",r).attr("height",s).attr("viewBox",[0,0,r,s]).attr("style","max-width: 100%; height: auto; height: intrinsic;");m.append("g").attr("transform",`translate(0,${s-h})`).call(j(d).ticks(t.length).tickSizeOuter(0)),m.append("g").attr("transform",`translate(${n},0)`).call(T(g).ticks(s/40)).call(e=>e.select(".domain").remove()).call(e=>e.selectAll(".tick line").clone().attr("x2",r-n-i).attr("stroke-opacity",.2)).call(e=>e.append("text").attr("x",-n).attr("y",10).attr("fill","currentColor").attr("text-anchor","start")),m.append("path").attr("fill","none").attr("stroke","#ff7f0e").attr("stroke-width",3).attr("d",o(t))}}},Z={id:"school-time-chart-container"};function tt(t,r,s,a,i,h){return p(),_("div",Z)}const et=f(X,[["render",tt]]),st={name:"TenantFailedAssessmentsByRootSubjectHorizontalBarChart",props:["data"],data(){return{}},mounted(){const i=document.getElementById("failed-chart-container").clientWidth,h=document.getElementById("failed-chart-container").clientHeight,n=w().domain([0,D(this.data,o=>o.quantity)]).range([200,i-0]),d=Y().domain(G(this.data,o=>-o.quantity).map(o=>o.name)).rangeRound([0,h-10]).padding(.1);n.tickFormat(20);const g=b("#failed-chart-container").append("svg").attr("width",i).attr("height",h).attr("viewBox",[0,0,i,h]).attr("style","max-width: 100%; height: 100%;");g.append("g").attr("fill","darkred").selectAll().data(this.data).join("rect").attr("x",n(0)).attr("y",o=>d(o.name)).attr("width",o=>n(o.quantity)-n(0)).attr("height",d.bandwidth()),g.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",o=>n(o.quantity)).attr("y",o=>d(o.name)+d.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(o=>o.quantity).call(o=>o.filter(m=>n(m.quantity)-n(0)<20).attr("dx",4).attr("fill","black").attr("text-anchor","start")),g.append("g").attr("transform","translate(0,0)").call(U(n).ticks(0)).call(o=>o.select(".domain").remove()),g.append("g").attr("transform","translate(200,0)").call(T(d).tickSizeOuter(0))}};function at(t,r,s,a,i,h){return null}const O=f(st,[["render",at]]),rt={name:"TenantTokensPerDayLineChart",props:[],data(){return{}},methods:{createChart(t){const r=document.getElementById("cost-chart-container").clientWidth,s=document.getElementById("cost-chart-container").clientHeight,a=20,i=20,h=20,n=25,d=B(I(t,e=>e.date),[n,r-i]),g=w([0,D(t,e=>e.quantity)],[s-h,a]),o=A().x(e=>d(e.date)).y(e=>g(e.quantity)),m=b("#cost-chart-container").append("svg").attr("width",r).attr("height",s).attr("viewBox",[0,0,r,s]).attr("style","max-width: 100%; height: auto; height: intrinsic;");m.append("g").attr("transform",`translate(0,${s-h})`).call(j(d).ticks(t.length).tickSizeOuter(0)),m.append("g").attr("transform",`translate(${n},0)`).call(T(g).ticks(s/80)).call(e=>e.selectAll(".tick line").clone().attr("x2",r-n-i).attr("stroke-opacity",.1)).call(e=>e.append("text").attr("x",-n).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text("↑ Tokens")),m.append("path").attr("fill","none").attr("stroke","teal").attr("stroke-width",3).attr("d",o(t))}}};function nt(t,r,s,a,i,h){return null}const ot=f(rt,[["render",nt]]);const it={name:"School-Admin-Class-Dashboard",setup(){const t=F(),r=P(),s=M();return{userDetailsStore:t,analyticsStore:r,usersStore:s}},data(){return{progressChartMode:"school",isAboveTheCurve:!1,teachers:[],selectedTeacher:{},isSchoolSelected:!0}},components:{SchoolProgressChart:Q,SchoolTimeChart:et,TenantFailedAssessmentsByRootSubjectHorizontalBarChart:O,SchoolCostChart:ot},async created(){this.teachers.length<1&&await this.getTeachers(this.userDetailsStore.tenantId),await this.getSchoolData(),this.analyticsStore.rootSubjectsFailedAssessments.length==0&&await this.getFailedAssessmentsBySubject(),await this.getSchoolCostData()},methods:{async getTeachers(t){const s=await(await fetch("/tenants/instructors/"+t)).json();for(let a=0;a<s.length;a++)s[a].type="teacher";this.teachers=s},async selectElement(t){this.clearCharts(),t.type==="teacher"?(this.selectedTeacher=t,this.isSchoolSelected=!1,await this.getClassData()):t==="school"&&(this.isSchoolSelected=!0,this.selectedTeacher={},await this.getSchoolData())},clearCharts(){this.analyticsStore.progress.class=[],this.analyticsStore.durationPerDay=[];let t=document.getElementById("progress-chart-container"),r=t.querySelector("svg");r&&r.remove(),t=document.getElementById("time-chart-container"),r=t.querySelector("svg"),r&&r.remove()},async getSchoolData(){this.progressChartMode="school",await this.getSchoolProgressData(),await this.getSchoolTimeData()},async getClassData(){this.progressChartMode="teacher",await this.getClassProgressData(this.selectedTeacher.id),await this.getClassTimeData()},async getSchoolProgressData(){await this.analyticsStore.getSchoolProgress(this.userDetailsStore.tenantId),this.$nextTick(()=>{this.$refs.progressChart&&this.$refs.progressChart.createChart(this.analyticsStore.progress.tenant)})},async getClassProgressData(){await this.analyticsStore.getClassProgress(this.selectedTeacher.id),this.$nextTick(()=>{this.$refs.progressChart&&this.$refs.progressChart.createChart(this.analyticsStore.progress.class)})},async getSchoolTimeData(){await this.analyticsStore.getSchoolTime(this.userDetailsStore.tenantId),this.$nextTick(()=>{this.$refs.timeChart&&this.$refs.timeChart.createChart(this.analyticsStore.time.tenant)})},async getClassTimeData(){await this.analyticsStore.getClassTime(this.selectedTeacher.id),this.$nextTick(()=>{this.$refs.timeChart&&this.$refs.timeChart.createChart(this.analyticsStore.time.class)})},async getFailedAssessmentsBySubject(){try{const t=await fetch(`/student-analytics/failed-assessments-by-subject/tenant/${this.userDetailsStore.tenantId}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);this.analyticsStore.rootSubjectsFailedAssessments=await t.json()}catch(t){console.error("Error fetching cohort mastered assessments:",t),this.analyticsStore.rootSubjectsFailedAssessments=[]}},async getSchoolCostData(){await this.analyticsStore.getSchoolCost(this.userDetailsStore.tenantId,"weekly"),this.$nextTick(()=>{this.$refs.costChart&&this.$refs.costChart.createChart(this.analyticsStore.cost.tenant)})}}},E=t=>(z("data-v-934fc3f3"),t=t(),H(),t),ct={class:"dashboard"},lt={key:0,class:"col-lg-1 col-md-2"},ht={class:"d-flex bg-light rounded p-2"},dt={class:"d-flex bg-light rounded p-2"},gt=["onClick"],mt={class:"container-fluid"},pt={class:"dash-row row"},ut={class:"col-md h-100"},_t=E(()=>l("h2",{class:"heading h5"},"Progress",-1)),yt={id:"progress-chart-container"},ft={key:1},St={class:"col-md"},Ct=E(()=>l("h2",{class:"heading h5"},"Challenges",-1)),xt={id:"failed-chart-container"},$t={key:1},kt={class:"dash-row row"},vt={class:"col-md position-relative h-100"},wt=E(()=>l("h2",{class:"heading h5"},"Cost",-1)),Tt={id:"cost-chart-container"},Dt={key:1},bt={class:"col-md h-100"},Bt=E(()=>l("h2",{class:"heading h5"},"Weekly engagement",-1)),At={id:"time-chart-container"},It={key:1};function jt(t,r,s,a,i,h){const n=u("RouterLink"),d=u("SchoolProgressChart"),g=u("TenantFailedAssessmentsByRootSubjectHorizontalBarChart"),o=u("SchoolCostChart"),m=u("SchoolTimeChart");return p(),_("div",ct,[i.teachers.length>0?(p(),_("div",lt,[l("div",ht,[l("button",{class:q(i.isSchoolSelected?"isCurrentlySelected":"side-buttons"),onClick:r[0]||(r[0]=e=>h.selectElement("school"))}," school ",2)]),(p(!0),_(L,null,V(i.teachers,e=>(p(),_("div",{key:e.id},[l("div",dt,[l("button",{class:q(e.id===i.selectedTeacher.id?"isCurrentlySelected":"side-buttons"),onClick:c=>h.selectElement(e)},N(e.username),11,gt)])]))),128))])):v("",!0),l("div",{class:q([{"col-lg-11":i.teachers.length>0,"col-md-10":i.teachers.length>0,"col-lg-12":i.teachers.length==0},"dashboard"])},[l("div",mt,[l("div",pt,[l("div",ut,[S(n,{to:"/progress-report",class:"",target:"_blank"},{default:C(()=>[_t]),_:1}),l("div",yt,[a.analyticsStore.progress.tenant.length>0||a.analyticsStore.progress.class.length>0?(p(),y(d,{key:0,ref:"progressChart"},null,512)):(p(),_("p",ft,"No data yet"))])]),l("div",St,[S(n,{to:"/challenges-report",class:"",target:"_blank"},{default:C(()=>[Ct]),_:1}),l("div",xt,[a.analyticsStore.rootSubjectsFailedAssessments.length>0?(p(),y(g,{key:0,data:a.analyticsStore.rootSubjectsFailedAssessments,ref:"failedAssessmentsChart"},null,8,["data"])):(p(),_("p",$t,"No challenges yet"))])])]),l("div",kt,[l("div",vt,[S(n,{to:"/cost-report",class:"",target:"_blank"},{default:C(()=>[wt]),_:1}),l("div",Tt,[a.analyticsStore.cost.tenant.length>0||a.analyticsStore.cost.class.length>0?(p(),y(o,{key:0,ref:"costChart"},null,512)):(p(),_("p",Dt,"No data yet"))])]),l("div",bt,[S(n,{to:"/engagement-report",target:"_blank"},{default:C(()=>[Bt]),_:1}),l("div",At,[a.analyticsStore.time.tenant.length>0||a.analyticsStore.time.class.length>0?(p(),y(m,{key:0,ref:"timeChart"},null,512)):(p(),_("p",It,"No data"))])])])])],2)])}const Pt=f(it,[["render",jt],["__scopeId","data-v-934fc3f3"]]),Et={name:"TeacherProgressChart",props:[],data(){return{axisData:[]}},mounted(){},methods:{createChart(t){if(t.class.length==0)this.axisData=t.tenant;else if(t.tenant.length==0)this.axisData=t.class;else{const c=t.class.reduce(($,k)=>Math.max($,k.quantity),-1/0),x=t.tenant.reduce(($,k)=>Math.max($,k.quantity),-1/0);c>=x?this.axisData=t.class:this.axisData=t.tenant}const r=Object.entries(t).map(([c,x])=>({name:c,values:x})),s=document.getElementById("progress-chart-container").clientWidth,a=document.getElementById("progress-chart-container").clientHeight,i=5,h=20,n=20,d=20,g=B(I(this.axisData,c=>c.date),[d,s-h]),o=w([0,D(this.axisData,c=>c.quantity)],[a-n,i]),m=A().x(c=>g(c.date)).y(c=>o(c.quantity)),e=b("#progress-chart-container").append("svg").attr("width","100%").attr("height","100%").attr("viewBox",[0,0,+Math.min(s,a),+Math.min(s,a)]).attr("preserveAspectRatio","xMinYMin");e.append("g").attr("transform",`translate(0,${a-20})`).call(j(g).ticks(s/100).tickSizeOuter(0)),e.append("g").attr("transform",`translate(${d},0)`).call(T(o).ticks(a/80)).call(c=>c.selectAll(".tick line").clone().attr("x2",s-d-h).attr("stroke-opacity",.1)),e.selectAll(".line").data(r).join("path").attr("fill","none").attr("stroke",c=>c.name=="class"?"green":"#ff7f0e").attr("stroke-width",3).attr("d",c=>m(c.values))}}};function Rt(t,r,s,a,i,h){return null}const qt=f(Et,[["render",Rt]]),Ft={name:"SchoolTimeChart",props:[],data(){return{axisData:[]}},mounted(){},methods:{createChart(t){if(t.class.length==0)this.axisData=t.tenant;else if(t.tenant.length==0)this.axisData=t.class;else{const c=t.class.reduce(($,k)=>Math.max($,k.quantity),-1/0),x=t.tenant.reduce(($,k)=>Math.max($,k.quantity),-1/0);c>=x?this.axisData=t.class:this.axisData=t.tenant}const r=Object.entries(t).map(([c,x])=>({name:c,values:x})),s=document.getElementById("time-chart-container").clientWidth,a=document.getElementById("time-chart-container").clientHeight,i=0,h=20,n=20,d=20,g=B(I(this.axisData,c=>c.date),[d,s-h]),o=w([0,D(this.axisData,c=>c.minutes)],[a-n,i]),m=A().x(c=>g(c.date)).y(c=>o(c.minutes)),e=b("#time-chart-container").append("svg").attr("width","100%").attr("height","100%").attr("viewBox",[0,0,+Math.min(s,a),+Math.min(s,a)]).attr("preserveAspectRatio","xMinYMin");e.append("g").attr("transform",`translate(0,${a-n})`).call(j(g).ticks(s/100).tickSizeOuter(0)),e.append("g").attr("transform",`translate(${d},0)`).call(T(o).ticks(a/80)).call(c=>c.selectAll(".tick line").clone().attr("x2",s-d-h).attr("stroke-opacity",.1)),e.selectAll(".line").data(r).join("path").attr("fill","none").attr("stroke",c=>c.name=="class"?"RoyalBlue":"#ff7f0e").attr("stroke-width",3).attr("d",c=>m(c.values))}}};function Mt(t,r,s,a,i,h){return null}const Lt=f(Ft,[["render",Mt]]),zt={name:"TenantTokensPerDayLineChart",props:[],data(){return{}},methods:{createChart(t){const r=document.getElementById("cost-chart-container").clientWidth,s=document.getElementById("cost-chart-container").clientHeight,a=0,i=20,h=20,n=25,d=B(I(t,e=>e.date),[n,r-i]),g=w([0,D(t,e=>e.quantity)],[s-h,a]),o=A().x(e=>d(e.date)).y(e=>g(e.quantity)),m=b("#cost-chart-container").append("svg").attr("width",r).attr("height",s).attr("viewBox",[0,0,r,s]).attr("style","max-width: 100%; height: auto; height: intrinsic;");m.append("g").attr("transform",`translate(0,${s-h})`).call(j(d).ticks(t.length).tickSizeOuter(0)),m.append("g").attr("transform",`translate(${n},0)`).call(T(g).ticks(s/80)).call(e=>e.selectAll(".tick line").clone().attr("x2",r-n-i).attr("stroke-opacity",.1)).call(e=>e.append("text").attr("x",-n).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text("↑ Tokens")),m.append("path").attr("fill","none").attr("stroke","teal").attr("stroke-width",3).attr("d",o(t))}}};function Ht(t,r,s,a,i,h){return null}const Ot=f(zt,[["render",Ht]]);const Vt={name:"Teacher-Analytics-Dashboard",setup(){const t=F(),r=P(),s=M();return{userDetailsStore:t,analyticsStore:r,usersStore:s}},data(){return{progressChartMode:"teacher"}},components:{TeacherProgressChart:qt,TeacherTimeChart:Lt,TeacherCostChart:Ot,TenantFailedAssessmentsByRootSubjectHorizontalBarChart:O},async created(){await this.getProgressData(),await this.getTimeData(),await this.getCostData(),await this.getChallengesData()},methods:{async getProgressData(){await this.analyticsStore.getSchoolProgress(this.userDetailsStore.tenantId),await this.analyticsStore.getClassProgress(this.userDetailsStore.userId),this.$nextTick(()=>{this.$refs.progressChart&&this.$refs.progressChart.createChart(this.analyticsStore.progress)})},async getTimeData(){await this.analyticsStore.getClassTime(this.userDetailsStore.userId),await this.analyticsStore.getSchoolTime(this.userDetailsStore.tenantId),this.$nextTick(()=>{this.$refs.timeChart&&this.$refs.timeChart.createChart(this.analyticsStore.time)})},async getCostData(){await this.analyticsStore.getClassCost(this.userDetailsStore.userId,"weekly"),await this.analyticsStore.getSchoolCost(this.userDetailsStore.tenantId,"weekly"),this.$nextTick(()=>{this.$refs.costChart&&this.$refs.costChart.createChart(this.analyticsStore.cost.class)})},async getComparisonData(){try{const t=await fetch(`/student-analytics/passed-assessments-by-subject/tenant/${this.userDetailsStore.tenantId}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);this.analyticsStore.rootSubjectsPassedAssessments=await t.json(),this.$nextTick(()=>{this.$refs.comparisonChart&&this.$refs.comparisonChart.createChart(this.analyticsStore.rootSubjectsPassedAssessments)})}catch(t){console.error("Error fetching cohort mastered assessments:",t),this.analyticsStore.rootSubjectsPassedAssessments=[]}},async getChallengesData(){await this.analyticsStore.getTeacherClassFailedAssessmentsBySubject(this.userDetailsStore.userId)}}},R=t=>(z("data-v-e3759b66"),t=t(),H(),t),Nt={class:"dashboard"},Wt={class:"container-fluid"},Ut=W('<div class="row top-row" data-v-e3759b66><div class="col-sm top-row-text" data-v-e3759b66><strong data-v-e3759b66>Skills Mastered: </strong><span data-v-e3759b66>10</span></div><div class="col-sm top-row-text" data-v-e3759b66><strong data-v-e3759b66>Students: </strong><span data-v-e3759b66>5</span></div><div class="col-sm top-row-text" data-v-e3759b66></div><div class="col-sm top-row-text" data-v-e3759b66></div></div>',1),Yt={class:"dash-row row"},Gt={class:"col-md h-100"},Jt=R(()=>l("h2",{class:"heading h5"},"Progress",-1)),Kt={id:"progress-chart-container",class:"position-relative"},Qt={class:"col-md h-100"},Xt=R(()=>l("h2",{class:"heading h5"},"Challenges",-1)),Zt={id:"failed-chart-container"},te={class:"dash-row row"},ee={class:"col-md position-relative h-100"},se=R(()=>l("h2",{class:"heading h5"},"AI usage",-1)),ae={id:"cost-chart-container"},re={class:"col-md position-relative h-100"},ne=R(()=>l("h2",{class:"heading h5"},"Engagement",-1)),oe={id:"time-chart-container"};function ie(t,r,s,a,i,h){const n=u("RouterLink"),d=u("TeacherProgressChart"),g=u("TenantFailedAssessmentsByRootSubjectHorizontalBarChart"),o=u("TeacherCostChart"),m=u("TeacherTimeChart");return p(),_("div",Nt,[l("div",Wt,[Ut,l("div",Yt,[l("div",Gt,[S(n,{to:"/progress-report",class:"",target:"_blank"},{default:C(()=>[Jt]),_:1}),l("div",Kt,[a.analyticsStore.progress.tenant.length>0||a.analyticsStore.progress.class.length>0?(p(),y(d,{key:0,ref:"progressChart"},null,512)):v("",!0)])]),l("div",Qt,[S(n,{to:"/challenges-report",class:"",target:"_blank"},{default:C(()=>[Xt]),_:1}),l("div",Zt,[a.analyticsStore.cohortRootSubjectsFailedAssessments.length>0?(p(),y(g,{key:0,data:a.analyticsStore.cohortRootSubjectsFailedAssessments},null,8,["data"])):v("",!0)])])]),l("div",te,[l("div",ee,[S(n,{to:"/reports/cost",class:"chart-heading",target:"_blank"},{default:C(()=>[se]),_:1}),l("div",ae,[a.analyticsStore.cost.tenant.length>0||a.analyticsStore.cost.class.length>0?(p(),y(o,{key:0,ref:"costChart"},null,512)):v("",!0)])]),l("div",re,[S(n,{to:"/engagement-report",class:"chart-heading",target:"_blank"},{default:C(()=>[ne]),_:1}),l("div",oe,[a.analyticsStore.time.tenant.length>0||a.analyticsStore.time.class.length>0?(p(),y(m,{key:0,ref:"timeChart"},null,512)):v("",!0)])])])])])}const ce=f(Vt,[["render",ie],["__scopeId","data-v-e3759b66"]]),le={name:"Dashboard",setup(){return{userDetailsStore:F()}},data(){return{}},components:{SchoolAdminDashboard:Pt,TeacherAnalyticsDashboard:ce},async created(){}};function he(t,r,s,a,i,h){const n=u("SchoolAdminDashboard"),d=u("TeacherAnalyticsDashboard");return p(),_(L,null,[a.userDetailsStore.role=="school_admin"?(p(),y(n,{key:0})):v("",!0),a.userDetailsStore.role=="instructor"||a.userDetailsStore.role=="partner"?(p(),y(d,{key:1})):v("",!0)],64)}const $e=f(le,[["render",he]]);export{$e as default};
