import{u as q}from"./CohortsStore-4297f527.js";import{_,o as h,c as m,f as A,r as p,a as c,t as b,s as f,g,k as S,b as $}from"./main-a6b8d99d.js";import{D as v}from"./downloadCSVBtn-151eb5a9.js";import{C as M}from"./CohortDurationPerDayLineChart-7c5f025f.js";import"./transform-4d0f7c8f.js";import{l as w,a as k,b as C}from"./linear-d9b6cbf2.js";import{m as x}from"./continuous-93813e6c.js";import{b as T}from"./band-2263c9e7.js";import{s as P}from"./sort-fcaf8f38.js";import{s as D}from"./string-c67ea49d.js";import"./line-d122782f.js";import"./time-3c9385c3.js";import"./point-ea70dc51.js";const j={name:"CohortCompareDurationHorizontalChart",props:["data","colour"],data(){return{padding:60}},mounted(){D("#cohort-compare-duration-chart-container");const t=25,e=0,r=0,u=10,a=200,d=1e3,i=Math.ceil((this.data.length+.1)*t)+e+u,n=w().domain([0,x(this.data,o=>o.quantity)]).range([a,d-r]),s=T().domain(P(this.data,o=>-o.quantity).map(o=>o.name)).rangeRound([e,i-u]).padding(.1);n.tickFormat(20);const l=D("#cohort-compare-duration-chart-container").append("svg").attr("width",d).attr("height",i).attr("viewBox",[0,0,d,i]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");l.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",n(0)).attr("y",o=>s(o.name)).attr("width",o=>n(o.quantity)-n(0)).attr("height",s.bandwidth()),l.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",o=>n(o.quantity)).attr("y",o=>s(o.name)+s.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(o=>o.formattedQuantity).call(o=>o.filter(y=>n(y.quantity)-n(0)<20).attr("dx",4).attr("fill","black").attr("text-anchor","start")),l.append("g").attr("transform",`translate(0,${e})`).call(k(n).ticks(0)).call(o=>o.select(".domain").remove()),l.append("g").attr("transform",`translate(${a},0)`).call(C(s).tickSizeOuter(0))}},B={id:"cohort-compare-duration-chart-container"};function N(t,e,r,u,a,d){return h(),m("div",B)}const I=_(j,[["render",N]]),z={name:"CohortDurationPerSkillHorizontalBarChart",props:["data","colour"],data(){return{padding:60}},mounted(){D("#cohort-duration-per-skill-chart-container");const t=25,e=0,r=0,u=10,a=200,d=1e3,i=Math.ceil((this.data.length+.1)*t)+e+u,n=w().domain([0,x(this.data,o=>o.quantity)]).range([a,d-r]),s=T().domain(P(this.data,o=>-o.quantity).map(o=>o.name)).rangeRound([e,i-u]).padding(.1);n.tickFormat(20);const l=D("#cohort-duration-per-skill-chart-container").append("svg").attr("width",d).attr("height",i).attr("viewBox",[0,0,d,i]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");l.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",n(0)).attr("y",o=>s(o.name)).attr("width",o=>n(o.quantity)-n(0)).attr("height",s.bandwidth()),l.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",o=>n(o.quantity)).attr("y",o=>s(o.name)+s.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(o=>o.formattedQuantity).call(o=>o.filter(y=>n(y.quantity)-n(0)<40).attr("dx",4).attr("fill","black").attr("text-anchor","start")),l.append("g").attr("transform",`translate(0,${e})`).call(k(n).ticks(0)).call(o=>o.select(".domain").remove()),l.append("g").attr("transform",`translate(${a},0)`).call(C(s).tickSizeOuter(0))},computed:{}},H={id:"cohort-duration-per-skill-chart-container"};function L(t,e,r,u,a,d){return h(),m("div",H)}const Q=_(z,[["render",L]]),V={setup(){const t=q(),e=A();return{cohortsStore:t,userDetailsStore:e}},components:{CohortDurationPerDayLineChart:M,CohortCompareDurationHorizontalChart:I,CohortDurationPerSkillHorizontalBarChart:Q,DownloadCSVBtn:v},data(){return{cohortId:this.$route.params.cohortId,cohortName:"",durationsPerDay:[],studentTotalDurations:[],studentDurationsPerSkill:[],durationsPerDayDownloadData:[],studentTotalDurationsDownloadData:[],studentDurationsPerSkillDownloadData:[]}},async created(){this.cohortsStore.cohorts.length<1&&await this.cohortsStore.getCohorts(this.userDetailsStore.userId);const t=this.cohortsStore.cohorts.find(e=>e.id==this.cohortId);t&&(this.cohortName=t.name),this.cohortId!="all-students"?(await this.getCohortDurationPerDay(),await this.getCohortStudentTotalDurations(),await this.getCohortDurationsPerSkill()):(await this.getAllStudentsDurationPerDay(),await this.getAllStudentsStudentTotalDurations(),await this.getAllStudentsDurationsPerSkill())},methods:{async getCohortDurationPerDay(){fetch(`/student-analytics/cohort-duration-per-day/${this.cohortId}`).then(t=>t.json()).then(t=>{for(let e=0;e<t.length;e++)t[e].formattedQuantity=t[e].quantity/(1e3*60),t[e].date=new Date(t[e].date);t.sort((e,r)=>e.date-r.date),this.durationsPerDay=t,this.durationsPerDayDownloadData=t.map(e=>({date:new Date(e.date).toLocaleDateString(),minutesSpent:this.millisToMinutesAndSeconds(e.quantity)}))}).catch(t=>{console.error("Error fetching student duration per day:",t)})},async getAllStudentsDurationPerDay(){fetch(`/student-analytics/all-students-duration-per-day/${this.userDetailsStore.userId}`).then(t=>t.json()).then(t=>{for(let e=0;e<t.length;e++)t[e].formattedQuantity=t[e].quantity/(1e3*60),t[e].date=new Date(t[e].date);t.sort((e,r)=>e.date-r.date),this.durationsPerDay=t,this.durationsPerDayDownloadData=t.map(e=>({date:new Date(e.date).toLocaleDateString(),minutesSpent:this.millisToMinutesAndSeconds(e.quantity)}))}).catch(t=>{console.error("Error fetching student duration per day:",t)})},async getCohortStudentTotalDurations(){fetch(`/student-analytics/cohort-total-durations/${this.cohortId}`).then(t=>t.json()).then(t=>{for(let e=0;e<t.length;e++)t[e].formattedQuantity=this.millisToMinutesAndSeconds(t[e].quantity),t[e].date=new Date(t[e].date);t.sort((e,r)=>e.date-r.date),this.studentTotalDurations=t,this.studentTotalDurationsDownloadData=t.map(e=>({studentName:e.name,minutesSpent:this.millisToMinutesAndSeconds(e.quantity)}))}).catch(t=>{console.error("Error fetching student duration per day:",t)})},async getAllStudentsStudentTotalDurations(){fetch(`/student-analytics/all-students-total-durations/${this.userDetailsStore.userId}`).then(t=>t.json()).then(t=>{for(let e=0;e<t.length;e++)t[e].formattedQuantity=this.millisToMinutesAndSeconds(t[e].quantity),t[e].date=new Date(t[e].date);t.sort((e,r)=>e.date-r.date),this.studentTotalDurations=t,this.studentTotalDurationsDownloadData=t.map(e=>({studentName:e.name,minutesSpent:this.millisToMinutesAndSeconds(e.quantity)}))}).catch(t=>{console.error("Error fetching student duration per day:",t)})},async getCohortDurationsPerSkill(){fetch(`/student-analytics/cohort-student-durations-per-skill/${this.cohortId}`).then(t=>t.json()).then(t=>{for(let e=0;e<t.length;e++)t[e].formattedQuantity=this.millisToMinutesAndSeconds(t[e].quantity);this.studentDurationsPerSkill=t,this.studentDurationsPerSkillDownloadData=t.map(e=>({skill:e.name,minutesSpent:this.millisToMinutesAndSeconds(e.quantity)}))}).catch(t=>{console.error("Error fetching student durations per skill:",t)})},async getAllStudentsDurationsPerSkill(){fetch(`/student-analytics/all-students-student-durations-per-skill/${this.userDetailsStore.userId}`).then(t=>t.json()).then(t=>{for(let e=0;e<t.length;e++)t[e].formattedQuantity=this.millisToMinutesAndSeconds(t[e].quantity);this.studentDurationsPerSkill=t,this.studentDurationsPerSkillDownloadData=t.map(e=>({skill:e.name,minutesSpent:this.millisToMinutesAndSeconds(e.quantity)}))}).catch(t=>{console.error("Error fetching student durations per skill:",t)})},millisToMinutesAndSeconds(t){var e=Math.floor(t/6e4),r=(t%6e4/1e3).toFixed(0);return e+":"+(r<10?"0":"")+r}}},E={class:"container"},R={class:"d-flex justify-content-between w-100"},F=c("h1",{class:"heading"},"Time Report",-1),O={class:"secondary-heading h3"},U={class:"secondary-heading d-flex justify-content-between"},G={key:1},J={class:"secondary-heading mt-4 d-flex justify-content-between"},K={key:1},W={class:"secondary-heading mt-4 d-flex justify-content-between"};function X(t,e,r,u,a,d){const i=p("DownloadCSVBtn"),n=p("CohortDurationPerDayLineChart"),s=p("CohortCompareDurationHorizontalChart"),l=p("CohortDurationPerSkillHorizontalBarChart");return h(),m("div",E,[c("span",R,[F,c("h2",O,b(a.cohortName),1)]),c("div",null,[c("h4",U,[f(" Total time on platform per day "),g(i,{data:a.durationsPerDayDownloadData,fileName:"Total time on platform per day"},null,8,["data"])]),a.durationsPerDay.length>0?(h(),S(n,{key:0,data:a.durationsPerDay,class:"mb-5"},null,8,["data"])):(h(),m("p",G,"No time recorded yet"))]),c("div",null,[c("h4",J,[f(" Total time on platform, comparing students "),g(i,{data:a.studentTotalDurationsDownloadData,fileName:"Total time on platform, comparing students"},null,8,["data"])]),a.studentTotalDurations.length>0?(h(),S(s,{key:0,data:a.studentTotalDurations,colour:"#5f31dd",class:"mb-5"},null,8,["data"])):(h(),m("p",K,"No time recorded yet"))]),c("div",null,[c("h4",W,[f(" Minutes per skill "),g(i,{data:a.studentDurationsPerSkillDownloadData,fileName:"Minutes per skill"},null,8,["data"])]),a.studentDurationsPerSkill.length>0?(h(),S(l,{key:0,data:a.studentDurationsPerSkill,class:"mb-5",colour:"#5f31dd"},null,8,["data"])):$("",!0)])])}const ut=_(V,[["render",X]]);export{ut as default};
