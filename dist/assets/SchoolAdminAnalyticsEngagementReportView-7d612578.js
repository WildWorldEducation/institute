import{s as y}from"./transform-62bed377.js";import{_,o as m,c as g,f as b,r as f,a as o,b as C,s as k,k as w,p as D,d as M}from"./main-c87842e3.js";import{l as v,m as T,a as L,b as x,c as P}from"./linear-de29b0e6.js";import{b as O}from"./band-a97ffeb0.js";import{s as A}from"./sort-a49d696f.js";import{o as $}from"./ordinal-ed23e132.js";import{q as j,S as B,p as I,a as S}from"./pie-bbb3c1fc.js";import{u as z,l as R}from"./line-69ff8f5e.js";import{e as E}from"./time-bec744cd.js";import{u as H}from"./AnalyticsStore-4c20b1d2.js";import"./colors-98f238a0.js";import"./point-ea70dc51.js";const N={name:"TenantAvgInteractionTimePerSkill",props:["data","colour"],data(){return{}},mounted(){y("#tenant-avg-interaction-time-per-skill-chart-container");const e=25,t=0,a=0,r=10,d=200,i=1e3,c=Math.ceil((this.data.length+.1)*e)+t+r,l=v().domain([0,T(this.data,s=>s.milliseconds)]).range([d,i-a]),h=O().domain(A(this.data,s=>-s.milliseconds).map(s=>s.name)).rangeRound([t,c-r]).padding(.1);l.tickFormat(20);const n=y("#tenant-avg-interaction-time-per-skill-chart-container").append("svg").attr("width",i).attr("height",c).attr("viewBox",[0,0,i,c]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");n.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",l(0)).attr("y",s=>h(s.name)).attr("width",s=>l(s.milliseconds)-l(0)).attr("height",h.bandwidth()),n.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",s=>l(s.milliseconds)).attr("y",s=>h(s.name)+h.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(s=>s.minutes).call(s=>s.filter(u=>l(u.milliseconds)-l(0)<30).attr("dx",4).attr("fill","black").attr("text-anchor","start")),n.append("g").attr("transform",`translate(0,${t})`).call(L(l).ticks(0)).call(s=>s.select(".domain").remove()),n.append("g").attr("transform",`translate(${d},0)`).call(x(h).tickSizeOuter(0))},computed:{}},U={id:"tenant-avg-interaction-time-per-skill-chart-container"};function V(e,t,a,r,d,i){return m(),g("div",U)}const W=_(N,[["render",V],["__scopeId","data-v-1b2a0514"]]),q={name:"TenantPercentageStudentsMasteredAtLeastOneSkillPieChart",props:["data"],data(){return{}},mounted(){y("#tenant-percentage-students-mastered-one-skill-chart-container");let e=this.data;const t=928,a=Math.min(t,250);$().domain(e.map(n=>n.name)).range(j(n=>B(n*.8+.1),e.length).reverse());const r=I().sort(null).value(n=>n.value),d=S().innerRadius(0).outerRadius(Math.min(t,a)/2-1),i=d.outerRadius()()*.6,c=S().innerRadius(i).outerRadius(i),l=r(e),h=y("#tenant-percentage-students-mastered-one-skill-chart-container").append("svg").attr("width",t).attr("height",a).attr("viewBox",[-t/2,-a/2,t,a]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");h.append("g").attr("stroke","white").selectAll().data(l).join("path").attr("fill",n=>{if(n.data.name==="Mastered one skill")return"darkgreen";if(n.data.name==="Mastered no skills")return"darkred"}).attr("d",d).append("title").text(n=>`${n.data.name}: ${n.data.value.toLocaleString("en-US")}`),h.append("g").attr("text-anchor","middle").selectAll().data(l).join("text").attr("transform",n=>`translate(${c.centroid(n)})`).call(n=>n.append("tspan").attr("y","-0.4em").attr("fill","white").attr("font-weight","bold").text(s=>s.data.name)).call(n=>n.filter(s=>s.endAngle-s.startAngle>.25).append("tspan").attr("x",0).attr("fill","white").attr("y","1em").attr("fill-opacity",1).text(s=>s.data.value.toLocaleString("en-US")))},computed:{}},F={id:"tenant-percentage-students-mastered-one-skill-chart-container"};function Y(e,t,a,r,d,i){return m(),g("div",F)}const G=_(q,[["render",Y]]),J={name:"TenantDurationPerDayLineChart",props:["data","colour"],data(){return{}},mounted(){const e=this.data;y("#tenant-duration-per-day-chart-container");const t=928,a=500,r=20,d=30,i=30,c=40,l=z(E(e,u=>u.date),[c,t-d]),h=v([0,T(e,u=>u.minutes)],[a-i,r]),n=R().x(u=>l(u.date)).y(u=>h(u.minutes)),s=y("#tenant-duration-per-day-chart-container").append("svg").attr("width",t).attr("height",a).attr("viewBox",[0,0,t,a]).attr("style","max-width: 100%; height: auto; height: intrinsic;");s.append("g").attr("transform",`translate(0,${a-i})`).call(P(l).ticks(e.length/2).tickSizeOuter(0)),s.append("g").attr("transform",`translate(${c},0)`).call(x(h).ticks(a/80)).call(u=>u.selectAll(".tick line").clone().attr("x2",t-c-d).attr("stroke-opacity",.1)).call(u=>u.append("text").attr("x",-c).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text("â†‘ Duration in minutes")),s.append("path").attr("fill","none").attr("stroke","#5f31dd").attr("stroke-width",1.5).attr("d",n(e))}},K={id:"tenant-duration-per-day-chart-container"};function Q(e,t,a,r,d,i){return m(),g("div",K)}const X=_(J,[["render",Q]]);const Z={setup(){const e=b(),t=H();return{userDetailsStore:e,analyticsStore:t}},components:{TenantAvgInteractionTimePerSkillHorizontalBarChart:W,TenantPercentageStudentsMasteredAtLeastOneSkillPieChart:G,TenantDurationPerDayLineChart:X},data(){return{tenantId:this.userDetailsStore.tenantId,durationPerDay:[],percentageStudentsMasteredOneSkill:[],isDataWeekly:!1,isTutorialComplete:!1,showTutorialTip1:!1,dataMode:"total"}},async created(){await this.checkIfTutorialComplete(),this.analyticsStore.avgTimeOnSkills.length==0&&await this.getAvgTimeOnSkills(),this.analyticsStore.durationPerDay.length==0&&await this.getTenantDuration(),this.analyticsStore.percentageStudentsMasteredOneSkill.length==0&&await this.getPercentageStudentsMasteredOneSkill()},methods:{async checkIfTutorialComplete(){const t=await(await fetch(`/users/check-tutorial-progress/school-report/${this.userDetailsStore.userId}`)).json();t==0?(this.isTutorialComplete=!1,this.showTutorialTip1=!0):t==1&&(this.isTutorialComplete=!0)},progressTutorial(e){e==1&&(this.showTutorialTip1=!1,this.markTutorialComplete())},restartTutorial(){this.isTutorialComplete=!1,this.showTutorialTip1=!0},markTutorialComplete(){let e="/users/mark-tutorial-complete/school-report/"+this.userDetailsStore.userId;fetch(e,{method:"PUT",headers:{"Content-Type":"application/json"}})},async getAvgTimeOnSkills(){try{const e=await fetch(`/student-analytics/avg-times-on-skills/tenant/${this.tenantId}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();this.analyticsStore.avgTimeOnSkills=Array.isArray(t)?t:[];for(let a=0;a<this.analyticsStore.avgTimeOnSkills.length;a++)this.analyticsStore.avgTimeOnSkills[a].minutes=this.millisToMinutesAndSeconds(this.analyticsStore.avgTimeOnSkills[a].milliseconds)}catch(e){console.error("Error fetching cohort mastered assessments:",e),this.avgTimeOnSkills=[]}},async getTenantDuration(){this.analyticsStore.durationPerDay=[];let e=`/student-analytics/tenant-duration-per-day/${this.dataMode}/${this.tenantId}`;fetch(e).then(t=>t.json()).then(async t=>{this.analyticsStore.durationPerDay=[];for(let a=0;a<t.length;a++)t[a].date=new Date(t[a].date),t[a].minutes=t[a].milliseconds/(1e3*60),this.analyticsStore.durationPerDay.push(t[a]);this.analyticsStore.durationPerDay.sort((a,r)=>a.date-r.date)}).catch(t=>{console.error("Error fetching student progress:",t)})},async getPercentageStudentsMasteredOneSkill(){this.analyticsStore.percentageStudentsMasteredOneSkill=[];try{let e=`/student-analytics/percentage-students-mastered-one-skill/tenant/${this.dataMode}/${this.tenantId}`,t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);this.analyticsStore.percentageStudentsMasteredOneSkill=await t.json()}catch(e){console.error("Error fetching cohort mastered assessments:",e),this.analyticsStore.percentageStudentsMasteredOneSkill=[]}},millisToMinutesAndSeconds(e){var t=Math.floor(e/6e4),a=(e%6e4/1e3).toFixed(0);return t+":"+(a<10?"0":"")+a},downloadData(e,t){const a=Object.keys(e[0]);console.log(a);const r=[];r.push(a.join(","));for(const l of e){const h=a.map(n=>{const s=l[n];return`"${String(s).replace(/"/g,'""')}"`});r.push(h.join(","))}const d=r.join(`
`),i=new Blob([d],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");c.href=URL.createObjectURL(i),c.download=t+".csv",c.click()},async toggleWeeklyCumulativeData(){this.dataMode=="total"?this.dataMode="weekly":this.dataMode="total",await this.getTenantDuration(),await this.getPercentageStudentsMasteredOneSkill()}}},p=e=>(D("data-v-ce517db7"),e=e(),M(),e),tt={class:"container"},et={class:"d-flex justify-content-between w-100 mb-2"},at=p(()=>o("h1",{class:"heading"},"Engagement Report",-1)),nt={class:"btn-group d-flex d-sm-inline-flex mt-2",role:"group"},st=p(()=>o("label",{class:"btn btn-outline-dark btn-sm filter-btn",for:"total1"},"Total",-1)),ot=p(()=>o("label",{class:"btn btn-outline-dark btn-sm filter-btn",for:"week1"},"This week",-1)),rt=p(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 192 512",width:"20",height:"23",class:"primary-icon"},[o("path",{d:"M48 80a48 48 0 1 1 96 0A48 48 0 1 1 48 80zM0 224c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224 32 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0 0-192-32 0c-17.7 0-32-14.3-32-32z"})],-1)),it=[rt],lt={key:0,class:"modal"},ct={class:"modal-content"},dt=p(()=>o("p",{class:"modal-text"}," The School Admin Engagement Report provides comprehensive analytics on student engagement and platform usage across your school. You can download chart data as CSV files using the download buttons next to each chart, and toggle between cumulative (total) and weekly data views using the filter buttons at the top right. ",-1)),ht={class:"d-flex justify-content-between"},ut={class:"chart"},mt={class:"h4 heading d-flex justify-content-between"},pt=p(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"18",height:"18"},[o("path",{d:"M0 64C0 28.7 28.7 0 64 0L213.5 0c17 0 33.3 6.7 45.3 18.7L365.3 125.3c12 12 18.7 28.3 18.7 45.3L384 448c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zm208-5.5l0 93.5c0 13.3 10.7 24 24 24L325.5 176 208 58.5zM175 441c9.4 9.4 24.6 9.4 33.9 0l64-64c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-23 23 0-86.1c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 86.1-23-23c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64z"})],-1)),gt=[pt],yt={key:1,style:{height:"500px"}},_t=p(()=>o("hr",{class:"mt-5 mb-5"},null,-1)),ft={class:"row"},kt={class:"h4 heading d-flex justify-content-between"},wt=p(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"18",height:"18"},[o("path",{d:"M0 64C0 28.7 28.7 0 64 0L213.5 0c17 0 33.3 6.7 45.3 18.7L365.3 125.3c12 12 18.7 28.3 18.7 45.3L384 448c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zm208-5.5l0 93.5c0 13.3 10.7 24 24 24L325.5 176 208 58.5zM175 441c9.4 9.4 24.6 9.4 33.9 0l64-64c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-23 23 0-86.1c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 86.1-23-23c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64z"})],-1)),St=[wt],vt={key:1},Tt=p(()=>o("hr",{class:"mt-5 mb-5"},null,-1)),xt={class:"row"},bt={class:"h4 heading d-flex justify-content-between"},Ct=p(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"18",height:"18"},[o("path",{d:"M0 64C0 28.7 28.7 0 64 0L213.5 0c17 0 33.3 6.7 45.3 18.7L365.3 125.3c12 12 18.7 28.3 18.7 45.3L384 448c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zm208-5.5l0 93.5c0 13.3 10.7 24 24 24L325.5 176 208 58.5zM175 441c9.4 9.4 24.6 9.4 33.9 0l64-64c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-23 23 0-86.1c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 86.1-23-23c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64z"})],-1)),Dt=[Ct],Mt={key:1,class:"mb-5"};function Lt(e,t,a,r,d,i){const c=f("TenantDurationPerDayLineChart"),l=f("TenantAvgInteractionTimePerSkillHorizontalBarChart"),h=f("TenantPercentageStudentsMasteredAtLeastOneSkillPieChart");return m(),g("div",tt,[o("span",et,[at,o("span",null,[o("div",nt,[o("input",{type:"radio",class:"btn-check",name:"timeFilter1",id:"total1",onClick:t[0]||(t[0]=(...n)=>i.toggleWeeklyCumulativeData&&i.toggleWeeklyCumulativeData(...n)),checked:""}),st,o("input",{type:"radio",class:"btn-check",name:"timeFilter1",id:"week1",onClick:t[1]||(t[1]=(...n)=>i.toggleWeeklyCumulativeData&&i.toggleWeeklyCumulativeData(...n))}),ot]),o("button",{class:"btn me-1",onClick:t[2]||(t[2]=(...n)=>i.restartTutorial&&i.restartTutorial(...n)),"aria-label":"info"},it)])]),d.showTutorialTip1?(m(),g("div",lt,[o("div",ct,[dt,o("div",ht,[o("button",{class:"btn primary-btn",onClick:t[3]||(t[3]=n=>i.progressTutorial(1))}," close ")])])])):C("",!0),o("div",ut,[o("h2",mt,[k(" Time per day "),o("button",{class:"btn",onClick:t[4]||(t[4]=n=>i.downloadData(r.analyticsStore.durationPerDay,"Time-per-day"))},gt)]),r.analyticsStore.durationPerDay.length>0?(m(),w(c,{key:0,data:r.analyticsStore.durationPerDay,colour:"#5f31dd",class:"mb-5"},null,8,["data"])):(m(),g("div",yt,"No data yet"))]),_t,o("div",ft,[o("h2",kt,[k(" Average interaction time per skill "),o("button",{class:"btn",onClick:t[5]||(t[5]=n=>i.downloadData(r.analyticsStore.avgTimeOnSkills,"Avg-time-per-skill"))},St)]),r.analyticsStore.avgTimeOnSkills.length>0?(m(),w(l,{key:0,data:r.analyticsStore.avgTimeOnSkills,colour:"purple",class:""},null,8,["data"])):(m(),g("p",vt,"No data yet"))]),Tt,o("div",xt,[o("h2",bt,[k(" Students who completed at least one skill "),o("button",{class:"btn",onClick:t[6]||(t[6]=n=>i.downloadData(r.analyticsStore.percentageStudentsMasteredOneSkill,"Percentage-students-completed-one-skill"))},Dt)]),r.analyticsStore.percentageStudentsMasteredOneSkill.length>0?(m(),w(h,{key:0,data:r.analyticsStore.percentageStudentsMasteredOneSkill,class:"mb-5"},null,8,["data"])):(m(),g("p",Mt,"No data yet"))])])}const Ut=_(Z,[["render",Lt],["__scopeId","data-v-ce517db7"]]);export{Ut as default};
