import{_ as f,A as _,f as S,r as d,o as u,c as p,a as o,t as y,g as h,k as g,s as D,p as v,d as w}from"./main-506f87fd.js";import{u as A}from"./TeacherAnalyticsStore-f7e24e3e.js";import{u as b}from"./AnalyticsStore-167729f6.js";import"./transform-af9a74a2.js";import{b as x,m as k}from"./continuous-7328829e.js";import{l as C,b as N}from"./linear-5b188edc.js";import{s as P}from"./string-dd82ab4a.js";import{S as T}from"./StudentDurationPerDayLineChart-c977f1ba.js";import{D as I}from"./downloadCSVBtn-f3058beb.js";import"./line-85f04100.js";import"./time-0457d93b.js";import"./point-ea70dc51.js";const $={name:"StudentSkillActivityChart",methods:{createChart(e){if(!e||e.length===0){console.warn("No data available for the chart");return}const a=document.getElementById("activity-chart-container").clientWidth,s=document.getElementById("activity-chart-container").clientHeight,n={top:20,right:0,bottom:60,left:200},r=P("#activity-chart-container").append("svg").attr("width","100%").attr("height","100%").append("g").attr("transform",`translate(${n.left},${n.top})`),l=x().domain(e.map(i=>i.name)).range([0,s-35]).padding(.2),c=C().domain([0,k(e,i=>i.quantity)]).range([0,a]);r.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",0).attr("y",i=>l(i.name)).attr("width",i=>i.quantity>0?c(i.quantity/2):c(1)).attr("height",i=>i.quantity>0?l.bandwidth():1).attr("fill","#5f31dd"),r.append("g").attr("class","axis").call(N(l)),r.append("text").attr("class","axis-label").style("font-size","16px").attr("transform",`translate(${a/2},${s+35})`).style("text-anchor","middle").text("Duration (minutes)"),r.selectAll(".bar-label").data(e).enter().append("text").attr("class","bar-label").attr("x",i=>c(i.quantity/2)+5).attr("y",i=>l(i.name)+l.bandwidth()/2).attr("dy","0.35em").style("font-size","14px").text(i=>i.formattedQuantity)}}};function V(e,a,s,n,t,r){return null}const B=f($,[["render",V]]);const q={setup(){const e=_(),a=A(),s=S(),n=b();return{usersStore:e,teacherAnalyticsStore:a,userDetailsStore:s,analyticsStore:n}},components:{StudentDurationPerDayLineChart:T,StudentSkillActivityChart:B,DownloadCSVBtn:I},data(){return{studentId:this.$route.params.studentId,studentName:null,skillDurations:[],durationsPerDay:[],allSkillsDuration:0,totalTimeOnPlatformDownloadData:[],minutesPerSkillDownloadData:[],averageDurationsPerDay:[]}},async created(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const e=this.usersStore.users.find(a=>a.id===this.studentId);e&&(this.studentName=e.username),await this.getStudentDurationPerDay(),await this.getStudentActivity()},methods:{async getStudentDurationPerDay(){let e=`/student-analytics/student-duration-per-day-class/${this.studentId}/${this.userDetailsStore.userId}`;this.userDetailsStore.role==="school_admin"&&(e=`/student-analytics/student-duration-per-day-tenant/${this.studentId}/${this.userDetailsStore.userId}`),fetch(e).then(a=>a.json()).then(a=>{const s=a.studentTime;for(let t=0;t<s.length;t++)s[t].formattedQuantity=s[t].quantity/(1e3*60),s[t].date=new Date(s[t].date);s.sort((t,r)=>t.date-r.date),console.log("response data: "),console.log(s),this.durationsPerDay=s,this.totalTimeOnPlatformDownloadData=this.durationsPerDay.map(t=>({date:t.date,minutes:t.formattedQuantity}));const n=a.averageTime;for(let t=0;t<n.length;t++)n[t].formattedQuantity=n[t].quantity/(1e3*60),n[t].date=new Date(n[t].date);n.sort((t,r)=>t.date-r.date),this.averageDurationsPerDay=n}).catch(a=>{console.error("Error fetching student duration per day:",a)})},async getStudentActivity(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const e=this.usersStore.users.find(a=>a.id===this.studentId);e&&(this.studentName=e.username),this.teacherAnalyticsStore.skillActivities.length==0&&await this.teacherAnalyticsStore.getSkillActivityReport(this.studentId),this.teacherAnalyticsStore.skillActivities=this.teacherAnalyticsStore.skillActivities.map(a=>({...a,formattedQuantity:this.millisToMinutesAndSeconds(a.quantity)})),this.$nextTick(()=>{this.$refs.activityChart&&this.$refs.activityChart.createChart(this.teacherAnalyticsStore.skillActivities)}),this.downloadData=this.teacherAnalyticsStore.skillActivities.map(a=>({skill:a.name,minutes:a.formattedQuantity}))},millisToMinutesAndSeconds(e){var a=Math.floor(e/6e4),s=(e%6e4/1e3).toFixed(0);return a+":"+(s<10?"0":"")+s}}},m=e=>(v("data-v-3e3d8827"),e=e(),w(),e),O={class:"container-fluid chart-page"},Q={class:"d-flex justify-content-between w-100"},j=m(()=>o("h1",{class:"heading h4"},"Engagement",-1)),E={class:"tertiary-heading h4"},R={class:"chart-row row"},L={class:"col-lg chart-col position-relative h-100"},M={id:"time-chart-container"},U={key:1},z={class:"position-absolute"},F={style:{color:"purple"}},H=m(()=>o("span",{style:{color:"#ff7f0e"}},"class average",-1)),W={class:"chart-row row"},G=m(()=>o("div",{class:"col-lg chart-col position-relative"},[o("div",{id:""}," TODO: Add time per subject bar chart ")],-1)),J={class:"col-lg chart-col position-relative"},K={id:"activity-chart-container"};function X(e,a,s,n,t,r){const l=d("DownloadCSVBtn"),c=d("StudentDurationPerDayLineChart"),i=d("StudentSkillActivityChart");return u(),p("div",O,[o("span",Q,[j,o("h2",E,y(t.studentName),1)]),o("div",R,[o("div",L,[o("div",M,[h(l,{data:t.totalTimeOnPlatformDownloadData,fileName:`Total time on platform - ${t.studentName}`,toolTip:"Download total time on platform data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),t.durationsPerDay.length>0?(u(),g(c,{key:0,data:t.durationsPerDay,averageDuration:t.averageDurationsPerDay,userRole:n.userDetailsStore.role,studentName:t.studentName},null,8,["data","averageDuration","userRole","studentName"])):(u(),p("p",U,"There is no data to show yet."))]),o("figcaption",z,[o("span",F,y(t.studentName),1),D(" vs "),H])])]),o("div",W,[G,o("div",J,[o("div",K,[h(l,{data:t.minutesPerSkillDownloadData,fileName:`Minutes per skill - ${t.studentName}`,toolTip:"Download minutes per skill data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),h(i,{ref:"activityChart"},null,512)])])])])}const dt=f(q,[["render",X],["__scopeId","data-v-3e3d8827"]]);export{dt as default};
