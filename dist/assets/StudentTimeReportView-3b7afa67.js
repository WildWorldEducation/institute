import{_ as f,o as h,c as p,A as v,r as y,a as o,t as _,k,b as S,F as $}from"./main-d4af69a9.js";import{s as g}from"./transform-61954928.js";import{l as D,m as x}from"./linear-279a0da9.js";import{b as T,s as P}from"./band-ebb49237.js";import{h as B,b as w,a as b}from"./continuous-f92add0b.js";import{u as A,l as C}from"./line-925d7bdd.js";import{e as M}from"./extent-4cf1c809.js";import"./init-77b53fdd.js";import"./ascending-3ff63084.js";import"./ordinal-ba9b4969.js";import"./time-a3d74c60.js";import"./array-4492e866.js";import"./point-e88f89db.js";const I={name:"TimePerSkillHorizontalBarChart",props:["data","colour"],data(){return{padding:60}},mounted(){g("#time-per-skill-chart-container");const t=25,e=0,n=0,l=10,s=200,d=1e3,c=Math.ceil((this.data.length+.1)*t)+e+l,r=D().domain([0,x(this.data,a=>a.quantity)]).range([s,d-n]),u=T().domain(P(this.data,a=>-a.quantity).map(a=>a.name)).rangeRound([e,c-l]).padding(.1);r.tickFormat(20);const m=g("#time-per-skill-chart-container").append("svg").attr("width",d).attr("height",c).attr("viewBox",[0,0,d,c]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");m.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",r(0)).attr("y",a=>u(a.name)).attr("width",a=>r(a.quantity)-r(0)).attr("height",u.bandwidth()),m.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",a=>r(a.quantity)).attr("y",a=>u(a.name)+u.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(a=>a.formattedQuantity).call(a=>a.filter(i=>r(i.quantity)-r(0)<40).attr("dx",4).attr("fill","black").attr("text-anchor","start")),m.append("g").attr("transform",`translate(0,${e})`).call(B(r).ticks(0)).call(a=>a.select(".domain").remove()),m.append("g").attr("transform",`translate(${s},0)`).call(w(u).tickSizeOuter(0))},computed:{}},L={id:"time-per-skill-chart-container"};function N(t,e,n,l,s,d){return h(),p("div",L)}const j=f(I,[["render",N]]),q={name:"StudentDurationPerDayLineChart",props:["data","colour"],data(){return{padding:60}},mounted(){const t=this.data;g("#student-duration-per-day-chart-container");const e=928,n=500,l=20,s=30,d=30,c=40,r=A(M(t,i=>i.date),[c,e-s]),u=D([0,x(t,i=>i.formattedQuantity)],[n-d,l]),m=C().x(i=>r(i.date)).y(i=>u(i.formattedQuantity)),a=g("#student-duration-per-day-chart-container").append("svg").attr("width",e).attr("height",n).attr("viewBox",[0,0,e,n]).attr("style","max-width: 100%; height: auto; height: intrinsic;");a.append("g").attr("transform",`translate(0,${n-d})`).call(b(r).ticks(t.length/2).tickSizeOuter(0)),a.append("g").attr("transform",`translate(${c},0)`).call(w(u).ticks(n/80)).call(i=>i.selectAll(".tick line").clone().attr("x2",e-c-s).attr("stroke-opacity",.1)).call(i=>i.append("text").attr("x",-c).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text("↑ Duration in seconds")),a.append("path").attr("fill","none").attr("stroke","#5f31dd").attr("stroke-width",1.5).attr("d",m(t))}},E={id:"student-duration-per-day-chart-container"};function Q(t,e,n,l,s,d){return h(),p("div",E)}const z=f(q,[["render",Q]]),H={setup(){return{usersStore:v()}},components:{TimePerSkillHorizontalBarChart:j,StudentDurationPerDayLineChart:z},data(){return{studentId:this.$route.params.studentId,studentName:null,skillDurations:[],durationsPerDay:[],allSkillsDuration:0,isDataLoaded:!1}},async created(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const t=this.usersStore.users.find(e=>e.id===this.studentId);t&&(this.studentName=t.username),await this.getSkillDuration(),await this.getAllSkillsDuration(),await this.getStudentDurationPerDay(),this.isDataLoaded=!0},methods:{async getSkillDuration(){fetch(`/student-analytics/skill-durations/${this.studentId}`).then(t=>t.json()).then(t=>{this.skillDurations=t;for(let e=0;e<this.skillDurations.length;e++)this.skillDurations[e].formattedQuantity=this.millisToMinutesAndSeconds(this.skillDurations[e].quantity)}).catch(t=>{console.error("Error fetching last visited skills:",t)})},async getAllSkillsDuration(){fetch(`/student-analytics/all-skills-duration/${this.studentId}`).then(t=>t.json()).then(t=>{this.allSkillsDuration=t.duration}).catch(t=>{console.error("Error fetching last visited skills:",t)})},async getStudentDurationPerDay(){fetch(`/student-analytics/student-duration-per-day/${this.studentId}`).then(t=>t.json()).then(t=>{for(let e=0;e<t.length;e++)t[e].formattedQuantity=this.millisToMinutesAndSeconds(t[e].quantity),t[e].formattedQuantity=this.convertMinutesSecondsToSeconds(t[e].formattedQuantity),t[e].date=new Date(t[e].date);t.sort((e,n)=>e.date-n.date),this.durationsPerDay=t}).catch(t=>{console.error("Error fetching student duration per day:",t)})},millisToMinutesAndSeconds(t){var e=Math.floor(t/6e4),n=(t%6e4/1e3).toFixed(0);return e+":"+(n<10?"0":"")+n},convertMinutesSecondsToSeconds(t){const e=t.split(":");if(e.length!==2)throw new Error("Invalid duration format. Expected 'MM:SS'.");const n=parseInt(e[0],10),l=parseInt(e[1],10);if(isNaN(n)||isNaN(l))throw new Error("Invalid numerical values in duration string.");return n*60+l}}},R={class:"container"},F={class:"d-flex justify-content-between w-100"},O=o("h1",{class:"heading"},"Time Report",-1),V={class:"secondary-heading h3"},U=o("p",null,[o("em",null," Please note that time spent on external sources (e.g. websites) related to skills is not measured.")],-1),G={key:0},J=o("h2",{class:"secondary-heading"},"Total time on platform",-1),K=o("h2",{class:"secondary-heading"},"All skills",-1),W=o("h2",{class:"secondary-heading"},"Minutes per skill",-1),X={key:2},Y=o("p",null,"No skills visited by this student.",-1),Z=[Y],tt=o("p",null," ",-1);function et(t,e,n,l,s,d){const c=y("StudentDurationPerDayLineChart"),r=y("TimePerSkillHorizontalBarChart");return h(),p($,null,[o("div",R,[o("span",F,[O,o("h2",V,_(s.studentName),1)]),U,s.isDataLoaded?(h(),p("div",G,[J,s.durationsPerDay.length>0?(h(),k(c,{key:0,data:s.durationsPerDay},null,8,["data"])):S("",!0),K,o("p",null,_(d.millisToMinutesAndSeconds(this.allSkillsDuration)),1),W,s.skillDurations.length>0?(h(),k(r,{key:1,data:s.skillDurations,colour:"darkgreen"},null,8,["data"])):(h(),p("div",X,Z))])):S("",!0)]),tt],64)}const gt=f(H,[["render",et]]);export{gt as default};
