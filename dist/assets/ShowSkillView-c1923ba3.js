import{_ as E,h as ct,r as w,o as l,c as a,a as r,t as k,b as u,m,f as S,k as L,j as T,T as et,p as x,E as zt,w as V,v as qt,F as C,x as O,e as B,G as K,H as Y,I as Gt,J as _t,d as Ct,u as Wt,A as st,K as it,g as Kt,L as xt,M as Q,N as Yt}from"./main-c6062aed.js";import{u as Jt,a as Zt}from"./TagsStore-ccc97234.js";import{F as Lt}from"./FlagModals-f8b60ac5.js";import{T as Mt}from"./tutorLoadingSymbol-f74596f8.js";import{T as Qt}from"./TooltipBtn-c903ee25.js";import{S as Xt}from"./SkillTimeTracker-38ebcedc.js";const $t="/images/source-avatars/source-default-avatar.png";const te={setup(){return{sessionDetailsStore:ct()}},props:["post","user"],data(){return{showActionBtns:!1,currentClickId:0}},mounted(){},computed:{},methods:{handleClickActionBtns(e){this.showActionBtns=!this.showActionBtns,this.currentClickId=e},showWarningModal(e){this.$parent.showWarningModal(e,"resource")},voteUp(e,t){t?fetch("/user-votes/"+this.user.userId+"/"+e+"/edit/cancel",{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}).then(()=>this.$parent.getSourceVotes(e)):fetch("/user-votes/"+this.user.userId+"/"+e+"/edit/up",{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}).then(()=>this.$parent.getSourceVotes(e))},voteDown(e,t){t?fetch("/user-votes/"+this.user.userId+"/"+e+"/edit/cancel",{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}).then(()=>{this.$parent.getSourceVotes(e,this.post.type)}):fetch("/user-votes/"+this.user.userId+"/"+e+"/edit/down",{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}).then(()=>{this.$parent.getSourceVotes(e,this.post.type)})},handleOpenFlagModal(e){this.$parent.handleOpenFlagModal(e,"resource")}}},ee={class:"row mt-4 forum-container source"},se={class:"d-flex align-items-center justify-content-between mb-2"},ie={class:"w-100"},oe={class:"col post-user-row"},re={class:"user-avatar"},ne=["src"],le={key:1,src:$t,class:"user-avatar-img",alt:"user avatar"},ae={class:"user-name-div d-flex justify-content-between w-100"},he={class:"user-name-text"},ce={key:0,"b-tooltip.hover":"",title:"This source was created or edited by a human",class:"author-icon me-4",style:{height:"50px"}},ue={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",height:"22",style:{opacity:"0.5"},class:"primary-icon"},de={key:1,"b-tooltip.hover":"",title:"This post was created by an AI",class:"author-icon me-4",style:{height:"50px"}},fe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512",height:"22",style:{opacity:"0.5"},class:"primary-icon"},pe={class:"source"},ge=["innerHTML"],me={class:"d-flex align-items-center justify-content-end mt-3"},ye={class:"first-post-row"},ke={class:"d-flex flex-row justify-content-end gap-1"},we={key:0,width:"34",height:"27",fill:"#36c1af",class:"vote-icon upvote-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},ve={key:1,width:"34",height:"27",fill:"#36c1af",class:"vote-icon upvote-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},be={key:0,width:"34",height:"27",fill:"#FC6E68",class:"vote-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Te={key:1,width:"34",height:"27",fill:"#FC6E68",class:"vote-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Se={key:2,class:"position-relative"},_e={key:0,class:"action-btns-div"},Ce={class:"d-flex flex-row-reverse"},xe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",style:{opacity:"0.5"},height:"20",width:"20",class:"primary-icon"};function Le(e,t,s,i,o,n){const h=w("router-link");return l(),a("div",ee,[r("div",se,[r("div",ie,[r("div",oe,[r("div",re,[i.sessionDetailsStore.isLoggedIn?(l(),a("img",{key:0,src:s.post.avatar,class:"user-avatar-img",alt:"user avatar"},null,8,ne)):(l(),a("img",le))]),r("div",ae,[r("span",he,k(s.post.username),1)]),s.post.is_human_edited?(l(),a("div",ce,[(l(),a("svg",ue,t[5]||(t[5]=[r("path",{d:"M112 48a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm40 304l0 128c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-223.1L59.4 304.5c-9.1 15.1-28.8 20-43.9 10.9s-20-28.8-10.9-43.9l58.3-97c17.4-28.9 48.6-46.6 82.3-46.6l29.7 0c33.7 0 64.9 17.7 82.3 46.6l58.3 97c9.1 15.1 4.2 34.8-10.9 43.9s-34.8 4.2-43.9-10.9L232 256.9 232 480c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-128-16 0z"},null,-1)])))])):(l(),a("div",de,[(l(),a("svg",fe,t[6]||(t[6]=[r("path",{d:"M320 0c17.7 0 32 14.3 32 32l0 64 120 0c39.8 0 72 32.2 72 72l0 272c0 39.8-32.2 72-72 72l-304 0c-39.8 0-72-32.2-72-72l0-272c0-39.8 32.2-72 72-72l120 0 0-64c0-17.7 14.3-32 32-32zM208 384c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zM264 256a40 40 0 1 0 -80 0 40 40 0 1 0 80 0zm152 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80zM48 224l16 0 0 192-16 0c-26.5 0-48-21.5-48-48l0-96c0-26.5 21.5-48 48-48zm544 0c26.5 0 48 21.5 48 48l0 96c0 26.5-21.5 48-48 48l-16 0 0-192 16 0z"},null,-1)])))]))])])]),r("div",pe,[r("div",{class:"forum-post w-auto",innerHTML:s.post.content},null,8,ge)]),r("div",me,[r("div",ye,[r("div",ke,[i.sessionDetailsStore.isLoggedIn?(l(),a("button",{key:0,class:"vote-btn",onClick:t[0]||(t[0]=d=>n.voteUp(s.post.id,s.post.userUpVote)),"b-tooltip.hover":"",title:"I Like This "},[s.post.userUpVote?(l(),a("svg",we,t[7]||(t[7]=[r("path",{d:"M23,10C23,8.89 22.1,8 21,8H14.68L15.64,3.43C15.66,3.33 15.67,3.22 15.67,3.11C15.67,2.7 15.5,2.32 15.23,2.05L14.17,1L7.59,7.58C7.22,7.95 7,8.45 7,9V19A2,2 0 0,0 9,21H18C18.83,21 19.54,20.5 19.84,19.78L22.86,12.73C22.95,12.5 23,12.26 23,12V10M1,21H5V9H1V21Z"},null,-1)]))):(l(),a("svg",ve,t[8]||(t[8]=[r("path",{d:"M5,9V21H1V9H5M9,21A2,2 0 0,1 7,19V9C7,8.45 7.22,7.95 7.59,7.59L14.17,1L15.23,2.06C15.5,2.33 15.67,2.7 15.67,3.11L15.64,3.43L14.69,8H21C22.11,8 23,8.9 23,10V12C23,12.26 22.95,12.5 22.86,12.73L19.84,19.78C19.54,20.5 18.83,21 18,21H9M9,19H18.03L21,12V10H12.21L13.34,4.68L9,9.03V19Z"},null,-1)])))])):u("",!0),r("span",{"b-on-hover":"",title:"number of votes this source received",class:m({"text-danger":s.post.voteCount<0,"primary-color":s.post.voteCount>0,"vote-count":!0})},k(s.post.voteCount),3),i.sessionDetailsStore.isLoggedIn?(l(),a("button",{key:1,class:"vote-btn","b-tooltip.hover":"",title:"I Dislike This ",onClick:t[1]||(t[1]=d=>n.voteDown(s.post.id,s.post.userDownVote))},[s.post.userDownVote?(l(),a("svg",be,t[9]||(t[9]=[r("path",{d:"M19,15H23V3H19M15,3H6C5.17,3 4.46,3.5 4.16,4.22L1.14,11.27C1.05,11.5 1,11.74 1,12V14A2,2 0 0,0 3,16H9.31L8.36,20.57C8.34,20.67 8.33,20.77 8.33,20.88C8.33,21.3 8.5,21.67 8.77,21.94L9.83,23L16.41,16.41C16.78,16.05 17,15.55 17,15V5C17,3.89 16.1,3 15,3Z"},null,-1)]))):(l(),a("svg",Te,t[10]||(t[10]=[r("path",{d:"M19,15V3H23V15H19M15,3A2,2 0 0,1 17,5V15C17,15.55 16.78,16.05 16.41,16.41L9.83,23L8.77,21.94C8.5,21.67 8.33,21.3 8.33,20.88L8.36,20.57L9.31,16H3C1.89,16 1,15.1 1,14V12C1,11.74 1.05,11.5 1.14,11.27L4.16,4.22C4.46,3.5 5.17,3 6,3H15M15,5H5.97L3,12V14H11.78L10.65,19.32L15,14.97V5Z"},null,-1)])))])):u("",!0),i.sessionDetailsStore.isLoggedIn?(l(),a("div",Se,[r("button",{class:"toggle-actions-bnt",onClick:t[2]||(t[2]=d=>n.handleClickActionBtns(s.post.id)),"b-tooltip.hover":"",title:"More Actions For This Source"},t[11]||(t[11]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"grey",class:"more-icon"},[r("path",{d:"M8 256a56 56 0 1 1 112 0A56 56 0 1 1 8 256zm160 0a56 56 0 1 1 112 0 56 56 0 1 1 -112 0zm216-56a56 56 0 1 1 0 112 56 56 0 1 1 0-112z"})],-1)])),S(et,{name:"dropdown"},{default:L(()=>[o.showActionBtns&&s.post.id==o.currentClickId?(l(),a("div",_e,[s.post.user_id==s.user.userId||s.user.role=="platform_admin"||s.user.role=="editor"?(l(),T(h,{key:0,to:"/resources/edit/"+s.post.id,class:"btn dropdown-btn",role:"button","b-tooltip.hover":"",title:"Edit This Source"},{default:L(()=>t[12]||(t[12]=[r("svg",{width:"19",height:"20",viewBox:"0 0 19 20",class:"primary-icon",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M0.75558 19.3181C0.77635 19.5132 0.87137 19.6928 1.02096 19.8198C1.17055 19.9468 1.36325 20.0114 1.55915 20.0002L5.27701 19.8288L0.398438 15.6145L0.75558 19.3181Z"}),r("path",{d:"M11.8467 2.24484L0.801758 15.0315L5.6802 19.2454L16.7251 6.45877L11.8467 2.24484Z",fill:"#857D99"}),r("path",{d:"M18.2555 3.11796L14.934 0.260817C14.832 0.172259 14.7134 0.104756 14.5852 0.0621907C14.4569 0.0196256 14.3215 0.00283902 14.1868 0.0127967C14.052 0.0227543 13.9205 0.0592596 13.7999 0.120212C13.6793 0.181165 13.572 0.265362 13.484 0.36796L12.4805 1.50725L17.359 5.71439L18.3519 4.56082C18.5289 4.35602 18.6181 4.08969 18.6 3.81958C18.582 3.54948 18.4582 3.29738 18.2555 3.11796Z",fill:"#857D99"})],-1)])),_:1,__:[12]},8,["to"])):u("",!0),s.post.user_id==s.user.userId||s.user.role=="platform_admin"||s.user.role=="editor"?(l(),a("button",{key:1,"b-tooltip.hover":"",title:"Delete This Source",type:"button",class:"btn dropdown-btn",onClick:t[3]||(t[3]=d=>n.showWarningModal(s.post))},t[13]||(t[13]=[r("svg",{width:"18",height:"18",viewBox:"0 0 20 20",class:"primary-icon",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M0.312625 14.5205L4.83312 9.99999L0.312625 5.49218C0.111396 5.29025 -0.00159545 5.0168 -0.00159545 4.73172C-0.00159545 4.44665 0.111396 4.17319 0.312625 3.97126L3.96282 0.312625C4.16474 0.111396 4.4382 -0.00159545 4.72327 -0.00159545C5.00835 -0.00159545 5.2818 0.111396 5.48373 0.312625L9.99999 4.83312L14.5205 0.312625C14.6204 0.21056 14.7397 0.12947 14.8714 0.0741101C15.003 0.0187502 15.1444 -0.00976563 15.2873 -0.00976562C15.4301 -0.00976563 15.5715 0.0187502 15.7032 0.0741101C15.8349 0.12947 15.9541 0.21056 16.0541 0.312625L19.6874 3.96282C19.8886 4.16474 20.0016 4.4382 20.0016 4.72327C20.0016 5.00835 19.8886 5.2818 19.6874 5.48373L15.1669 9.99999L19.6874 14.5205C19.8883 14.7217 20.0012 14.9944 20.0012 15.2788C20.0012 15.5632 19.8883 15.836 19.6874 16.0372L16.0541 19.6874C15.8529 19.8883 15.5801 20.0012 15.2957 20.0012C15.0113 20.0012 14.7386 19.8883 14.5374 19.6874L9.99999 15.1669L5.49218 19.6874C5.29025 19.8886 5.0168 20.0016 4.73172 20.0016C4.44665 20.0016 4.17319 19.8886 3.97126 19.6874L0.312625 16.0541C0.21056 15.9541 0.12947 15.8349 0.0741101 15.7032C0.0187502 15.5715 -0.00976563 15.4301 -0.00976562 15.2873C-0.00976563 15.1444 0.0187502 15.003 0.0741101 14.8714C0.12947 14.7397 0.21056 14.6204 0.312625 14.5205Z"})],-1)]))):u("",!0),r("button",{"b-tooltip.hover":"",title:"Flag This Source For Review",type:"button",class:"btn dropdown-btn",onClick:t[4]||(t[4]=d=>n.handleOpenFlagModal(s.post.id,s.post.type))},[r("div",Ce,[(l(),a("svg",xe,t[14]||(t[14]=[r("path",{d:"M64 32C64 14.3 49.7 0 32 0S0 14.3 0 32V64 368 480c0 17.7 14.3 32 32 32s32-14.3 32-32V352l64.3-16.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30V66.1c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L64 48V32z"},null,-1)])))])])])):u("",!0)]),_:1})])):u("",!0)])])])])}const Me=E(te,[["render",Le]]);const Ae={props:["post","user"],data(){return{showActionBtns:!1,currentClickId:0,isAlreadyTutoring:this.$parent.isAlreadyTutoring,expandPost:!1,showActionButton:!1,showContactDetails:!1}},mounted(){},computed:{},methods:{showWarningModal(e){this.$parent.showWarningModal(e,"tutorPost")},voteUp(e,t){t?fetch("/tutor-votes/"+this.user.userId+"/"+e+"/edit/cancel",{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}).then(()=>this.$parent.getTutorPostVotes(e)):fetch("/tutor-votes/"+this.user.userId+"/"+e+"/edit/up",{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}).then(()=>this.$parent.getTutorPostVotes(e))},voteDown(e,t){t?fetch("/tutor-votes/"+this.user.userId+"/"+e+"/edit/cancel",{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}).then(()=>this.$parent.getTutorPostVotes(e)):fetch("/tutor-votes/"+this.user.userId+"/"+e+"/edit/down",{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}).then(()=>this.$parent.getTutorPostVotes(e))},handleOpenFlagModal(e){this.$parent.handleOpenFlagModal(e,"tutor_post")},deleteTutorPost(e){this.$parent.deleteTutorPost(e,"tutorPost")},toPlainText(e){return e==null?void 0:e.replace(/<\/?[^>]+(>|$)/g,"")},showContactAdviceModal(){this.showContactDetails=!this.showContactDetails,document.getElementById("myModal").addEventListener("click",e=>{e.target.classList.contains("modal-content")||(this.showContactDetails=!1)}),document.getElementById("modal-content").addEventListener("click",function(e){e.stopPropagation()},!1)}}},Ie={class:"d-flex justify-content-center ms-3 ms-md-0 tutor-avatar-div"},De=["src"],Re={class:"d-flex flex-column w-100"},Ee={class:"d-flex flex-row justify-content-between"},Pe={class:"tutor-user-name text-capitalize"},Oe={class:"d-flex mt-4 tutor-post"},Be={key:0,class:"d-flex flex-column"},He=["innerHTML"],Ne={class:"d-flex align-items-center justify-content-end mt-3"},Ue={class:"first-post-row"},Ve={class:"d-flex flex-row justify-content-end gap-1"},je={key:0,width:"34",height:"27",fill:"#36c1af",class:"vote-icon upvote-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Fe={key:1,width:"34",height:"27",fill:"#36c1af",class:"vote-icon upvote-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},ze={key:0,width:"34",height:"27",fill:"#FC6E68",class:"vote-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},qe={key:1,width:"34",height:"27",fill:"#FC6E68",class:"vote-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Ge={class:"position-relative"},We={key:0,class:"action-btns-div"},Ke=["title"],Ye={class:"d-flex flex-row-reverse"},Je={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",style:{opacity:"0.5"},height:"20",width:"20",class:"primary-icon"},Ze={id:"myModal",class:"modal"},Qe={id:"modal-content",class:"modal-content contact-modal-content"},Xe=["innerHTML"];function $e(e,t,s,i,o,n){const h=w("router-link");return l(),a(C,null,[r("div",zt(e.$attrs,{class:"tutor d-flex w-100 p-3 flex-column flex-lg-row mt-4"}),[r("div",Ie,[r("img",{src:s.post.avatar,class:"tutor-img rounded",alt:"user avatar"},null,8,De)]),r("div",Re,[r("div",Ee,[r("div",Pe,k(s.post.username),1),r("div",{"b-on-hover":"",title:"expand cover letter",style:{cursor:"pointer"},onClick:t[0]||(t[0]=d=>o.expandPost=!o.expandPost),class:m([o.expandPost?"arrow-up":"arrow-down"])},t[9]||(t[9]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",heigh:"15",width:"15",fill:"grey"},[r("path",{d:"M201.4 137.4c12.5-12.5 32.8-12.5 45.3 0l160 160c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L224 205.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l160-160z"})],-1)]),2)]),r("div",Oe,[o.expandPost?u("",!0):(l(),a("p",{key:0,class:"tutor-post-content","b-on-hover":"",title:"expand this cover letter",onClick:t[1]||(t[1]=d=>o.expandPost=!0)},[t[10]||(t[10]=r("span",{class:"cover-letter-word"},"cover letter - ",-1)),x(k(n.toPlainText(s.post.description)),1)])),S(et,{name:"dropdown"},{default:L(()=>[o.expandPost?(l(),a("div",Be,[r("p",{innerHTML:s.post.description},null,8,He),r("button",{class:"btn green-btn mt-2 me-0 ms-auto w-auto mb-3",onClick:t[2]||(t[2]=d=>n.showContactAdviceModal())}," Contact details ")])):u("",!0)]),_:1})]),r("div",Ne,[r("div",Ue,[r("div",Ve,[s.post.user_id!=s.user.userId?(l(),a("button",{key:0,class:"vote-btn",onClick:t[3]||(t[3]=d=>n.voteUp(s.post.id,s.post.userUpVote,s.post.type)),"b-tooltip.hover":"",title:"I Vote This User "},[s.post.userUpVote?(l(),a("svg",je,t[11]||(t[11]=[r("path",{d:"M23,10C23,8.89 22.1,8 21,8H14.68L15.64,3.43C15.66,3.33 15.67,3.22 15.67,3.11C15.67,2.7 15.5,2.32 15.23,2.05L14.17,1L7.59,7.58C7.22,7.95 7,8.45 7,9V19A2,2 0 0,0 9,21H18C18.83,21 19.54,20.5 19.84,19.78L22.86,12.73C22.95,12.5 23,12.26 23,12V10M1,21H5V9H1V21Z"},null,-1)]))):(l(),a("svg",Fe,t[12]||(t[12]=[r("path",{d:"M5,9V21H1V9H5M9,21A2,2 0 0,1 7,19V9C7,8.45 7.22,7.95 7.59,7.59L14.17,1L15.23,2.06C15.5,2.33 15.67,2.7 15.67,3.11L15.64,3.43L14.69,8H21C22.11,8 23,8.9 23,10V12C23,12.26 22.95,12.5 22.86,12.73L19.84,19.78C19.54,20.5 18.83,21 18,21H9M9,19H18.03L21,12V10H12.21L13.34,4.68L9,9.03V19Z"},null,-1)])))])):u("",!0),r("span",{"b-on-hover":"",title:"number of votes this tutor post received",class:m({"text-danger":s.post.voteCount<0,"primary-color":s.post.voteCount>0,"vote-count":!0})},k(s.post.voteCount),3),s.post.user_id!=s.user.userId?(l(),a("button",{key:1,class:"vote-btn","b-tooltip.hover":"",title:"I Dislike This ",onClick:t[4]||(t[4]=d=>n.voteDown(s.post.id,s.post.userDownVote,s.post.type))},[s.post.userDownVote?(l(),a("svg",ze,t[13]||(t[13]=[r("path",{d:"M19,15H23V3H19M15,3H6C5.17,3 4.46,3.5 4.16,4.22L1.14,11.27C1.05,11.5 1,11.74 1,12V14A2,2 0 0,0 3,16H9.31L8.36,20.57C8.34,20.67 8.33,20.77 8.33,20.88C8.33,21.3 8.5,21.67 8.77,21.94L9.83,23L16.41,16.41C16.78,16.05 17,15.55 17,15V5C17,3.89 16.1,3 15,3Z"},null,-1)]))):(l(),a("svg",qe,t[14]||(t[14]=[r("path",{d:"M19,15V3H23V15H19M15,3A2,2 0 0,1 17,5V15C17,15.55 16.78,16.05 16.41,16.41L9.83,23L8.77,21.94C8.5,21.67 8.33,21.3 8.33,20.88L8.36,20.57L9.31,16H3C1.89,16 1,15.1 1,14V12C1,11.74 1.05,11.5 1.14,11.27L4.16,4.22C4.46,3.5 5.17,3 6,3H15M15,5H5.97L3,12V14H11.78L10.65,19.32L15,14.97V5Z"},null,-1)])))])):u("",!0),r("div",Ge,[r("button",{class:"toggle-actions-bnt",onClick:t[5]||(t[5]=d=>o.showActionBtns=!o.showActionBtns),"b-tooltip.hover":"",title:"More Actions For This Tutor Offer"},t[15]||(t[15]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"grey",class:"more-icon"},[r("path",{d:"M8 256a56 56 0 1 1 112 0A56 56 0 1 1 8 256zm160 0a56 56 0 1 1 112 0 56 56 0 1 1 -112 0zm216-56a56 56 0 1 1 0 112 56 56 0 1 1 0-112z"})],-1)])),S(et,{name:"dropdown"},{default:L(()=>[o.showActionBtns?(l(),a("div",We,[s.post.user_id==s.user.userId||s.user.role=="platform_admin"||s.user.role=="editor"?(l(),T(h,{key:0,to:"/tutor/edit/"+s.post.id,class:"btn dropdown-btn",role:"button","b-tooltip.hover":"",title:"Edit This Tutor Post"},{default:L(()=>t[16]||(t[16]=[r("svg",{width:"19",height:"20",viewBox:"0 0 19 20",class:"primary-icon",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M0.75558 19.3181C0.77635 19.5132 0.87137 19.6928 1.02096 19.8198C1.17055 19.9468 1.36325 20.0114 1.55915 20.0002L5.27701 19.8288L0.398438 15.6145L0.75558 19.3181Z"}),r("path",{d:"M11.8467 2.24484L0.801758 15.0315L5.6802 19.2454L16.7251 6.45877L11.8467 2.24484Z",fill:"#857D99"}),r("path",{d:"M18.2555 3.11796L14.934 0.260817C14.832 0.172259 14.7134 0.104756 14.5852 0.0621907C14.4569 0.0196256 14.3215 0.00283902 14.1868 0.0127967C14.052 0.0227543 13.9205 0.0592596 13.7999 0.120212C13.6793 0.181165 13.572 0.265362 13.484 0.36796L12.4805 1.50725L17.359 5.71439L18.3519 4.56082C18.5289 4.35602 18.6181 4.08969 18.6 3.81958C18.582 3.54948 18.4582 3.29738 18.2555 3.11796Z",fill:"#857D99"})],-1)])),_:1,__:[16]},8,["to"])):u("",!0),s.post.user_id==s.user.userId||s.user.role=="platform_admin"||s.user.role=="editor"?(l(),a("button",{key:1,"b-tooltip.hover":"",title:"'Delete This Tutor Post'",type:"button",class:"btn dropdown-btn",onClick:t[6]||(t[6]=d=>n.showWarningModal(s.post))},t[17]||(t[17]=[r("svg",{width:"18",height:"18",viewBox:"0 0 20 20",class:"primary-icon",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M0.312625 14.5205L4.83312 9.99999L0.312625 5.49218C0.111396 5.29025 -0.00159545 5.0168 -0.00159545 4.73172C-0.00159545 4.44665 0.111396 4.17319 0.312625 3.97126L3.96282 0.312625C4.16474 0.111396 4.4382 -0.00159545 4.72327 -0.00159545C5.00835 -0.00159545 5.2818 0.111396 5.48373 0.312625L9.99999 4.83312L14.5205 0.312625C14.6204 0.21056 14.7397 0.12947 14.8714 0.0741101C15.003 0.0187502 15.1444 -0.00976563 15.2873 -0.00976562C15.4301 -0.00976563 15.5715 0.0187502 15.7032 0.0741101C15.8349 0.12947 15.9541 0.21056 16.0541 0.312625L19.6874 3.96282C19.8886 4.16474 20.0016 4.4382 20.0016 4.72327C20.0016 5.00835 19.8886 5.2818 19.6874 5.48373L15.1669 9.99999L19.6874 14.5205C19.8883 14.7217 20.0012 14.9944 20.0012 15.2788C20.0012 15.5632 19.8883 15.836 19.6874 16.0372L16.0541 19.6874C15.8529 19.8883 15.5801 20.0012 15.2957 20.0012C15.0113 20.0012 14.7386 19.8883 14.5374 19.6874L9.99999 15.1669L5.49218 19.6874C5.29025 19.8886 5.0168 20.0016 4.73172 20.0016C4.44665 20.0016 4.17319 19.8886 3.97126 19.6874L0.312625 16.0541C0.21056 15.9541 0.12947 15.8349 0.0741101 15.7032C0.0187502 15.5715 -0.00976563 15.4301 -0.00976562 15.2873C-0.00976563 15.1444 0.0187502 15.003 0.0741101 14.8714C0.12947 14.7397 0.21056 14.6204 0.312625 14.5205Z"})],-1)]))):u("",!0),r("button",{"b-tooltip.hover":"",title:s.post.type!="tutor"?"Flag This Source For Review":"Flag This Tutor Post For Review",type:"button",class:"btn dropdown-btn",onClick:t[7]||(t[7]=d=>n.handleOpenFlagModal(s.post.id,s.post.type))},[r("div",Ye,[(l(),a("svg",Je,t[18]||(t[18]=[r("path",{d:"M64 32C64 14.3 49.7 0 32 0S0 14.3 0 32V64 368 480c0 17.7 14.3 32 32 32s32-14.3 32-32V352l64.3-16.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30V66.1c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L64 48V32z"},null,-1)])))])],8,Ke)])):u("",!0)]),_:1})])])])])])],16),V(r("div",null,[r("div",Ze,[r("div",Qe,[r("button",{type:"button",class:"close closeBtn",onClick:t[8]||(t[8]=d=>n.showContactAdviceModal()),"aria-label":"Close"},t[19]||(t[19]=[r("span",{"aria-hidden":"true"},[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"25",height:"25"},[r("path",{d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z",fill:"black"})])],-1)])),r("div",{innerHTML:s.post.contact_preference},null,8,Xe)])])],512),[[qt,o.showContactDetails]])],64)}const ts=E(Ae,[["render",$e],["__scopeId","data-v-049d1615"]]);const es={setup(){return{sessionDetailsStore:ct()}},emits:["progressTutorial","skipTutorial"],props:["posts","user","skillId","showTutorialTip10","userRole"],data(){return{showActionBtns:!1,currentClickId:0,isAlreadyTutoring:this.$parent.isAlreadyTutoring,showWarnModal:!1,currentPost:null,warnText:"",deletePostType:"",isLoading:!0,isAlreadyTutoring:!1}},components:{TutorPostCard:ts,SourcePostCard:Me},mounted(){this.showTutorialTip10&&this.scrollToTooltip()},watch:{showTutorialTip10(e){e&&this.$nextTick(()=>{this.scrollToTooltip()})}},computed:{orderedAndNamedPosts(){var e=this.posts.sort((t,s)=>s.voteCount===t.voteCount?new Date(s.created_at)-new Date(t.created_at):s.voteCount-t.voteCount);for(let t=0;t<this.posts.length;t++)this.posts[t].type=="tutor-post"&&e[t].user_id==this.sessionDetailsStore.userId&&(this.isAlreadyTutoring=!0);return this.isLoading=!1,e},tutorialTipContent(){return this.userRole==="editor"||this.userRole==="instructor"?"You can also share resources that you have personally used to learn about this topic. Your contributions can help others in their learning journey.":"You can also volunteer to tutor others on this subject and share resources you, personally, have used to learn about this topic"}},methods:{deletePost(e,t){switch(this.deletePostType){case"tutorPost":this.$parent.deleteTutorPost(this.currentPost),this.isAlreadyTutoring=!1;break;default:this.$parent.deletePost(this.currentPost);break}this.showWarnModal=!1},showWarningModal(e,t){switch(t){case"tutorPost":this.warnText="Are you sure you want to remove this tutor offer?",this.deletePostType="tutorPost";break;default:this.deletePostType="resource",this.warnText="Are you sure you want to delete this source?";break}this.currentPost=e,this.showWarnModal=!0},handleOpenFlagModal(e,t){this.$parent.flagPost=e,this.$parent.showFlaggingModal=!0,this.showActionBtns=!1,this.$parent.flagType=t},getSourceVotes(e){this.$parent.getSourceVotes(e)},getTutorPostVotes(e){this.$parent.getTutorPostVotes(e)},scrollToTooltip(){this.$nextTick(()=>{var e;(e=this.$refs.tutorialTip10)==null||e.scrollIntoView({behavior:"smooth",block:"center"})})}}},ss={key:0,class:"d-flex flex-column"},is={class:"d-flex flex-column w-100"},os={class:"d-flex justify-content-xl-end justify-content-between"},rs={key:0,ref:"tutorialTip10",class:"tool-tip-base d-flex justify-content-end"},ns={class:"explain-tool-tip triangle-top-right hovering-info-panel"},ls={class:"tool-tip-text"},as={class:"d-flex justify-content-between"},hs={id:"posts-big-container"},cs={key:1},us={id:"myModal",class:"modal"},ds={class:"modal-content"},fs={style:{display:"flex",gap:"10px"}};function ps(e,t,s,i,o,n){const h=w("router-link"),d=w("SourcePostCard"),f=w("TutorPostCard");return l(),a(C,null,[i.sessionDetailsStore.isLoggedIn?(l(),a("div",ss,[r("div",is,[r("div",os,[S(h,{to:"/resources/add/"+s.skillId,class:"btn primary-btn me-2",role:"button"},{default:L(()=>t[4]||(t[4]=[x("Add source   ",-1),r("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M6.34811 20.0423L6.34811 13.6494L-0.0358702 13.6583C-0.320945 13.6579 -0.594203 13.5444 -0.795782 13.3428C-0.997361 13.1412 -1.11082 12.868 -1.11132 12.5829L-1.11729 7.41477C-1.1168 7.1297 -1.00334 6.85644 -0.801757 6.65486C-0.600179 6.45328 -0.326921 6.33982 -0.0418461 6.33933L6.3481 6.34231L6.3481 -0.0506238C6.34659 -0.193451 6.3736 -0.335145 6.42756 -0.467396C6.48152 -0.599646 6.56134 -0.719794 6.66234 -0.820794C6.76334 -0.921794 6.88349 -1.00161 7.01574 -1.05557C7.14799 -1.10953 7.28969 -1.13655 7.43251 -1.13503L12.5827 -1.12308C12.8678 -1.12259 13.141 -1.00913 13.3426 -0.807549C13.5442 -0.60597 13.6577 -0.332713 13.6582 -0.047637L13.6552 6.34231L20.0481 6.34231C20.3325 6.34248 20.6052 6.45552 20.8063 6.65661C21.0074 6.8577 21.1204 7.13039 21.1206 7.41477L21.1325 12.565C21.1324 12.8494 21.0193 13.122 20.8182 13.3231C20.6171 13.5242 20.3444 13.6373 20.0601 13.6374L13.6552 13.6494L13.6641 20.0334C13.6636 20.3184 13.5502 20.5917 13.3486 20.7933C13.147 20.9948 12.8738 21.1083 12.5887 21.1088L7.43252 21.1267C7.28969 21.1282 7.148 21.1012 7.01575 21.0473C6.88349 20.9933 6.76335 20.9135 6.66235 20.8125C6.56135 20.7115 6.48153 20.5913 6.42757 20.4591C6.37361 20.3268 6.34659 20.1851 6.34811 20.0423Z",fill:"white"})],-1)])),_:1,__:[4]},8,["to"]),s.user.role=="student"&&o.isAlreadyTutoring==!1?(l(),T(h,{key:0,to:"/tutor/add/"+s.skillId,class:"btn primary-btn",role:"button"},{default:L(()=>t[5]||(t[5]=[x("Offer to tutor   ",-1),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"18",height:"20"},[r("path",{d:"M32 32C32 14.3 46.3 0 64 0S96 14.3 96 32V240H32V32zM224 192c0-17.7 14.3-32 32-32s32 14.3 32 32v64c0 17.7-14.3 32-32 32s-32-14.3-32-32V192zm-64-64c17.7 0 32 14.3 32 32v48c0 17.7-14.3 32-32 32s-32-14.3-32-32V160c0-17.7 14.3-32 32-32zm160 96c0-17.7 14.3-32 32-32s32 14.3 32 32v64c0 17.7-14.3 32-32 32s-32-14.3-32-32V224zm-96 88l0-.6c9.4 5.4 20.3 8.6 32 8.6c13.2 0 25.4-4 35.6-10.8c8.7 24.9 32.5 42.8 60.4 42.8c11.7 0 22.6-3.1 32-8.6V352c0 88.4-71.6 160-160 160H162.3c-42.4 0-83.1-16.9-113.1-46.9L37.5 453.5C13.5 429.5 0 396.9 0 363V336c0-35.3 28.7-64 64-64h88c22.1 0 40 17.9 40 40s-17.9 40-40 40H96c-8.8 0-16 7.2-16 16s7.2 16 16 16h56c39.8 0 72-32.2 72-72z",fill:"white"})],-1)])),_:1,__:[5]},8,["to"])):u("",!0)]),s.showTutorialTip10?(l(),a("div",rs,[r("div",ns,[r("div",ls,[r("p",null,k(n.tutorialTipContent),1),r("div",as,[r("button",{class:"btn primary-btn",onClick:t[0]||(t[0]=y=>e.$emit("progressTutorial",10))}," Next "),r("button",{class:"btn red-btn",onClick:t[1]||(t[1]=y=>e.$emit("skipTutorial"))}," exit tutorial ")])])])],512)):u("",!0)])])):u("",!0),r("div",hs,[(l(!0),a(C,null,O(n.orderedAndNamedPosts,y=>(l(),a("div",null,[y.type==="source"?(l(),T(d,{key:0,post:y,user:s.user},null,8,["post","user"])):u("",!0),y.type==="tutor-post"?(l(),T(f,{key:1,post:y,user:s.user,class:"my-4"},null,8,["post","user"])):u("",!0)]))),256))]),o.showWarnModal?(l(),a("div",cs,[r("div",us,[r("div",ds,[r("p",null,k(o.warnText),1),r("div",fs,[r("button",{type:"button",class:"btn btn-danger",onClick:t[2]||(t[2]=y=>n.deletePost())}," Yes "),r("button",{type:"button",class:"btn btn-dark",onClick:t[3]||(t[3]=y=>o.showWarnModal=!1)}," No ")])])])])):u("",!0)],64)}const gs=E(es,[["render",ps],["__scopeId","data-v-6cc63391"]]);const ms={setup(){return{userDetailsStore:B()}},emits:["progressTutorial","skipTutorial"],props:["skillId","showTutorialTip10","userRole"],data(){return{sourcePosts:[],tutorPosts:[],user:{},showModal:!1,resourceId:null,showFlaggingModal:!1,flagPost:"",flagType:"",showActionBtns:!1,currentClickId:"",source:null,activeTab:"allPost"}},components:{FlagModals:Lt,ForumAllPost:gs},computed:{posts(){let e=this.sourcePosts;return e=e.concat(this.tutorPosts),e}},async created(){await this.getUserId(),await this.getSourcePosts(this.skillId);for(let e=0;e<this.sourcePosts.length;e++)await this.getSourceVotes(this.sourcePosts[e].id);if(this.$parent.sessionDetailsStore.isLoggedIn==!0){await this.getTutorPosts(this.skillId);for(let e=0;e<this.tutorPosts.length;e++)await this.getTutorPostVotes(this.tutorPosts[e].id)}},methods:{async getUserId(){fetch("/get-session-details").then(function(e){return e.json()}).then(e=>this.user=e)},async getSourcePosts(e){await fetch("/skills/"+e+"/resources").then(function(t){return t.json()}).then(t=>{t.forEach(function(s){s.type="source"}),this.sourcePosts=t})},async getSourceVotes(e){await fetch("/user-votes/"+e).then(t=>t.json()).then(t=>{var s=t,i=0;let o=!1,n=!1;for(let h=0;h<s.length;h++)s[h].user_id==this.user.userId&&(s[h].vote==1?o=!0:s[h].vote==-1&&(n=!0)),i=i+s[h].vote;for(let h=0;h<this.sourcePosts.length;h++)this.sourcePosts[h].id==e&&(this.sourcePosts[h].voteCount=i,this.sourcePosts[h].userUpVote=o,this.sourcePosts[h].userDownVote=n)})},async getTutorPosts(e){await fetch("/tutor-posts/"+e+"/list").then(function(t){return t.json()}).then(t=>{t.forEach(s=>{s.type="tutor-post",s.contact_preference==null&&(s.contact_preference=s.email)});for(let s=0;s<t.length;s++)t[s].skill_id==this.skillId&&this.tutorPosts.push(t[s])})},async getTutorPostVotes(e){await fetch("/tutor-votes/"+e).then(t=>t.json()).then(t=>{var s=t,i=0;let o=!1,n=!1;for(let h=0;h<s.length;h++)s[h].user_id==this.user.userId&&(s[h].vote==1?o=!0:s[h].vote==-1&&(n=!0)),i=i+s[h].vote;for(let h=0;h<this.tutorPosts.length;h++)this.tutorPosts[h].id==e&&(this.tutorPosts[h].voteCount=i,this.tutorPosts[h].userUpVote=o,this.tutorPosts[h].userDownVote=n)})},deletePost(e){switch(this.showModal=!1,e.type){case"tutor-post":fetch("/tutor-posts/delete/"+e.id,{method:"DELETE"}).then(()=>{this.isAlreadyTutoring=!1}),this.tutorPosts=this.tutorPosts.filter(t=>t.id!==e.id);break;case"source":fetch("/resources/delete/"+e.id,{method:"DELETE"}),this.sourcePosts=this.sourcePosts.filter(t=>t.id!==e.id);break}},deleteTutorPost(e){this.showModal=!1,fetch("/tutor-posts/delete/"+e.id,{method:"DELETE"}).then(()=>{this.getS,this.isAlreadyTutoring=!1}),this.tutorPosts=this.tutorPosts.filter(t=>t.id!=e.id)},showWarningModal(e){this.source=e,this.showModal=!0},closeWarningModal(){this.showModal=!1},handleTabClick(e){switch(e){case"tutorPost":this.activeTab="tutorPost";break;case"resource":this.activeTab="resource";break;default:this.activeTab="allPost";break}}}},ys={class:"container-fluid mt-4"};function ks(e,t,s,i,o,n){const h=w("ForumAllPost"),d=w("FlagModals");return l(),a(C,null,[r("div",ys,[t[2]||(t[2]=r("div",{class:"forum-header"},[r("h2",{class:"secondary-heading"},"Other Places To Learn This")],-1)),S(h,{posts:n.posts,user:o.user,skillId:s.skillId,showTutorialTip10:s.showTutorialTip10,userRole:i.userDetailsStore.role,onProgressTutorial:t[0]||(t[0]=f=>e.$emit("progressTutorial",f)),onSkipTutorial:t[1]||(t[1]=f=>e.$emit("skipTutorial",f))},null,8,["posts","user","skillId","showTutorialTip10","userRole"])]),o.showFlaggingModal?(l(),T(d,{key:0,userId:i.userDetailsStore.userId,contentType:o.flagType,contentId:o.flagPost},null,8,["userId","contentType","contentId"])):u("",!0)],64)}const ws=E(ms,[["render",ks],["__scopeId","data-v-692c33e8"]]);const vs={props:["tutorType","skill","skillLevel","learningObjectives","isAITokenLimitReached"],emits:["recording-started","recording-stopped","message-sent"],setup(){const e=B(),t=K(),s=Y();return{userDetailsStore:e,settingStore:t,tenantStore:s}},data(){return{chunks:[],micAllowed:!1,mediaRecorder:null,stream:null,recording:!1,isLoading:!1,recordingTimer:null,recordingDuration:0}},methods:{async allowMic(){try{navigator.mediaDevices&&(this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.mediaRecorder=new MediaRecorder(this.stream),this.setupMediaRecorder(),this.micAllowed=!0)}catch(e){console.error("Error accessing microphone:",e),alert("Could not access your microphone. Please check your browser settings.")}},setupMediaRecorder(){this.mediaRecorder&&(this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.chunks.push(e.data)},this.mediaRecorder.onstop=()=>{const e=new Blob(this.chunks,{type:"audio/webm; codecs=opus"});this.chunks=[];const t=new FileReader;t.readAsDataURL(e),t.onloadend=()=>this.sendAudioDataToServer(t.result)})},async startRecording(){if(!(!this.mediaRecorder&&(await this.allowMic(),!this.mediaRecorder)))try{this.mediaRecorder.start(),this.recording=!0,this.recordingDuration=0,this.recordingTimer=setInterval(()=>this.recordingDuration++,1e3),this.$emit("recording-started")}catch(e){console.error("Error starting recording:",e),this.resetRecorder()}},stopRecording(){if(!(!this.mediaRecorder||!this.recording))try{this.mediaRecorder.stop(),this.recording=!1,this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null),this.isLoading=!0,this.$emit("recording-stopped")}catch(e){console.error("Error stopping recording:",e),this.resetRecorder()}},recordSpeech(){this.recording?this.stopRecording():this.startRecording()},async sendAudioDataToServer(e){try{const t=await fetch("/ai-tutor/stt/convert",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({skillUrl:this.skill.url,skillName:this.skill.name,skillId:this.skill.id,skillLevel:this.englishSkillLevel||this.skillLevel,learningObjectives:this.learningObjectives,audioData:e,tutorType:this.tutorType,freeMonthlyTokenLimit:this.settingStore.freeTokenMonthlyLimit,monthlyTokenUsage:this.userDetailsStore.monthlyTokenUsage,billingMode:this.tenantStore.billingMode,tenantId:this.userDetailsStore.tenantId})});if(this.isLoading=!1,t.ok)await this.$parent.getChatHistory(),this.$emit("message-sent"),this.$nextTick(()=>{this.$parent.scrollToMessageInput&&this.$parent.scrollToMessageInput()});else throw new Error("Server error")}catch(t){console.error("Error sending audio data:",t),this.isLoading=!1,this.$emit("message-error"),alert("Failed to send your recording. Please try again.")}},resetRecorder(){this.recording=!1,this.isLoading=!1,this.chunks=[],this.recordingDuration=0,this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null)},cleanupResources(){if(this.recordingTimer&&clearInterval(this.recordingTimer),this.mediaRecorder&&this.recording)try{this.mediaRecorder.stop()}catch(e){console.error("Error stopping media recorder during cleanup:",e)}this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.mediaRecorder=null,this.micAllowed=!1,this.recording=!1,this.isLoading=!1,this.chunks=[]},formatTime(e){const t=Math.floor(e/60),s=e%60;return`${t}:${s.toString().padStart(2,"0")}`}},mounted(){this.visibilityHandler=()=>{document.visibilityState==="hidden"&&this.recording&&this.stopRecording()},document.addEventListener("visibilitychange",this.visibilityHandler)},beforeUnmount(){document.removeEventListener("visibilitychange",this.visibilityHandler),this.cleanupResources()}},bs={class:"voice-recorder"},Ts=["disabled"],Ss={key:1,class:"recording-container"},_s=["disabled","title"],Cs={key:0,width:"20",height:"20",viewBox:"0 0 384 512",fill:"currentColor"},xs={key:1,width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor"},Ls={key:2,class:"spinner"},Ms={key:0,class:"recording-indicator"},As={class:"recording-timer"};function Is(e,t,s,i,o,n){return l(),a("div",bs,[o.micAllowed?(l(),a("div",Ss,[r("button",{class:m(["voice-btn",{recording:o.recording,processing:o.isLoading}]),onClick:t[1]||(t[1]=h=>n.recordSpeech()),disabled:s.isAITokenLimitReached||o.isLoading,title:o.recording?"Stop recording":"Start recording"},[!o.recording&&!o.isLoading?(l(),a("svg",Cs,t[3]||(t[3]=[r("path",{d:"M192 0C139 0 96 43 96 96l0 160c0 53 43 96 96 96s96-43 96-96l0-160c0-53-43-96-96-96zM64 216c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 40c0 89.1 66.2 162.7 152 174.4l0 33.6-48 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l72 0 72 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-48 0 0-33.6C321.8 418.7 384 345.1 384 256l0-40c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 40c0 70.7-57.3 128-128 128s-128-57.3-128-128l0-40z"},null,-1)]))):o.recording?(l(),a("svg",xs,t[4]||(t[4]=[r("path",{d:"M6,6H18V18H6V6Z"},null,-1)]))):o.isLoading?(l(),a("div",Ls)):u("",!0)],10,_s),o.recording?(l(),a("div",Ms,[t[5]||(t[5]=r("div",{class:"recording-pulse"},null,-1)),r("span",As,k(n.formatTime(o.recordingDuration)),1)])):u("",!0)])):(l(),a("button",{key:0,class:"voice-btn permission",onClick:t[0]||(t[0]=h=>n.allowMic()),disabled:s.isAITokenLimitReached,title:"Allow microphone access"},t[2]||(t[2]=[r("svg",{width:"20",height:"20",viewBox:"0 0 384 512",fill:"currentColor"},[r("path",{d:"M192 0C139 0 96 43 96 96l0 160c0 53 43 96 96 96s96-43 96-96l0-160c0-53-43-96-96-96zM64 216c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 40c0 89.1 66.2 162.7 152 174.4l0 33.6-48 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l72 0 72 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-48 0 0-33.6C321.8 418.7 384 345.1 384 256l0-40c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 40c0 70.7-57.3 128-128 128s-128-57.3-128-128l0-40z"})],-1)]),8,Ts))])}const Ds=E(vs,[["render",Is],["__scopeId","data-v-6548d61f"]]),R=Object.create(null);R.open="0";R.close="1";R.ping="2";R.pong="3";R.message="4";R.upgrade="5";R.noop="6";const z=Object.create(null);Object.keys(R).forEach(e=>{z[R[e]]=e});const ot={type:"error",data:"parser error"},At=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",It=typeof ArrayBuffer=="function",Dt=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,ut=({type:e,data:t},s,i)=>At&&t instanceof Blob?s?i(t):yt(t,i):It&&(t instanceof ArrayBuffer||Dt(t))?s?i(t):yt(new Blob([t]),i):i(R[e]+(t||"")),yt=(e,t)=>{const s=new FileReader;return s.onload=function(){const i=s.result.split(",")[1];t("b"+(i||""))},s.readAsDataURL(e)};function kt(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let X;function Rs(e,t){if(At&&e.data instanceof Blob)return e.data.arrayBuffer().then(kt).then(t);if(It&&(e.data instanceof ArrayBuffer||Dt(e.data)))return t(kt(e.data));ut(e,!1,s=>{X||(X=new TextEncoder),t(X.encode(s))})}const wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<wt.length;e++)U[wt.charCodeAt(e)]=e;const Es=e=>{let t=e.length*.75,s=e.length,i,o=0,n,h,d,f;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const y=new ArrayBuffer(t),p=new Uint8Array(y);for(i=0;i<s;i+=4)n=U[e.charCodeAt(i)],h=U[e.charCodeAt(i+1)],d=U[e.charCodeAt(i+2)],f=U[e.charCodeAt(i+3)],p[o++]=n<<2|h>>4,p[o++]=(h&15)<<4|d>>2,p[o++]=(d&3)<<6|f&63;return y},Ps=typeof ArrayBuffer=="function",dt=(e,t)=>{if(typeof e!="string")return{type:"message",data:Rt(e,t)};const s=e.charAt(0);return s==="b"?{type:"message",data:Os(e.substring(1),t)}:z[s]?e.length>1?{type:z[s],data:e.substring(1)}:{type:z[s]}:ot},Os=(e,t)=>{if(Ps){const s=Es(e);return Rt(s,t)}else return{base64:!0,data:e}},Rt=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},Et=String.fromCharCode(30),Bs=(e,t)=>{const s=e.length,i=new Array(s);let o=0;e.forEach((n,h)=>{ut(n,!1,d=>{i[h]=d,++o===s&&t(i.join(Et))})})},Hs=(e,t)=>{const s=e.split(Et),i=[];for(let o=0;o<s.length;o++){const n=dt(s[o],t);if(i.push(n),n.type==="error")break}return i};function Ns(){return new TransformStream({transform(e,t){Rs(e,s=>{const i=s.length;let o;if(i<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,i);else if(i<65536){o=new Uint8Array(3);const n=new DataView(o.buffer);n.setUint8(0,126),n.setUint16(1,i)}else{o=new Uint8Array(9);const n=new DataView(o.buffer);n.setUint8(0,127),n.setBigUint64(1,BigInt(i))}e.data&&typeof e.data!="string"&&(o[0]|=128),t.enqueue(o),t.enqueue(s)})}})}let $;function j(e){return e.reduce((t,s)=>t+s.length,0)}function F(e,t){if(e[0].length===t)return e.shift();const s=new Uint8Array(t);let i=0;for(let o=0;o<t;o++)s[o]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),s}function Us(e,t){$||($=new TextDecoder);const s=[];let i=0,o=-1,n=!1;return new TransformStream({transform(h,d){for(s.push(h);;){if(i===0){if(j(s)<1)break;const f=F(s,1);n=(f[0]&128)===128,o=f[0]&127,o<126?i=3:o===126?i=1:i=2}else if(i===1){if(j(s)<2)break;const f=F(s,2);o=new DataView(f.buffer,f.byteOffset,f.length).getUint16(0),i=3}else if(i===2){if(j(s)<8)break;const f=F(s,8),y=new DataView(f.buffer,f.byteOffset,f.length),p=y.getUint32(0);if(p>Math.pow(2,53-32)-1){d.enqueue(ot);break}o=p*Math.pow(2,32)+y.getUint32(4),i=3}else{if(j(s)<o)break;const f=F(s,o);d.enqueue(dt(n?f:$.decode(f),t)),i=0}if(o===0||o>e){d.enqueue(ot);break}}}})}const Pt=4;function v(e){if(e)return Vs(e)}function Vs(e){for(var t in v.prototype)e[t]=v.prototype[t];return e}v.prototype.on=v.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};v.prototype.once=function(e,t){function s(){this.off(e,s),t.apply(this,arguments)}return s.fn=t,this.on(e,s),this};v.prototype.off=v.prototype.removeListener=v.prototype.removeAllListeners=v.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+e];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var i,o=0;o<s.length;o++)if(i=s[o],i===t||i.fn===t){s.splice(o,1);break}return s.length===0&&delete this._callbacks["$"+e],this};v.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(s){s=s.slice(0);for(var i=0,o=s.length;i<o;++i)s[i].apply(this,t)}return this};v.prototype.emitReserved=v.prototype.emit;v.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};v.prototype.hasListeners=function(e){return!!this.listeners(e).length};const J=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,s)=>s(t,0))(),M=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),js="arraybuffer";function Ot(e,...t){return t.reduce((s,i)=>(e.hasOwnProperty(i)&&(s[i]=e[i]),s),{})}const Fs=M.setTimeout,zs=M.clearTimeout;function Z(e,t){t.useNativeTimers?(e.setTimeoutFn=Fs.bind(M),e.clearTimeoutFn=zs.bind(M)):(e.setTimeoutFn=M.setTimeout.bind(M),e.clearTimeoutFn=M.clearTimeout.bind(M))}const qs=1.33;function Gs(e){return typeof e=="string"?Ws(e):Math.ceil((e.byteLength||e.size)*qs)}function Ws(e){let t=0,s=0;for(let i=0,o=e.length;i<o;i++)t=e.charCodeAt(i),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(i++,s+=4);return s}function Bt(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Ks(e){let t="";for(let s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t}function Ys(e){let t={},s=e.split("&");for(let i=0,o=s.length;i<o;i++){let n=s[i].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}class Js extends Error{constructor(t,s,i){super(t),this.description=s,this.context=i,this.type="TransportError"}}class ft extends v{constructor(t){super(),this.writable=!1,Z(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,s,i){return super.emitReserved("error",new Js(t,s,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const s=dt(t,this.socket.binaryType);this.onPacket(s)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,s={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(s)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const s=Ks(t);return s.length?"?"+s:""}}class Zs extends ft{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const s=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||s()})),this.writable||(i++,this.once("drain",function(){--i||s()}))}else s()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const s=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};Hs(t,this.socket.binaryType).forEach(s),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Bs(t,s=>{this.doWrite(s,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",s=this.query||{};return this.opts.timestampRequests!==!1&&(s[this.opts.timestampParam]=Bt()),!this.supportsBinary&&!s.sid&&(s.b64=1),this.createUri(t,s)}}let Ht=!1;try{Ht=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Qs=Ht;function Xs(){}class $s extends Zs{constructor(t){if(super(t),typeof location<"u"){const s=location.protocol==="https:";let i=location.port;i||(i=s?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port}}doWrite(t,s){const i=this.request({method:"POST",data:t});i.on("success",s),i.on("error",(o,n)=>{this.onError("xhr post error",o,n)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(s,i)=>{this.onError("xhr poll error",s,i)}),this.pollXhr=t}}class D extends v{constructor(t,s,i){super(),this.createRequest=t,Z(this,i),this._opts=i,this._method=i.method||"GET",this._uri=s,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var t;const s=Ot(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");s.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(s);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let o in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(o)&&i.setRequestHeader(o,this._opts.extraHeaders[o])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var o;i.readyState===3&&((o=this._opts.cookieJar)===null||o===void 0||o.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(o){this.setTimeoutFn(()=>{this._onError(o)},0);return}typeof document<"u"&&(this._index=D.requestsCount++,D.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Xs,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete D.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}D.requestsCount=0;D.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",vt);else if(typeof addEventListener=="function"){const e="onpagehide"in M?"pagehide":"unload";addEventListener(e,vt,!1)}}function vt(){for(let e in D.requests)D.requests.hasOwnProperty(e)&&D.requests[e].abort()}const ti=function(){const e=Nt({xdomain:!1});return e&&e.responseType!==null}();class ei extends $s{constructor(t){super(t);const s=t&&t.forceBase64;this.supportsBinary=ti&&!s}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new D(Nt,this.uri(),t)}}function Nt(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Qs))return new XMLHttpRequest}catch{}if(!t)try{return new M[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Ut=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class si extends ft{get name(){return"websocket"}doOpen(){const t=this.uri(),s=this.opts.protocols,i=Ut?{}:Ot(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,s,i)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let s=0;s<t.length;s++){const i=t[s],o=s===t.length-1;ut(i,this.supportsBinary,n=>{try{this.doWrite(i,n)}catch{}o&&J(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",s=this.query||{};return this.opts.timestampRequests&&(s[this.opts.timestampParam]=Bt()),this.supportsBinary||(s.b64=1),this.createUri(t,s)}}const tt=M.WebSocket||M.MozWebSocket;class ii extends si{createSocket(t,s,i){return Ut?new tt(t,s,i):s?new tt(t,s):new tt(t)}doWrite(t,s){this.ws.send(s)}}class oi extends ft{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const s=Us(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=t.readable.pipeThrough(s).getReader(),o=Ns();o.readable.pipeTo(t.writable),this._writer=o.writable.getWriter();const n=()=>{i.read().then(({done:d,value:f})=>{d||(this.onPacket(f),n())}).catch(d=>{})};n();const h={type:"open"};this.query.sid&&(h.data=`{"sid":"${this.query.sid}"}`),this._writer.write(h).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let s=0;s<t.length;s++){const i=t[s],o=s===t.length-1;this._writer.write(i).then(()=>{o&&J(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const ri={websocket:ii,webtransport:oi,polling:ei},ni=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,li=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function rt(e){if(e.length>8e3)throw"URI too long";const t=e,s=e.indexOf("["),i=e.indexOf("]");s!=-1&&i!=-1&&(e=e.substring(0,s)+e.substring(s,i).replace(/:/g,";")+e.substring(i,e.length));let o=ni.exec(e||""),n={},h=14;for(;h--;)n[li[h]]=o[h]||"";return s!=-1&&i!=-1&&(n.source=t,n.host=n.host.substring(1,n.host.length-1).replace(/;/g,":"),n.authority=n.authority.replace("[","").replace("]","").replace(/;/g,":"),n.ipv6uri=!0),n.pathNames=ai(n,n.path),n.queryKey=hi(n,n.query),n}function ai(e,t){const s=/\/{2,9}/g,i=t.replace(s,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&i.splice(0,1),t.slice(-1)=="/"&&i.splice(i.length-1,1),i}function hi(e,t){const s={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,o,n){o&&(s[o]=n)}),s}const nt=typeof addEventListener=="function"&&typeof removeEventListener=="function",q=[];nt&&addEventListener("offline",()=>{q.forEach(e=>e())},!1);class P extends v{constructor(t,s){if(super(),this.binaryType=js,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(s=t,t=null),t){const i=rt(t);s.hostname=i.host,s.secure=i.protocol==="https"||i.protocol==="wss",s.port=i.port,i.query&&(s.query=i.query)}else s.host&&(s.hostname=rt(s.host).host);Z(this,s),this.secure=s.secure!=null?s.secure:typeof location<"u"&&location.protocol==="https:",s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.hostname=s.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=s.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},s.transports.forEach(i=>{const o=i.prototype.name;this.transports.push(o),this._transportsByName[o]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},s),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Ys(this.opts.query)),nt&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},q.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const s=Object.assign({},this.opts.query);s.EIO=Pt,s.transport=t,this.id&&(s.sid=this.id);const i=Object.assign({},this.opts,{query:s,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&P.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const s=this.createTransport(t);s.open(),this.setTransport(s)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",s=>this._onClose("transport close",s))}onOpen(){this.readyState="open",P.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const s=new Error("server error");s.code=t.data,this._onError(s);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let s=1;for(let i=0;i<this.writeBuffer.length;i++){const o=this.writeBuffer[i].data;if(o&&(s+=Gs(o)),i>0&&s>this._maxPayload)return this.writeBuffer.slice(0,i);s+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,J(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,s,i){return this._sendPacket("message",t,s,i),this}send(t,s,i){return this._sendPacket("message",t,s,i),this}_sendPacket(t,s,i,o){if(typeof s=="function"&&(o=s,s=void 0),typeof i=="function"&&(o=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const n={type:t,data:s,options:i};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),o&&this.once("flush",o),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},s=()=>{this.off("upgrade",s),this.off("upgradeError",s),t()},i=()=>{this.once("upgrade",s),this.once("upgradeError",s)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():t()}):this.upgrading?i():t()),this}_onError(t){if(P.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),nt&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=q.indexOf(this._offlineEventListener);i!==-1&&q.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,s),this.writeBuffer=[],this._prevBufferLen=0}}}P.protocol=Pt;class ci extends P{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let s=this.createTransport(t),i=!1;P.priorWebsocketSuccess=!1;const o=()=>{i||(s.send([{type:"ping",data:"probe"}]),s.once("packet",c=>{if(!i)if(c.type==="pong"&&c.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",s),!s)return;P.priorWebsocketSuccess=s.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(p(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})}else{const I=new Error("probe error");I.transport=s.name,this.emitReserved("upgradeError",I)}}))};function n(){i||(i=!0,p(),s.close(),s=null)}const h=c=>{const I=new Error("probe error: "+c);I.transport=s.name,n(),this.emitReserved("upgradeError",I)};function d(){h("transport closed")}function f(){h("socket closed")}function y(c){s&&c.name!==s.name&&n()}const p=()=>{s.removeListener("open",o),s.removeListener("error",h),s.removeListener("close",d),this.off("close",f),this.off("upgrading",y)};s.once("open",o),s.once("error",h),s.once("close",d),this.once("close",f),this.once("upgrading",y),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{i||s.open()},200):s.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const s=[];for(let i=0;i<t.length;i++)~this.transports.indexOf(t[i])&&s.push(t[i]);return s}}let ui=class extends ci{constructor(t,s={}){const i=typeof t=="object"?t:s;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(o=>ri[o]).filter(o=>!!o)),super(t,i)}};function di(e,t="",s){let i=e;s=s||typeof location<"u"&&location,e==null&&(e=s.protocol+"//"+s.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=s.protocol+e:e=s.host+e),/^(https?|wss?):\/\//.test(e)||(typeof s<"u"?e=s.protocol+"//"+e:e="https://"+e),i=rt(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const n=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+n+":"+i.port+t,i.href=i.protocol+"://"+n+(s&&s.port===i.port?"":":"+i.port),i}const fi=typeof ArrayBuffer=="function",pi=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Vt=Object.prototype.toString,gi=typeof Blob=="function"||typeof Blob<"u"&&Vt.call(Blob)==="[object BlobConstructor]",mi=typeof File=="function"||typeof File<"u"&&Vt.call(File)==="[object FileConstructor]";function pt(e){return fi&&(e instanceof ArrayBuffer||pi(e))||gi&&e instanceof Blob||mi&&e instanceof File}function G(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let s=0,i=e.length;s<i;s++)if(G(e[s]))return!0;return!1}if(pt(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return G(e.toJSON(),!0);for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&G(e[s]))return!0;return!1}function yi(e){const t=[],s=e.data,i=e;return i.data=lt(s,t),i.attachments=t.length,{packet:i,buffers:t}}function lt(e,t){if(!e)return e;if(pt(e)){const s={_placeholder:!0,num:t.length};return t.push(e),s}else if(Array.isArray(e)){const s=new Array(e.length);for(let i=0;i<e.length;i++)s[i]=lt(e[i],t);return s}else if(typeof e=="object"&&!(e instanceof Date)){const s={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=lt(e[i],t));return s}return e}function ki(e,t){return e.data=at(e.data,t),delete e.attachments,e}function at(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let s=0;s<e.length;s++)e[s]=at(e[s],t);else if(typeof e=="object")for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(e[s]=at(e[s],t));return e}const wi=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],vi=5;var g;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(g||(g={}));class bi{constructor(t){this.replacer=t}encode(t){return(t.type===g.EVENT||t.type===g.ACK)&&G(t)?this.encodeAsBinary({type:t.type===g.EVENT?g.BINARY_EVENT:g.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let s=""+t.type;return(t.type===g.BINARY_EVENT||t.type===g.BINARY_ACK)&&(s+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(s+=t.nsp+","),t.id!=null&&(s+=t.id),t.data!=null&&(s+=JSON.stringify(t.data,this.replacer)),s}encodeAsBinary(t){const s=yi(t),i=this.encodeAsString(s.packet),o=s.buffers;return o.unshift(i),o}}function bt(e){return Object.prototype.toString.call(e)==="[object Object]"}class gt extends v{constructor(t){super(),this.reviver=t}add(t){let s;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");s=this.decodeString(t);const i=s.type===g.BINARY_EVENT;i||s.type===g.BINARY_ACK?(s.type=i?g.EVENT:g.ACK,this.reconstructor=new Ti(s),s.attachments===0&&super.emitReserved("decoded",s)):super.emitReserved("decoded",s)}else if(pt(t)||t.base64)if(this.reconstructor)s=this.reconstructor.takeBinaryData(t),s&&(this.reconstructor=null,super.emitReserved("decoded",s));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let s=0;const i={type:Number(t.charAt(0))};if(g[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===g.BINARY_EVENT||i.type===g.BINARY_ACK){const n=s+1;for(;t.charAt(++s)!=="-"&&s!=t.length;);const h=t.substring(n,s);if(h!=Number(h)||t.charAt(s)!=="-")throw new Error("Illegal attachments");i.attachments=Number(h)}if(t.charAt(s+1)==="/"){const n=s+1;for(;++s&&!(t.charAt(s)===","||s===t.length););i.nsp=t.substring(n,s)}else i.nsp="/";const o=t.charAt(s+1);if(o!==""&&Number(o)==o){const n=s+1;for(;++s;){const h=t.charAt(s);if(h==null||Number(h)!=h){--s;break}if(s===t.length)break}i.id=Number(t.substring(n,s+1))}if(t.charAt(++s)){const n=this.tryParse(t.substr(s));if(gt.isPayloadValid(i.type,n))i.data=n;else throw new Error("invalid payload")}return i}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,s){switch(t){case g.CONNECT:return bt(s);case g.DISCONNECT:return s===void 0;case g.CONNECT_ERROR:return typeof s=="string"||bt(s);case g.EVENT:case g.BINARY_EVENT:return Array.isArray(s)&&(typeof s[0]=="number"||typeof s[0]=="string"&&wi.indexOf(s[0])===-1);case g.ACK:case g.BINARY_ACK:return Array.isArray(s)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ti{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const s=ki(this.reconPack,this.buffers);return this.finishedReconstruction(),s}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Si=Object.freeze(Object.defineProperty({__proto__:null,Decoder:gt,Encoder:bi,get PacketType(){return g},protocol:vi},Symbol.toStringTag,{value:"Module"}));function A(e,t,s){return e.on(t,s),function(){e.off(t,s)}}const _i=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class jt extends v{constructor(t,s,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=s,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[A(t,"open",this.onopen.bind(this)),A(t,"packet",this.onpacket.bind(this)),A(t,"error",this.onerror.bind(this)),A(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...s){var i,o,n;if(_i.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(s.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(s),this;const h={type:g.EVENT,data:s};if(h.options={},h.options.compress=this.flags.compress!==!1,typeof s[s.length-1]=="function"){const p=this.ids++,c=s.pop();this._registerAckCallback(p,c),h.id=p}const d=(o=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||o===void 0?void 0:o.writable,f=this.connected&&!(!((n=this.io.engine)===null||n===void 0)&&n._hasPingExpired());return this.flags.volatile&&!d||(f?(this.notifyOutgoingListeners(h),this.packet(h)):this.sendBuffer.push(h)),this.flags={},this}_registerAckCallback(t,s){var i;const o=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(o===void 0){this.acks[t]=s;return}const n=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let d=0;d<this.sendBuffer.length;d++)this.sendBuffer[d].id===t&&this.sendBuffer.splice(d,1);s.call(this,new Error("operation has timed out"))},o),h=(...d)=>{this.io.clearTimeoutFn(n),s.apply(this,d)};h.withError=!0,this.acks[t]=h}emitWithAck(t,...s){return new Promise((i,o)=>{const n=(h,d)=>h?o(h):i(d);n.withError=!0,s.push(n),this.emit(t,...s)})}_addToQueue(t){let s;typeof t[t.length-1]=="function"&&(s=t.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((o,...n)=>i!==this._queue[0]?void 0:(o!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),s&&s(o)):(this._queue.shift(),s&&s(null,...n)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const s=this._queue[0];s.pending&&!t||(s.pending=!0,s.tryCount++,this.flags=s.flags,this.emit.apply(this,s.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:g.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,s){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,s),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(i=>String(i.id)===t)){const i=this.acks[t];delete this.acks[t],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case g.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case g.EVENT:case g.BINARY_EVENT:this.onevent(t);break;case g.ACK:case g.BINARY_ACK:this.onack(t);break;case g.DISCONNECT:this.ondisconnect();break;case g.CONNECT_ERROR:this.destroy();const i=new Error(t.data.message);i.data=t.data.data,this.emitReserved("connect_error",i);break}}onevent(t){const s=t.data||[];t.id!=null&&s.push(this.ack(t.id)),this.connected?this.emitEvent(s):this.receiveBuffer.push(Object.freeze(s))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const s=this._anyListeners.slice();for(const i of s)i.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const s=this;let i=!1;return function(...o){i||(i=!0,s.packet({type:g.ACK,id:t,data:o}))}}onack(t){const s=this.acks[t.id];typeof s=="function"&&(delete this.acks[t.id],s.withError&&t.data.unshift(null),s.apply(this,t.data))}onconnect(t,s){this.id=t,this.recovered=s&&this._pid===s,this._pid=s,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:g.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const s=this._anyListeners;for(let i=0;i<s.length;i++)if(t===s[i])return s.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const s=this._anyOutgoingListeners;for(let i=0;i<s.length;i++)if(t===s[i])return s.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const s=this._anyOutgoingListeners.slice();for(const i of s)i.apply(this,t.data)}}}function H(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}H.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),s=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+s:e-s}return Math.min(e,this.max)|0};H.prototype.reset=function(){this.attempts=0};H.prototype.setMin=function(e){this.ms=e};H.prototype.setMax=function(e){this.max=e};H.prototype.setJitter=function(e){this.jitter=e};class ht extends v{constructor(t,s){var i;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(s=t,t=void 0),s=s||{},s.path=s.path||"/socket.io",this.opts=s,Z(this,s),this.reconnection(s.reconnection!==!1),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor((i=s.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new H({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(s.timeout==null?2e4:s.timeout),this._readyState="closed",this.uri=t;const o=s.parser||Si;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=s.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var s;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(s=this.backoff)===null||s===void 0||s.setMin(t),this)}randomizationFactor(t){var s;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(s=this.backoff)===null||s===void 0||s.setJitter(t),this)}reconnectionDelayMax(t){var s;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(s=this.backoff)===null||s===void 0||s.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new ui(this.uri,this.opts);const s=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const o=A(s,"open",function(){i.onopen(),t&&t()}),n=d=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",d),t?t(d):this.maybeReconnectOnOpen()},h=A(s,"error",n);if(this._timeout!==!1){const d=this._timeout,f=this.setTimeoutFn(()=>{o(),n(new Error("timeout")),s.close()},d);this.opts.autoUnref&&f.unref(),this.subs.push(()=>{this.clearTimeoutFn(f)})}return this.subs.push(o),this.subs.push(h),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(A(t,"ping",this.onping.bind(this)),A(t,"data",this.ondata.bind(this)),A(t,"error",this.onerror.bind(this)),A(t,"close",this.onclose.bind(this)),A(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(s){this.onclose("parse error",s)}}ondecoded(t){J(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,s){let i=this.nsps[t];return i?this._autoConnect&&!i.active&&i.connect():(i=new jt(this,t,s),this.nsps[t]=i),i}_destroy(t){const s=Object.keys(this.nsps);for(const i of s)if(this.nsps[i].active)return;this._close()}_packet(t){const s=this.encoder.encode(t);for(let i=0;i<s.length;i++)this.engine.write(s[i],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,s){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,s),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const s=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(o=>{o?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",o)):t.onreconnect()}))},s);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const N={};function W(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const s=di(e,t.path||"/socket.io"),i=s.source,o=s.id,n=s.path,h=N[o]&&n in N[o].nsps,d=t.forceNew||t["force new connection"]||t.multiplex===!1||h;let f;return d?f=new ht(i,t):(N[o]||(N[o]=new ht(i,t)),f=N[o]),s.query&&!t.query&&(t.query=s.queryKey),f.socket(s.path,t)}Object.assign(W,{Manager:ht,Socket:jt,io:W,connect:W});const b=Gt({connected:!1,assistantData:[],streamingMessage:"",isStreaming:!1,isRunJustEnded:!1,isStudentMasteredSkill:!1,streamType:"aiTutor",currentStreamThread:""}),Ci=void 0,_=W(Ci);_.on("connect",()=>{b.connected=!0});_.on("disconnect",()=>{b.connected=!1});_.on("stream-message",(...e)=>{b.isRunJustEnded=!1,b.isStreaming=!0,b.streamingMessage=b.streamingMessage+e[0].value,b.streamType=e[1],b.currentStreamThread=e[3]});_.on("run-end",(...e)=>{b.isStreaming=!1,b.isRunJustEnded=!0});_.on("new-learning-objective-message",(...e)=>{console.log("new message "),console.log(e[0]),b.currentStreamThread=e[0].threadId});const xi={props:["width","height","color","borderWidth"],data:()=>({widthCss:"48px",heightCss:"48px",colorCss:"#a48be6",borderWidthCss:"5px"}),created(){this.width&&(this.widthCss=this.width),this.height&&(this.heightCss=this.height),this.color&&(this.colorCss=this.color),this.borderWidth&&(this.borderWidthCss=this.borderWidth)}},Li={class:"playing"};function Mi(e,t,s,i,o,n){return l(),a("div",Li,t[0]||(t[0]=[r("span",{class:"playing__bar playing__bar1"},null,-1),r("span",{class:"playing__bar playing__bar2"},null,-1),r("span",{class:"playing__bar playing__bar3"},null,-1)]))}const Ft=E(xi,[["render",Mi],["__scopeId","data-v-3ebfe8e0"]]);const mt={setup(){const e=B(),t=_t(),s=Ct(),i=K(),o=Y();return{stateOfSocket:b,userDetailsStore:e,userSkillsStore:t,skillTreeStore:s,settingStore:i,tenantStore:o}},props:["skill","showTutorialTip7","showTutorialTip8","showTutorialTip9","areAllSubskillsMastered"],emits:["progressTutorial","skipTutorial","skillMastered"],components:{TutorLoadingSymbol:Mt,TooltipBtn:Qt,SpeechRecorder:Ds,PlayingAudioAnimation:Ft},data(){return{message:"",socraticTutorChatHistory:[],assessingTutorChatHistory:[],transcriptForAssessment:[],chatHistory:[],waitForAIresponse:!1,mode:"hide",englishSkillLevel:"",learningObjectives:[],tutorType:"socratic",showChat:!0,isTextToSpeech:!0,audio:null,isAudioPlaying:!1,assistantData:{assistantId:null,threadId:null},isNewSocraticChat:!0,isNewAssessingChat:!0,waitForGenerateAudio:!1,currentIndexAudioPlaying:null,isMobileCheck:window.innerWidth,hasTutorButtonBeenClicked:!1,modalTextAreaHeight:"",isLoading:!1,loadingMessage:"",isRecording:!1,numberOfConversationalQuizMessages:0}},async created(){this.connectToSocketSever()},async mounted(){let e=document.createElement("script");e.setAttribute("src","https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"),document.head.appendChild(e);let t=document.createElement("script");t.setAttribute("src","https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"),document.head.appendChild(t);let s=document.createElement("script");s.setAttribute("src","https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"),document.head.appendChild(s),this.learningObjectives=this.skill.learningObjectives.map(i=>i.objective),this.englishSkillLevel=this.skill.level.replace("_"," "),this.audio=new Audio,this.audio.addEventListener("ended",()=>{this.isAudioPlaying=!1,this.currentIndexAudioPlaying=null}),this.settingStore.freeTokenMonthlyLimit==0&&this.settingStore.getSettings()},methods:{handleKeyDown(e){e.shiftKey||this.$parent.isAITokenLimitReached||(e.preventDefault(),this.sendMessage())},async showTutorModal(e){try{this.tutorType=e,await this.getChatHistory(),e=="socratic"?this.chatHistory=this.socraticTutorChatHistory:e=="assessing"&&(this.chatHistory=this.assessingTutorChatHistory),this.$parent.isAITokenLimitReached?this.mode="docked":(this.mode="modal",this.hasTutorButtonBeenClicked=!1,this.isLoading=!1,await this.askQuestion())}catch(t){console.error("Error in showTutorModal:",t)}},async hideTutorModal(e){this.tutorType=e,await this.getChatHistory(),e=="socratic"?this.chatHistory=this.socraticTutorChatHistory:e=="assessing"&&(this.chatHistory=this.assessingTutorChatHistory),this.modalTextAreaHeight="60px",this.mode="docked"},async getChatHistory(){try{const e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId,skillName:this.skill.name,skillUrl:this.skill.url,skillLevel:this.englishSkillLevel,learningObjectives:this.learningObjectives})};let t="";this.tutorType=="socratic"?t="/ai-tutor/socratic/messages-list":this.tutorType=="assessing"&&(t="/ai-tutor/assessing/messages-list");const i=await(await fetch(t,e)).json();this.assistantData.assistantId=i.assistantData.assistantId,this.assistantData.threadId=i.assistantData.threadId,this.tutorType=="socratic"?(this.socraticTutorChatHistory=i.messages,this.chatHistory=this.socraticTutorChatHistory):this.tutorType=="assessing"&&(this.assessingTutorChatHistory=i.messages,this.chatHistory=this.assessingTutorChatHistory,this.numberOfConversationalQuizMessages++,console.log(this.settingStore.quizMaxQuestions),this.numberOfConversationalQuizMessages==this.settingStore.quizMaxQuestions*2&&(this.assessMastery(),this.numberOfConversationalQuizMessages=0)),this.chatHistory.length>0&&(this.assistantData.threadId=this.chatHistory[0].thread_id,this.tutorType=="socratic"?this.isNewSocraticChat=!1:this.tutorType=="assessing"&&(this.isNewAssessingChat=!1)),this.$parent.checkTokenUsage()}catch(e){console.error(e)}},convertLatexToPlainText(e){let t=e;return t=t.replaceAll("^2","squared"),t=t.replaceAll("^3","cubed"),t=t.replaceAll("^","to the power of"),t=t.replaceAll("<","is smaller than"),t=t.replaceAll(">","is greater than"),t=t.replaceAll("leq","is smaller than or equal to"),t=t.replaceAll("geq","is greater than or equal to"),t=t.replaceAll("sqrt","square root of"),t=t.replaceAll("$",""),t},async generateAudio(e,t){for(let d=0;d<this.chatHistory.length;d++)this.chatHistory[d].index==e&&(this.chatHistory[d].isAudioGenerating=!0);this.waitForGenerateAudio=!0;let s=this.convertLatexToPlainText(t);const i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,messageNumber:e,threadID:this.assistantData.threadId})};let o="";this.tutorType=="socratic"?o="/ai-tutor/socratic/generate-tts":o="/ai-tutor/assessing/generate-tts";const h=await(await fetch(o,i)).json();this.waitForGenerateAudio=!1;for(let d=0;d<this.chatHistory.length;d++)this.chatHistory[d].index==e&&(this.chatHistory[d].isAudioGenerating=!1);await this.getChatHistory(),this.userDetailsStore.isAudioAutoPlay&&this.playNewMessageAudio(e,h.speechUrl)},playAudio(e){if(this.isAudioPlaying==!0)this.isAudioPlaying=!1,this.audio.pause(),this.currentIndexAudioPlaying=null;else{let t="";for(let s=0;s<this.chatHistory.length;s++)this.chatHistory[s].index==e&&(t=this.chatHistory[s].audio);this.audio.pause(),this.audio.src=t,this.audio.load(),this.audio.play(),this.isAudioPlaying=!0,this.currentIndexAudioPlaying=e}},onVoiceMessageError(){this.isRecording=!1;const e=this.$refs.messageInput||this.$refs.modalMessageInput;e&&(e.placeholder="Type your message or use voice input...")},playNewMessageAudio(e,t){this.isAudioPlaying==!0&&(this.isAudioPlaying=!1,this.audio.pause(),this.currentIndexAudioPlaying=null),this.audio.pause(),this.audio.src=t,this.audio.load(),this.audio.play(),this.isAudioPlaying=!0,this.currentIndexAudioPlaying=e,this.getChatHistory()},async sendMessage(){if(this.waitForAIresponse)return;function e(t){return t===null||t.match(/^ *$/)!==null}if(e(this.message)){this.askQuestion();return}this.waitForAIresponse=!0;try{let t="new-message";const s={role:"user",content:[{text:{value:this.message}}]};typeof this.chatHistory.length>"u"?(this.chatHistory=[],this.chatHistory.push(s)):this.mode=="docked"?this.chatHistory.unshift(s):this.mode=="modal"&&this.chatHistory.push(s);const i={threadId:this.assistantData.threadId,assistantId:this.assistantData.assistantId,tutorType:this.tutorType,skillName:this.skill.name,skillId:this.skill.id,skillLevel:this.englishSkillLevel,learningObjectives:this.learningObjectives,message:this.message,userId:this.userDetailsStore.userId,freeMonthlyTokenLimit:this.settingStore.freeTokenMonthlyLimit,monthlyTokenUsage:this.userDetailsStore.monthlyTokenUsage,billingMode:this.tenantStore.billingMode,tenantId:this.userDetailsStore.tenantId};this.message="",_.emit(t,i)}catch(t){console.error(t),this.waitForAIresponse=!1}this.$nextTick(()=>{this.scrollToMessageInput()})},async askQuestion(){if(!this.waitForAIresponse){this.waitForAIresponse=!0;try{let e="ask-question";const t={tutorType:this.tutorType,skillLevel:this.skill.level,learningObjectives:this.learningObjectives,skillName:this.skill.name,threadId:this.assistantData.threadId,assistantId:this.assistantData.assistantId,message:"",userId:this.userDetailsStore.userId,skillId:this.skill.id,freeMonthlyTokenLimit:this.settingStore.freeTokenMonthlyLimit,monthlyTokenUsage:this.userDetailsStore.monthlyTokenUsage,billingMode:this.tenantStore.billingMode,tenantId:this.userDetailsStore.tenantId};_.emit(e,t),this.message=""}catch(e){console.error(e),this.waitForAIresponse=!1}this.$nextTick(()=>{this.scrollToMessageInput()})}},async assessMastery(){await this.userSkillsStore.recordAssessmentAttempt(this.userDetailsStore.userId,this.skill.id);for(let e=0;e<this.assessingTutorChatHistory.length;e++){let t=this.assessingTutorChatHistory[e];if(t.role=="assistant"){let i={examiner:t.content[0].text.value};this.transcriptForAssessment.push(i)}else if(t.role=="user"){let i={student:t.content[0].text.value};this.transcriptForAssessment.push(i)}}this.transcriptForAssessment=this.transcriptForAssessment.reverse();try{const e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId,skillName:this.skill.name,skillUrl:this.skill.url,skillId:this.skill.id,skillLevel:this.englishSkillLevel,learningObjectives:this.learningObjectives,transcriptForAssessment:this.transcriptForAssessment,freeMonthlyTokenLimit:this.settingStore.freeTokenMonthlyLimit,monthlyTokenUsage:this.userDetailsStore.monthlyTokenUsage,billingMode:this.tenantStore.billingMode,tenantId:this.userDetailsStore.tenantId})},s=await fetch("/ai-tutor/assessing/assess",e);if(s.status===500)return;(await s.json()).result.result>=70&&this.makeMastered(),this.waitForAIresponse=!1}catch(e){console.error(e),this.waitForAIresponse=!1}},applyMarkDownFormatting(e){const t=window.markdownit({breaks:!0}).use(window.texmath,{engine:katex,delimiters:["brackets","dollars"],katexOptions:{macros:{"\\RR":"\\mathbb{R}"}}}),s=this.formatTextForDisplay(e);return t.render(s)},scrollToMessageInput(){const e=this.$refs.messageInputDiv;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},async makeMastered(){await this.userSkillsStore.MakeMastered(this.userDetailsStore.userId,this.skill),this.$emit("skillMastered"),this.mode==="modal"&&(this.mode="docked")},connectToSocketSever(){_.connect()},disconnectToSocketSever(){console.log("disconnect"),_.disconnect()},createChatStream(){_.emit("create-stream",this.userDetailsStore.userId,this.skill.id,this.skill.name,this.skill.level,this.skill.url,e=>{})},removeStreamMessage(){b.streamType="pause",b.streamingMessage=""},handleTutorClick(e){this.userDetailsStore.userId?(this.isLoading=!0,this.loadingMessage=`Loading ${e==="socratic"?"Socratic Tutor":"Conversational Test"}...`,this.hasTutorButtonBeenClicked=!0,this.showTutorModal(e)):this.$parent.showGuestTooltip()},navigateToAssessment(){if(!(this.skill.type==="super"&&!this.areAllSubskillsMastered)){if(!this.userDetailsStore.userId){this.$parent.showGuestTooltip();return}this.isLoading=!0,this.loadingMessage="Loading Multiple-Choice Assessment Test...",this.$router.push(`${this.skill.id}/assessment`)}},getLatexStrings(e){const t=[];let s=!1,i=!1,o="",n=0,h=0;for(let d=0;d<e.length;d++){const f=e[d];if(f==="$"){if(e[d+1]==="$")continue;s=!s,s?n=d:h=d}s&&(i=!0,o=o+f),i&&!s&&(o=o+f,t.push({string:o,startIndex:n,endIndex:h}),o="",i=!1)}return t},getLatexStringsBetweenSquareBracket(e){let t=[],s=!1,i=!1,o="",n=0,h=0;for(let d=0;d<e.length;d++){const f=e[d];f==="\\"&&(e[d+1]==="["?(s=!0,n=d):e[d+1]==="]"&&(s=!1,h=d)),s&&(i=!0,o=o+f),i&&!s&&(o=o+f,o=o+e[d+1],t.push({string:o,startIndex:n,endIndex:h}),o="",i=!1)}return t},formatTextForDisplay(e){const t=this.getLatexStrings(e);let s=e;return t.forEach(o=>{let n=o.string.replaceAll("$ ","$");n=n.replaceAll(" $","$"),s=s.replaceAll(o.string,n)}),this.getLatexStringsBetweenSquareBracket(e).forEach(o=>{let n=`
`+o.string;s=s.replaceAll(o.string,n)}),s},onRecordingStarted(){this.message="",this.isRecording=!0;const e=this.$refs.messageInput||this.$refs.modalMessageInput;e&&(e.placeholder="Recording in progress...")},onRecordingStopped(){const e=this.$refs.messageInput||this.$refs.modalMessageInput;e&&(e.placeholder="Converting speech to text...")},onVoiceMessageSent(){this.isRecording=!1;const e=this.$refs.messageInput||this.$refs.modalMessageInput;e&&(e.placeholder="Type your message or use voice input..."),this.$nextTick(()=>{this.scrollToMessageInput()})},autoResizeTextarea(){const e=this.$refs.messageInput;if(e){e.style.height="auto";const t=e.scrollHeight,s=18,i=120,o=Math.min(Math.max(t,s),i);e.style.height=o+"px"}},autoResizeModalTextarea(){const e=this.$refs.modalMessageInput;if(e){e.style.height="auto";const t=e.scrollHeight,s=18,i=120,o=Math.min(Math.max(t,s),i);e.style.height=o+"px"}}},computed:{sortedChatHistory(){return!this.chatHistory||!Array.isArray(this.chatHistory)?[]:this.mode=="modal"?[...this.chatHistory].sort((e,t)=>e.index-t.index):this.mode=="docked"?[...this.chatHistory].sort((e,t)=>t.index-e.index):[...this.chatHistory]}},watch:{stateOfSocket:{async handler(e,t){if(e.streamType==="aiTutor"&&(e.isStreaming&&(this.waitForAIresponse=!1,this.$nextTick(()=>{this.scrollToMessageInput()})),!e.isStreaming&&e.isRunJustEnded)){this.waitForAIresponse=!1;let s=0;this.chatHistory!=null&&this.chatHistory.length>0&&(s=this.chatHistory.length);const i={role:"assistant",content:[{text:{value:this.stateOfSocket.streamingMessage},type:"text"}],index:s};this.removeStreamMessage(),typeof this.chatHistory.length>"u"?(this.chatHistory=[],this.chatHistory.push(i)):this.mode=="docked"?this.chatHistory.unshift(i):this.mode=="modal"&&this.chatHistory.push(i),this.generateAudio(i.index,i.content[0].text.value),this.$nextTick(()=>{this.scrollToMessageInput()})}},deep:!0},$route(e,t){this.isLoading=!1,this.loadingMessage=""}}},Tt=()=>{Wt(e=>({"744edb56":e.modalTextAreaHeight}))},St=mt.setup;mt.setup=St?(e,t)=>(Tt(),St(e,t)):Tt;const Ai={key:0,class:"modal"},Ii={class:"d-flex flex-column flex-md-row gap-2 align-items-baseline mb-1"},Di={class:"d-flex flex-row w-100 justify-content-between"},Ri={class:"d-flex gap-2"},Ei={class:"d-flex gap-2"},Pi={key:0,class:"ai-tutor-processing mt-1"},Oi={key:0},Bi={class:"d-flex"},Hi={title:"Dock AI tutor","b-tooltip.hover":""},Ni={key:0,class:"tool-tip-base d-flex justify-content-start"},Ui={class:"explain-tool-tip hovering-info-panel triangle-top-left"},Vi={class:"tool-tip-text"},ji={class:"d-flex justify-content-between"},Fi={key:1,class:"alert alert-warning mt-1",role:"alert"},zi={key:2,class:"d-flex flex-column justify-content-between"},qi={class:"container-fluid p-0"},Gi={class:"row mb-2 mb-md-3 g-2"},Wi={class:"col-12 col-md-6"},Ki={key:0},Yi={class:"explain-tool-tip hovering-info-panel triangle-top-left"},Ji={class:"tool-tip-text"},Zi={class:"d-flex justify-content-between"},Qi={key:0,class:"col-12 col-md-6"},Xi=["title"],$i={key:0},to={class:"explain-tool-tip hovering-info-panel triangle-top-left"},eo={class:"tool-tip-text"},so={class:"d-flex justify-content-between"},io={class:"row g-2"},oo={key:0,class:"col-12 col-md-6 offset-md-6"},ro=["disabled"],no={key:0,class:"loading-overlay"},lo={class:"loading-container"},ao={class:"loading-text mt-3"},ho={key:1,class:"d-flex justify-content-between"},co={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"18",height:"18"},uo={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"18",height:"18"},fo={key:3,class:"input-container"},po={class:"input-wrapper"},go=["disabled"],mo=["disabled"],yo={key:4,class:"ai-tutor-processing mt-1"},ko=["innerHTML"],wo={key:0,class:"d-flex justify-content-end message-divider"},vo={class:"user-conversation"},bo={class:"tutor-conversation"},To=["innerHTML"],So={key:0,class:"d-flex"},_o=["onClick"],Co={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"yellow",height:"18",width:"18"},xo={key:1,class:"d-flex gap-1 align-items-center"},Lo=["innerHTML"],Mo={key:1,class:"modal-input"},Ao={class:"input-row"},Io=["disabled"],Do=["disabled"];function Ro(e,t,s,i,o,n){const h=w("TooltipBtn"),d=w("TutorLoadingSymbol"),f=w("SpeechRecorder"),y=w("PlayingAudioAnimation");return l(),a(C,null,[o.mode==="modal"?(l(),a("div",Ai)):u("",!0),r("div",{class:m({"container mt-3":o.mode==="docked","modal-mode-container":o.mode==="modal"})},[r("div",Ii,[r("div",Di,[r("div",Ri,[r("span",Ei,[o.mode==="docked"&&o.tutorType=="socratic"?(l(),T(h,{key:0,class:"d-none d-md-block",toolTipText:"Press the 'generate speech' button to hear the tutor speak with AI generated speech.",bubbleWidth:"350px",trianglePosition:"left",absoluteTop:"37px"})):o.mode==="docked"&&o.tutorType=="assessing"?(l(),T(h,{key:1,class:"d-none d-md-block",toolTipText:`Your dialog with the Conversational Test will continue indefinitely until 70% of your
                                    answers are deemed to be correct.`,bubbleWidth:"350px",trianglePosition:"left",absoluteTop:"37px"})):u("",!0),o.mode==="docked"&&o.tutorType=="socratic"?(l(),T(h,{key:2,class:"d-md-none",toolTipText:"Press the 'generate speech' button to hear the tutor speak with AI generated speech.",bubbleWidth:"100px",trianglePosition:"left",absoluteTop:"37px"})):o.mode==="docked"&&o.tutorType=="assessing"?(l(),T(h,{key:3,class:"d-md-none",toolTipText:`Your dialog with the Conversational Test will continue indefinitely until 70% of your
                                    answers are deemed to be correct.`,bubbleWidth:"100px",trianglePosition:"left",absoluteTop:"37px"})):u("",!0)]),o.mode==="modal"&&o.waitForAIresponse?(l(),a("div",Pi,[t[19]||(t[19]=r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512",width:"18",height:"18",fill:"black"},[r("path",{d:"M320 0c17.7 0 32 14.3 32 32l0 64 120 0c39.8 0 72 32.2 72 72l0 272c0 39.8-32.2 72-72 72l-304 0c-39.8 0-72-32.2-72-72l0-272c0-39.8 32.2-72 72-72l120 0 0-64c0-17.7 14.3-32 32-32zM208 384c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zM264 256a40 40 0 1 0 -80 0 40 40 0 1 0 80 0zm152 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80zM48 224l16 0 0 192-16 0c-26.5 0-48-21.5-48-48l0-96c0-26.5 21.5-48 48-48zm544 0c26.5 0 48 21.5 48 48l0 96c0 26.5-21.5 48-48 48l-16 0 0-192 16 0z"})],-1)),o.isMobileCheck>576?(l(),a("span",Oi,"Thinking")):u("",!0),S(d)])):o.mode==="modal"&&o.tutorType=="assessing"?(l(),T(h,{key:1,class:"d-none d-md-block",toolTipText:`Your dialog with the Conversational Test will continue indefinitely until 70% of your
                                    answers are deemed to be correct.`,bubbleWidth:"350px",trianglePosition:"left",absoluteTop:"37px"})):u("",!0)]),r("div",Bi,[r("div",Hi,[o.mode==="modal"?(l(),a("button",{key:0,class:"primary-btn btn close-btn ms-2",onClick:t[0]||(t[0]=p=>n.hideTutorModal(o.tutorType)),"aria-label":"Close"},t[20]||(t[20]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",fill:"white",width:"16"},[r("path",{d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"})],-1)]))):u("",!0)])])])]),i.userDetailsStore.role=="student"&&s.showTutorialTip7?(l(),a("div",Ni,[r("div",Ui,[r("div",Vi,[t[21]||(t[21]=r("p",null," The AI Tutor is here to help you master this skill through personalized assistance. You can ask questions, receive explanations, practice concepts, or get guidance at any time during your learning journey. ",-1)),r("div",ji,[r("button",{class:"btn primary-btn",onClick:t[1]||(t[1]=p=>e.$emit("progressTutorial",7))}," next "),r("button",{class:"btn red-btn",onClick:t[2]||(t[2]=p=>e.$emit("skipTutorial"))}," exit tutorial ")])])])])):u("",!0),e.$parent.isAITokenLimitReached?(l(),a("div",Fi," You have reached your monthly AI token limit. Please recharge your tokens to use more. ")):u("",!0),o.mode==="docked"||o.mode==="hide"?(l(),a("div",zi,[r("div",qi,[r("div",Gi,[r("div",Wi,[r("button",{class:m(["btn socratic-btn ms-1 fs-2 w-100 py-2 fw-bold h-100 text-nowrap",{"text-decoration-underline":o.mode!=="hide"&&o.tutorType==="socratic",disabled:o.hasTutorButtonBeenClicked||e.$parent.isAITokenLimitReached}]),onClick:t[3]||(t[3]=p=>n.handleTutorClick("socratic"))}," Socratic Tutor ",2),i.userDetailsStore.role=="student"&&s.showTutorialTip8?(l(),a("div",Ki,[r("div",Yi,[r("div",Ji,[t[22]||(t[22]=r("p",null," The Socratic Tutor helps you learn through guided questioning. It encourages critical thinking by asking you questions that lead you to discover answers yourself, helping build deeper understanding of concepts. ",-1)),r("div",Zi,[r("button",{class:"btn primary-btn",onClick:t[4]||(t[4]=p=>e.$emit("progressTutorial",8))}," next "),r("button",{class:"btn red-btn",onClick:t[5]||(t[5]=p=>e.$emit("skipTutorial"))}," exit tutorial ")])])])])):u("",!0)]),e.$parent.isMastered?u("",!0):(l(),a("div",Qi,[r("button",{class:m(["btn assessing-btn ms-1 fs-2 w-100 py-2 fw-bold h-100 text-nowrap",{"text-decoration-underline":o.tutorType==="assessing",disabled:s.skill.type==="super"&&!s.areAllSubskillsMastered||o.hasTutorButtonBeenClicked||e.$parent.isAITokenLimitReached}]),onClick:t[6]||(t[6]=p=>s.skill.type==="super"&&!s.areAllSubskillsMastered?null:n.handleTutorClick("assessing")),title:s.skill.type==="super"&&!s.areAllSubskillsMastered?"Master all subskills first to unlock this assessment":""}," Conversational Test ",10,Xi),i.userDetailsStore.role=="student"&&s.showTutorialTip9?(l(),a("div",$i,[r("div",to,[r("div",eo,[t[23]||(t[23]=r("p",null," Your dialog with the Conversational Test will continue indefinitely until 70% of your answers are deemed to be correct. ",-1)),r("div",so,[r("button",{class:"btn primary-btn",onClick:t[7]||(t[7]=p=>e.$emit("progressTutorial",9))}," next "),r("button",{class:"btn red-btn",onClick:t[8]||(t[8]=p=>e.$emit("skipTutorial"))}," exit tutorial ")])])])])):u("",!0)]))]),r("div",io,[!e.$parent.isMastered&&s.skill.type!="domain"&&s.skill.id?(l(),a("div",oo,[r("button",{class:m(["btn assessing-btn ms-1 fs-2 w-100 py-2 fw-bold h-100 d-block text-nowrap",{disabled:s.skill.type==="super"&&!s.areAllSubskillsMastered}]),onClick:t[9]||(t[9]=(...p)=>n.navigateToAssessment&&n.navigateToAssessment(...p)),disabled:s.skill.type==="super"&&!s.areAllSubskillsMastered}," Multiple-Choice Test ",10,ro)])):u("",!0),s.skill.type==="super"&&!s.areAllSubskillsMastered?(l(),a("div",{key:1,class:m(["text-end small",{"text-center":o.isMobileCheck<576}])},t[24]||(t[24]=[r("em",null,"To unlock the tests, first master all the cluster skills",-1)]),2)):u("",!0)])]),o.isLoading?(l(),a("div",no,[r("div",lo,[t[25]||(t[25]=r("span",{class:"assessment-loader"},null,-1)),r("div",ao,k(o.loadingMessage),1)])])):u("",!0),o.mode!="hide"?(l(),a("div",ho,[r("button",{class:"btn plus-btn ms-1",onClick:t[10]||(t[10]=p=>o.showChat=!o.showChat)},[o.showChat?(l(),a("svg",uo,t[27]||(t[27]=[r("path",{d:"M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"},null,-1)]))):(l(),a("svg",co,t[26]||(t[26]=[r("path",{d:"M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"},null,-1)])))])])):u("",!0)])):u("",!0),o.mode==="docked"&&!e.$parent.isAITokenLimitReached?(l(),a("div",fo,[r("div",po,[V(r("textarea",{ref:"messageInput",class:"chat-text-area","onUpdate:modelValue":t[11]||(t[11]=p=>o.message=p),placeholder:"Type your message or use voice input...",onKeydown:t[12]||(t[12]=it((...p)=>n.handleKeyDown&&n.handleKeyDown(...p),["enter"])),onInput:t[13]||(t[13]=(...p)=>n.autoResizeTextarea&&n.autoResizeTextarea(...p)),disabled:o.isRecording},null,40,go),[[st,o.message]]),S(f,{class:"voice-input-button",tutorType:o.tutorType,skill:s.skill,skillLevel:o.englishSkillLevel,learningObjectives:o.learningObjectives,isAITokenLimitReached:e.$parent.isAITokenLimitReached,onRecordingStarted:n.onRecordingStarted,onRecordingStopped:n.onRecordingStopped,onMessageSent:n.onVoiceMessageSent,onMessageError:n.onVoiceMessageError},null,8,["tutorType","skill","skillLevel","learningObjectives","isAITokenLimitReached","onRecordingStarted","onRecordingStopped","onMessageSent","onMessageError"]),r("button",{class:m(["btn send-btn",{"socratic-btn":o.tutorType==="socratic","assessing-btn":o.tutorType==="assessing"}]),onClick:t[14]||(t[14]=p=>n.sendMessage()),disabled:o.isRecording},t[28]||(t[28]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"18",height:"18",fill:"white"},[r("path",{d:"M2,21L23,12L2,3V10L17,12L2,14V21Z"})],-1)]),10,mo)])])):u("",!0),o.mode==="docked"&&o.waitForAIresponse?(l(),a("div",yo,[t[29]||(t[29]=r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512",width:"18",height:"18",fill:"black"},[r("path",{d:"M320 0c17.7 0 32 14.3 32 32l0 64 120 0c39.8 0 72 32.2 72 72l0 272c0 39.8-32.2 72-72 72l-304 0c-39.8 0-72-32.2-72-72l0-272c0-39.8 32.2-72 72-72l120 0 0-64c0-17.7 14.3-32 32-32zM208 384c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zM264 256a40 40 0 1 0 -80 0 40 40 0 1 0 80 0zm152 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80zM48 224l16 0 0 192-16 0c-26.5 0-48-21.5-48-48l0-96c0-26.5 21.5-48 48-48zm544 0c26.5 0 48 21.5 48 48l0 96c0 26.5-21.5 48-48 48l-16 0 0-192 16 0z"})],-1)),t[30]||(t[30]=x(" Thinking ",-1)),S(d)])):u("",!0),o.showChat&&o.mode!=="hide"&&(o.chatHistory.length>0||o.waitForAIresponse||i.stateOfSocket.isStreaming)?(l(),a("div",{key:5,class:m(["d-flex flex-column align-items-start tutor-chatting-section",{"tutor-chatting-waiting-response-section":o.mode==="modal"&&o.waitForAIresponse}])},[o.showChat&&o.mode!="hide"?(l(),a("div",{key:0,class:m(["d-flex flex-column mx-auto",{"docked-chat-history":o.mode==="docked","modal-chat-history":o.mode==="modal","socratic-chat":o.tutorType==="socratic","assessing-chat":o.tutorType==="assessing"}]),ref:"messageInputDiv"},[i.stateOfSocket.isStreaming&&i.stateOfSocket.streamType==="aiTutor"&&o.mode=="docked"?(l(),a("div",{key:0,class:"d-flex my-3 tutor-conversation streamed-message",innerHTML:n.applyMarkDownFormatting(i.stateOfSocket.streamingMessage)},null,8,ko)):u("",!0),(l(!0),a(C,null,O(n.sortedChatHistory,(p,c)=>(l(),a(C,null,[p.role==="user"?(l(),a("div",wo,[r("div",vo,[r("em",null,k(p.content[0].text.value),1)])])):p.role==="assistant"&&p.content[0].type=="text"?(l(),a("div",{key:1,class:m(["d-flex justify-content-between w-100",{"message-divider":c!==0,"first-message":c===0}])},[r("div",bo,[r("div",{innerHTML:n.applyMarkDownFormatting(p.content[0].text.value)},null,8,To)]),p.isAudioGenerating&&p.role==="assistant"?(l(),a("div",So,t[31]||(t[31]=[r("span",{class:"speech-loader"},null,-1)]))):!o.waitForGenerateAudio&&!p.isAudioGenerating&&p.role==="assistant"?(l(),a("button",{key:1,onClick:I=>n.playAudio(p.index),class:"btn speechButton"},[o.isAudioPlaying==!1?(l(),a("svg",Co,t[32]||(t[32]=[r("path",{d:"M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zM188.3 147.1c7.6-4.2 16.8-4.1 24.3 .5l144 88c7.1 4.4 11.5 12.1 11.5 20.5s-4.4 16.1-11.5 20.5l-144 88c-7.4 4.5-16.7 4.7-24.3 .5s-12.3-12.2-12.3-20.9l0-176c0-8.7 4.7-16.7 12.3-20.9z"},null,-1)]))):o.isAudioPlaying==!0&&p.index===o.currentIndexAudioPlaying?(l(),a("div",xo,[t[33]||(t[33]=r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"yellow",height:"18",width:"18"},[r("path",{d:"M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm192-96l128 0c17.7 0 32 14.3 32 32l0 128c0 17.7-14.3 32-32 32l-128 0c-17.7 0-32-14.3-32-32l0-128c0-17.7 14.3-32 32-32z"})],-1)),S(y)])):u("",!0)],8,_o)):u("",!0)],2)):u("",!0)],64))),256)),i.stateOfSocket.isStreaming&&i.stateOfSocket.streamType==="aiTutor"&&o.mode=="modal"?(l(),a("div",{key:1,class:m(["d-flex my-3 tutor-conversation streamed-message",{"mt-auto":o.isNewSocraticChat&&o.tutorType=="socratic"||o.isNewAssessingChat&&o.tutorType=="assessing"}]),innerHTML:n.applyMarkDownFormatting(i.stateOfSocket.streamingMessage)},null,10,Lo)):u("",!0)],2)):u("",!0),o.mode==="modal"&&!e.$parent.isAITokenLimitReached?(l(),a("div",Mo,[r("div",Ao,[V(r("textarea",{ref:"modalMessageInput",class:"modal-textarea","onUpdate:modelValue":t[15]||(t[15]=p=>o.message=p),placeholder:"Type your message or use voice input...",onKeydown:t[16]||(t[16]=it((...p)=>n.handleKeyDown&&n.handleKeyDown(...p),["enter"])),onInput:t[17]||(t[17]=(...p)=>n.autoResizeModalTextarea&&n.autoResizeModalTextarea(...p)),disabled:o.isRecording},null,40,Io),[[st,o.message]]),S(f,{tutorType:o.tutorType,skill:s.skill,skillLevel:o.englishSkillLevel,learningObjectives:o.learningObjectives,isAITokenLimitReached:e.$parent.isAITokenLimitReached,onRecordingStarted:n.onRecordingStarted,onRecordingStopped:n.onRecordingStopped,onMessageSent:n.onVoiceMessageSent,onMessageError:n.onVoiceMessageError},null,8,["tutorType","skill","skillLevel","learningObjectives","isAITokenLimitReached","onRecordingStarted","onRecordingStopped","onMessageSent","onMessageError"]),r("button",{class:"send-btn",onClick:t[18]||(t[18]=p=>n.sendMessage()),disabled:o.isRecording},t[34]||(t[34]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"18",height:"18",fill:"white"},[r("path",{d:"M2,21L23,12L2,3V10L17,12L2,14V21Z"})],-1)]),8,Do)])])):u("",!0)],2)):u("",!0)],2)],64)}const Eo=E(mt,[["render",Ro],["__scopeId","data-v-a1d88699"]]);const Po={setup(){const e=B(),t=K(),s=Y();return{userDetailsStore:e,settingStore:t,tenantStore:s,stateOfSocket:b}},props:["skillName","skillId","skillUrl","skillLevel","learningObjective","learningObjectiveId"],components:{TutorLoadingSymbol:Mt,PlayingAudioAnimation:Ft},data(){return{message:"",messageList:[],waitForAIresponse:!1,isGotMessages:!1,englishSkillLevel:"",threadID:"",isAudioPlaying:!1,assistantData:null,waitForGenerateAudio:!1,currentIndexAudioPlaying:null}},async mounted(){let e=document.createElement("script");e.setAttribute("src","https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"),document.head.appendChild(e);let t=document.createElement("script");t.setAttribute("src","https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"),document.head.appendChild(t);let s=document.createElement("script");s.setAttribute("src","https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"),document.head.appendChild(s),this.englishSkillLevel=this.skillLevel.replace("_"," "),await this.getMessages()},async created(){this.connectToSocketSever()},methods:{handleKeyDown(e){e.shiftKey||(e.preventDefault(),this.sendMessage())},async getMessages(){this.message="";try{const e=`/ai-tutor/learning-objective/messages-list?userId=${encodeURIComponent(this.userDetailsStore.userId)}&learningObjectiveId=${encodeURIComponent(this.learningObjectiveId)}&learningObjective=${encodeURIComponent(this.learningObjective)}&skillLevel=${encodeURIComponent(this.englishSkillLevel)}`,t=await fetch(e);if(!t.ok){console.error(`HTTP Error ${t.status}: ${t.statusText}`),this.messageList=[],this.assistantData=null,this.isGotMessages=!0;return}const s=await t.json();this.messageList=s.messages||[],this.assistantData=s.assistantData||null,this.isGotMessages=!0,this.messageList.length>0&&(this.threadID=this.messageList[0].thread_id),this.$parent.checkTokenUsage()}catch(e){console.error("Error in getMessages:",e),this.messageList=[],this.assistantData=null,this.isGotMessages=!0}},async generateAudio(e,t){this.waitForGenerateAudio=!0,this.messageList[0].isAudioGenerating=!0;const s=this.convertLatexToPlainText(t),i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,messageNumber:e,threadID:this.assistantData.threadId})},h=await(await fetch("/ai-tutor/learning-objective/generate-tts",i)).json();this.waitForGenerateAudio=!1,this.messageList[0].isAudioGenerating=!1,await this.getMessages(),this.userDetailsStore.isAudioAutoPlay&&this.playNewMessageAudio(e,h.speechUrl)},playAudio(e){if(this.isAudioPlaying==!0)this.isAudioPlaying=!1,this.audio.pause();else{let t="";for(let s=0;s<this.messageList.length;s++)this.messageList[s].index==e&&(t=this.messageList[s].audio);this.audio=new Audio(t),this.audio.addEventListener("ended",()=>{this.isAudioPlaying=!1,this.currentIndexAudioPlaying=null}),this.isAudioPlaying=!0,this.currentIndexAudioPlaying=e,this.audio.play()}},playNewMessageAudio(e,t){this.isAudioPlaying==!0&&(this.isAudioPlaying=!1,this.audio.pause()),this.audio=new Audio(t),this.audio.addEventListener("ended",()=>{this.isAudioPlaying=!1,this.currentIndexAudioPlaying=null}),this.isAudioPlaying=!0,this.currentIndexAudioPlaying=e,this.audio.play(),this.getMessages()},async sendMessage(){if(this.waitForAIresponse)return;function e(t){return t===null||t.match(/^ *$/)!==null}if(e(this.message)){this.requestTutoring();return}this.waitForAIresponse=!0;try{const t={role:"user",content:[{text:{value:this.message}}]};if(this.messageList||(this.messageList=[]),this.messageList.unshift(t),!this.assistantData){console.error("Assistant data not available"),this.waitForAIresponse=!1;return}const s={threadId:this.assistantData.threadId,assistantId:this.assistantData.assistantId,message:this.message,learningObjective:this.learningObjective,userId:this.userDetailsStore.userId,skillName:this.skillName,skillLevel:this.englishSkillLevel,skillId:this.skillId,freeMonthlyTokenLimit:this.settingStore.freeTokenMonthlyLimit,monthlyTokenUsage:this.userDetailsStore.monthlyTokenUsage,billingMode:this.tenantStore.billingMode,tenantId:this.userDetailsStore.tenantId};_.emit("new-learning-objective-message",s),this.message=""}catch(t){console.error("Error in sendMessage:",t),this.waitForAIresponse=!1}},async requestTutoring(){this.message="tutor me on this",this.sendMessage()},applyMarkDownFormatting(e){const t=window.markdownit({breaks:!0}).use(window.texmath,{engine:katex,delimiters:["brackets","dollars"],katexOptions:{macros:{"\\RR":"\\mathbb{R}"}}}),s=this.formatTextForDisplay(e);return t.render(s)},connectToSocketSever(){_.connect()},disconnectToSocketSever(){_.disconnect()},removeStreamMessage(){b.streamType="pause",b.streamingMessage=""},getLatexStrings(e){const t=[];let s=!1,i=!1,o="",n=0,h=0;for(let d=0;d<e.length;d++){const f=e[d];f==="$"&&(s=!s,s?n=d:h=d),s&&(i=!0,o=o+f),i&&!s&&(o=o+f,t.push({string:o,startIndex:n,endIndex:h}),o="",i=!1)}return t},convertLatexToPlainText(e){let t=e;return t=t.replaceAll("^2","squared"),t=t.replaceAll("^3","cubed"),t=t.replaceAll("^","to the power of"),t=t.replaceAll("<","is smaller than"),t=t.replaceAll(">","is greater than"),t=t.replaceAll("leq","is smaller than or equal to"),t=t.replaceAll("geq","is greater than or equal to"),t=t.replaceAll("sqrt","square root of"),t=t.replaceAll("\\div","divide by"),t=t.replaceAll("$",""),t},formatTextForDisplay(e){const t=this.getLatexStrings(e);let s=e;return t.forEach(i=>{let o=i.string.replaceAll("$ ","$");o=o.replaceAll(" $","$"),s=s.replaceAll(i.string,o)}),s},connectToSocketSever(){_.connect()},disconnectToSocketSever(){_.disconnect()},removeStreamMessage(){b.streamType="pause",b.streamingMessage=""}},watch:{stateOfSocket:{async handler(e,t){if(e.streamType==="learningObjective"&&(e.isStreaming&&(this.waitForAIresponse=!1),!e.isStreaming&&e.isRunJustEnded&&this.assistantData.threadId==e.currentStreamThread)){const s={role:"assistant",content:[{text:{value:this.stateOfSocket.streamingMessage},type:"text"}]};this.removeStreamMessage(),this.messageList.unshift(s);let i=this.messageList.reverse();for(let n=0;n<i.length;n++)i[n].index=n;this.messageList=i.reverse();const o=parseInt(this.messageList.length)-1;this.generateAudio(o,s.content[0].text.value)}},deep:!0}}},Oo={key:0,class:"loading-animation d-flex justify-content-center align-items-center py-4"},Bo={key:1},Ho={class:"d-flex justify-content-end mt-2"},No=["disabled"],Uo={class:"d-flex mt-1"},Vo={key:0,class:"ai-tutor-processing mt-2"},jo={class:"d-flex flex-column mx-auto chat-component socratic-chat"},Fo=["innerHTML"],zo={key:0,class:"user-conversation"},qo=["innerHTML"],Go={key:2},Wo=["onClick"],Ko={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"yellow",height:"18",width:"18"},Yo={key:1,class:"d-flex gap-1 align-items-center"};function Jo(e,t,s,i,o,n){const h=w("TutorLoadingSymbol"),d=w("PlayingAudioAnimation");return o.isGotMessages==!1?(l(),a("div",Oo,t[4]||(t[4]=[r("span",{class:"spinning-loader"},null,-1)]))):(l(),a("div",Bo,[r("span",Ho,[o.isGotMessages?(l(),a("button",{key:0,class:"btn border border-dark",onClick:t[0]||(t[0]=f=>n.requestTutoring()),disabled:e.$parent.isAITokenLimitReached}," tutor me on this ",8,No)):u("",!0)]),r("span",Uo,[V(r("textarea",{class:"chat-input border border-dark rounded","onUpdate:modelValue":t[1]||(t[1]=f=>o.message=f),type:"text",onKeydown:t[2]||(t[2]=it((...f)=>n.handleKeyDown&&n.handleKeyDown(...f),["enter"]))},null,544),[[st,o.message]]),r("button",{class:"btn border border-dark ms-1 message-btn",onClick:t[3]||(t[3]=f=>n.sendMessage())},t[5]||(t[5]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"18",height:"18",fill:"black"},[r("path",{d:"M256 448c141.4 0 256-93.1 256-208S397.4 32 256 32S0 125.1 0 240c0 45.1 17.7 86.8 47.7 120.9c-1.9 24.5-11.4 46.3-21.4 62.9c-5.5 9.2-11.1 16.6-15.2 21.6c-2.1 2.5-3.7 4.4-4.9 5.7c-.6 .6-1 1.1-1.3 1.4l-.3 .3c0 0 0 0 0 0c0 0 0 0 0 0s0 0 0 0s0 0 0 0c-4.6 4.6-5.9 11.4-3.4 17.4c2.5 6 8.3 9.9 14.8 9.9c28.7 0 57.6-8.9 81.6-19.3c22.9-10 42.4-21.9 54.3-30.6c31.8 11.5 67 17.9 104.1 17.9zM128 208a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm128 0a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm96 32a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"})],-1)]))]),o.waitForAIresponse?(l(),a("div",Vo,[t[6]||(t[6]=r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512",width:"18",height:"18",fill:"black"},[r("path",{d:"M320 0c17.7 0 32 14.3 32 32l0 64 120 0c39.8 0 72 32.2 72 72l0 272c0 39.8-32.2 72-72 72l-304 0c-39.8 0-72-32.2-72-72l0-272c0-39.8 32.2-72 72-72l120 0 0-64c0-17.7 14.3-32 32-32zM208 384c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zM264 256a40 40 0 1 0 -80 0 40 40 0 1 0 80 0zm152 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80zM48 224l16 0 0 192-16 0c-26.5 0-48-21.5-48-48l0-96c0-26.5 21.5-48 48-48zm544 0c26.5 0 48 21.5 48 48l0 96c0 26.5-21.5 48-48 48l-16 0 0-192 16 0z"})],-1)),t[7]||(t[7]=x(" Thinking ",-1)),S(h)])):u("",!0),r("div",jo,[i.stateOfSocket.isStreaming&&i.stateOfSocket.streamType==="learningObjective"&&i.stateOfSocket.currentStreamThread==o.assistantData.threadId?(l(),a("div",{key:0,class:"d-flex my-3 tutor-conversation streamed-message p-2",innerHTML:n.applyMarkDownFormatting(i.stateOfSocket.streamingMessage)},null,8,Fo)):u("",!0),(l(!0),a(C,null,O(o.messageList,(f,y)=>(l(),a("div",{class:m(["d-flex my-3",{"justify-content-end":f.role==="user"}])},[f.role==="user"?(l(),a("div",zo,[r("em",null,k(f.content[0].text.value),1)])):f.role==="assistant"?(l(),a("div",{key:1,class:"tutor-conversation p-2",innerHTML:n.applyMarkDownFormatting(f.content[0].text.value)},null,8,qo)):u("",!0),f.isAudioGenerating&&f.role==="assistant"?(l(),a("div",Go,t[8]||(t[8]=[r("span",{class:"speech-loader"},null,-1)]))):!o.waitForGenerateAudio&&!f.isAudioGenerating&&f.role==="assistant"?(l(),a("button",{key:3,onClick:p=>n.playAudio(f.index),class:"btn speechButton"},[o.isAudioPlaying==!1?(l(),a("svg",Ko,t[9]||(t[9]=[r("path",{d:"M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zM188.3 147.1c7.6-4.2 16.8-4.1 24.3 .5l144 88c7.1 4.4 11.5 12.1 11.5 20.5s-4.4 16.1-11.5 20.5l-144 88c-7.4 4.5-16.7 4.7-24.3 .5s-12.3-12.2-12.3-20.9l0-176c0-8.7 4.7-16.7 12.3-20.9z"},null,-1)]))):o.isAudioPlaying==!0&&f.index===o.currentIndexAudioPlaying?(l(),a("div",Yo,[t[10]||(t[10]=r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"yellow",height:"18",width:"18"},[r("path",{d:"M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm192-96l128 0c17.7 0 32 14.3 32 32l0 128c0 17.7-14.3 32-32 32l-128 0c-17.7 0-32-14.3-32-32l0-128c0-17.7 14.3-32 32-32z"})],-1)),S(d)])):u("",!0)],8,Wo)):u("",!0)],2))),256))])]))}const Zo=E(Po,[["render",Jo],["__scopeId","data-v-48a4559b"]]);const Qo={setup(){const e=Jt(),t=Zt(),s=B(),i=Kt(),o=Ct(),n=_t(),h=ct(),d=xt(),f=K(),y=Y();return e.tagsList.length==0&&e.getTagsList(),{tagsStore:e,skillTagsStore:t,userDetailsStore:s,skillsStore:i,skillTreeStore:o,userSkillsStore:n,sessionDetailsStore:h,showSkillStore:d,settingsStore:f,tenantStore:y}},data(){return{skillUrl:this.$route.params.skillUrl,skillId:null,skill:{learningObjectives:[]},userSkills:[],isMastered:!1,isUnlocked:!1,isAssessmentStarted:!1,isGoal:!1,filters:[],showFlaggingModal:!1,ancestor:this.$route.params.id,accessibleSkills:[],showAncestorLink:!1,isMobileCheck:window.innerWidth,showConfirmModal:!1,isSkillLoaded:!1,goalSteps:[],goals:[],toggleModal:!1,selectedSkill:null,isTutorialComplete:!1,showTutorialTip1:!1,showTutorialTip2:!1,showTutorialTip3:!1,showTutorialTip4:!1,showTutorialTip5:!1,showTutorialTip6:!1,showTutorialTip7:!1,showTutorialTip8:!1,showTutorialTip9:!1,showTutorialTip10:!1,showTutorialTip11:!1,showGuestLoginTooltip:!1,showCategoryCompletedModal:!1,nextSkillsInBranch:[],showLearningObjectives:!0,isAITokenLimitReached:!1,showMasteryModal:!1,areAllSubskillsMastered:!1,unmasteredSubskills:[],showUnmasteredModal:!1,thumbnailCDN:"https://d3igul60eo50b1.cloudfront.net",thumbnail:"",thumbnailURL:""}},computed:{calculatedSkillName(){return this.skillUrl?this.skillUrl.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}},components:{Forum:ws,FlagModals:Lt,AITutor:Eo,LearningObjectiveAITutor:Zo},async created(){try{this.isSkillLoaded=!1,document.title=this.calculatedSkillName+" - Parrhesia",this.thumbnailURL=this.thumbnailCDN+"/"+this.skillUrl;const e=[this.getSkill()];if(this.sessionDetailsStore.isLoggedIn&&e.push(this.checkTokenUsage()),await Promise.all(e),this.isSkillLoaded=!0,this.sessionDetailsStore.isLoggedIn){this.tenantStore.billingMode==null&&await this.tenantStore.getTenantDetails(this.userDetailsStore.tenantId);const t=[this.getUserSkills()];t.push(this.checkIfTutorialComplete()),await Promise.all(t),this.skill.type==="super"?await this.checkSubskillMastery():this.areAllSubskillsMastered=!0,this.isUnlocked||this.nearestAccessibleAncestor(this.skill)}}catch(e){console.error("Error in created hook:",e),this.isSkillLoaded=!1}},mounted(){this.showTutorialTip6&&this.scrollToTooltip(),this.showTutorialTip7&&this.scrollToTooltip()},methods:{async checkTokenUsage(){try{if(await this.userDetailsStore.getUserDetails(),await this.tenantStore.getTenantDetails(this.userDetailsStore.tenantId),this.userDetailsStore.email=="collinsmalcolm@gmail.com"||this.userDetailsStore.email=="simonehcollins@gmail.com"||this.userDetailsStore.userName=="malcolm"||this.userDetailsStore.userName=="simonehcollins")return;if(this.settingsStore&&typeof this.settingsStore.getSettings=="function")this.settingsStore.freeTokenMonthlyLimit===0&&await this.settingsStore.getSettings();else{console.error("Settings store is not properly initialized"),this.isAITokenLimitReached=!0;return}this.settingsStore.freeTokenMonthlyLimit<=this.userDetailsStore.monthlyTokenUsage&&(this.tenantStore.billingMode=="school"?this.tenantStore.tokens<=0&&(this.isAITokenLimitReached=!0):this.userDetailsStore.tokens<=0&&(this.isAITokenLimitReached=!0))}catch(e){console.error("Error in checkTokenUsage:",e),this.isAITokenLimitReached=!0}},async getSkill(){await this.showSkillStore.getSkillFirstPart(this.skillUrl),this.skill.intro_sentence=this.showSkillStore.skill.intro_sentence,this.skill.type=this.showSkillStore.skill.type,this.skill.level=this.showSkillStore.skill.level,this.skill.is_human_edited=this.showSkillStore.skill.is_human_edited;const e=this.showSkillStore.skill.image_thumbnail_url.split("/");this.thumbnailURL=this.thumbnailCDN+"/"+e[e.length-1],await this.showSkillStore.getSkillSecondPart(this.skillUrl),this.skill=this.showSkillStore.skill,this.skillId=this.skill.id,this.calculatedSkillName.includes("Vocabulary Test")&&(this.showLearningObjectives=!1),this.skill.learningObjectives=[],await this.getLearningObjectives(),document.querySelector('meta[name="description"]').setAttribute("content",this.skill.intro_sentence),this.getSkillFilters(),this.userDetailsStore.role=="student"&&this.recordSkillVisit(this.skillId)},async getLearningObjectives(){const e=await fetch("/skill-learning-objectives/"+this.skillId+"/list");if(this.skill.learningObjectives=await e.json(),this.sessionDetailsStore.isLoggedIn)for(let t=0;t<this.skill.learningObjectives.length;t++)this.skill.learningObjectives[t].showAI=!1},recordSkillVisit(e){fetch("/user-skills/record-visit/"+e)},async getSkillFilters(){this.skillTagsStore.skillTagsList.length==0&&await this.skillTagsStore.getSkillTagsList();for(let e=0;e<this.skillTagsStore.skillTagsList.length;e++)this.skillTagsStore.skillTagsList[e].skill_id==this.skillId&&this.filters.push(this.skillTagsStore.skillTagsList[e].tag_id)},async getUserSkills(){const t=await(await fetch("/user-skills/filtered-unnested-list/"+this.userDetailsStore.userId)).json();this.userSkills=t,this.isMastered=!1,this.isUnlocked=!1,this.isGoal=!1,this.isAssessmentStarted=!1;for(let s=0;s<this.userSkills.length;s++)this.userSkills[s].id==this.skill.id&&(this.skill.type==="domain"?(this.userSkills[s].is_accessible==1&&(this.isUnlocked=!0),this.userSkills[s].is_goal==1&&(this.isGoal=!0)):(this.userSkills[s].is_mastered==1&&(this.isMastered=!0),this.userSkills[s].is_accessible==1&&(this.isUnlocked=!0),this.userSkills[s].is_assessment_started==1&&(this.isAssessmentStarted=!0),this.userSkills[s].is_goal==1&&(this.isGoal=!0))),this.userSkills[s].is_accessible==1&&this.accessibleSkills.push(this.userSkills[s]);if(this.skill.type==="super")try{const i=await(await fetch(`/skills/sub-skills/${this.skill.id}`)).json();if(!i||i.length===0)this.areAllSubskillsMastered=!0;else{let o=!0;for(const n of i){const h=this.userSkills.find(d=>d.id===n.id);if(!h||h.is_mastered!==1){o=!1;break}}this.areAllSubskillsMastered=o}}catch(s){console.error("Error checking subskill mastery:",s),this.areAllSubskillsMastered=!1}else this.areAllSubskillsMastered=!0},async MakeMastered(){if(this.skill.type==="domain")try{const t=await(await fetch(`/skills/get-first-child-skill/${this.skill.id}`)).json();await this.userSkillsStore.MakeMastered(this.userDetailsStore.userId,this.skill),await this.getUserSkills(),this.isMastered=!1,t&&t.url?this.$router.push(`/skills/${t.url}`):(await this.getNextSkillsInBranch(),this.showCategoryCompletedModal=!0)}catch(e){console.error("Error marking domain skill as mastered:",e)}else await this.userSkillsStore.MakeMastered(this.userDetailsStore.userId,this.skill),this.isMastered=!0,await this.getUserSkills(),await this.getNextSkillsInBranch(),this.showCategoryCompletedModal=!0},async getNextSkillsInBranch(){const e=await fetch("/user-skills/get-next-accessible-in-branch/"+this.userDetailsStore.userId+"/"+this.skillId);this.nextSkillsInBranch=await e.json()},closeFlagModal(){this.showModal=!1},nearestAccessibleAncestor(e){if(this.userDetailsStore.role!=="student")return;if(this.accessibleSkills.find(i=>i.id==e.id)){this.ancestor=e.url,this.showAncestorLink=!0;return}let s=[];if(e.type=="super")for(let i=0;i<this.accessibleSkills.length;i++)this.accessibleSkills[i].type=="sub"&&this.accessibleSkills[i].parent==e.id&&this.accessibleSkills[i].is_mastered!=1&&s.push(this.accessibleSkills[i]);if(s.length>0){this.ancestor=s[0].url,this.showAncestorLink=!0;return}fetch("/skills/show/"+e.parent).then(async i=>{if(!i.ok){if(i.status===404)return console.warn(`Parent skill not found for skill ID: ${e.parent}`),this.showAncestorLink=!1,null;throw new Error(`HTTP ${i.status}: ${i.statusText}`)}const o=await i.text();if(!o||o.trim()==="")return console.warn(`Empty response from /skills/show/${e.parent}`),this.showAncestorLink=!1,null;try{return JSON.parse(o)}catch(n){throw console.error(`JSON Parse Error for /skills/show/${e.parent}:`,n),console.error("Response text:",o),n}}).then(i=>{if(i&&!i.error)return this.nearestAccessibleAncestor(i);console.warn("No valid parent skill data found, stopping ancestor search"),this.showAncestorLink=!1}).catch(i=>{console.error("Error in nearestAccessibleAncestor:",i),this.showAncestorLink=!1})},copyShareableURLToClipBoard(){navigator.clipboard.writeText(window.location.href),this.showConfirmModal=!0},imageUrlAlternative(e){e.target.src="/images/skill-avatar/recurso.png"},openModal(e){this.selectedSkill=e,this.toggleModal=!0},closeModal(){this.toggleModal=!1,this.selectedSkill=null},async confirmCreateGoal(){this.selectedSkill&&(await this.userSkillsStore.getFilteredUnnestedList(this.userDetailsStore.userId),this.createGoal(this.selectedSkill),this.closeModal())},createGoal(e){e.type!="domain"&&this.goalSteps.push(e);let t=!1;if(e.type=="super")for(let i=0;i<this.userSkillsStore.filteredUnnestedList.length;i++)this.userSkillsStore.filteredUnnestedList[i].type=="sub"&&this.userSkillsStore.filteredUnnestedList[i].parent==e.id&&this.userSkillsStore.filteredUnnestedList[i].is_mastered!=1&&(this.goalSteps.push(this.userSkillsStore.filteredUnnestedList[i]),this.userSkillsStore.filteredUnnestedList[i].is_accessible&&(t=!0));if(this.accessibleSkills.find(i=>i.id==e.id)||t){this.populateGoalSteps();return}fetch("/skills/show/"+e.parent).then(i=>i.json()).then(i=>this.createGoal(i))},populateGoalSteps(){const e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({goalSteps:this.goalSteps})},t="/user-skills/set-goal/"+this.userDetailsStore.userId+"/"+this.skillId;fetch(t,e).then(()=>{alert(`You've created a goal for ${this.calculatedSkillName}, you can view your goals in the drop-down menu.`),this.$router.push(`/goals/${this.userDetailsStore.userId}/${this.skillId}`)})},async checkIfTutorialComplete(){const t=await(await fetch("/users/check-tutorial-progress/skill/"+this.userDetailsStore.userId)).json();t==0?(this.isTutorialComplete=!1,this.showTutorialTip1=!0):t==1&&(this.isTutorialComplete=!0)},progressTutorial(e){e==1?(this.showTutorialTip1=!1,this.isMastered?this.showTutorialTip3=!0:this.showTutorialTip2=!0):e==2?(this.showTutorialTip2=!1,this.showTutorialTip3=!0):e==3?(this.showTutorialTip3=!1,this.showTutorialTip4=!0):e==4?(this.showTutorialTip4=!1,this.showTutorialTip5=!0):e==5?(this.showTutorialTip5=!1,(this.userDetailsStore.role==="editor"||this.userDetailsStore.role==="instructor")&&(this.showTutorialTip5=!1,this.markTutorialComplete()),this.showTutorialTip6=!0):e==6?(this.showTutorialTip6=!1,this.showTutorialTip7=!0):e==7?(this.showTutorialTip7=!1,this.isMastered?this.showTutorialTip10=!0:this.showTutorialTip8=!0):e==8?(this.showTutorialTip8=!1,this.showTutorialTip9=!0):e==9?(this.showTutorialTip9=!1,this.showTutorialTip10=!0):e==10?(this.showTutorialTip10=!1,this.showTutorialTip11=!0):e==11&&(this.showTutorialTip11=!1,this.markTutorialComplete())},restartTutorial(){this.showTutorialTip1=!0,this.showTutorialTip2=!1,this.showTutorialTip3=!1,this.showTutorialTip4=!1,this.showTutorialTip5=!1,this.showTutorialTip6=!1,this.showTutorialTip7=!1,this.showTutorialTip8=!1,this.showTutorialTip9=!1,this.showTutorialTip10=!1,this.showTutorialTip11=!1,this.showInstructorEditorTutorialTip=!1,this.isTutorialComplete=!1},markTutorialComplete(){let e="/users/mark-tutorial-complete/skill/"+this.userDetailsStore.userId;fetch(e,{method:"PUT",headers:{"Content-Type":"application/json"}})},skipTutorial(){this.showTutorialTip1=!1,this.showTutorialTip2=!1,this.showTutorialTip3=!1,this.showTutorialTip4=!1,this.showTutorialTip5=!1,this.showTutorialTip6=!1,this.showTutorialTip7=!1,this.showTutorialTip8=!1,this.showTutorialTip9=!1,this.showTutorialTip10=!1,this.showTutorialTip11=!1,this.isTutorialComplete=!0,this.markTutorialComplete()},scrollToTooltip(){this.$nextTick(()=>{this.userDetailsStore.role=="student"&&this.showTutorialTip6&&this.$refs.learningObjectivesSection?this.$refs.learningObjectivesSection.scrollIntoView({behavior:"smooth",block:"start"}):this.showTutorialTip7&&this.$refs.aiTutorSection&&this.$refs.aiTutorSection.scrollIntoView({behavior:"smooth",block:"start"})})},scrollToAITutor(e){this.$refs.aiTutorSection&&this.$refs.aiTutorSection.scrollIntoView({behavior:"smooth",block:"start"}),e&&this.$refs.aiTutor.showTutorModal("socratic")},async checkSubskillMastery(){if(this.skill.type!=="super"){this.areAllSubskillsMastered=!0;return}try{const t=await(await fetch(`/skills/sub-skills/${this.skill.id}`)).json();if(!t||t.length===0){this.areAllSubskillsMastered=!0,this.unmasteredSubskills=[];return}let s=!0;this.unmasteredSubskills=[];for(const i of t){const o=this.userSkills.find(n=>n.id===i.id);(!o||o.is_mastered!=="1")&&(s=!1,this.unmasteredSubskills.push(i))}this.areAllSubskillsMastered=s}catch(e){console.error("Error checking subskill mastery:",e),this.areAllSubskillsMastered=!1,this.unmasteredSubskills=[]}},showUnmasteredSubskillsModal(){this.showUnmasteredModal=!0},handleSkillMastered(){this.isMastered=!0,this.showMasteryModal=!0},showGuestTooltip(){this.showGuestLoginTooltip=!0}},watch:{async $route(e,t){this.skillUrl=e.params.skillUrl,await this.getSkill(),await this.getUserSkills()},showTutorialTip6(e){e&&this.$nextTick(()=>{this.scrollToTooltip()})},showTutorialTip7(e){e&&this.$nextTick(()=>{this.scrollToTooltip()})}}},Xo={class:"container"},$o={class:"d-flex justify-content-between top-row"},tr={key:0,class:"border border-2 opacity-100 hr mb-2"},er={key:0},sr={key:1},ir={class:"modal-content"},or={class:"d-flex"},rr={key:0},nr={class:"modal-content"},lr={style:{color:"var(--primary-color)"}},ar={class:"modal-btns d-flex justify-content-between mt-3"},hr={class:"d-flex"},cr={key:0,class:"tool-tip-base"},ur={class:"explain-tool-tip triangle-top-left hovering-info-panel narrow-info-panel"},dr={class:"tool-tip-text"},fr={class:"tool-tip-text"},pr={class:"d-flex justify-content-between"},gr={class:"tool-tip-text"},mr={class:"d-flex justify-content-between"},yr={key:2,class:"tool-tip-base d-flex justify-content-end"},kr={class:"explain-tool-tip triangle-top-right hovering-info-panel narrow-info-panel"},wr={class:"tool-tip-text"},vr={class:"d-flex justify-content-between"},br={class:"explain-tool-tip triangle-top-left hovering-info-panel narrow-info-panel"},Tr={class:"tool-tip-text"},Sr={class:"d-flex justify-content-between"},_r={key:4,class:"tool-tip-base d-flex justify-content-end"},Cr={class:"explain-tool-tip triangle-top-right narrow-info-panel hovering-info-panel"},xr={class:"tool-tip-text"},Lr={class:"d-flex justify-content-between"},Mr={class:"tool-tip-text"},Ar={class:"d-flex justify-content-between"},Ir={key:6,class:"tool-tip-base d-flex justify-content-end"},Dr={class:"explain-tool-tip triangle-top-right narrow-info-panel hovering-info-panel"},Rr={class:"tool-tip-text"},Er={class:"d-flex justify-content-between"},Pr={key:7,class:"border border-1 opacity-100 hr mt-2 mb-0"},Or={class:"row"},Br={class:"col-md-8 order-2 order-md-1"},Hr={class:""},Nr={class:"bg-white rounded p-2",style:{"min-height":"60px"}},Ur={key:0,class:"mt-1"},Vr=["innerHTML"],jr={class:"col-md-4 order-1 order-md-2"},Fr={class:"info-box p-2 mb-4"},zr=["href","aria-label"],qr=["src","alt"],Gr={key:0},Wr={key:1},Kr={key:2},Yr={key:3},Jr={key:4},Zr={class:"mt-2"},Qr={key:0,"b-tooltip.hover":"",title:"This page was written or edited by a human"},Xr={key:1,"b-tooltip.hover":"",title:"This page was written by an AI"},$r={key:0,class:"mt-4",ref:"learningObjectivesSection"},tn={key:0,class:"tool-tip-base d-flex justify-content-start"},en={class:"explain-tool-tip hovering-info-panel triangle-top-left"},sn={class:"tool-tip-text"},on={class:"d-flex justify-content-between"},rn={class:"bg-white rounded p-2"},nn={class:"ms-2 w-100"},ln={class:"mb-0"},an={key:0},hn=["onClick"],cn={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"18",height:"18"},un={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"18",height:"18"},dn={key:1},fn={class:"row mt-3"},pn={class:"control control-checkbox"},gn={class:"my-auto mx-2 me-4"},mn=["value"],yn={class:"row mt-3 mb-3 position-relative",ref:"aiTutorSection"},kn={key:1},wn={key:2,class:"modal"},vn={class:"modal-content mastery-modal"},bn={class:"text-center mb-4"},Tn={class:"mb-3"},Sn={class:"d-flex justify-content-center"},_n={key:0},Cn={class:"row mt-3 mb-3"},xn={class:"modal-content asking-modal"},Ln={class:"d-flex justify-content-end gap-2"},Mn={key:1,class:"modal"},An={class:"modal-content"},In={class:"heading h5"},Dn={class:"d-flex justify-content-between"},Rn={key:4,class:"modal"},En={class:"modal-content"},Pn={key:0},On={class:"d-flex justify-content-between"},Bn={key:1},Hn={class:"d-flex justify-content-between"},Nn={key:2},Un={key:5,class:"modal"},Vn={class:"modal-content"},jn={key:0},Fn={class:"d-flex justify-content-between"},zn={key:1},qn={class:"d-flex justify-content-between"},Gn={key:2},Wn={key:6,class:"modal"},Kn={class:"modal-content"},Yn={key:0},Jn={class:"d-flex justify-content-between"},Zn={key:1},Qn={class:"d-flex justify-content-between"},Xn={key:2},$n={class:"d-flex justify-content-between"};function tl(e,t,s,i,o,n){const h=w("router-link"),d=w("LearningObjectiveAITutor"),f=w("AITutor"),y=w("Forum"),p=w("FlagModals");return l(),a(C,null,[r("div",Xo,[r("div",{id:"skill-info-container",class:m({domain:o.skill.type=="domain"})},[r("div",null,[r("div",$o,[r("h1",{class:m(["heading",{"text-center":o.isMobileCheck<576}])},k(n.calculatedSkillName),3)]),o.isMobileCheck>576?(l(),a("hr",tr)):u("",!0)]),r("div",{class:m(["row",{"mb-0":!i.sessionDetailsStore.isLoggedIn&&o.isMobileCheck<576,"mb-2":i.sessionDetailsStore.isLoggedIn||o.isMobileCheck>=576}])},[r("div",{class:m(["col d-flex justify-content-between",{"flex-column":o.isMobileCheck<576}])},[r("div",{class:m(["d-flex gap-1 w-100",{"justify-content-between":o.isMobileCheck<576}])},[!i.sessionDetailsStore.isLoggedIn&&o.skill.type!="domain"?(l(),a("button",{key:0,onClick:t[0]||(t[0]=(...c)=>n.showGuestTooltip&&n.showGuestTooltip(...c)),class:"btn socratic-btn"}," Socratic Tutor ")):i.userDetailsStore.role=="student"&&o.isAITokenLimitReached==!1&&o.skill.type!="domain"?(l(),a("button",{key:1,onClick:t[1]||(t[1]=c=>n.scrollToAITutor(!0)),class:"btn socratic-btn"}," Socratic Tutor ")):i.userDetailsStore.role=="student"&&o.skill.type!="domain"?(l(),a("button",{key:2,onClick:t[2]||(t[2]=c=>n.scrollToAITutor(!1)),class:"btn socratic-btn"}," Socratic Tutor ")):u("",!0),i.userDetailsStore.isSkillsLocked==1&&i.userDetailsStore.role=="student"&&!o.isUnlocked&&!o.isMastered&&o.showAncestorLink&&(o.skill.type!="super"||o.areAllSubskillsMastered)?(l(),T(h,{key:3,to:"/skills/"+o.ancestor,class:"btn assessment-btn me-1"},{default:L(()=>t[59]||(t[59]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"20",fill:"white"},[r("path",{d:"M144 144l0 48 160 0 0-48c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192l0-48C80 64.5 144.5 0 224 0s144 64.5 144 144l0 48 16 0c35.3 0 64 28.7 64 64l0 192c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 256c0-35.3 28.7-64 64-64l16 0z"})],-1),x("   Go to Nearest Unlocked Skill ",-1)])),_:1,__:[59]},8,["to"])):i.userDetailsStore.role=="student"&&!o.isMastered&&o.skill.type!="domain"&&(o.skill.type!=="super"||o.areAllSubskillsMastered)?(l(),a("button",{key:4,class:"btn me-1 assessment-btn",onClick:t[3]||(t[3]=c=>n.scrollToAITutor(!1))}," Take the Test ")):i.userDetailsStore.role=="student"&&!o.isMastered&&o.skill.type==="super"&&!o.areAllSubskillsMastered?(l(),a("button",{key:5,class:"btn me-1 assessment-btn",style:{opacity:"0.7"},onClick:t[4]||(t[4]=(...c)=>n.showUnmasteredSubskillsModal&&n.showUnmasteredSubskillsModal(...c)),title:"Click to see which subskills need to be mastered"}," Master Subskills First ")):i.userDetailsStore.role=="student"&&o.skill.type=="domain"?(l(),a("button",{key:6,onClick:t[5]||(t[5]=c=>n.MakeMastered()),class:"btn me-1 assessment-btn"}," Mark complete and go to next skill ")):i.sessionDetailsStore.isLoggedIn?u("",!0):(l(),a("button",{key:7,onClick:t[6]||(t[6]=(...c)=>n.showGuestTooltip&&n.showGuestTooltip(...c)),class:"btn me-1 assessment-btn"},[o.skill.type!="domain"?(l(),a("span",er,"Take the Test")):(l(),a("span",sr,"Mark complete and go to next skill"))])),o.showUnmasteredModal?(l(),a("div",{key:8,class:"modal",onClick:t[9]||(t[9]=Q(c=>o.showUnmasteredModal=!1,["self"]))},[r("div",ir,[t[60]||(t[60]=r("h1",{class:"heading h5"}," Complete these cluster skills first: ",-1)),(l(!0),a(C,null,O(o.unmasteredSubskills,c=>(l(),a("div",null,[S(h,{class:m([{"grade-school":o.skill.level=="grade_school","middle-school":o.skill.level=="middle_school","high-school":o.skill.level=="high_school",college:o.skill.level=="college",phd:o.skill.level=="phd"},"skill-link btn mb-1 text-start"]),to:`/skills/${c.url}`,onClick:t[7]||(t[7]=I=>o.showUnmasteredModal=!1)},{default:L(()=>[x(k(c.name),1)]),_:2},1032,["class","to"])]))),256)),r("button",{class:"btn primary-btn ms-auto me-0",onClick:t[8]||(t[8]=c=>o.showUnmasteredModal=!1)}," Close ")])])):u("",!0)],2),r("div",{class:m(["d-flex",{"justify-content-between":o.isMobileCheck<576,"mt-2":o.isMobileCheck<576}])},[r("span",or,[i.sessionDetailsStore.isLoggedIn?(l(),T(h,{key:0,to:"/skills/edit/"+o.skillUrl,class:"edit-btn btn primary-btn me-1"},{default:L(()=>t[61]||(t[61]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"20",height:"20",fill:"white"},[r("path",{d:"M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z"})],-1)])),_:1,__:[61]},8,["to"])):u("",!0),i.userDetailsStore.role=="platform_admin"||i.userDetailsStore.role=="editor"?(l(),T(h,{key:1,to:"/skills/history/"+this.skillUrl,class:"btn primary-btn me-1"},{default:L(()=>[o.isMobileCheck>576?(l(),a("span",rr,"History ")):u("",!0),t[62]||(t[62]=r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"18",height:"20",fill:"white"},[r("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9L0 168c0 13.3 10.7 24 24 24l110.1 0c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24l0 104c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65 0-94.1c0-13.3-10.7-24-24-24z"})],-1))]),_:1,__:[62]},8,["to"])):u("",!0),o.skill.type!="domain"&&i.sessionDetailsStore.isLoggedIn&&o.isMastered==!1&&o.isUnlocked==!1&&o.isGoal==!1&&i.userDetailsStore.role=="student"?(l(),a("button",{key:2,class:"btn primary-btn me-1",onClick:t[10]||(t[10]=c=>n.openModal(o.skill))},t[63]||(t[63]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"white",width:"20",height:"20"},[r("path",{d:"M448 256A192 192 0 1 0 64 256a192 192 0 1 0 384 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 80a80 80 0 1 0 0-160 80 80 0 1 0 0 160zm0-224a144 144 0 1 1 0 288 144 144 0 1 1 0-288zM224 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"})],-1)]))):u("",!0)]),o.toggleModal?(l(),a("div",{key:0,onClick:t[13]||(t[13]=Q((...c)=>n.closeModal&&n.closeModal(...c),["self"])),class:"modal"},[r("div",nr,[r("p",null,[t[64]||(t[64]=x(" Are you sure you want to create a goal for ",-1)),r("span",lr,k(n.calculatedSkillName),1),t[65]||(t[65]=x("? ",-1))]),r("div",ar,[r("button",{class:"btn red-btn",onClick:t[11]||(t[11]=(...c)=>n.closeModal&&n.closeModal(...c))}," No "),r("button",{class:"btn primary-btn",onClick:t[12]||(t[12]=(...c)=>n.confirmCreateGoal&&n.confirmCreateGoal(...c))}," Yes ")])])])):u("",!0),r("span",hr,[i.sessionDetailsStore.isLoggedIn||o.isMobileCheck>=576?(l(),a("button",{key:0,onClick:t[14]||(t[14]=(...c)=>n.copyShareableURLToClipBoard&&n.copyShareableURLToClipBoard(...c)),class:"btn me-1","aria-label":"share"},t[66]||(t[66]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"20",heigth:"20"},[r("path",{class:"primary-icon",d:"M352 224c53 0 96-43 96-96s-43-96-96-96s-96 43-96 96c0 4 .2 8 .7 11.9l-94.1 47C145.4 170.2 121.9 160 96 160c-53 0-96 43-96 96s43 96 96 96c25.9 0 49.4-10.2 66.6-26.9l94.1 47c-.5 3.9-.7 7.8-.7 11.9c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-25.9 0-49.4 10.2-66.6 26.9l-94.1-47c.5-3.9 .7-7.8 .7-11.9s-.2-8-.7-11.9l94.1-47C302.6 213.8 326.1 224 352 224z"})],-1)]))):u("",!0),i.sessionDetailsStore.isLoggedIn?(l(),a("button",{key:1,onClick:t[15]||(t[15]=c=>o.showFlaggingModal=!0),class:"btn me-1","b-tooltip.hover":"",title:"Report this skill to the admin if it has errors"},t[67]||(t[67]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",class:"flag-icon"},[r("path",{class:"primary-icon",d:"M64 32C64 14.3 49.7 0 32 0S0 14.3 0 32V64 368 480c0 17.7 14.3 32 32 32s32-14.3 32-32V352l64.3-16.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30V66.1c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L64 48V32z"})],-1)]))):u("",!0),i.sessionDetailsStore.isLoggedIn?(l(),a("button",{key:2,class:"btn me-1",onClick:t[16]||(t[16]=(...c)=>n.restartTutorial&&n.restartTutorial(...c)),"aria-label":"info"},t[68]||(t[68]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 192 512",width:"20",height:"23",class:"primary-icon"},[r("path",{d:"M48 80a48 48 0 1 1 96 0A48 48 0 1 1 48 80zM0 224c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224 32 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0 0-192-32 0c-17.7 0-32-14.3-32-32z"})],-1)]))):u("",!0)])],2)],2),i.userDetailsStore.role=="student"&&o.showTutorialTip2?(l(),a("div",cr,[r("div",ur,[r("div",dr,[r("div",fr,[t[69]||(t[69]=r("p",null,' Use "Take the Test" to assess your mastery, or "Socratic Tutor" to learn through guided questions. ',-1)),t[70]||(t[70]=r("p",null," If locked, the test button will redirect you to the nearest unlocked skill. ",-1)),r("div",pr,[r("button",{class:"btn primary-btn",onClick:t[17]||(t[17]=c=>n.progressTutorial(2))}," next "),r("button",{class:"btn red-btn",onClick:t[18]||(t[18]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])])])])):u("",!0),i.userDetailsStore.role=="student"&&o.showTutorialTip3?(l(),a("div",{key:1,class:m(["tool-tip-base d-flex justify-content-start",{"justify-content-end":o.isMobileCheck>576}])},[r("div",{class:m(["explain-tool-tip triangle-top-left hovering-info-panel narrow-info-panel",{"triangle-top-middle":o.isMobileCheck>576}])},[r("div",gr,[t[71]||(t[71]=r("p",null," Suggesting edits to this page or its test can increase your reputation score. ",-1)),t[72]||(t[72]=r("p",null," If this skill is marked as locked, you can also bookmark this skill by marking it as a goal. ",-1)),r("div",mr,[r("button",{class:"btn primary-btn",onClick:t[19]||(t[19]=c=>n.progressTutorial(3))}," next "),r("button",{class:"btn red-btn",onClick:t[20]||(t[20]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])],2)],2)):u("",!0),i.userDetailsStore.role=="student"&&o.showTutorialTip4?(l(),a("div",yr,[r("div",kr,[r("div",wr,[t[73]||(t[73]=r("p",null," Here you can share a link to this skill with a friend, or flag this page as unhelpful or incorrect. ",-1)),r("div",vr,[r("button",{class:"btn primary-btn",onClick:t[21]||(t[21]=c=>n.progressTutorial(4))}," next "),r("button",{class:"btn red-btn",onClick:t[22]||(t[22]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])])])):u("",!0),i.userDetailsStore.role=="editor"&&o.showTutorialTip2?(l(),a("div",{key:3,class:m(["tool-tip-base d-flex justify-content-start",{"justify-content-end":o.isMobileCheck>576}])},[r("div",br,[r("div",Tr,[t[74]||(t[74]=r("p",null,' The "Edit" button allows you to edit this skill page or its assessment. The "History" button shows all previous versions and changes. ',-1)),r("div",Sr,[r("button",{class:"btn primary-btn",onClick:t[23]||(t[23]=c=>n.progressTutorial(2))}," next "),r("button",{class:"btn red-btn",onClick:t[24]||(t[24]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])])],2)):u("",!0),i.userDetailsStore.role=="editor"&&o.showTutorialTip3?(l(),a("div",_r,[r("div",Cr,[r("div",xr,[t[75]||(t[75]=r("p",null," Here you can share a link to this skill with a friend, or flag this page as unhelpful or incorrect. ",-1)),r("div",Lr,[r("button",{class:"btn primary-btn",onClick:t[25]||(t[25]=c=>n.progressTutorial(3))}," next "),r("button",{class:"btn red-btn",onClick:t[26]||(t[26]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])])])):u("",!0),i.userDetailsStore.role=="instructor"&&o.showTutorialTip2?(l(),a("div",{key:5,class:m(["tool-tip-base d-flex justify-content-start",{"justify-content-end":o.isMobileCheck>576}])},[r("div",{class:m(["explain-tool-tip triangle-top-left hovering-info-panel narrow-info-panel",{"triangle-top-middle":o.isMobileCheck>576}])},[r("div",Mr,[t[76]||(t[76]=r("p",null," Here you can suggest an edit to this skill page. ",-1)),r("div",Ar,[r("button",{class:"btn primary-btn",onClick:t[27]||(t[27]=c=>n.progressTutorial(2))}," next "),r("button",{class:"btn red-btn",onClick:t[28]||(t[28]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])],2)],2)):u("",!0),i.userDetailsStore.role=="instructor"&&o.showTutorialTip3?(l(),a("div",Ir,[r("div",Dr,[r("div",Rr,[t[77]||(t[77]=r("p",null," Here you can share a link to this skill with a friend, or flag this page as unhelpful or incorrect. ",-1)),r("div",Er,[r("button",{class:"btn primary-btn",onClick:t[29]||(t[29]=c=>n.progressTutorial(3))}," next "),r("button",{class:"btn red-btn",onClick:t[30]||(t[30]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])])])):u("",!0),o.isMobileCheck>576?(l(),a("hr",Pr)):u("",!0)],2),r("div",Or,[r("div",Br,[r("div",Hr,[t[78]||(t[78]=r("h2",{class:"h4 secondary-heading"},"Introduction",-1)),r("div",Nr,[r("p",null,k(o.skill.intro_sentence),1)])]),o.skill.type!="domain"?(l(),a("div",Ur,[t[79]||(t[79]=r("h2",{class:"h4 secondary-heading"}," Requirements for Mastery ",-1)),r("div",{class:"bg-white rounded p-2 mastery-requirements-section",innerHTML:o.skill.mastery_requirements,style:{"min-height":"100px"}},null,8,Vr)])):u("",!0)]),r("div",jr,[r("div",Fr,[r("a",{href:o.skill.image_url,"aria-label":"full size image representing "+n.calculatedSkillName},[r("img",{src:o.thumbnailURL,onError:t[31]||(t[31]=(...c)=>n.imageUrlAlternative&&n.imageUrlAlternative(...c)),class:"rounded img-fluid",alt:"image representing "+n.calculatedSkillName,width:"294.4",height:"294.4",loading:"lazy",fetchpriority:"high",style:{"aspect-ratio":"1/1","object-fit":"cover"}},null,40,qr)],8,zr),!i.sessionDetailsStore.isLoggedIn&&o.isMobileCheck<576?(l(),a("button",{key:0,onClick:t[32]||(t[32]=(...c)=>n.copyShareableURLToClipBoard&&n.copyShareableURLToClipBoard(...c)),class:"btn","aria-label":"share"},t[80]||(t[80]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",width:"20",heigth:"20"},[r("path",{class:"primary-icon",d:"M352 224c53 0 96-43 96-96s-43-96-96-96s-96 43-96 96c0 4 .2 8 .7 11.9l-94.1 47C145.4 170.2 121.9 160 96 160c-53 0-96 43-96 96s43 96 96 96c25.9 0 49.4-10.2 66.6-26.9l94.1 47c-.5 3.9-.7 7.8-.7 11.9c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-25.9 0-49.4 10.2-66.6 26.9l-94.1-47c.5-3.9 .7-7.8 .7-11.9s-.2-8-.7-11.9l94.1-47C302.6 213.8 326.1 224 352 224z"})],-1)]))):u("",!0),r("div",{class:m({"mt-0":!i.sessionDetailsStore.isLoggedIn&&o.isMobileCheck<576,"mt-2":i.sessionDetailsStore.isLoggedIn||o.isMobileCheck>=576})},[t[81]||(t[81]=r("h2",{class:"h4 secondary-heading"},"Level",-1)),o.skill.level=="grade_school"?(l(),a("span",Gr,"Grade School")):o.skill.level=="middle_school"?(l(),a("span",Wr,"Middle School")):o.skill.level=="high_school"?(l(),a("span",Kr,"High School")):o.skill.level=="college"?(l(),a("span",Yr,"College")):o.skill.level=="phd"?(l(),a("span",Jr,"PHD")):u("",!0)],2),r("div",Zr,[t[84]||(t[84]=r("h2",{class:"h4 secondary-heading"},"Author",-1)),o.skill.is_human_edited?(l(),a("div",Qr,t[82]||(t[82]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",height:"22"},[r("path",{d:"M112 48a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm40 304l0 128c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-223.1L59.4 304.5c-9.1 15.1-28.8 20-43.9 10.9s-20-28.8-10.9-43.9l58.3-97c17.4-28.9 48.6-46.6 82.3-46.6l29.7 0c33.7 0 64.9 17.7 82.3 46.6l58.3 97c9.1 15.1 4.2 34.8-10.9 43.9s-34.8 4.2-43.9-10.9L232 256.9 232 480c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-128-16 0z",fill:"black"})],-1)]))):(l(),a("div",Xr,t[83]||(t[83]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512",height:"22"},[r("path",{d:"M320 0c17.7 0 32 14.3 32 32l0 64 120 0c39.8 0 72 32.2 72 72l0 272c0 39.8-32.2 72-72 72l-304 0c-39.8 0-72-32.2-72-72l0-272c0-39.8 32.2-72 72-72l120 0 0-64c0-17.7 14.3-32 32-32zM208 384c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zm96 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l32 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0zM264 256a40 40 0 1 0 -80 0 40 40 0 1 0 80 0zm152 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80zM48 224l16 0 0 192-16 0c-26.5 0-48-21.5-48-48l0-96c0-26.5 21.5-48 48-48zm544 0c26.5 0 48 21.5 48 48l0 96c0 26.5-21.5 48-48 48l-16 0 0-192 16 0z",fill:"black"})],-1)])))])])])]),o.skill.type!="domain"&&o.showLearningObjectives?(l(),a("div",$r,[t[89]||(t[89]=r("h2",{class:"h4 secondary-heading"},"Learning Objectives",-1)),i.userDetailsStore.role=="student"&&o.showTutorialTip6?(l(),a("div",tn,[r("div",en,[r("div",sn,[t[85]||(t[85]=r("p",null," Learning Objectives outline the specific skills and knowledge you need to master this subject. Click the + button next to any objective to get personalized help from an AI tutor specifically focused on that objective. ",-1)),r("div",on,[r("button",{class:"btn primary-btn",onClick:t[33]||(t[33]=c=>n.progressTutorial(6))}," next "),r("button",{class:"btn red-btn",onClick:t[34]||(t[34]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])])])):u("",!0),r("div",rn,[(l(!0),a(C,null,O(o.skill.learningObjectives,c=>(l(),a("div",{class:m(["d-flex mb-3 justify-content-between",{"mb-4":c.showAI}])},[t[88]||(t[88]=r("div",null,[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"6",height:"6"},[r("path",{d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z"})])],-1)),r("div",nn,[r("p",ln,k(c.objective),1),c.showAI?(l(),a("div",an,[S(d,{learningObjective:c.objective,learningObjectiveId:c.id,skillName:n.calculatedSkillName,skillId:o.skill.id,skillUrl:o.skill.url,skillLevel:o.skill.level},null,8,["learningObjective","learningObjectiveId","skillName","skillId","skillUrl","skillLevel"])])):u("",!0)]),i.sessionDetailsStore.isLoggedIn&&i.userDetailsStore.role=="student"?(l(),a("button",{key:0,class:"btn plus-btn",onClick:I=>c.showAI=!c.showAI},[c.showAI?(l(),a("svg",un,t[87]||(t[87]=[r("path",{d:"M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"},null,-1)]))):(l(),a("svg",cn,t[86]||(t[86]=[r("path",{d:"M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"},null,-1)])))],8,hn)):u("",!0)],2))),256))])],512)):u("",!0),i.userDetailsStore.role=="platform_admin"?(l(),a("div",dn,[t[92]||(t[92]=r("div",{class:"row"},[r("div",{class:"col col-md-8 p-4 p-md-0"},[r("hr",{class:"border border-2 opacity-100 hr"})])],-1)),r("div",fn,[t[91]||(t[91]=r("div",{class:"h1-title"},"Filter",-1)),(l(!0),a(C,null,O(i.tagsStore.tagsList,c=>(l(),a("label",pn,[r("span",gn,k(c.name),1),V(r("input",{type:"checkbox",value:c.id,"onUpdate:modelValue":t[35]||(t[35]=I=>o.filters=I),disabled:""},null,8,mn),[[Yt,o.filters]]),t[90]||(t[90]=r("div",{class:"control_indicator"},null,-1))]))),256))])])):u("",!0)],2),r("div",yn,[o.isSkillLoaded&&(i.userDetailsStore.role==="student"||!i.sessionDetailsStore.isLoggedIn)&&o.skill.type!=="domain"?(l(),T(f,{key:0,ref:"aiTutor",skill:o.skill,showTutorialTip7:o.showTutorialTip7,showTutorialTip8:o.showTutorialTip8,showTutorialTip9:o.showTutorialTip9,areAllSubskillsMastered:o.areAllSubskillsMastered,onSkipTutorial:n.skipTutorial,onProgressTutorial:n.progressTutorial,onSkillMastered:n.handleSkillMastered},null,8,["skill","showTutorialTip7","showTutorialTip8","showTutorialTip9","areAllSubskillsMastered","onSkipTutorial","onProgressTutorial","onSkillMastered"])):o.isSkillLoaded&&i.userDetailsStore.role==="student"&&o.skill.type!=="domain"?(l(),a("div",kn,t[93]||(t[93]=[r("em",null,"You have reached your monthly AI token limit. Please recharge your tokens to use more.",-1)]))):u("",!0),o.showMasteryModal?(l(),a("div",wn,[r("div",vn,[r("div",bn,[t[96]||(t[96]=r("h2",{class:"heading"},"Congratulations!",-1)),r("p",Tn,[t[94]||(t[94]=x(" You have mastered the skill ",-1)),r("strong",null,k(n.calculatedSkillName),1),t[95]||(t[95]=x("! ",-1))]),t[97]||(t[97]=r("div",{class:"trophy-icon mb-3"},[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 576 512",width:"80",height:"80",fill:"#FFD700"},[r("path",{d:"M400 0H176c-26.5 0-48.1 21.8-47.1 48.2c.2 5.3 .4 10.6 .7 15.8H24C10.7 64 0 74.7 0 88c0 92.6 33.5 157 78.5 200.7c44.3 43.1 98.3 64.8 138.1 75.8c23.4 6.5 39.4 26 39.4 45.6c0 20.9-17 37.9-37.9 37.9H192c-17.7 0-32 14.3-32 32s14.3 32 32 32H384c17.7 0 32-14.3 32-32s-14.3-32-32-32H357.9C337 448 320 431 320 410.1c0-19.6 15.9-39.2 39.4-45.6c39.9-11 93.9-32.7 138.2-75.8C542.5 245 576 180.6 576 88c0-13.3-10.7-24-24-24H446.4c.3-5.2 .5-10.4 .7-15.8C448.1 21.8 426.5 0 400 0zM48.9 112h84.4c9.1 90.1 29.2 150.3 51.9 190.6c-24.9-11-50.8-26.5-73.2-48.3c-32-31.1-58-76-63-142.3zM464.1 254.3c-22.4 21.8-48.3 37.3-73.2 48.3c22.7-40.3 42.8-100.5 51.9-190.6h84.4c-5.1 66.3-31.1 111.2-63 142.3z"})])],-1))]),r("div",Sn,[r("button",{class:"btn primary-btn",onClick:t[36]||(t[36]=c=>o.showMasteryModal=!1)}," Continue ")])])])):u("",!0)],512),o.skill.type!="domain"?(l(),a("div",_n,[r("div",Cn,[o.isSkillLoaded?(l(),T(y,{key:0,skillId:o.skill.id,showTutorialTip10:o.showTutorialTip10,userRole:i.userDetailsStore.role,onSkipTutorial:n.skipTutorial,onProgressTutorial:n.progressTutorial},null,8,["skillId","showTutorialTip10","userRole","onSkipTutorial","onProgressTutorial"])):u("",!0)])])):u("",!0),t[98]||(t[98]=r("p",null," ",-1))]),o.showConfirmModal?(l(),a("div",{key:0,onClick:t[38]||(t[38]=c=>o.showConfirmModal=!1),class:"modal"},[r("div",xn,[t[100]||(t[100]=r("p",null,"URL copied to clipboard",-1)),r("div",Ln,[r("button",{type:"button",class:"btn primary-btn modal-btn",onClick:t[37]||(t[37]=c=>o.showConfirmModal=!1)},t[99]||(t[99]=[r("span",{class:"d-none d-md-block"}," OK ",-1),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"18",height:"18",fill:"white",class:"d-md-none"},[r("path",{d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"})],-1)]))])])])):u("",!0),o.showCategoryCompletedModal?(l(),a("div",Mn,[r("div",An,[r("h1",In," You have completed "+k(n.calculatedSkillName)+"! ",1),t[101]||(t[101]=r("p",null,"The next skills in this branch are:",-1)),(l(!0),a(C,null,O(o.nextSkillsInBranch,c=>(l(),a("div",null,[S(h,{class:m([{"grade-school":c.level=="grade_school","middle-school":c.level=="middle_school","high-school":c.level=="high_school",college:c.level=="college",phd:c.level=="phd"},"skill-link btn mb-1"]),to:`/skills/${c.url}`,target:"_blank"},{default:L(()=>[x(k(c.name),1)]),_:2},1032,["class","to"])]))),256)),r("button",{class:"btn primary-btn ms-auto me-0",onClick:t[39]||(t[39]=c=>o.showCategoryCompletedModal=!1)}," Close ")])])):u("",!0),o.showFlaggingModal?(l(),T(p,{key:2,userId:i.userDetailsStore.userId,contentType:"skill",contentId:o.skillId},null,8,["userId","contentId"])):u("",!0),o.showGuestLoginTooltip?(l(),a("div",{key:3,class:"modal",onClick:t[43]||(t[43]=c=>o.showGuestLoginTooltip=!1)},[r("div",{class:"modal-content",onClick:t[42]||(t[42]=Q(()=>{},["stop"]))},[t[103]||(t[103]=r("p",null," Please login to access this feature and track your learning progress. ",-1)),r("div",Dn,[S(h,{class:"btn primary-btn",to:"/login",onClick:t[40]||(t[40]=c=>o.showGuestLoginTooltip=!1)},{default:L(()=>t[102]||(t[102]=[x(" Login ",-1)])),_:1,__:[102]}),r("button",{class:"btn red-btn",onClick:t[41]||(t[41]=c=>o.showGuestLoginTooltip=!1)}," Close ")])])])):u("",!0),i.userDetailsStore.role=="student"&&(o.showTutorialTip1||o.showTutorialTip5||o.showTutorialTip11)?(l(),a("div",Rn,[r("div",En,[o.showTutorialTip1?(l(),a("div",Pn,[t[104]||(t[104]=r("p",null," Here is where you can learn about a subject, find resources for mastering it, and take a test to demonstrate your mastery. ",-1)),r("div",On,[r("button",{class:"btn primary-btn",onClick:t[44]||(t[44]=c=>n.progressTutorial(1))}," next "),r("button",{class:"btn red-btn",onClick:t[45]||(t[45]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])):o.showTutorialTip5?(l(),a("div",Bn,[t[105]||(t[105]=r("p",null,' The "Requirements for Mastery" and "Learning Objectives" sections explain everything one needs to learn to master the skill. ',-1)),r("div",Hn,[r("button",{class:"btn primary-btn",onClick:t[46]||(t[46]=c=>n.progressTutorial(5))}," next "),r("button",{class:"btn red-btn",onClick:t[47]||(t[47]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])):o.showTutorialTip11?(l(),a("div",Nn,[t[106]||(t[106]=r("p",null," Remember that you can master this skill in two ways: by taking the formal assessment test at the top of the page, or by successfully completing an assessment session with the Assessment Tutor. Choose the method that works best for your learning style. ",-1)),r("button",{class:"btn primary-btn",onClick:t[48]||(t[48]=c=>n.progressTutorial(11))}," close ")])):u("",!0)])])):u("",!0),i.userDetailsStore.role=="editor"&&(o.showTutorialTip1||o.showTutorialTip4||o.showTutorialTip5)?(l(),a("div",Un,[r("div",Vn,[o.showTutorialTip1?(l(),a("div",jn,[t[107]||(t[107]=r("p",null," Here is where you can learn about a subject, find resources for mastering it, and take a test to demonstrate your mastery. ",-1)),r("div",Fn,[r("button",{class:"btn primary-btn",onClick:t[49]||(t[49]=c=>n.progressTutorial(1))}," next "),r("button",{class:"btn red-btn",onClick:t[50]||(t[50]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])):o.showTutorialTip4?(l(),a("div",zn,[t[108]||(t[108]=r("p",null,' The "Requirements for mastery" section explains everything a student needs to learn to master the skill. ',-1)),r("div",qn,[r("button",{class:"btn primary-btn",onClick:t[51]||(t[51]=c=>n.progressTutorial(4))}," next "),r("button",{class:"btn red-btn",onClick:t[52]||(t[52]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])):o.showTutorialTip5?(l(),a("div",Gn,[t[109]||(t[109]=r("p",null,' At the bottom of the page, in the "Best Places To Learn This" section, students can find various sites and resources to learn about this topic. ',-1)),r("button",{class:"btn primary-btn",onClick:t[53]||(t[53]=c=>n.progressTutorial(5))}," close ")])):u("",!0)])])):u("",!0),i.userDetailsStore.role=="instructor"&&(o.showTutorialTip1||o.showTutorialTip4||o.showTutorialTip5)?(l(),a("div",Wn,[r("div",Kn,[o.showTutorialTip1?(l(),a("div",Yn,[t[110]||(t[110]=r("p",null," This page is where students can learn about, and take a test to try to master, this skill. ",-1)),r("div",Jn,[r("button",{class:"btn primary-btn",onClick:t[54]||(t[54]=c=>n.progressTutorial(1))}," next "),r("button",{class:"btn red-btn",onClick:t[55]||(t[55]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])):o.showTutorialTip4?(l(),a("div",Zn,[t[111]||(t[111]=r("p",null,' The "Requirements for mastery" section explains everything a student needs to learn to master the skill. ',-1)),r("div",Qn,[r("button",{class:"btn primary-btn",onClick:t[56]||(t[56]=c=>n.progressTutorial(4))}," next "),r("button",{class:"btn red-btn",onClick:t[57]||(t[57]=(...c)=>n.skipTutorial&&n.skipTutorial(...c))}," exit tutorial ")])])):o.showTutorialTip5?(l(),a("div",Xn,[t[112]||(t[112]=r("p",null,' At the bottom of the page, in the "Best Places To Learn This" section, students can find various sites and resources to learn about this topic. ',-1)),r("div",$n,[r("button",{class:"btn primary-btn",onClick:t[58]||(t[58]=c=>n.progressTutorial(5))}," close ")])])):u("",!0)])])):u("",!0)],64)}const el=E(Qo,[["render",tl],["__scopeId","data-v-1fcafbea"]]),sl={setup(){const e=B(),t=xt();return{userDetailsStore:e,showSkillStore:t}},data(){return{}},components:{ShowSkill:el,SkillTimeTracker:Xt},beforeRouteLeave(e,t,s){if(!this.userDetailsStore.userId||this.showSkillStore.skill.type=="domain"){s();return}this.$refs.skillTimeTracker.saveDuration(),s()}},il={class:"position-relative d-flex"},ol={class:"container"};function rl(e,t,s,i,o,n){const h=w("ShowSkill"),d=w("SkillTimeTracker");return l(),a(C,null,[r("div",il,[r("div",ol,[S(h,{ref:"childComponent"},null,512)])]),i.showSkillStore.skill?(l(),T(d,{key:0,ref:"skillTimeTracker"},null,512)):u("",!0)],64)}const fl=E(sl,[["render",rl]]);export{fl as default};
