import{_ as m,f as g,L as f,i as y,o,c as r,a as s,q as h,t as u,s as b,b as p,F as S,z as _,p as k,d as T}from"./main-1e01188a.js";const P={setup(){const t=g(),e=f(),l=y();return{userDetailsStore:t,settingsStore:e,sessionDetailsStore:l}},data(){return{monthlyTokenUsage:null,year:0,month:"",isAITokenLimitReached:!1,isMobileCheck:window.innerWidth,showTooltip:!1,subscription:{},subSchedule:{},basicPlanPriceId:"price_1RCKSvFfW0WtxYZHCcfnbL5R",infinitePlanPriceId:"price_1RCKUZFfW0WtxYZHxz1ksgww",nextSubSchedulePhasePlan:"",isLoading:!1,receipts:[]}},async created(){this.settingsStore.freePlanTokenLimit||await this.settingsStore.getSettings(),await this.userDetailsStore.getUserDetails(),await this.getSubscription()},async mounted(){let t=document.createElement("script");t.setAttribute("src","https://js.stripe.com/v3/"),document.head.appendChild(t),this.userDetailsStore.subscriptionTier=="free"?this.settingsStore.freePlanTokenLimit&&this.userDetailsStore.monthlyTokenUsage&&this.settingsStore.freePlanTokenLimit<=this.userDetailsStore.monthlyTokenUsage&&(this.isAITokenLimitReached=!0):this.userDetailsStore.subscriptionTier=="basic"&&this.settingsStore.basicPlanTokenLimit&&this.userDetailsStore.monthlyTokenUsage&&this.settingsStore.basicPlanTokenLimit<=this.userDetailsStore.monthlyTokenUsage&&(this.isAITokenLimitReached=!0),this.year=new Date().getFullYear();const e=["January","February","March","April","May","June","July","August","September","October","November","December"],l=new Date;this.month=e[l.getMonth()]},computed:{formattedStripeCurrentPeriodEndDate(){let t=new Date(this.subscription.current_period_end*1e3);const e=t.getUTCMonth()+1,l=t.getUTCDate();return t.getUTCFullYear()+"/"+e+"/"+l},formattedMonthlyTokenUsage(){return this.userDetailsStore.monthlyTokenUsage?this.userDetailsStore.monthlyTokenUsage.toLocaleString():"0"},formattedFreePlanTokenLimit(){return this.settingsStore.freePlanTokenLimit?this.settingsStore.freePlanTokenLimit.toLocaleString():"0"},formattedBasicPlanTokenLimit(){return this.settingsStore.basicPlanTokenLimit?this.settingsStore.basicPlanTokenLimit.toLocaleString():"0"},subscriptionTierFormatted(){return this.userDetailsStore.subscriptionTier?this.userDetailsStore.subscriptionTier.toLocaleString():"free"}},methods:{async getSubscription(){const e=await(await fetch("/subscriptions/get-sub/"+this.userDetailsStore.userId)).json();if(this.subscription=e.subscription,this.subSchedule=e.subSchedule,this.subSchedule){let l=this.subSchedule.phases[1].items[0].price;l==this.basicPlanPriceId?this.nextSubSchedulePhasePlan="Basic":l==this.infinitePlanPriceId&&(this.nextSubSchedulePhasePlan="Infinite")}for(let l=0;l<e.charges.data.length;l++)this.receipts.push(e.charges.data[l]);console.log(this.receipts)},checkout(t){fetch("/subscriptions/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId,planType:t})}).then(e=>e.ok?e.json():e.json().then(l=>Promise.reject(l))).then(({url:e})=>{window.location=e}).catch(e=>{console.error(e.error)})},loadPortal(){fetch("/subscriptions/create-customer-portal-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId})}).then(t=>t.ok?t.json():t.json().then(e=>Promise.reject(e))).then(({url:t})=>{window.location=t}).catch(t=>{console.error(t.error)})},cancelPlan(){if(confirm("Are you sure you want to downgrade to the Free plan?"))fetch("/subscriptions/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId})}).then(function(t){return t.json()}).then(async t=>{t.status=="succeeded"?this.getSubscription():alert("Downgrade did not work. Please try again later.")});else return},downgradePlan(){if(confirm("Are you sure you want to downgrade to the Basic plan?"))this.isLoading=!0,fetch("/subscriptions/downgrade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:this.subscription.id,subScheduleId:this.subSchedule?this.subSchedule.id:null})}).then(function(t){return t.json()}).then(async t=>{t.status=="succeeded"?await this.getSubscription():alert("Downgrade did not work. Please try again later."),this.isLoading=!1});else return},upgradePlan(){if(confirm("Are you sure you want to upgrade to the Infinite plan? (You will be billed immediately)"))this.isLoading=!0,fetch("/subscriptions/upgrade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:this.subscription.id})}).then(function(t){return t.json()}).then(async t=>{t.status=="succeeded"?(await this.userDetailsStore.getUserDetails(),this.$router.push("/subscriptions/completed")):alert("Upgrade did not work. Please try again later."),this.isLoading=!1});else return},formattedStripeReceiptDate(t){let e=new Date(t.created*1e3);const l=e.getUTCMonth()+1,d=e.getUTCDate();return e.getUTCFullYear()+"/"+l+"/"+d},formattedStripeReceiptAmount(t){return(t.amount_captured/100).toLocaleString("en-US",{style:"currency",currency:"USD"})},openTooltip(){this.showTooltip=!0},closeTooltip(){this.showTooltip=!1}}},a=t=>(k("data-v-3d5153a7"),t=t(),T(),t),w={class:"container"},D={class:"row mt-4"},C={class:"col-md"},v=a(()=>s("strong",null,"Your subscription tier:",-1)),L=a(()=>s("strong",null,"Current token usage:",-1)),I={key:0,class:"modal"},x={class:"modal-content"},M=a(()=>s("p",null," It is against our policy to share accounts and each account is meant to only be used by one user. ",-1)),U=a(()=>s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 192 512",width:"20",height:"20",class:"primary-icon"},[s("path",{d:"M48 80a48 48 0 1 1 96 0A48 48 0 1 1 48 80zM0 224c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224 32 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0 0-192-32 0c-17.7 0-32-14.3-32-32z"})],-1)),j=[U],A=a(()=>s("hr",null,null,-1)),F={key:0,class:"d-flex justify-content-center align-items-center py-4"},O=a(()=>s("span",{class:"subscription-loader"},null,-1)),R=[O],B={key:1,class:"row mt-4"},Y=a(()=>s("h2",{class:"secondary-heading h4"},"Free",-1)),N=a(()=>s("strong",null,"Token limit:",-1)),J={key:0,disabled:"",class:"btn primary-btn mt-1"},z=a(()=>s("h2",{class:"secondary-heading h4"},"Basic",-1)),E=a(()=>s("p",null,"Ideal for moderate use",-1)),W=a(()=>s("p",null,"$20 / month",-1)),V=a(()=>s("strong",null,"Token limit:",-1)),Z={key:2,disabled:"",class:"btn primary-btn mt-1 mb-3"},H=a(()=>s("h2",{class:"secondary-heading h4"},"Infinite",-1)),K=a(()=>s("p",null,"Ideal for daily use",-1)),q=a(()=>s("p",null,"$100 / month",-1)),G=a(()=>s("p",null,[s("strong",null,"Token limit:"),b(" Infinite ")],-1)),Q={key:2,disabled:"",class:"btn primary-btn mt-1"},X=a(()=>s("hr",null,null,-1)),$=a(()=>s("h2",{class:"secondary-heading h4"},"Receipts",-1)),ee=["href"],te={key:0};function se(t,e,l,d,i,n){return o(),r("div",w,[s("div",D,[s("div",C,[s("h2",{class:h(["secondary-heading h4 mb-4",{"text-center":i.isMobileCheck<576}])}," Monthly AI usage: "+u(i.month)+" "+u(i.year),3),s("ul",null,[s("li",null,[s("p",null,[v,b(" "+u(n.subscriptionTierFormatted),1)])]),s("li",null,[s("p",null,[L,b(" "+u(n.formattedMonthlyTokenUsage),1)])])]),i.isAITokenLimitReached?(o(),r("div",{key:0,class:h(["alert alert-warning",{"mb-0":i.isMobileCheck>=576}]),role:"alert"}," You are over the monthly free limit. You can't use the AI features until next month. ",2)):p("",!0),i.subscription&&i.subscription.cancel_at_period_end?(o(),r("div",{key:1,class:h(["alert alert-warning",{"mb-0":i.isMobileCheck>=576}]),role:"alert"}," Your plan will downgrade to the Free plan on "+u(n.formattedStripeCurrentPeriodEndDate),3)):p("",!0),i.nextSubSchedulePhasePlan!=""?(o(),r("div",{key:2,class:h(["alert alert-warning",{"mb-0":i.isMobileCheck>=576}]),role:"alert"}," Your plan will downgrade to the "+u(i.nextSubSchedulePhasePlan)+" plan on "+u(n.formattedStripeCurrentPeriodEndDate),3)):p("",!0)]),i.showTooltip?(o(),r("div",I,[s("div",x,[s("div",null,[M,s("button",{class:"btn primary-btn",onClick:e[0]||(e[0]=(...c)=>n.closeTooltip&&n.closeTooltip(...c))}," Close ")])])])):p("",!0),s("div",{class:h(["col-md d-flex",i.isMobileCheck>576?"justify-content-end":"justify-content-center"])},[d.userDetailsStore.subscriptionTier!="free"?(o(),r("button",{key:0,class:"btn primary-btn",onClick:e[1]||(e[1]=c=>n.loadPortal())}," Manage subscription ")):p("",!0),s("button",{class:"btn info-btn ms-1",onClick:e[2]||(e[2]=(...c)=>n.openTooltip&&n.openTooltip(...c))},j)],2)]),A,i.isLoading==!0?(o(),r("div",F,R)):(o(),r("div",B,[s("div",{class:h(["col-md mb-3",{"text-center":i.isMobileCheck<576}])},[Y,s("p",null,[N,b(" "+u(n.formattedFreePlanTokenLimit),1)]),d.userDetailsStore.subscriptionTier=="free"?(o(),r("button",J," current plan ")):i.subscription&&i.subscription.cancel_at_period_end==!1&&i.nextSubSchedulePhasePlan!="Basic"?(o(),r("button",{key:1,onClick:e[3]||(e[3]=c=>n.cancelPlan()),class:"btn primary-btn mt-1 mb-3"}," downgrade ")):p("",!0)],2),s("div",{class:h(["col-md mb-3",{"text-center":i.isMobileCheck<576}])},[z,E,W,s("p",null,[V,b(" "+u(n.formattedBasicPlanTokenLimit),1)]),d.userDetailsStore.subscriptionTier=="free"?(o(),r("button",{key:0,onClick:e[4]||(e[4]=c=>n.checkout("basic")),class:"btn primary-btn mt-1"}," buy ")):i.subscription&&d.userDetailsStore.subscriptionTier=="infinite"&&i.nextSubSchedulePhasePlan!="Basic"&&i.subscription.cancel_at_period_end==!1?(o(),r("button",{key:1,onClick:e[5]||(e[5]=c=>n.downgradePlan()),class:"btn primary-btn mt-1"}," downgrade ")):this.userDetailsStore.subscriptionTier=="basic"?(o(),r("button",Z," current plan ")):p("",!0)],2),s("div",{class:h(["col-md mb-3",{"text-center":i.isMobileCheck<576}])},[H,K,q,G,d.userDetailsStore.subscriptionTier=="free"?(o(),r("button",{key:0,onClick:e[6]||(e[6]=c=>n.checkout("infinite")),class:"btn primary-btn mt-1"}," buy ")):i.subscription&&d.userDetailsStore.subscriptionTier=="basic"&&i.subscription.cancel_at_period_end==!1?(o(),r("button",{key:1,onClick:e[7]||(e[7]=c=>n.upgradePlan()),class:"btn primary-btn mt-1"}," upgrade ")):this.userDetailsStore.subscriptionTier=="infinite"?(o(),r("button",Q," current plan ")):p("",!0)],2)])),X,s("div",{class:h({"text-center":i.isMobileCheck<576})},[$,(o(!0),r(S,null,_(i.receipts,c=>(o(),r("div",null,[s("a",{href:c.receipt_url,target:"_blank"},u(n.formattedStripeReceiptAmount(c))+" "+u(n.formattedStripeReceiptDate(c)),9,ee)]))),256)),i.isMobileCheck<576?(o(),r("p",te,"Â ")):p("",!0)],2)])}const ne=m(P,[["render",se],["__scopeId","data-v-3d5153a7"]]);export{ne as default};
