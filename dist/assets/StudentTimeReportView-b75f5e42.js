import{_ as g,y as v,e as w,r as m,o as p,c as S,a as o,t as f,f as y,j as D,p as b,b as T}from"./main-0db18a32.js";import{u as A}from"./TeacherAnalyticsStore-17500d9d.js";import{u as k}from"./AnalyticsStore-c8b73b27.js";import"./transform-af9a74a2.js";import{l as x,c as C,b as j}from"./linear-5b188edc.js";import{m as N,b as P}from"./continuous-7328829e.js";import{s as B}from"./sort-ed61f96d.js";import{s as I}from"./string-dd82ab4a.js";import{S as V,T as O}from"./TimePerSubjectHorizontalBarChart-0de0d828.js";import{D as q}from"./downloadCSVBtn-6d425410.js";import"./line-85f04100.js";import"./time-0457d93b.js";import"./point-ea70dc51.js";const R={name:"StudentSkillActivityChart",methods:{createChart(a){if(!a||a.length===0){console.warn("No data available for the chart");return}const e=25,n=0,i=0,t=10,l=200,d=document.getElementById("activity-chart-container").clientWidth,u=e*a.length,r=x().domain([0,N(a,s=>s.quantity)]).range([l,d-i]),c=P().domain(B(a,s=>-s.quantity).map(s=>s.name)).rangeRound([n,u-t]).padding(.1),h=I("#activity-chart-container").append("svg").attr("width","100%").attr("height","100%").attr("viewBox",[0,0,d,u]).attr("preserveAspectRatio","xMinYMin");h.append("g").attr("fill",(function(s){return"#5f31dd"}).bind(this)).selectAll().data(a).join("rect").attr("x",r(0)).attr("y",s=>c(s.name)).attr("width",s=>r(s.quantity)-r(0)).attr("height",c.bandwidth()),h.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(a).join("text").attr("x",s=>r(s.quantity)).attr("y",s=>c(s.name)+c.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(s=>s.formattedQuantity).call(s=>s.filter(_=>r(_.quantity)-r(0)<40).attr("dx",4).attr("fill","black").attr("text-anchor","start")),h.append("g").attr("transform",`translate(0,${n})`).call(C(r).ticks(0)).call(s=>s.select(".domain").remove()),h.append("g").attr("transform",`translate(${l},0)`).call(j(c).tickSizeOuter(0))}}};function $(a,e,n,i,t,l){return null}const Q=g(R,[["render",$]]);const M={setup(){const a=v(),e=A(),n=w(),i=k();return{usersStore:a,teacherAnalyticsStore:e,userDetailsStore:n,analyticsStore:i}},components:{StudentDurationPerDayLineChart:V,StudentSkillActivityChart:Q,TimePerSubjectHorizontalBarChart:O,DownloadCSVBtn:q},data(){return{studentId:this.$route.params.studentId,studentName:null,durationsPerDay:[],totalTimeOnPlatformDownloadData:[],minutesPerSkillDownloadData:[],averageDurationsPerDay:[],timeSpentOnSubjectDownloadData:[]}},async created(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const a=this.usersStore.users.find(e=>e.id===this.studentId);a&&(this.studentName=a.username),await this.getStudentDurationPerDay(),await this.getStudentActivity(),this.analyticsStore.subjectTimeSpent.length===0&&await this.analyticsStore.getStudentSubjectTimeSpent(this.studentId),this.getTimeSpentOnSkillDownloadData()},methods:{getTimeSpentOnSkillDownloadData(){this.timeSpentOnSubjectDownloadData=this.analyticsStore.subjectTimeSpent.map(a=>({subject:a.name,timeSpent:a.formattedQuantity}))},async getStudentDurationPerDay(){let a=`/student-analytics/student-duration-per-day-class/${this.studentId}/${this.userDetailsStore.userId}`;this.userDetailsStore.role==="school_admin"&&(a=`/student-analytics/student-duration-per-day-tenant/${this.studentId}/${this.userDetailsStore.tenantId}`),fetch(a).then(e=>e.json()).then(e=>{const n=e.studentTime;for(let t=0;t<n.length;t++)n[t].formattedQuantity=n[t].quantity/(1e3*60),n[t].date=new Date(n[t].date);n.sort((t,l)=>t.date-l.date),this.durationsPerDay=n,this.totalTimeOnPlatformDownloadData=this.durationsPerDay.map(t=>({date:t.date,minutes:t.formattedQuantity}));const i=e.averageTime;for(let t=0;t<i.length;t++)i[t].formattedQuantity=i[t].quantity/(1e3*60),i[t].date=new Date(i[t].date);i.sort((t,l)=>t.date-l.date),this.averageDurationsPerDay=i}).catch(e=>{console.error("Error fetching student duration per day:",e)})},async getStudentActivity(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const a=this.usersStore.users.find(e=>e.id===this.studentId);a&&(this.studentName=a.username),this.teacherAnalyticsStore.skillActivities.length==0&&await this.teacherAnalyticsStore.getSkillActivityReport(this.studentId),!this.teacherAnalyticsStore.skillActivities.error&&(this.teacherAnalyticsStore.skillActivities=this.teacherAnalyticsStore.skillActivities.map(e=>({...e,formattedQuantity:this.millisToMinutesAndSeconds(e.quantity)})),this.$nextTick(()=>{this.$refs.activityChart&&this.$refs.activityChart.createChart(this.teacherAnalyticsStore.skillActivities)}),this.downloadData=this.teacherAnalyticsStore.skillActivities.map(e=>({skill:e.name,minutes:e.formattedQuantity})))},millisToMinutesAndSeconds(a){var e=Math.floor(a/6e4),n=(a%6e4/1e3).toFixed(0);return e+":"+(n<10?"0":"")+n}}},L={class:"container-fluid chart-page"},z={class:"d-flex justify-content-between w-100 ps-3 pe-4 pt-2"},E={class:"secondary-heading h4"},H={class:"chart-row row"},U={class:"col-lg chart-col position-relative h-100 chart-card"},F={id:"time-chart-container"},W={key:1},Y={class:"position-absolute"},G={style:{color:"purple"}},J={class:"chart-row row"},K={class:"col-lg chart-col position-relative chart-card"},X={id:"subject-activity-chart-container"},Z={class:"col-lg chart-col position-relative overflow-auto chart-card"},tt={id:"activity-chart-container"};function et(a,e,n,i,t,l){const d=m("DownloadCSVBtn"),u=m("StudentDurationPerDayLineChart"),r=m("TimePerSubjectHorizontalBarChart"),c=m("StudentSkillActivityChart");return p(),S("div",L,[o("span",z,[e[0]||(e[0]=o("h1",{class:"heading h4"},"Engagement",-1)),o("h2",E,f(t.studentName),1)]),o("div",H,[o("div",U,[o("div",F,[y(d,{data:t.totalTimeOnPlatformDownloadData,fileName:`Total time on platform - ${t.studentName}`,toolTip:"Download total time on platform data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),t.durationsPerDay.length>0?(p(),D(u,{key:0,data:t.durationsPerDay,averageDuration:t.averageDurationsPerDay,userRole:i.userDetailsStore.role,studentName:t.studentName},null,8,["data","averageDuration","userRole","studentName"])):(p(),S("p",W,"There is no data to show yet."))]),o("figcaption",Y,[o("span",G,f(t.studentName),1),e[1]||(e[1]=b(" vs ",-1)),e[2]||(e[2]=o("span",{style:{color:"#ff7f0e"}},"class average",-1))])])]),o("div",J,[o("div",K,[o("div",X,[y(d,{data:t.timeSpentOnSubjectDownloadData,fileName:`Time spent on subject - ${t.studentName}`,toolTip:"Download Time spent on subject data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),i.analyticsStore.subjectTimeSpent.length>0?(p(),D(r,{key:0,data:i.analyticsStore.subjectTimeSpent,colour:"purple"},null,8,["data"])):T("",!0)])]),o("div",Z,[o("div",tt,[y(d,{data:t.minutesPerSkillDownloadData,fileName:`Minutes per skill - ${t.studentName}`,toolTip:"Download minutes per skill data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),y(c,{ref:"activityChart"},null,512)])])])])}const yt=g(M,[["render",et],["__scopeId","data-v-21020f13"]]);export{yt as default};
