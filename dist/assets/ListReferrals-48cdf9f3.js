import{_ as y,y as _,e as m,r as k,o,c as i,a as s,p as g,j as w,t as c,f as u,l as d,T as b,b as f,F as C,x as S}from"./main-ae8b2d89.js";const v={setup(){const t=_(),e=m();return{usersStore:t,usersDetailsStore:e}},data(){return{referrals:[],copySuccess:!1,copyTimeoutId:null}},async created(){typeof this.usersDetailsStore.userId>"u"&&await this.usersDetailsStore.getUserDetails(),await this.getReferrals()},computed:{referralLink(){return`https://parrhesia.io/student-signup?ref=${this.usersDetailsStore.userName}`}},methods:{async getReferrals(){fetch(`/referrals/${this.usersDetailsStore.userId}/list`).then(function(t){return t.json()}).then(async t=>{await this.usersStore.getUsers(),this.referrals=t;for(let e=0;e<this.referrals.length;e++)for(let r=0;r<this.usersStore.users.length;r++)this.referrals[e].referred_user_id==this.usersStore.users[r].id&&(this.referrals[e].referredUser=this.usersStore.users[r].username),this.referrals[e].referrer_user_id==this.usersStore.users[r].id&&(this.referrals[e].referringUser=this.usersStore.users[r].username);console.log(this.referrals)})},async copyReferralLink(){try{await this.copyToClipboard(this.referralLink)}catch(t){console.error("Copy failed:",t)}},async copyToClipboard(t){this.copyTimeoutId&&clearTimeout(this.copyTimeoutId);let e=!1;if(navigator.clipboard&&window.isSecureContext)try{await navigator.clipboard.writeText(t),e=!0}catch{console.warn("Clipboard API failed, using fallback")}if(!e){await this.$nextTick();const r=this.$refs.referralInput;r&&(r.focus(),r.select(),e=document.execCommand("copy"))}if(e)this.showCopyFeedback();else throw new Error("Could not copy to clipboard")},showCopyFeedback(){this.copySuccess=!0,this.copyTimeoutId=setTimeout(()=>{this.copySuccess=!1,this.copyTimeoutId=null},3e3)}},beforeUnmount(){this.copyTimeoutId&&clearTimeout(this.copyTimeoutId)}},x={class:"container bg-light rounded"},T={class:"d-flex justify-content-between align-items-start mb-4"},I={key:0,class:"referral-link-section"},L={class:"d-flex align-items-center gap-2"},R={class:"referral-link-container"},D=["value"],U={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},V={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},j={key:0,class:"copy-success-message mt-2 mb-0"},N={class:"referrals-list"},B={key:0,class:"list-unstyled"},F={class:"referral-item p-3 border rounded"},H={key:1,class:"text-muted"};function M(t,e,r,p,n,l){const h=k("router-link");return o(),i("div",x,[s("div",T,[e[4]||(e[4]=s("h1",{class:"heading"},"Referrals",-1)),p.usersDetailsStore.role=="partner"?(o(),i("div",I,[e[3]||(e[3]=s("h3",{class:"secondary-heading h5 mb-2"},"Student Referral Link",-1)),s("div",L,[s("div",R,[s("input",{ref:"referralInput",value:l.referralLink,type:"text",class:"form-control referral-input",readonly:""},null,8,D),s("button",{onClick:e[0]||(e[0]=(...a)=>l.copyReferralLink&&l.copyReferralLink(...a)),class:g(["btn primary-btn copy-btn",{"btn-success":n.copySuccess}])},[n.copySuccess?(o(),i("svg",V,e[2]||(e[2]=[s("path",{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(o(),i("svg",U,e[1]||(e[1]=[s("path",{d:"M20 9H11C9.89543 9 9 9.89543 9 11V20C9 21.1046 9.89543 22 11 22H20C21.1046 22 22 21.1046 22 20V11C22 9.89543 21.1046 9 20 9Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),s("path",{d:"M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))),w(" "+c(n.copySuccess?"Copied!":"Copy"),1)],2)])]),u(b,{name:"fade"},{default:d(()=>[n.copySuccess?(o(),i("p",j," âœ“ Referral link copied to clipboard! ")):f("",!0)]),_:1})])):f("",!0)]),s("div",N,[e[5]||(e[5]=s("h3",{class:"secondary-heading h5 mb-3"},"Your Referrals",-1)),n.referrals.length>0?(o(),i("ul",B,[(o(!0),i(C,null,S(n.referrals,a=>(o(),i("li",{key:a.id,class:"mb-2"},[s("div",F,[u(h,{to:"/referrals/"+a.referrer_user_id+"/"+a.referred_user_id,class:"text-decoration-none"},{default:d(()=>[s("strong",null,c(a.referredUser),1)]),_:2},1032,["to"])])]))),128))])):(o(),i("p",H," No referrals yet. Share your referral link to start earning! "))])])}const z=y(v,[["render",M],["__scopeId","data-v-10dab299"]]);export{z as default};
