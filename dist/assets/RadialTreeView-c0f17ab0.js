import{_ as R,a as j,u as F,r as b,o as k,c as y,b as C,w as Z,v as B,d as h,e as w,n as G,F as N,p as O,f as z,S as U,i as q,j as P,k as E}from"./main-794d02be.js";import{S as V,z as W,s as x,t as L,h as M,a as X,b as I,c as H,i as $}from"./zoom-21ec1339.js";const J={setup(){const t=j(),e=F();return{userDetailsStore:t,skillTreeStore:e}},data(){return{width:6e3,height:null,radius:0,radiusMultiplier:96,skill:{id:null,children:[],isMastered:null,isUnlocked:null,container:null,name:null,description:null,tagIDs:[],sprite:null,type:null,subskills:[]},tree:{},root:{},context:{},hiddenCanvasContext:{},scaleMultiplier:.8,startDragOffset:{x:0,y:0},mouseDown:!1,nodes:[],nextCol:1,colToNode:{},isSkillInfoPanelShown:!1,scale:1,panX:0,panY:0,d3Zoom:null,data:{},isLoading:!0,xPos:0,yPos:0,showAnimation:!1,showSkillPanel:!1,userAvatarImg:null,currentZoom:1,resetPosZoom:.1,resultNode:null,truncateLevel:"phd"}},components:{SkillPanel:V},async mounted(){this.truncateLevel=this.userDetailsStore.skillTreeLevel,(this.skillTreeStore.userSkillsSubSkillsSeparate.length==0||this.userDetailsStore.radialTreeLevel!=this.userDetailsStore.skillTreeLevel)&&await this.skillTreeStore.getUserSkillsSubSkillsSeparate(this.truncateLevel),this.width=window.innerWidth,this.height=window.innerHeight,this.radius=Math.min(this.width,this.height)/2-30,this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkillsSubSkillsSeparate.skills},this.userAvatarImg=new Image,this.userAvatarImg.src=this.userDetailsStore.avatar,this.userAvatarImg.onload=()=>{this.getAlgorithm(),this.d3Zoom=W().scaleExtent([.05,8]).on("zoom",({transform:t})=>{this.currentZoom=t.k,this.zoomed(t)}),x(this.context.canvas).call(this.d3Zoom),this.resetPos()},canvas.addEventListener("click",async t=>{this.nodes;var e=t.layerX,a=t.layerY;this.xPos=e,this.yPos=a,this.showAnimation=!0,setTimeout(()=>{this.showAnimation=!1},500);var r=this.hiddenCanvasContext,l=r.getImageData(e,a,1,1).data,i="rgb("+l[0]+","+l[1]+","+l[2]+")",n=this.colToNode[i];if(n){n.renderCol=n.__pickColor,this.skill.name=n.data.skill_name,this.skill.id=n.data.id,this.skill.type=n.data.type,this.skill.subskills=n.data.subskills;const s=await(await fetch("/skills/mastery-requirements-and-url/"+this.skill.id)).json();if(this.skill.type=="super"){const p=await(await fetch("/skills/sub-skills/"+this.skill.id)).json();this.skill.subskills=p}this.skill.masteryRequirements=s.mastery_requirements,this.skill.url=s.url,this.showSkillPanel=!0}}),this.isLoading=!1},methods:{getAlgorithm(){var t=[];t=JSON.parse(JSON.stringify(this.skill.children)),this.data={skill_name:"",children:t};const e=this.skillTreeStore.userSkillsSubSkillsSeparate.count;e>2e3?(this.radiusMultiplier=96,this.resetPosZoom=.05):e>1e3?(this.radiusMultiplier=60,this.resetPosZoom=.1):e>500?(this.radiusMultiplier=30,this.resetPosZoom=.1):e>100?(this.radiusMultiplier=6,this.resetPosZoom=.4):(this.radiusMultiplier=4,this.resetPosZoom=.4);const a=L().size([2*Math.PI,this.radius*this.radiusMultiplier]).separation((i,n)=>(i.parent==n.parent?1:2)/i.depth);this.root=a(M(this.data).sort((i,n)=>X(i.data.name,n.data.name)));var r=document.getElementById("canvas");r.width=this.width,r.height=this.height,this.context=r.getContext("2d");let l=document.getElementById("hidden-canvas");this.hiddenCanvasContext=l.getContext("2d",{willReadFrequently:!0}),l.style.display="none",this.context.translate(this.width/2,this.height/2),this.hiddenCanvasContext.translate(this.width/2,this.height/2),this.drawTree()},drawTree(){this.nodes=this.root.descendants();const t=this.root.links();this.context.beginPath();for(const e of t)this.drawLink(e);this.context.beginPath();for(const e of this.nodes)e.renderCol?this.context.fillStyle=e.renderCol:this.context.fillStyle="RGBA(105, 105, 105, 0.8)",e.__pickColor===void 0&&(e.__pickColor=this.genColor(),this.colToNode[e.__pickColor]=e),this.hiddenCanvasContext.fillStyle=e.__pickColor,this.drawNode(e);this.context.fillStyle="transparent",this.context.save(),this.context.beginPath(),this.context.moveTo(0,0),this.context.arc(0,0,20,0,2*Math.PI),this.context.stroke(),this.context.clip(),this.context.drawImage(this.userAvatarImg,-20,-20,40,40),this.context.restore()},rotateNode(t,e,a,r,l){var i=Math.PI/180*l,n=Math.cos(i),o=Math.sin(i),s=n*(a-t)+o*(r-e)+t,d=n*(r-e)-o*(a-t)+e;return[s,d]},drawNode(t){var p;let e=this.context,a=this.hiddenCanvasContext,r=Math.cos(t.x)*t.y,l=Math.sin(t.x)*t.y,i=n(0,0,r,l,90);function n(c,u,f,m,_){var g=Math.PI/180*_,S=Math.cos(g),T=Math.sin(g),A=S*(f-c)+T*(m-u)+c,D=S*(m-u)-T*(f-c)+u;return[A,D]}let o;t.data.type=="domain"?o="black":t.data.level=="grade_school"?o="#40E0D0":t.data.level=="middle_school"?o="#33A133":t.data.level=="high_school"?o="#FFD700":t.data.level=="college"?o="#FFA500":t.data.level=="phd"&&(o="#FF0000");let s;if(t.depth==1?s=20:s=10,t.data.type!=="domain"&&(e.beginPath(),e.moveTo(i[0],i[1]),e.arc(i[0],i[1],s,0,2*Math.PI),e.fillStyle=o,e.fill(),t.data.type=="super")){let c=e.font;e.fillStyle="black",e.font=`bold ${s}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.data.subskills.length,i[0],i[1]+1),e.font=c}function d(c,u,f,m){var _=m-u,g=f-c,S=Math.atan2(_,g);return S}var d=d(0,0,i[0],i[1]);if(this.scale>.6){e.save(),e.lineJoin="bevel",e.translate(i[0],i[1]),e.rotate(d);let c=0,u=0;2*Math.PI/3>Math.abs(d)>=Math.PI/3?(u=i[0]>0?15:-15,c=0):(c=i[0]>0?15:-15,u=0);let f=t.data.skill_name;t.data.skill_name===((p=this.resultNode)==null?void 0:p.data.skill_name)&&(f="▶ "+f+" ◀"),i[0]<0?(e.textAlign=t.data.level!=="domain"?"end":"start",e.rotate(Math.PI)):e.textAlign=t.data.level!=="domain"?"start":"end",e.strokeStyle="#1e293b",e.lineWidth=4,e.strokeText(t.data.skill_name,c,u),e.fillStyle=this.textFillColor(t.data.skill_name,t.data.level),e.fillText(f,c,u),e.restore()}a.beginPath(),a.moveTo(i[0],i[1]),a.arc(i[0],i[1],s,0,2*Math.PI),a.fill()},textFillColor(t,e){var a;return t===((a=this.resultNode)==null?void 0:a.data.skill_name)?"#FFAE00":e==="domain"?"#FFF":"#afb9c9"},drawLink(t){const e=I().angle(r=>r.x).radius(r=>r.y).context(this.context);let a="";if(t.target.data.is_mastered==1)this.context.lineWidth=4+parseInt(3*(1/this.currentZoom)),a="#8d6ce7";else{let r=2;this.context.lineWidth=parseInt(r*(1/this.currentZoom)),this.userDetailsStore.theme=="original"||this.userDetailsStore.theme=="apprentice"?a="#000":this.userDetailsStore.theme=="scholar"&&(a="#fff")}this.context.beginPath(),e(t),this.context.strokeStyle=a,this.context.stroke()},genColor(){var t=[];this.nextCol<16777215&&(t.push(this.nextCol&255),t.push((this.nextCol&65280)>>8),t.push((this.nextCol&16711680)>>16),this.nextCol+=100);var e="rgb("+t.join(",")+")";return e},zoomed(t){this.scale=t.k,this.context.save(),this.hiddenCanvasContext.save(),this.context.clearRect(this.width/2*-1,this.height/2*-1,this.width,this.height),this.context.fillRect(this.width/2*-1,this.height/2*-1,this.width,this.height),this.hiddenCanvasContext.clearRect(this.width/2*-1,this.height/2*-1,this.width,this.height),this.context.translate(t.x-this.width/2,t.y-this.height/2),this.context.scale(t.k,t.k),this.hiddenCanvasContext.translate(t.x-this.width/2,t.y-this.height/2),this.hiddenCanvasContext.scale(t.k,t.k),this.drawTree(),this.context.fill(),this.context.restore(),this.hiddenCanvasContext.fill(),this.hiddenCanvasContext.restore()},async printPDF(){await this.getPrintAlgorithm();var t=document.getElementById("radialTree"),e=x(t),a=e.node(),r=new XMLSerializer,l=r.serializeToString(a),i={svg:l,treeType:"radial"},n=JSON.stringify(i),o=new XMLHttpRequest;o.responseType="arraybuffer",o.open("POST","/skilltree/print-pdf",!0),o.setRequestHeader("Content-type","application/json;charset=UTF-8"),o.setRequestHeader("Accept","application/json, text/plain, */*"),o.send(n),o.onload=function(){if(this.readyState==4&&this.status==200){let d=new Blob([o.response],{type:"application/pdf"});const p=window.URL.createObjectURL(d);var s=document.createElement("a");document.body.appendChild(s),s.style="display: none",s.href=p,s.download="My-Skill-Tree.pdf",s.click(),window.URL.revokeObjectURL(p)}}},async getPrintAlgorithm(){await this.skillTreeStore.getUserSkills();const t={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills};var e=[];e=JSON.parse(JSON.stringify(t.children));function a(l){for(var i=l.length;i--;){if(l[i].type=="super"&&l[i].position!="end"){var n=[],o=[];for(let d=0;d<l[i].children.length;d++)l[i].children[d].type=="sub"?n.push(l[i].children[d]):o.push(l[i].children[d]);var s={skill_name:l[i].skill_name,type:"super",position:"end",children:n};l[i].children=[],l[i].children.push(s);for(let d=0;d<o.length;d++)l[i].children.push(o[d])}typeof l[i]<"u"&&l[i].children&&Array.isArray(l[i].children)&&l[i].children.length>0&&a(l[i].children)}}a(e);const r={skill_name:"My skills",children:e};await this.createSVGTree(r)},async createSVGTree(t){const r=13200.000000000002,l=24e3*.59,n=L().size([2*Math.PI,this.radius*50]).separation((s,d)=>(s.parent==d.parent?1:2)/s.depth)(M(t));let o=H("svg").attr("id","radialTree").attr("width",24e3).attr("height",24e3).attr("viewBox",[-r,-l,24e3,24e3]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");o.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(n.links()).join("path").attr("d",I().angle(s=>s.x).radius(s=>s.y)).attr("stroke",function(s){return"#000"}).attr("stroke-width",function(s){return s.target.data.is_mastered==1?4:1.5}).style("stroke-dasharray",function(s){if(s.source.data.type=="super"&&s.target.data.position=="end"||s.target.data.type=="sub")return 5}),o.append("g").selectAll().data(n.descendants()).join("circle").attr("transform",s=>`rotate(${s.x*180/Math.PI-90}) translate(${s.y},0)`).attr("fill","#000").attr("r",2.5),o.append("g").attr("stroke-linejoin","round").attr("stroke-width",1).selectAll().data(n.descendants()).join("text").attr("transform",s=>`rotate(${s.x*180/Math.PI-90}) translate(${s.y},0) rotate(${s.x>=Math.PI?180:0})`).attr("dy","0.31em").attr("x",s=>s.x<Math.PI==!s.children?6:-6).attr("text-anchor",s=>s.x<Math.PI==!s.children?"start":"end").style("font-weight",function(s){return s.data.type=="super"?"700":"400"}).style("font-style",function(s){if(s.data.type=="sub")return"italic"}).style("paint-order",function(s){return"stroke"}).clone(!0).lower().style("stroke-width",function(s){return"1px"}).text(function(s){return s.data.position=="end"?"":s.data.skill_name}),document.querySelector("#SVGskilltree").append(o.node())},resetPos(){x(this.context.canvas).transition().duration(300).call(this.d3Zoom.transform,$.translate(this.width/2,this.height/2).scale(this.resetPosZoom))},findNodeWithName(t){let e=!1,a=null;return this.root.each(function(r){e||r.data.skill_name.toLowerCase()===t&&(a=r,e=!0)}),a},goToLocation(t){const e=this.$refs.wrapper.clientHeight,a=this.$refs.wrapper.clientWidth,r=a>480?1.75:1.45,l=a>480?2:2.3,i=2;this.resultNode=t;let n=Math.cos(t.x)*t.y,o=Math.sin(t.x)*t.y,s=this.rotateNode(0,0,n,o,90);const d=-s[0]*r+a/i,p=-s[1]*r+e/l;x(this.context.canvas).transition().duration(2e3).call(this.d3Zoom.transform,$.translate(d,p).scale(r))},async truncateToGradeLevel(t){this.truncateLevel=t,await this.skillTreeStore.getUserSkillsSubSkillsSeparate(t),this.skill.children=this.skillTreeStore.userSkillsSubSkillsSeparate.skills,this.userAvatarImg.onload(),this.saveSkillTreeGradeLevel()},saveSkillTreeGradeLevel(){this.userDetailsStore.skillTreeLevel=this.truncateLevel,this.userDetailsStore.radialTreeLevel=this.truncateLevel;const t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:this.truncateLevel})};var e="/users/"+this.userDetailsStore.userId+"/skill-tree-level";fetch(e,t)}}},v=t=>(O("data-v-123fda7e"),t=t(),z(),t),Y={key:0,class:"loading-animation d-flex justify-content-center align-items-center py-4"},K=v(()=>h("span",{class:"loader"},null,-1)),Q=[K],tt={id:"wrapper",ref:"wrapper"},et=v(()=>h("canvas",{id:"canvas",width:"1500",height:"1500"},null,-1)),st=v(()=>h("canvas",{id:"hidden-canvas",width:"1500",height:"1500"},null,-1)),it=v(()=>h("div",{id:"SVGskilltree"},null,-1)),lt=v(()=>h("div",{id:"sidepanel-backdrop"},null,-1));function at(t,e,a,r,l,i){const n=b("SkillPanel");return k(),y(N,null,[l.isLoading==!0?(k(),y("div",Y,Q)):C("",!0),Z(h("div",tt,[w(n,{skill:l.skill,showSkillPanel:l.showSkillPanel},null,8,["skill","showSkillPanel"]),l.showAnimation?(k(),y("div",{key:0,style:G({top:`${l.yPos}px`,left:`${l.xPos}px`}),class:"click-animation"},null,4)):C("",!0),et,st,it,lt],512),[[B,l.isLoading==!1]])],64)}const nt=R(J,[["render",at],["__scopeId","data-v-123fda7e"]]);const ot={setup(){},data(){return{}},components:{RadialTree:nt,SkillTreeSearchBar:U},methods:{handleChooseResult(t){const e=this.$refs.childComponent.findNodeWithName(t.toLowerCase());if(!e)return console.error("Cannot find node with name: "+t),!1;this.$refs.childComponent.goToLocation(e)},clearResult(){this.$refs.childComponent.resetPos()}}},rt={class:"container-fluid position-absolute legend-div"},ht={class:"mobile-legend"},dt={class:"search-mobile-row me-2"},ct={class:"d-flex justify-content-end"},ut={class:"tablet-and-up-legend"},pt={class:"d-flex justify-content-between"},ft={class:"d-flex col-lg justify-content-between"},kt=h("span",null,"Loading...",-1),vt={class:"position-absolute bottom-legend-div"},mt={class:"tablet-and-up-legend"},gt={class:"d-flex legend"};function St(t,e,a,r,l,i){const n=b("SkillTreeSearchBar"),o=b("RadialTree");return k(),y(N,null,[h("div",rt,[h("div",ht,[h("div",dt,[w(n,{findNode:i.handleChooseResult,clearResults:i.clearResult},null,8,["findNode","clearResults"])]),h("div",ct,[h("button",{class:"btn primary-btn",onClick:e[0]||(e[0]=s=>t.resetPos())}," Reset ")])]),h("div",ut,[h("div",pt,[h("div",ft,[w(n,{class:"me-2",findNode:i.handleChooseResult,clearResults:i.clearResult},null,8,["findNode","clearResults"]),h("button",{class:"btn primary-btn me-2",onClick:e[1]||(e[1]=s=>t.$refs.childComponent.printPDF())}," Print ")])])])]),(k(),q(E,null,{default:P(()=>[w(o,{ref:"childComponent"},null,512)]),fallback:P(()=>[kt]),_:1})),h("div",vt,[h("div",mt,[h("div",gt,[h("button",{class:"btn grade-school me-2",onClick:e[2]||(e[2]=s=>t.$refs.childComponent.truncateToGradeLevel("grade_school"))}," Grade school "),h("button",{class:"btn middle-school me-2",onClick:e[3]||(e[3]=s=>t.$refs.childComponent.truncateToGradeLevel("middle_school"))}," Middle school "),h("button",{class:"btn high-school me-2",onClick:e[4]||(e[4]=s=>t.$refs.childComponent.truncateToGradeLevel("high_school"))}," High school "),h("button",{class:"btn college me-2",onClick:e[5]||(e[5]=s=>t.$refs.childComponent.truncateToGradeLevel("college"))}," College "),h("button",{class:"btn phd me-2",onClick:e[6]||(e[6]=s=>t.$refs.childComponent.truncateToGradeLevel("phd"))}," PHD ")])])])],64)}const wt=R(ot,[["render",St]]);export{wt as default};
