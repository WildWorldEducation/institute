import{I as f,_ as w,m as S,i as g,o as a,c as o,d as t,l as _,t as h,b as u,a as p,w as b,F as y,p as v,f as A}from"./main-f08cf2f1.js";import{u as k}from"./AssessmentsStore-5d96a769.js";import{u as M}from"./UsersStore-6c8916a4.js";import{u as N}from"./UserSkillsStore-831d276d.js";import{_ as q}from"./general-banner-1c13aca4.js";const x=f("unmarkedAnswers",{state:()=>({unmarkedAnswers:[]}),actions:{async getUnmarkedAnswers(){const s=await(await fetch("/unmarked-answers/list")).json(),m=await(await fetch("/questions/essay/list")).json();for(let r=0;r<s.length;r++)for(let i=0;i<m.length;i++)s[r].question_id==m[i].id&&(s[r].question=m[i].question);const l=await(await fetch("/assessments/list")).json();for(let r=0;r<s.length;r++)for(let i=0;i<l.length;i++)s[r].assessment_id==l[i].id&&(s[r].studentId=l[i].student_id,s[r].skillId=l[i].skill_id);return this.unmarkedAnswers=s,this.$state},async deleteUnmarkedAnswer(e){const s=await fetch("/unmarked-answers/"+e.id,{method:"DELETE"});await(await fetch("/unmarked-answers/list/"+e.assessment_id)).json()==0&&k().deleteAssessment(e.assessment_id),s.error&&console.log(s.error),this.getUnmarkedAnswers()}}});const I={setup(){const e=x(),s=k(),n=M(),m=S(),d=N();return{unmarkedAnswersStore:e,usersStore:n,skillsStore:m,assessmentsStore:s,userSkillsStore:d}},data(){return{assessmentId:this.$route.params.id,questionNumber:0,answers:[],assessment:{},skill:{},studentName:"",skillName:"",showModal:!1,modalMessage:"",isFailed:!1}},async created(){this.unmarkedAnswersStore.unmarkedAnswers.length==0&&await this.unmarkedAnswersStore.getUnmarkedAnswers(),this.assessmentsStore.assessments.length==0&&await this.assessmentsStore.getAssessments();for(let e=0;e<this.unmarkedAnswersStore.unmarkedAnswers.length;e++)this.unmarkedAnswersStore.unmarkedAnswers[e].assessment_id==this.assessmentId&&this.answers.push(this.unmarkedAnswersStore.unmarkedAnswers[e]);for(let e=0;e<this.assessmentsStore.assessments.length;e++)this.assessmentsStore.assessments[e].id==this.assessmentId&&(this.assessment=this.assessmentsStore.assessments[e]);this.usersStore.users.length==0&&await this.usersStore.getUsers();for(let e=0;e<this.answers.length;e++)for(let s=0;s<this.usersStore.users.length;s++)this.answers[e].studentId==this.usersStore.users[s].id&&(this.answers[e].studentUsername=this.usersStore.users[s].username,this.studentName=this.usersStore.users[s].username);this.skillsStore.skillsList.length==0&&await this.skillsStore.getSkillsList();for(let e=0;e<this.answers.length;e++)for(let s=0;s<this.skillsStore.skillsList.length;s++)this.answers[e].skillId==this.skillsStore.skillsList[s].id&&(this.answers[e].skillName=this.skillsStore.skillsList[s].name,this.skill=this.skillsStore.skillsList[s],this.skillName=this.skillsStore.skillsList[s].name)},computed:{},methods:{Next(){this.questionNumber++},Previous(){this.questionNumber--},dateFormat(){return new Date(this.assessment.date).toLocaleDateString("default",{weekday:"short",year:"numeric",month:"short",day:"numeric"})},async MarkCorrect(e){var s="/assessments/"+e.assessment_id+"/increase-grade";await fetch(s,{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}),await this.assessmentsStore.getAssessments();for(let n=0;n<this.assessmentsStore.assessments.length;n++)this.assessmentsStore.assessments[n].id==e.assessment_id&&(this.assessment=this.assessmentsStore.assessments[n],this.assessmentsStore.assessments[n].num_unmarked_questions_remaining==0&&(this.assessmentsStore.assessments[n].current_score/this.assessmentsStore.assessments[n].total_score*100>=90?(this.MakeMastered(this.assessmentsStore.assessments[n].student_id,this.skill),this.modalMessage="Student passed",this.showModal=!0,this.isFailed=!1):(this.modalMessage="Student failed",this.showModal=!0,this.isFailed=!0)));this.unmarkedAnswersStore.deleteUnmarkedAnswer(e),this.answers.splice(this.questionNumber,1),this.assessment.date=this.dateFormat()},async MarkIncorrect(e){var s="/assessments/"+e.assessment_id+"/decrease-grade";fetch(s,{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}),await this.assessmentsStore.getAssessments();for(let n=0;n<this.assessmentsStore.assessments.length;n++)this.assessmentsStore.assessments[n].id==e.assessment_id&&this.assessmentsStore.assessments[n].num_unmarked_questions_remaining==0&&this.assessmentsStore.assessments[n].current_score/this.assessmentsStore.assessments[n].total_score*100<90&&(this.modalMessage="Student failed",this.isFailed=!0,this.showModal=!0);this.unmarkedAnswersStore.deleteUnmarkedAnswer(e),this.answers.splice(this.questionNumber,1),this.assessment.date=this.dateFormat()},async MakeMastered(e,s){await this.userSkillsStore.MakeMastered(e,s)}}},c=e=>(v("data-v-e0c80f2c"),e=e(),A(),e),U=c(()=>t("div",{id:"banner"},[t("img",{src:q,class:"img-fluid"})],-1)),j={class:"container mt-3 pb-4"},C=c(()=>t("div",{id:"page-tile"},"Unmarked Essay Questions",-1)),L={id:"assessment-info"},F={id:"date"},T={key:0},V={id:"question-bg"},E={class:"d-flex w-100 flex-row justify-content-end"},O=c(()=>t("span",{"b-tooltip.hover":"",title:"The student needs to get at least 90% to pass",id:"score-text",class:"me-2"}," score: ",-1)),P={"b-tooltip.hover":"",title:"current score",id:"current-score"},D={title:"total score",id:"total-score"},B={id:"question",class:"mb-3"},H=["innerHTML"],$={key:1,class:"d-flex flex-column"},K=c(()=>t("p",null,"No unmarked questions currently",-1)),Q={key:0},z={key:1},G={key:2,class:"d-flex mt-3 mb-2"},J={class:"d-flex w-100 justify-content-lg-center gap-2"},R={key:0,class:"d-flex justify-content-end"},W={key:0},X={id:"myModal",class:"modal"},Y={class:"modal-content"},Z={class:"modal-message"},ss={style:{display:"flex",gap:"10px"}};function es(e,s,n,m,d,l){const r=g("router-link");return a(),o(y,null,[U,t("div",j,[C,t("div",L,[_(h(this.studentName)+" : "+h(this.skillName)+" ",1),t("span",F,h(this.assessment.date),1)]),this.answers.length>0?(a(),o("div",T,[t("div",V,[t("div",E,[O,t("span",P,h(this.assessment.current_score)+" / ",1),t("span",D,h(this.assessment.total_score),1)]),t("div",B,h(this.answers[this.questionNumber].question),1),t("div",{id:"answer",class:"mb-3",innerHTML:this.answers[this.questionNumber].answer},null,8,H)])])):(a(),o("div",$,[K,d.isFailed?(a(),o("p",Q,"Student has failed")):(a(),o("p",z,"Student has passed and mastered this skill"))])),this.answers.length>0?(a(),o("div",G,[t("div",J,[t("button",{onClick:s[0]||(s[0]=i=>l.MarkCorrect(this.answers[this.questionNumber])),class:"btn green-btn"}," Mark Correct "),t("button",{onClick:s[1]||(s[1]=i=>l.MarkIncorrect(this.answers[this.questionNumber])),class:"btn red-btn"}," Mark Incorrect ")]),this.answers.length>0?(a(),o("div",R,[this.questionNumber>0?(a(),o("button",{key:0,onClick:s[2]||(s[2]=i=>l.Previous()),class:"btn green-btn me-2"}," Previous ")):u("",!0),this.questionNumber!=this.answers.length-1?(a(),o("button",{key:1,onClick:s[3]||(s[3]=i=>l.Next()),class:"btn green-btn"}," Next ")):u("",!0)])):u("",!0)])):u("",!0)]),d.showModal?(a(),o("div",W,[t("div",X,[t("div",Y,[t("p",Z,h(d.modalMessage),1),t("div",ss,[p(r,{class:"btn green-btn",to:"/"},{default:b(()=>[_("To Hub")]),_:1}),t("button",{class:"btn purple-btn",onClick:s[4]||(s[4]=i=>d.showModal=!1)}," OK ")])])])])):u("",!0)],64)}const os=w(I,[["render",es],["__scopeId","data-v-e0c80f2c"]]);export{os as default};
