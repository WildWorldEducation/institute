import{_ as k,o as m,c as f,A as B,r as S,a as h,t as D,k as x,b as v,F as C}from"./main-f58754dd.js";import"./transform-23c7b39f.js";import{l as w,m as T,b as M,s as L}from"./linear-5b5f98b2.js";import{s as _}from"./select-03d56b88.js";import{a as N,b as P,h as A}from"./continuous-dd31f971.js";import{d as I,u as E,s as j,e as q,f as Q,g as z,h as H,i as R,j as $,k as F,l as U}from"./time-d987a114.js";import{i as O}from"./init-77b53fdd.js";import{e as V}from"./extent-4cf1c809.js";import{w as Y,c as p,a as G}from"./array-4492e866.js";import{x as J,y as K}from"./point-e88f89db.js";import"./ascending-3ff63084.js";import"./ordinal-ba9b4969.js";function W(){return O.apply(I(U,F,$,R,H,z,Q,q,j,E).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function b(t){this._context=t}b.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:this._context.lineTo(t,n);break}}};function X(t){return new b(t)}function Z(t,n){var s=p(!0),l=null,r=X,o=null,d=Y(a);t=typeof t=="function"?t:t===void 0?J:p(t),n=typeof n=="function"?n:n===void 0?K:p(n);function a(e){var u,i=(e=G(e)).length,c,g=!1,y;for(l==null&&(o=r(y=d())),u=0;u<=i;++u)!(u<i&&s(c=e[u],u,e))===g&&((g=!g)?o.lineStart():o.lineEnd()),g&&o.point(+t(c,u,e),+n(c,u,e));if(y)return o=null,y+""||null}return a.x=function(e){return arguments.length?(t=typeof e=="function"?e:p(+e),a):t},a.y=function(e){return arguments.length?(n=typeof e=="function"?e:p(+e),a):n},a.defined=function(e){return arguments.length?(s=typeof e=="function"?e:p(!!e),a):s},a.curve=function(e){return arguments.length?(r=e,l!=null&&(o=r(l)),a):r},a.context=function(e){return arguments.length?(e==null?l=o=null:o=r(l=e),a):l},a}const tt={name:"TimePerSkillHorizontalBarChart",props:["data","colour"],data(){return{padding:60}},mounted(){_("#time-per-skill-chart-container");const t=25,n=0,s=0,l=10,r=200,o=1e3,d=Math.ceil((this.data.length+.1)*t)+n+l,a=w().domain([0,T(this.data,i=>i.quantity)]).range([r,o-s]),e=M().domain(L(this.data,i=>-i.quantity).map(i=>i.name)).rangeRound([n,d-l]).padding(.1);a.tickFormat(20);const u=_("#time-per-skill-chart-container").append("svg").attr("width",o).attr("height",d).attr("viewBox",[0,0,o,d]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");u.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",a(0)).attr("y",i=>e(i.name)).attr("width",i=>a(i.quantity)-a(0)).attr("height",e.bandwidth()),u.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",i=>a(i.quantity)).attr("y",i=>e(i.name)+e.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(i=>i.formattedQuantity).call(i=>i.filter(c=>a(c.quantity)-a(0)<40).attr("dx",4).attr("fill","black").attr("text-anchor","start")),u.append("g").attr("transform",`translate(0,${n})`).call(N(a).ticks(0)).call(i=>i.select(".domain").remove()),u.append("g").attr("transform",`translate(${r},0)`).call(P(e).tickSizeOuter(0))},computed:{}},nt={id:"time-per-skill-chart-container"};function et(t,n,s,l,r,o){return m(),f("div",nt)}const at=k(tt,[["render",et]]),it={name:"StudentDurationPerDayLineChart",props:["data","colour"],data(){return{padding:60}},mounted(){const t=this.data;_("#student-duration-per-day-chart-container");const n=928,s=500,l=20,r=30,o=30,d=40,a=W(V(t,c=>c.date),[d,n-r]),e=w([0,T(t,c=>c.formattedQuantity)],[s-o,l]),u=Z().x(c=>a(c.date)).y(c=>e(c.formattedQuantity)),i=_("#student-duration-per-day-chart-container").append("svg").attr("width",n).attr("height",s).attr("viewBox",[0,0,n,s]).attr("style","max-width: 100%; height: auto; height: intrinsic;");i.append("g").attr("transform",`translate(0,${s-o})`).call(A(a).ticks(t.length/2).tickSizeOuter(0)),i.append("g").attr("transform",`translate(${d},0)`).call(P(e).ticks(s/80)).call(c=>c.selectAll(".tick line").clone().attr("x2",n-d-r).attr("stroke-opacity",.1)).call(c=>c.append("text").attr("x",-d).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text("↑ Duration in seconds and minutes")),i.append("path").attr("fill","none").attr("stroke","darkblue").attr("stroke-width",1.5).attr("d",u(t))}},st={id:"student-duration-per-day-chart-container"};function rt(t,n,s,l,r,o){return m(),f("div",st)}const ot=k(it,[["render",rt]]),lt={setup(){return{usersStore:B()}},components:{TimePerSkillHorizontalBarChart:at,StudentDurationPerDayLineChart:ot},data(){return{studentId:this.$route.params.studentId,studentName:null,skillDurations:[],durationsPerDay:[],allSkillsDuration:0,isDataLoaded:!1}},async created(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const t=this.usersStore.users.find(n=>n.id===this.studentId);t&&(this.studentName=t.username),await this.getSkillDuration(),await this.getAllSkillsDuration(),await this.getStudentDurationPerDay(),this.isDataLoaded=!0},methods:{async getSkillDuration(){fetch(`/student-analytics/skill-durations/${this.studentId}`).then(t=>t.json()).then(t=>{this.skillDurations=t;for(let n=0;n<this.skillDurations.length;n++)this.skillDurations[n].formattedQuantity=this.millisToMinutesAndSeconds(this.skillDurations[n].quantity)}).catch(t=>{console.error("Error fetching last visited skills:",t)})},async getAllSkillsDuration(){fetch(`/student-analytics/all-skills-duration/${this.studentId}`).then(t=>t.json()).then(t=>{this.allSkillsDuration=t.duration}).catch(t=>{console.error("Error fetching last visited skills:",t)})},async getStudentDurationPerDay(){fetch(`/student-analytics/student-duration-per-day/${this.studentId}`).then(t=>t.json()).then(t=>{for(let n=0;n<t.length;n++)t[n].formattedQuantity=this.millisToMinutesAndSeconds(t[n].quantity),t[n].formattedQuantity=this.convertMinutesSecondsToSeconds(t[n].formattedQuantity),t[n].date=new Date(t[n].date);t.sort((n,s)=>n.date-s.date),this.durationsPerDay=t}).catch(t=>{console.error("Error fetching student duration per day:",t)})},millisToMinutesAndSeconds(t){var n=Math.floor(t/6e4),s=(t%6e4/1e3).toFixed(0);return n+":"+(s<10?"0":"")+s},convertMinutesSecondsToSeconds(t){const n=t.split(":");if(n.length!==2)throw new Error("Invalid duration format. Expected 'MM:SS'.");const s=parseInt(n[0],10),l=parseInt(n[1],10);if(isNaN(s)||isNaN(l))throw new Error("Invalid numerical values in duration string.");return s*60+l}}},ct={class:"container"},ut={class:"d-flex justify-content-between w-100"},dt=h("h1",{class:"heading"},"Time Report",-1),ht={class:"secondary-heading h3"},mt=h("p",null,[h("em",null," Please note that time spent on external sources (e.g. websites) related to skills is not measured.")],-1),pt={key:0},ft=h("h2",{class:"secondary-heading"},"Total time on platform",-1),gt=h("h2",{class:"secondary-heading"},"All skills",-1),_t=h("h2",{class:"secondary-heading"},"Minutes per skill",-1),yt={key:2},kt=h("p",null,"No skills visited by this student.",-1),St=[kt],Dt=h("p",null," ",-1);function xt(t,n,s,l,r,o){const d=S("StudentDurationPerDayLineChart"),a=S("TimePerSkillHorizontalBarChart");return m(),f(C,null,[h("div",ct,[h("span",ut,[dt,h("h2",ht,D(r.studentName),1)]),mt,r.isDataLoaded?(m(),f("div",pt,[ft,r.durationsPerDay.length>0?(m(),x(d,{key:0,data:r.durationsPerDay},null,8,["data"])):v("",!0),gt,h("p",null,D(o.millisToMinutesAndSeconds(this.allSkillsDuration)),1),_t,r.skillDurations.length>0?(m(),x(a,{key:1,data:r.skillDurations,colour:"darkgreen"},null,8,["data"])):(m(),f("div",yt,St))])):v("",!0)]),Dt],64)}const Et=k(lt,[["render",xt]]);export{Et as default};
