import{_ as p,y,r as d,o as u,c as m,a as r,t as f,f as h,k as S}from"./main-f29d17c4.js";import{u as _}from"./TeacherAnalyticsStore-d194c0ea.js";import{T as g,S as v}from"./TimePerSkillHorizontalBarChart-a3634dff.js";import"./transform-4d0f7c8f.js";import{b as D,m as w}from"./continuous-e5db47ab.js";import{l as A,b as k}from"./linear-841004c4.js";import{s as x}from"./string-c67ea49d.js";import{D as b}from"./downloadCSVBtn-bbd65ba2.js";import"./line-bfb1ca50.js";import"./time-ce17bce2.js";import"./point-ea70dc51.js";import"./sort-fcaf8f38.js";const C={name:"StudentSkillActivityChart",methods:{createChart(e){if(!e||e.length===0){console.warn("No data available for the chart");return}const t=document.getElementById("activity-chart-container").clientWidth,i=document.getElementById("activity-chart-container").clientHeight,c={top:20,right:0,bottom:60,left:200},o=x("#activity-chart-container").append("svg").attr("width","100%").attr("height","100%").append("g").attr("transform",`translate(${c.left},${c.top})`),n=D().domain(e.map(a=>a.name)).range([0,i-35]).padding(.2),l=A().domain([0,w(e,a=>a.quantity)]).range([0,t]);o.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",0).attr("y",a=>n(a.name)).attr("width",a=>a.quantity>0?l(a.quantity/2):l(1)).attr("height",a=>a.quantity>0?n.bandwidth():1).attr("fill","#5f31dd"),o.append("g").attr("class","axis").call(k(n)),o.append("text").attr("class","axis-label").style("font-size","16px").attr("transform",`translate(${t/2},${i+35})`).style("text-anchor","middle").text("Duration (minutes)"),o.selectAll(".bar-label").data(e).enter().append("text").attr("class","bar-label").attr("x",a=>l(a.quantity/2)+5).attr("y",a=>n(a.name)+n.bandwidth()/2).attr("dy","0.35em").style("font-size","14px").text(a=>a.formattedQuantity)}}};function P(e,t,i,c,s,o){return null}const T=p(C,[["render",P]]);const $={setup(){const e=y(),t=_();return{usersStore:e,teacherAnalyticsStore:t}},components:{TimePerSkillHorizontalBarChart:g,StudentDurationPerDayLineChart:v,StudentSkillActivityChart:T,DownloadCSVBtn:b},data(){return{studentId:this.$route.params.studentId,studentName:null,skillDurations:[],durationsPerDay:[],allSkillsDuration:0,totalTimeOnPlatformDownloadData:[],minutesPerSkillDownloadData:[]}},async created(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const e=this.usersStore.users.find(t=>t.id===this.studentId);e&&(this.studentName=e.username),await this.getStudentDurationPerDay(),await this.getStudentActivity()},methods:{async getStudentDurationPerDay(){fetch(`/student-analytics/student-duration-per-day/${this.studentId}`).then(e=>e.json()).then(e=>{for(let t=0;t<e.length;t++)e[t].formattedQuantity=e[t].quantity/(1e3*60),e[t].date=new Date(e[t].date);e.sort((t,i)=>t.date-i.date),this.durationsPerDay=e,this.totalTimeOnPlatformDownloadData=this.durationsPerDay.map(t=>({date:t.date,minutes:t.formattedQuantity}))}).catch(e=>{console.error("Error fetching student duration per day:",e)})},async getStudentActivity(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const e=this.usersStore.users.find(t=>t.id===this.studentId);e&&(this.studentName=e.username),this.teacherAnalyticsStore.skillActivities.length==0&&await this.teacherAnalyticsStore.getSkillActivityReport(this.studentId),this.teacherAnalyticsStore.skillActivities=this.teacherAnalyticsStore.skillActivities.map(t=>({...t,formattedQuantity:this.millisToMinutesAndSeconds(t.quantity)})),this.$nextTick(()=>{this.$refs.activityChart&&this.$refs.activityChart.createChart(this.teacherAnalyticsStore.skillActivities)}),this.downloadData=this.teacherAnalyticsStore.skillActivities.map(t=>({skill:t.name,minutes:t.formattedQuantity}))},millisToMinutesAndSeconds(e){var t=Math.floor(e/6e4),i=(e%6e4/1e3).toFixed(0);return t+":"+(i<10?"0":"")+i}}},N={class:"container-fluid chart-page"},B={class:"d-flex justify-content-between w-100"},I={class:"tertiary-heading h4"},V={class:"row h-100"},q={class:"col-lg chart-col position-relative"},O={id:"time-chart-container"},Q={key:1},j={class:"col-lg chart-col position-relative"},E={id:"activity-chart-container"};function L(e,t,i,c,s,o){const n=d("DownloadCSVBtn"),l=d("StudentDurationPerDayLineChart"),a=d("StudentSkillActivityChart");return u(),m("div",N,[r("span",B,[t[0]||(t[0]=r("h1",{class:"heading h4"},"Time spent",-1)),r("h2",I,f(s.studentName),1)]),r("div",V,[r("div",q,[r("div",O,[h(n,{data:s.totalTimeOnPlatformDownloadData,fileName:`Total time on platform - ${s.studentName}`,toolTip:"Download total time on platform data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),s.durationsPerDay.length>0?(u(),S(l,{key:0,data:s.durationsPerDay},null,8,["data"])):(u(),m("p",Q,"There is no data to show yet."))])]),r("div",j,[r("div",E,[h(n,{data:s.minutesPerSkillDownloadData,fileName:`Minutes per skill - ${s.studentName}`,toolTip:"Download minutes per skill data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),h(a,{ref:"activityChart"},null,512)])])])])}const Z=p($,[["render",L],["__scopeId","data-v-6729fc4a"]]);export{Z as default};
