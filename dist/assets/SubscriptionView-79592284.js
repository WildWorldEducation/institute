import{_ as m,f as g,L as y,i as S,o,c as r,a as e,q as b,t as u,s as p,b as d,p as f,d as k}from"./main-b51ffd51.js";const _={setup(){const s=g(),t=y(),l=S();return{userDetailsStore:s,settingsStore:t,sessionDetailsStore:l}},data(){return{monthlyTokenUsage:null,year:0,month:"",isAITokenLimitReached:!1,isMobileCheck:window.innerWidth,showTooltip:!1,subscription:{},subSchedule:{},basicPlanPriceId:"price_1RCKSvFfW0WtxYZHCcfnbL5R",infinitePlanPriceId:"price_1RCKUZFfW0WtxYZHxz1ksgww",nextSubSchedulePhasePlan:"",isLoading:!1}},async created(){this.settingsStore.freePlanTokenLimit||await this.settingsStore.getSettings(),await this.userDetailsStore.getUserDetails(),await this.getSubscription()},async mounted(){let s=document.createElement("script");s.setAttribute("src","https://js.stripe.com/v3/"),document.head.appendChild(s),this.userDetailsStore.subscriptionTier=="free"?this.settingsStore.freePlanTokenLimit&&this.userDetailsStore.monthlyTokenUsage&&this.settingsStore.freePlanTokenLimit<=this.userDetailsStore.monthlyTokenUsage&&(this.isAITokenLimitReached=!0):this.userDetailsStore.subscriptionTier=="basic"&&this.settingsStore.basicPlanTokenLimit&&this.userDetailsStore.monthlyTokenUsage&&this.settingsStore.basicPlanTokenLimit<=this.userDetailsStore.monthlyTokenUsage&&(this.isAITokenLimitReached=!0),this.year=new Date().getFullYear();const t=["January","February","March","April","May","June","July","August","September","October","November","December"],l=new Date;this.month=t[l.getMonth()]},computed:{formattedStripeCurrentPeriodEndDate(){let s=new Date(this.subscription.current_period_end*1e3);const t=s.getUTCMonth()+1,l=s.getUTCDate();return s.getUTCFullYear()+"/"+t+"/"+l},formattedMonthlyTokenUsage(){return this.userDetailsStore.monthlyTokenUsage?this.userDetailsStore.monthlyTokenUsage.toLocaleString():"0"},formattedFreePlanTokenLimit(){return this.settingsStore.freePlanTokenLimit?this.settingsStore.freePlanTokenLimit.toLocaleString():"0"},formattedBasicPlanTokenLimit(){return this.settingsStore.basicPlanTokenLimit?this.settingsStore.basicPlanTokenLimit.toLocaleString():"0"},subscriptionTierFormatted(){return this.userDetailsStore.subscriptionTier?this.userDetailsStore.subscriptionTier.toLocaleString():"free"}},methods:{async getSubscription(){const t=await(await fetch("/subscriptions/get-sub/"+this.userDetailsStore.userId)).json();if(this.subscription=t.subscription,this.subSchedule=t.subSchedule,this.subSchedule){let l=this.subSchedule.phases[1].items[0].price;l==this.basicPlanPriceId?this.nextSubSchedulePhasePlan="Basic":l==this.infinitePlanPriceId&&(this.nextSubSchedulePhasePlan="Infinite")}},checkout(s){fetch("/subscriptions/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId,planType:s})}).then(t=>t.ok?t.json():t.json().then(l=>Promise.reject(l))).then(({url:t})=>{window.location=t}).catch(t=>{console.error(t.error)})},loadPortal(){fetch("/subscriptions/create-customer-portal-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId})}).then(s=>s.ok?s.json():s.json().then(t=>Promise.reject(t))).then(({url:s})=>{window.location=s}).catch(s=>{console.error(s.error)})},cancelPlan(){if(confirm("Are you sure you want to downgrade to the Free plan?"))fetch("/subscriptions/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userDetailsStore.userId})}).then(()=>{this.getSubscription()});else return},downgradePlan(){if(confirm("Are you sure you want to downgrade to the Basic plan?"))this.isLoading=!0,fetch("/subscriptions/downgrade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:this.subscription.id,subScheduleId:this.subSchedule?this.subSchedule.id:null})}).then(function(s){return s.json()}).then(async s=>{s.status=="succeeded"?await this.getSubscription():alert("Downgrade did not work. Please try again later."),this.isLoading=!1});else return},upgradePlan(){if(confirm("Are you sure you want to upgrade to the Infinite plan? (You will be billed immediately)"))this.isLoading=!0,fetch("/subscriptions/upgrade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:this.subscription.id})}).then(function(s){return s.json()}).then(async s=>{s.status=="succeeded"?(await this.userDetailsStore.getUserDetails(),this.$router.push("/subscriptions/success/view")):alert("Upgrade did not work. Please try again later."),this.isLoading=!1});else return},openTooltip(){this.showTooltip=!0},closeTooltip(){this.showTooltip=!1}}},a=s=>(f("data-v-d0ab016b"),s=s(),k(),s),T={class:"container"},w={class:"d-flex justify-content-end w-100"},P=a(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 192 512",width:"20",height:"20",class:"primary-icon"},[e("path",{d:"M48 80a48 48 0 1 1 96 0A48 48 0 1 1 48 80zM0 224c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224 32 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0 0-192-32 0c-17.7 0-32-14.3-32-32z"})],-1)),D=[P],C={class:"row mt-4"},v={class:"col-md mb-3"},I=a(()=>e("strong",null,"Your subscription tier:",-1)),L=a(()=>e("strong",null,"Current token usage:",-1)),x={key:0,class:"alert alert-warning",role:"alert"},j={key:1,class:"alert alert-warning",role:"alert"},U={key:2,class:"alert alert-warning",role:"alert"},M={key:0,class:"modal"},A={class:"modal-content"},F=a(()=>e("p",null," It is against our policy to share accounts and each account is meant to only be used by one user. ",-1)),O=a(()=>e("hr",null,null,-1)),B={key:0,class:"d-flex justify-content-center align-items-center py-4"},Y=a(()=>e("span",{class:"subscription-loader"},null,-1)),N=[Y],J={key:1,class:"row mt-4"},R=a(()=>e("h2",{class:"secondary-heading h4"},"Free",-1)),E=a(()=>e("strong",null,"Token limit:",-1)),W={key:0,disabled:"",class:"btn primary-btn mt-1"},z=a(()=>e("h2",{class:"secondary-heading h4"},"Basic",-1)),V=a(()=>e("p",null,"Ideal for moderate use",-1)),Z=a(()=>e("p",null,"$20 / month",-1)),H=a(()=>e("strong",null,"Token limit:",-1)),K={key:2,disabled:"",class:"btn primary-btn mt-1 mb-3"},q=a(()=>e("h2",{class:"secondary-heading h4"},"Infinite",-1)),G=a(()=>e("p",null,"Ideal for daily use",-1)),Q=a(()=>e("p",null,"$100 / month",-1)),X=a(()=>e("p",null,[e("strong",null,"Token limit:"),p(" Infinite ")],-1)),$={key:2,disabled:"",class:"btn primary-btn mt-1"};function ee(s,t,l,h,i,n){return o(),r("div",T,[e("div",w,[e("button",{class:"btn mb-2",onClick:t[0]||(t[0]=(...c)=>n.openTooltip&&n.openTooltip(...c))},D)]),e("div",C,[e("div",v,[e("h2",{class:b(["secondary-heading h4 mb-4",{"text-center":i.isMobileCheck<576}])}," Monthly AI usage: "+u(i.month)+" "+u(i.year),3),e("ul",null,[e("li",null,[e("p",null,[I,p(" "+u(n.subscriptionTierFormatted),1)])]),e("li",null,[e("p",null,[L,p(" "+u(n.formattedMonthlyTokenUsage),1)])])]),i.isAITokenLimitReached?(o(),r("div",x," You are over the monthly free limit. You can't use the AI features until next month. ")):d("",!0),i.subscription&&i.subscription.cancel_at_period_end?(o(),r("div",j," Your plan will downgrade to the Free plan on "+u(n.formattedStripeCurrentPeriodEndDate),1)):d("",!0),i.nextSubSchedulePhasePlan!=""?(o(),r("div",U," Your plan will downgrade to the "+u(i.nextSubSchedulePhasePlan)+" plan on "+u(n.formattedStripeCurrentPeriodEndDate),1)):d("",!0)]),i.showTooltip?(o(),r("div",M,[e("div",A,[e("div",null,[F,e("button",{class:"btn primary-btn",onClick:t[1]||(t[1]=(...c)=>n.closeTooltip&&n.closeTooltip(...c))}," Close ")])])])):d("",!0),e("div",{class:b(["col-md mb-3 d-flex",i.isMobileCheck>576?"justify-content-end":"justify-content-center"])},[h.userDetailsStore.subscriptionTier!="free"?(o(),r("button",{key:0,class:"btn primary-btn",onClick:t[2]||(t[2]=c=>n.loadPortal())}," Manage billing ")):d("",!0)],2)]),O,i.isLoading==!0?(o(),r("div",B,N)):(o(),r("div",J,[e("div",{class:b(["col-md mb-3",{"text-center":i.isMobileCheck<576}])},[R,e("p",null,[E,p(" "+u(n.formattedFreePlanTokenLimit),1)]),h.userDetailsStore.subscriptionTier=="free"?(o(),r("button",W," current plan ")):i.subscription&&i.subscription.cancel_at_period_end==!1?(o(),r("button",{key:1,onClick:t[3]||(t[3]=c=>n.cancelPlan()),class:"btn primary-btn mt-1 mb-3"}," downgrade ")):d("",!0)],2),e("div",{class:b(["col-md mb-3",{"text-center":i.isMobileCheck<576}])},[z,V,Z,e("p",null,[H,p(" "+u(n.formattedBasicPlanTokenLimit),1)]),h.userDetailsStore.subscriptionTier=="free"?(o(),r("button",{key:0,onClick:t[4]||(t[4]=c=>n.checkout("basic")),class:"btn primary-btn mt-1"}," buy ")):i.subscription&&h.userDetailsStore.subscriptionTier=="infinite"&&i.nextSubSchedulePhasePlan!="Basic"?(o(),r("button",{key:1,onClick:t[5]||(t[5]=c=>n.downgradePlan()),class:"btn primary-btn mt-1"}," downgrade ")):this.userDetailsStore.subscriptionTier=="basic"?(o(),r("button",K," current plan ")):d("",!0)],2),e("div",{class:b(["col-md mb-3",{"text-center":i.isMobileCheck<576}])},[q,G,Q,X,h.userDetailsStore.subscriptionTier=="free"?(o(),r("button",{key:0,onClick:t[6]||(t[6]=c=>n.checkout("infinite")),class:"btn primary-btn mt-1"}," buy ")):h.userDetailsStore.subscriptionTier=="basic"?(o(),r("button",{key:1,onClick:t[7]||(t[7]=c=>n.upgradePlan()),class:"btn primary-btn mt-1"}," upgrade ")):this.userDetailsStore.subscriptionTier=="infinite"?(o(),r("button",$," current plan ")):d("",!0)],2)]))])}const se=m(_,[["render",ee],["__scopeId","data-v-d0ab016b"]]);export{se as default};
