import{_ as b,y,r as g,o,c as n,a as s,f as p,l as _,j as c,b as d,w as u,A as h,t as v,p as U,F as M}from"./main-341f8131.js";import{f as x,h as I}from"./theme.compact-9c19ed15.js";const S={setup(){return{usersStore:y()}},data(){return{userId:this.$route.params.id,user:{},originalUser:{},image:"",avatar:"",validate:{first_name:!1,last_name:!1,email:!1,emailFormat:!1,notSquareImg:!1,notCropped:!1},errorUsernameMessage:"",errorEmailMessage:"",showCropModal:!1,cropCanvas:"",cropResult:{coordinates:null,image:null},lastZoomValue:0,zoomValue:0,isImageLoading:!1}},components:{Cropper:x,Preview:I},computed:{hasFormChanges(){const t=e=>e==null||e===""?"":e;return t(this.user.first_name)!==t(this.originalUser.first_name)||t(this.user.last_name)!==t(this.originalUser.last_name)||t(this.user.username)!==t(this.originalUser.username)||t(this.user.email)!==t(this.originalUser.email)}},async mounted(){this.usersStore.users.length<1&&await this.usersStore.getUsers(),this.getUser()},methods:{getUser(){fetch("/users/show/"+this.userId).then(function(t){return t.json()}).then(t=>{this.user=t,this.originalUser={...t}}).then(()=>{this.image=this.user.avatar})},ValidateForm(){this.validate.username=!this.user.username,this.validate.username||this.Submit()},ValidateEmail(){const t=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return this.user.email&&!t.test(this.user.email)?(this.errorEmailMessage="Please enter a valid email address!",!1):!0},clearUsernameError(){this.errorUsernameMessage=""},clearEmailError(){this.errorEmailMessage=""},async Submit(){let t={};if(this.user.first_name&&(t.firstname=this.user.first_name),this.user.last_name&&(t.lastname=this.user.last_name),t.username=this.user.username,this.user.email&&this.ValidateEmail())t.email=this.user.email;else if(this.user.email&&!this.ValidateEmail())return;this.user.avatar&&(t.avatar=this.user.avatar);const e={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},l="/users/"+this.userId+"/instructor/edit";try{const m=await fetch(l,e);if(!m.ok){const r=await m.json();this.errorUsernameMessage="",this.errorEmailMessage="",r.errors&&(r.errors.username&&(this.errorUsernameMessage=r.errors.username),r.errors.email&&(this.errorEmailMessage=r.errors.email));return}await this.usersStore.getUsers(),this.originalUser={...this.user},this.$router.push("/students")}catch(m){console.error(m)}},async SubmitAvatar(){if(this.isImageLoading=!0,!this.user.avatar)return;const t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:this.user.avatar})};var e="/users/"+this.userId+"/instructor/edit-avatar";fetch(e,t).then(()=>{this.isImageLoading=!1,this.usersStore.getUsers()})},onFileChange(t){var e=t.target.files||t.dataTransfer.files;e.length&&this.createImage(e[0])},createImage(t){var e=new Image,l=new FileReader,m=this;l.onload=r=>{m.image=r.target.result,this.image=r.target.result,this.avatar=this.image,e.src=r.target.result,this.user.avatar=this.image},e.onload=()=>{e.width/e.height!==1?(this.validate.notSquareImg=!0,this.showCropModal=!0):this.validate.notSquareImg=!1},l.readAsDataURL(t)},removeImage:function(t){this.image=""},cropImageChange({coordinates:t,canvas:e,image:l}){this.cropResult={coordinates:t,image:l},this.cropCanvas=e.toDataURL()},handleCropImage(){var t=new Image;t.src=this.cropCanvas,this.user.avatar=this.cropCanvas,this.image=this.cropCanvas,this.showCropModal=!1,this.validate.notSquareImg=!1,this.validate.notCropped=!1},handleCancelCrop(){this.showCropModal=!1},stencilSize({boundaries:t}){return{width:Math.min(t.height,t.width)-48,height:Math.min(t.height,t.width)-48}},handlePhoneCropper(){if(window.innerWidth<940){const{visibleArea:t,image:e}=this.$refs.cropper.getResult();this.zoomValue=t.height/e.height,this.lastZoomValue=this.zoomValue,this.$refs.cropper.zoom(this.zoomValue)}},cropperZoomIn(){this.$refs.cropper.visibleArea.height>30&&this.$refs.cropper.zoom(2)},cropperZoomOut(){this.$refs.cropper.visibleArea.height<3e3&&this.$refs.cropper.zoom(.5)}}},V={class:"container p-1"},E={class:"row"},k={class:"col-12 col-md-6 mb-3"},z={class:""},H=["src"],L={key:1,class:"loading-animation d-flex justify-content-center align-items-center py-4"},F={class:"d-flex gap-1 mt-1"},R=["disabled"],j={class:"col-12 col-md-6 mb-2"},B={class:"mb-3"},P={class:"mb-3"},q={class:"mb-3"},Z={key:0,class:"form-validate"},A={class:"mb-2"},O={key:0,class:"form-validate"},T={class:""},N=["disabled"],D={class:"mb-3 row"},J={class:"d-none"},W={key:0},G={id:"myModal",class:"modal"},K={class:"modal-content d-flex flex-column"},Q={id:"crop-component",ref:"cropComponent"},X={id:"crop-result"},Y={id:"zoom-range"},$={class:"d-flex flex-row justify-content-center mt-2"},ee={class:"d-flex flex-row justify-content-between justify-content-lg-end gap-2 mt-5 pb-2 pb-lg-0"};function se(t,e,l,m,r,a){const f=g("router-link"),w=g("cropper"),C=g("preview");return o(),n(M,null,[s("div",V,[p(f,{class:"btn red-btn mb-1",to:"/students"},{default:_(()=>e[14]||(e[14]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",height:"20",width:"20",fill:"white"},[s("path",{d:"M134.1 296H436c6.6 0 12-5.4 12-12v-56c0-6.6-5.4-12-12-12H134.1v-46.1c0-21.4-25.9-32.1-41-17L7 239c-9.4 9.4-9.4 24.6 0 33.9l86.1 86.1c15.1 15.1 41 4.4 41-17V296z"})],-1),c("  Back to Students ",-1)])),_:1,__:[14]}),s("div",E,[s("div",k,[s("div",z,[r.isImageLoading?(o(),n("div",L,e[15]||(e[15]=[s("span",{class:"loader"},null,-1)]))):(o(),n("img",{key:0,class:"rounded",src:r.image,height:"350",width:"350",style:{"background-color":"lightgrey"}},null,8,H)),s("div",F,[e[17]||(e[17]=s("label",{class:"btn green-btn",for:"image-input"}," Change ",-1)),r.avatar!=""?(o(),n("button",{key:0,class:"btn green-btn",onClick:e[0]||(e[0]=i=>r.showCropModal=!0)},e[16]||(e[16]=[c(" Crop   ",-1),s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"18",height:"18",fill:"white"},[s("path",{d:"M448 109.3l54.6-54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L402.7 64 160 64v64l178.7 0L128 338.7V32c0-17.7-14.3-32-32-32S64 14.3 64 32V64H32C14.3 64 0 78.3 0 96s14.3 32 32 32H64V384c0 35.3 28.7 64 64 64H352V384H173.3L384 173.3 384 480c0 17.7 14.3 32 32 32s32-14.3 32-32V448h32c17.7 0 32-14.3 32-32s-14.3-32-32-32H448l0-274.7z"})],-1)]))):d("",!0)])]),s("button",{disabled:r.avatar=="",class:"btn primary-btn mt-1",onClick:e[1]||(e[1]=i=>a.SubmitAvatar())}," Update student avatar ",8,R)]),s("div",j,[s("div",B,[e[18]||(e[18]=s("h2",{class:"secondary-heading h4"},"First name",-1)),u(s("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>r.user.first_name=i),type:"text",class:"form-control"},null,512),[[h,r.user.first_name]])]),s("div",P,[e[19]||(e[19]=s("h2",{class:"secondary-heading h4"},"Last name",-1)),u(s("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>r.user.last_name=i),type:"text",class:"form-control"},null,512),[[h,r.user.last_name]])]),s("div",q,[e[20]||(e[20]=s("h2",{class:"secondary-heading h4"},"Username",-1)),u(s("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>r.user.username=i),type:"text",class:"form-control",onInput:e[5]||(e[5]=(...i)=>a.clearUsernameError&&a.clearUsernameError(...i))},null,544),[[h,r.user.username]]),r.validate.username&&(r.user.username==""||r.user.username==null)||r.errorUsernameMessage?(o(),n("div",Z,v(r.errorUsernameMessage||"Please enter a username!"),1)):d("",!0)]),s("div",A,[e[21]||(e[21]=s("h2",{class:"secondary-heading h4"},"Email address",-1)),u(s("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>r.user.email=i),type:"email",class:"form-control",onInput:e[7]||(e[7]=(...i)=>a.clearEmailError&&a.clearEmailError(...i))},null,544),[[h,r.user.email]]),r.errorEmailMessage?(o(),n("div",O,v(r.errorEmailMessage||"Please enter a valid email address!"),1)):d("",!0)]),s("div",T,[s("button",{class:"btn primary-btn",onClick:e[8]||(e[8]=i=>a.ValidateForm()),disabled:!a.hasFormChanges}," Update student details ",8,N)])])]),s("div",D,[s("div",J,[s("input",{id:"image-input",class:"form-control",type:"file",accept:"image/*",onChange:e[9]||(e[9]=(...i)=>a.onFileChange&&a.onFileChange(...i))},null,32),e[22]||(e[22]=s("p",{style:{"font-size":"14px"}},[s("em",null,"Maximum file size 15mb")],-1))])])]),r.showCropModal?(o(),n("div",W,[s("div",G,[s("div",K,[s("div",Q,[p(w,{src:r.image,onChange:a.cropImageChange,onReady:a.handlePhoneCropper,"stencil-props":{movable:!0,resizable:!0,aspectRatio:1},"image-restriction":"stencil",class:"cropper",ref:"cropper",debounce:!1},null,8,["src","onChange","onReady"]),s("div",X,[e[23]||(e[23]=s("div",{class:"form-label"},"Result:",-1)),p(C,{width:120,height:120,image:r.cropResult.image,coordinates:r.cropResult.coordinates},null,8,["image","coordinates"])])],512),s("div",Y,[s("span",{class:"mt-1 me-1 zoom-icon",onClick:e[10]||(e[10]=(...i)=>a.cropperZoomOut&&a.cropperZoomOut(...i))},e[24]||(e[24]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"20",height:"20",fill:"gray"},[s("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM136 184c-13.3 0-24 10.7-24 24s10.7 24 24 24H280c13.3 0 24-10.7 24-24s-10.7-24-24-24H136z"})],-1)])),s("span",{class:"mt-1 ms-1 zoom-icon",onClick:e[11]||(e[11]=(...i)=>a.cropperZoomIn&&a.cropperZoomIn(...i))},e[25]||(e[25]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"20",height:"20",fill:"gray"},[s("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM184 296c0 13.3 10.7 24 24 24s24-10.7 24-24V232h64c13.3 0 24-10.7 24-24s-10.7-24-24-24H232V120c0-13.3-10.7-24-24-24s-24 10.7-24 24v64H120c-13.3 0-24 10.7-24 24s10.7 24 24 24h64v64z"})],-1)]))]),s("div",$,[r.validate.notCropped?(o(),n("div",{key:0,id:"warning-line",class:U({shake:r.validate.notCropped})}," Please crop your image to square aspect ratio ",2)):d("",!0)]),s("div",ee,[s("button",{class:"btn red-btn",onClick:e[12]||(e[12]=(...i)=>a.handleCancelCrop&&a.handleCancelCrop(...i))},e[26]||(e[26]=[s("span",null,"Cancel",-1)])),s("button",{class:"btn green-btn",onClick:e[13]||(e[13]=(...i)=>a.handleCropImage&&a.handleCropImage(...i))},e[27]||(e[27]=[s("span",null,"Crop",-1)]))])])])])):d("",!0)],64)}const ie=b(S,[["render",se],["__scopeId","data-v-7702db2b"]]);export{ie as default};
