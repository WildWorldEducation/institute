import{_ as b,A as y,r as p,o as n,c as l,a as e,g,l as I,s as v,b as h,w as m,C as u,t as _,q as M,F as x,p as S,d as V}from"./main-159c490b.js";import{f as U,h as k}from"./theme.compact-2fffbc1f.js";const E={setup(){return{usersStore:y()}},data(){return{userId:this.$route.params.id,user:{},image:"",avatar:"",validate:{first_name:!1,last_name:!1,email:!1,emailFormat:!1,notSquareImg:!1,notCropped:!1},errorUsernameMessage:"",errorEmailMessage:"",showCropModal:!1,cropCanvas:"",cropResult:{coordinates:null,image:null},lastZoomValue:0,zoomValue:0,isImageLoading:!1}},components:{Cropper:U,Preview:k},async mounted(){this.usersStore.users.length<1&&await this.usersStore.getUsers(),this.getUser()},methods:{getUser(){fetch("/users/show/"+this.userId).then(function(t){return t.json()}).then(t=>this.user=t).then(()=>{this.image=this.user.avatar})},ValidateForm(){this.validate.username=!this.user.username,this.validate.username||this.Submit()},ValidateEmail(){const t=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return this.user.email&&!t.test(this.user.email)?(this.errorEmailMessage="Please enter a valid email address!",!1):!0},clearUsernameError(){this.errorUsernameMessage=""},clearEmailError(){this.errorEmailMessage=""},async Submit(){let t={};if(this.user.first_name&&(t.firstname=this.user.first_name),this.user.last_name&&(t.lastname=this.user.last_name),t.username=this.user.username,this.user.email&&this.ValidateEmail())t.email=this.user.email;else if(this.user.email&&!this.ValidateEmail())return;this.user.avatar&&(t.avatar=this.user.avatar);const s={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},c="/users/"+this.userId+"/instructor/edit";try{const d=await fetch(c,s);if(!d.ok){const r=await d.json();this.errorUsernameMessage="",this.errorEmailMessage="",r.errors&&(r.errors.username&&(this.errorUsernameMessage=r.errors.username),r.errors.email&&(this.errorEmailMessage=r.errors.email));return}await this.usersStore.getUsers(),this.$router.push("/students")}catch(d){console.error(d)}},async SubmitAvatar(){if(this.isImageLoading=!0,!this.user.avatar)return;const t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:this.user.avatar})};var s="/users/"+this.userId+"/instructor/edit-avatar";fetch(s,t).then(()=>{this.isImageLoading=!1})},onFileChange(t){var s=t.target.files||t.dataTransfer.files;s.length&&this.createImage(s[0])},createImage(t){var s=new Image,c=new FileReader,d=this;c.onload=r=>{d.image=r.target.result,this.image=r.target.result,this.avatar=this.image,s.src=r.target.result,this.user.avatar=this.image},s.onload=()=>{s.width/s.height!==1?(this.validate.notSquareImg=!0,this.showCropModal=!0):this.validate.notSquareImg=!1},c.readAsDataURL(t)},removeImage:function(t){this.image=""},cropImageChange({coordinates:t,canvas:s,image:c}){this.cropResult={coordinates:t,image:c},this.cropCanvas=s.toDataURL()},handleCropImage(){var t=new Image;t.src=this.cropCanvas,this.user.avatar=this.cropCanvas,this.image=this.cropCanvas,this.showCropModal=!1,this.validate.notSquareImg=!1,this.validate.notCropped=!1},handleCancelCrop(){this.showCropModal=!1},stencilSize({boundaries:t}){return{width:Math.min(t.height,t.width)-48,height:Math.min(t.height,t.width)-48}},handlePhoneCropper(){if(window.innerWidth<940){const{visibleArea:t,image:s}=this.$refs.cropper.getResult();this.zoomValue=t.height/s.height,this.lastZoomValue=this.zoomValue,this.$refs.cropper.zoom(this.zoomValue)}},cropperZoomIn(){this.$refs.cropper.visibleArea.height>30&&this.$refs.cropper.zoom(2)},cropperZoomOut(){this.$refs.cropper.visibleArea.height<3e3&&this.$refs.cropper.zoom(.5)}}},i=t=>(S("data-v-0ca8f3e7"),t=t(),V(),t),z={class:"container p-1"},H=i(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",height:"20",width:"20",fill:"white"},[e("path",{d:"M134.1 296H436c6.6 0 12-5.4 12-12v-56c0-6.6-5.4-12-12-12H134.1v-46.1c0-21.4-25.9-32.1-41-17L7 239c-9.4 9.4-9.4 24.6 0 33.9l86.1 86.1c15.1 15.1 41 4.4 41-17V296z"})],-1)),L={class:"row"},R={class:"col-12 col-md-6 mb-3"},F={class:""},q=["src"],B={key:1,class:"loading-animation d-flex justify-content-center align-items-center py-4"},P=i(()=>e("span",{class:"loader"},null,-1)),j=[P],Z={class:"d-flex gap-1 mt-1"},A=i(()=>e("label",{class:"btn green-btn",for:"image-input"}," Change ",-1)),O=i(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"18",height:"18",fill:"white"},[e("path",{d:"M448 109.3l54.6-54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L402.7 64 160 64v64l178.7 0L128 338.7V32c0-17.7-14.3-32-32-32S64 14.3 64 32V64H32C14.3 64 0 78.3 0 96s14.3 32 32 32H64V384c0 35.3 28.7 64 64 64H352V384H173.3L384 173.3 384 480c0 17.7 14.3 32 32 32s32-14.3 32-32V448h32c17.7 0 32-14.3 32-32s-14.3-32-32-32H448l0-274.7z"})],-1)),T=["disabled"],N={class:"col-12 col-md-6 mb-2"},D={class:"mb-3"},J=i(()=>e("h2",{class:"secondary-heading h4"},"First name",-1)),W={class:"mb-3"},G=i(()=>e("h2",{class:"secondary-heading h4"},"Last name",-1)),K={class:"mb-3"},Q=i(()=>e("h2",{class:"secondary-heading h4"},"Username",-1)),X={key:0,class:"form-validate"},Y={class:"mb-2"},$=i(()=>e("h2",{class:"secondary-heading h4"},"Email address",-1)),ee={key:0,class:"form-validate"},se={class:""},te={class:"mb-3 row"},re={class:"d-none"},ae=i(()=>e("p",{style:{"font-size":"14px"}},[e("em",null,"Maximum file size 15mb")],-1)),oe={key:0},ie={id:"myModal",class:"modal"},ne={class:"modal-content d-flex flex-column"},le={id:"crop-component",ref:"cropComponent"},ce={id:"crop-result"},de=i(()=>e("div",{class:"form-label"},"Result:",-1)),he={id:"zoom-range"},me=i(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"20",height:"20",fill:"gray"},[e("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM136 184c-13.3 0-24 10.7-24 24s10.7 24 24 24H280c13.3 0 24-10.7 24-24s-10.7-24-24-24H136z"})],-1)),ue=[me],pe=i(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"20",height:"20",fill:"gray"},[e("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM184 296c0 13.3 10.7 24 24 24s24-10.7 24-24V232h64c13.3 0 24-10.7 24-24s-10.7-24-24-24H232V120c0-13.3-10.7-24-24-24s-24 10.7-24 24v64H120c-13.3 0-24 10.7-24 24s10.7 24 24 24h64v64z"})],-1)),ge=[pe],ve={class:"d-flex flex-row justify-content-center mt-2"},_e={class:"d-flex flex-row justify-content-between justify-content-lg-end gap-2 mt-5 pb-2 pb-lg-0"},fe=i(()=>e("span",{class:"d-none d-lg-block"},"Cancel",-1)),we=[fe],Ce=i(()=>e("span",{class:"d-none d-lg-block"},"Crop",-1)),be=[Ce];function ye(t,s,c,d,r,o){const f=p("router-link"),w=p("cropper"),C=p("preview");return n(),l(x,null,[e("div",z,[g(f,{class:"btn red-btn mb-1",to:"/students"},{default:I(()=>[H,v("  Back to Students ")]),_:1}),e("div",L,[e("div",R,[e("div",F,[r.isImageLoading?(n(),l("div",B,j)):(n(),l("img",{key:0,class:"rounded",src:r.image,height:"350",width:"350",style:{"background-color":"lightgrey"}},null,8,q)),e("div",Z,[A,r.avatar!=""?(n(),l("button",{key:0,class:"btn green-btn",onClick:s[0]||(s[0]=a=>r.showCropModal=!0)},[v(" Crop   "),O])):h("",!0)])]),e("button",{disabled:r.avatar=="",class:"btn primary-btn mt-1",onClick:s[1]||(s[1]=a=>o.SubmitAvatar())}," Update student avatar ",8,T)]),e("div",N,[e("div",D,[J,m(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>r.user.first_name=a),type:"text",class:"form-control"},null,512),[[u,r.user.first_name]])]),e("div",W,[G,m(e("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>r.user.last_name=a),type:"text",class:"form-control"},null,512),[[u,r.user.last_name]])]),e("div",K,[Q,m(e("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>r.user.username=a),type:"text",class:"form-control",onInput:s[5]||(s[5]=(...a)=>o.clearUsernameError&&o.clearUsernameError(...a))},null,544),[[u,r.user.username]]),r.validate.username&&(r.user.username==""||r.user.username==null)||r.errorUsernameMessage?(n(),l("div",X,_(r.errorUsernameMessage||"Please enter a username!"),1)):h("",!0)]),e("div",Y,[$,m(e("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>r.user.email=a),type:"email",class:"form-control",onInput:s[7]||(s[7]=(...a)=>o.clearEmailError&&o.clearEmailError(...a))},null,544),[[u,r.user.email]]),r.errorEmailMessage?(n(),l("div",ee,_(r.errorEmailMessage||"Please enter a valid email address!"),1)):h("",!0)]),e("div",se,[e("button",{class:"btn primary-btn",onClick:s[8]||(s[8]=a=>o.ValidateForm())}," Update student details ")])])]),e("div",te,[e("div",re,[e("input",{id:"image-input",class:"form-control",type:"file",accept:"image/*",onChange:s[9]||(s[9]=(...a)=>o.onFileChange&&o.onFileChange(...a))},null,32),ae])])]),r.showCropModal?(n(),l("div",oe,[e("div",ie,[e("div",ne,[e("div",le,[g(w,{src:r.image,onChange:o.cropImageChange,onReady:o.handlePhoneCropper,"stencil-props":{movable:!0,resizable:!0,aspectRatio:1},"image-restriction":"stencil",class:"cropper",ref:"cropper",debounce:!1},null,8,["src","onChange","onReady"]),e("div",ce,[de,g(C,{width:120,height:120,image:r.cropResult.image,coordinates:r.cropResult.coordinates},null,8,["image","coordinates"])])],512),e("div",he,[e("span",{class:"mt-1 me-1 zoom-icon",onClick:s[10]||(s[10]=(...a)=>o.cropperZoomOut&&o.cropperZoomOut(...a))},ue),e("span",{class:"mt-1 ms-1 zoom-icon",onClick:s[11]||(s[11]=(...a)=>o.cropperZoomIn&&o.cropperZoomIn(...a))},ge)]),e("div",ve,[r.validate.notCropped?(n(),l("div",{key:0,id:"warning-line",class:M({shake:r.validate.notCropped})}," Please crop your image to square aspect ratio ",2)):h("",!0)]),e("div",_e,[e("button",{class:"btn red-btn",onClick:s[12]||(s[12]=(...a)=>o.handleCancelCrop&&o.handleCancelCrop(...a))},we),e("button",{class:"btn green-btn",onClick:s[13]||(s[13]=(...a)=>o.handleCropImage&&o.handleCropImage(...a))},be)])])])])):h("",!0)],64)}const xe=b(E,[["render",ye],["__scopeId","data-v-0ca8f3e7"]]);export{xe as default};
