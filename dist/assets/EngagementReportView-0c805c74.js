import{s as f}from"./transform-35b9fb9e.js";import{_ as T,o as p,c as m,f as b,r as k,a as i,b as C,s as y,k as w,p as M,d as D}from"./main-138df8f6.js";import{l as S,m as v,a as L,b as x,c as P}from"./linear-c968f95f.js";import{b as O,o as A}from"./band-18e9f0c1.js";import{s as $}from"./sort-855cf5d1.js";import{q as j,S as B,p as I,a as _}from"./pie-1771a485.js";import{u as z,l as R}from"./line-8aa3dac8.js";import{e as E}from"./time-962c8065.js";import{u as H}from"./AnalyticsStore-85b92399.js";import"./point-ea70dc51.js";const N={name:"TenantAvgInteractionTimePerSkill",props:["data","colour"],data(){return{}},mounted(){f("#tenant-avg-interaction-time-per-skill-chart-container");const e=25,t=0,a=0,o=10,d=200,r=1e3,c=Math.ceil((this.data.length+.1)*e)+t+o,l=S().domain([0,v(this.data,n=>n.milliseconds)]).range([d,r-a]),h=O().domain($(this.data,n=>-n.milliseconds).map(n=>n.name)).rangeRound([t,c-o]).padding(.1);l.tickFormat(20);const s=f("#tenant-avg-interaction-time-per-skill-chart-container").append("svg").attr("width",r).attr("height",c).attr("viewBox",[0,0,r,c]).attr("style","max-width: 100%; height: 100%; font: 14px sans-serif;");s.append("g").attr("fill",this.colour).selectAll().data(this.data).join("rect").attr("x",l(0)).attr("y",n=>h(n.name)).attr("width",n=>l(n.milliseconds)-l(0)).attr("height",h.bandwidth()),s.append("g").attr("fill","white").attr("text-anchor","end").selectAll().data(this.data).join("text").attr("x",n=>l(n.milliseconds)).attr("y",n=>h(n.name)+h.bandwidth()/2).attr("dy","0.35em").attr("dx",-4).text(n=>n.minutes).call(n=>n.filter(u=>l(u.milliseconds)-l(0)<30).attr("dx",4).attr("fill","black").attr("text-anchor","start")),s.append("g").attr("transform",`translate(0,${t})`).call(L(l).ticks(0)).call(n=>n.select(".domain").remove()),s.append("g").attr("transform",`translate(${d},0)`).call(x(h).tickSizeOuter(0))},computed:{}},U={id:"tenant-avg-interaction-time-per-skill-chart-container"};function W(e,t,a,o,d,r){return p(),m("div",U)}const V=T(N,[["render",W],["__scopeId","data-v-8636d168"]]),q={name:"TenantPercentageStudentsMasteredAtLeastOneSkillPieChart",props:["data"],data(){return{}},mounted(){f("#tenant-percentage-students-mastered-one-skill-chart-container");let e=this.data;const t=928,a=Math.min(t,250);A().domain(e.map(s=>s.name)).range(j(s=>B(s*.8+.1),e.length).reverse());const o=I().sort(null).value(s=>s.value),d=_().innerRadius(0).outerRadius(Math.min(t,a)/2-1),r=d.outerRadius()()*.6,c=_().innerRadius(r).outerRadius(r),l=o(e),h=f("#tenant-percentage-students-mastered-one-skill-chart-container").append("svg").attr("width",t).attr("height",a).attr("viewBox",[-t/2,-a/2,t,a]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");h.append("g").attr("stroke","white").selectAll().data(l).join("path").attr("fill",s=>{if(s.data.name==="Mastered one skill")return"darkgreen";if(s.data.name==="Mastered no skills")return"darkred"}).attr("d",d).append("title").text(s=>`${s.data.name}: ${s.data.value.toLocaleString("en-US")}`),h.append("g").attr("text-anchor","middle").selectAll().data(l).join("text").attr("transform",s=>`translate(${c.centroid(s)})`).call(s=>s.append("tspan").attr("y","-0.4em").attr("fill","white").attr("font-weight","bold").text(n=>n.data.name)).call(s=>s.filter(n=>n.endAngle-n.startAngle>.25).append("tspan").attr("x",0).attr("fill","white").attr("y","1em").attr("fill-opacity",1).text(n=>n.data.value.toLocaleString("en-US")))},computed:{}},F={id:"tenant-percentage-students-mastered-one-skill-chart-container"};function G(e,t,a,o,d,r){return p(),m("div",F)}const J=T(q,[["render",G]]),K={name:"TenantDurationPerDayLineChart",props:["data","colour"],data(){return{}},mounted(){const e=this.data;f("#tenant-duration-per-day-chart-container");const t=928,a=500,o=20,d=30,r=30,c=40,l=z(E(e,u=>u.date),[c,t-d]),h=S([0,v(e,u=>u.minutes)],[a-r,o]),s=R().x(u=>l(u.date)).y(u=>h(u.minutes)),n=f("#tenant-duration-per-day-chart-container").append("svg").attr("width",t).attr("height",a).attr("viewBox",[0,0,t,a]).attr("style","max-width: 100%; height: auto; height: intrinsic;");n.append("g").attr("transform",`translate(0,${a-r})`).call(P(l).ticks(e.length/2).tickSizeOuter(0)),n.append("g").attr("transform",`translate(${c},0)`).call(x(h).ticks(a/80)).call(u=>u.selectAll(".tick line").clone().attr("x2",t-c-d).attr("stroke-opacity",.1)).call(u=>u.append("text").attr("x",-c).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text("â†‘ Duration in minutes")),n.append("path").attr("fill","none").attr("stroke","#5f31dd").attr("stroke-width",1.5).attr("d",s(e))}},Q={id:"tenant-duration-per-day-chart-container"};function X(e,t,a,o,d,r){return p(),m("div",Q)}const Y=T(K,[["render",X]]);const Z={setup(){const e=b(),t=H();return{userDetailsStore:e,analyticsStore:t}},components:{TenantAvgInteractionTimePerSkillHorizontalBarChart:V,TenantPercentageStudentsMasteredAtLeastOneSkillPieChart:J,TenantDurationPerDayLineChart:Y},data(){return{tenantId:this.$route.params.tenantId,durationPerDay:[],percentageStudentsMasteredOneSkill:[],isDataWeekly:!1,isTutorialComplete:!1,showTutorialTip1:!1,showTutorialTip2:!1,showTutorialTip3:!1,showTutorialTip4:!1,dataMode:"total"}},async created(){await this.checkIfTutorialComplete(),this.analyticsStore.avgTimeOnSkills.length==0&&await this.getAvgTimeOnSkills(),this.analyticsStore.durationPerDay.length==0&&await this.getTenantDuration(),this.analyticsStore.percentageStudentsMasteredOneSkill.length==0&&await this.getPercentageStudentsMasteredOneSkill()},methods:{async checkIfTutorialComplete(){const t=await(await fetch(`/users/check-tutorial-progress/school-report/${this.userDetailsStore.userId}`)).json();t==0?(this.isTutorialComplete=!1,this.showTutorialTip1=!0):t==1&&(this.isTutorialComplete=!0)},progressTutorial(e){e==1?(this.showTutorialTip1=!1,this.showTutorialTip2=!0):e==2?(this.showTutorialTip2=!1,this.showTutorialTip3=!0):e==3?(this.showTutorialTip3=!1,this.showTutorialTip4=!0):e==4&&(this.showTutorialTip4=!1,this.markTutorialComplete())},restartTutorial(){this.isTutorialComplete=!1,this.showTutorialTip1=!0,this.showTutorialTip2=!1,this.showTutorialTip3=!1,this.showTutorialTip4=!1},markTutorialComplete(){let e="/users/mark-tutorial-complete/school-report/"+this.userDetailsStore.userId;fetch(e,{method:"PUT",headers:{"Content-Type":"application/json"}})},skipTutorial(){this.showTutorialTip1=!1,this.showTutorialTip2=!1,this.showTutorialTip3=!1,this.showTutorialTip4=!1,this.isTutorialComplete=!0,this.markTutorialComplete()},async getAvgTimeOnSkills(){try{const e=await fetch(`/student-analytics/avg-times-on-skills/tenant/${this.tenantId}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();this.analyticsStore.avgTimeOnSkills=Array.isArray(t)?t:[];for(let a=0;a<this.analyticsStore.avgTimeOnSkills.length;a++)this.analyticsStore.avgTimeOnSkills[a].minutes=this.millisToMinutesAndSeconds(this.analyticsStore.avgTimeOnSkills[a].milliseconds)}catch(e){console.error("Error fetching cohort mastered assessments:",e),this.avgTimeOnSkills=[]}},async getTenantDuration(){this.analyticsStore.durationPerDay=[];let e=`/student-analytics/tenant-duration-per-day/${this.dataMode}/${this.tenantId}`;fetch(e).then(t=>t.json()).then(async t=>{this.analyticsStore.durationPerDay=[];for(let a=0;a<t.length;a++)t[a].date=new Date(t[a].date),t[a].minutes=t[a].milliseconds/(1e3*60),this.analyticsStore.durationPerDay.push(t[a]);this.analyticsStore.durationPerDay.sort((a,o)=>a.date-o.date)}).catch(t=>{console.error("Error fetching student progress:",t)})},async getPercentageStudentsMasteredOneSkill(){this.analyticsStore.percentageStudentsMasteredOneSkill=[];try{let e=`/student-analytics/percentage-students-mastered-one-skill/tenant/${this.dataMode}/${this.tenantId}`,t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);this.analyticsStore.percentageStudentsMasteredOneSkill=await t.json()}catch(e){console.error("Error fetching cohort mastered assessments:",e),this.analyticsStore.percentageStudentsMasteredOneSkill=[]}},millisToMinutesAndSeconds(e){var t=Math.floor(e/6e4),a=(e%6e4/1e3).toFixed(0);return t+":"+(a<10?"0":"")+a},downloadData(e,t){const a=Object.keys(e[0]);console.log(a);const o=[];o.push(a.join(","));for(const l of e){const h=a.map(s=>{const n=l[s];return`"${String(n).replace(/"/g,'""')}"`});o.push(h.join(","))}const d=o.join(`
`),r=new Blob([d],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");c.href=URL.createObjectURL(r),c.download=t+".csv",c.click()},async toggleWeeklyCumulativeData(){this.dataMode=="total"?this.dataMode="weekly":this.dataMode="total",await this.getTenantDuration(),await this.getPercentageStudentsMasteredOneSkill()}}},g=e=>(M("data-v-219d950a"),e=e(),D(),e),tt={class:"container"},et={class:"d-flex justify-content-between w-100"},at=g(()=>i("h1",{class:"heading"},"Engagement Report",-1)),st={class:"btn-group d-flex d-sm-inline-flex mt-2",role:"group"},nt=g(()=>i("label",{class:"btn btn-outline-dark btn-sm filter-btn",for:"total1"},"Total",-1)),it=g(()=>i("label",{class:"btn btn-outline-dark btn-sm filter-btn",for:"week1"},"This week",-1)),rt=g(()=>i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 192 512",width:"20",height:"23",class:"primary-icon"},[i("path",{d:"M48 80a48 48 0 1 1 96 0A48 48 0 1 1 48 80zM0 224c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224 32 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0 0-192-32 0c-17.7 0-32-14.3-32-32z"})],-1)),ot=[rt],lt={key:0,class:"modal"},ct={class:"modal-content"},dt=g(()=>i("p",{class:"modal-text"}," The School Admin Report provides comprehensive analytics on student engagement, academic performance, and resource usage across your school. ",-1)),ht={class:"d-flex justify-content-between"},ut={class:"d-flex justify-content-between"},pt=g(()=>i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"18",height:"18"},[i("path",{d:"M0 64C0 28.7 28.7 0 64 0L213.5 0c17 0 33.3 6.7 45.3 18.7L365.3 125.3c12 12 18.7 28.3 18.7 45.3L384 448c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zm208-5.5l0 93.5c0 13.3 10.7 24 24 24L325.5 176 208 58.5zM175 441c9.4 9.4 24.6 9.4 33.9 0l64-64c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-23 23 0-86.1c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 86.1-23-23c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64z"})],-1)),mt=[pt],gt={key:2,style:{height:"500px"}},ft={class:"d-flex justify-content-between"},Tt=g(()=>i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"18",height:"18"},[i("path",{d:"M0 64C0 28.7 28.7 0 64 0L213.5 0c17 0 33.3 6.7 45.3 18.7L365.3 125.3c12 12 18.7 28.3 18.7 45.3L384 448c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zm208-5.5l0 93.5c0 13.3 10.7 24 24 24L325.5 176 208 58.5zM175 441c9.4 9.4 24.6 9.4 33.9 0l64-64c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-23 23 0-86.1c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 86.1-23-23c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64z"})],-1)),kt=[Tt],yt={key:4},wt={class:"d-flex justify-content-between"},_t=g(()=>i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"18",height:"18"},[i("path",{d:"M0 64C0 28.7 28.7 0 64 0L213.5 0c17 0 33.3 6.7 45.3 18.7L365.3 125.3c12 12 18.7 28.3 18.7 45.3L384 448c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zm208-5.5l0 93.5c0 13.3 10.7 24 24 24L325.5 176 208 58.5zM175 441c9.4 9.4 24.6 9.4 33.9 0l64-64c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-23 23 0-86.1c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 86.1-23-23c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64z"})],-1)),St=[_t],vt={key:6,class:"mb-5"};function xt(e,t,a,o,d,r){const c=k("TenantDurationPerDayLineChart"),l=k("TenantAvgInteractionTimePerSkillHorizontalBarChart"),h=k("TenantPercentageStudentsMasteredAtLeastOneSkillPieChart");return p(),m("div",tt,[i("span",et,[at,i("span",null,[i("div",st,[i("input",{type:"radio",class:"btn-check",name:"timeFilter1",id:"total1",onClick:t[0]||(t[0]=(...s)=>r.toggleWeeklyCumulativeData&&r.toggleWeeklyCumulativeData(...s)),checked:""}),nt,i("input",{type:"radio",class:"btn-check",name:"timeFilter1",id:"week1",onClick:t[1]||(t[1]=(...s)=>r.toggleWeeklyCumulativeData&&r.toggleWeeklyCumulativeData(...s))}),it]),i("button",{class:"btn me-1",onClick:t[2]||(t[2]=(...s)=>r.restartTutorial&&r.restartTutorial(...s)),"aria-label":"info"},ot)])]),d.showTutorialTip1?(p(),m("div",lt,[i("div",ct,[dt,i("div",ht,[i("button",{class:"btn primary-btn",onClick:t[3]||(t[3]=s=>r.progressTutorial(1))}," next "),i("button",{class:"btn red-btn",onClick:t[4]||(t[4]=(...s)=>r.skipTutorial&&r.skipTutorial(...s))}," exit tutorial ")])])])):C("",!0),i("h4",ut,[y(" Time spent on platform per day "),i("button",{class:"btn",onClick:t[5]||(t[5]=s=>r.downloadData(o.analyticsStore.durationPerDay,"Time-per-day"))},mt)]),o.analyticsStore.durationPerDay.length>0?(p(),w(c,{key:1,data:o.analyticsStore.durationPerDay,colour:"#5f31dd",class:"mb-5"},null,8,["data"])):(p(),m("div",gt,"No data yet")),i("h4",ft,[y(" Average interaction time per skill (minutes) "),i("button",{class:"btn",onClick:t[6]||(t[6]=s=>r.downloadData(o.analyticsStore.avgTimeOnSkills,"Avg-time-per-skill"))},kt)]),o.analyticsStore.avgTimeOnSkills.length>0?(p(),w(l,{key:3,data:o.analyticsStore.avgTimeOnSkills,colour:"purple",class:"mb-5"},null,8,["data"])):(p(),m("p",yt,"No data yet")),i("h4",wt,[y(" Percentage of students who completed at least one skill (cumulative) "),i("button",{class:"btn",onClick:t[7]||(t[7]=s=>r.downloadData(o.analyticsStore.percentageStudentsMasteredOneSkill,"Percentage-students-completed-one-skill"))},St)]),o.analyticsStore.percentageStudentsMasteredOneSkill.length>0?(p(),w(h,{key:5,data:o.analyticsStore.percentageStudentsMasteredOneSkill,class:"mb-5"},null,8,["data"])):(p(),m("p",vt,"No data yet"))])}const Bt=T(Z,[["render",xt],["__scopeId","data-v-219d950a"]]);export{Bt as default};
