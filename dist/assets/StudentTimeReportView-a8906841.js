import{_ as p,A as y,r as d,o as u,c as m,a as o,t as f,g as h,k as _,p as S,d as g}from"./main-f43802e9.js";import{u as v}from"./TeacherAnalyticsStore-f758b6c6.js";import{T as D,S as w}from"./TimePerSkillHorizontalBarChart-e21c50cd.js";import"./transform-4d0f7c8f.js";import{b as A,m as k}from"./continuous-e5db47ab.js";import{l as x,b}from"./linear-841004c4.js";import{s as C}from"./string-c67ea49d.js";import{D as P}from"./downloadCSVBtn-4e6ea100.js";import"./line-bfb1ca50.js";import"./time-ce17bce2.js";import"./point-ea70dc51.js";import"./sort-fcaf8f38.js";const T={name:"StudentSkillActivityChart",methods:{createChart(t){if(!t||t.length===0){console.warn("No data available for the chart");return}const e=document.getElementById("activity-chart-container").clientWidth,s=document.getElementById("activity-chart-container").clientHeight,c={top:20,right:0,bottom:60,left:200},r=C("#activity-chart-container").append("svg").attr("width","100%").attr("height","100%").append("g").attr("transform",`translate(${c.left},${c.top})`),n=A().domain(t.map(a=>a.name)).range([0,s-35]).padding(.2),l=x().domain([0,k(t,a=>a.quantity)]).range([0,e]);r.selectAll(".bar").data(t).enter().append("rect").attr("class","bar").attr("x",0).attr("y",a=>n(a.name)).attr("width",a=>a.quantity>0?l(a.quantity/2):l(1)).attr("height",a=>a.quantity>0?n.bandwidth():1).attr("fill","green"),r.append("g").attr("class","axis").call(b(n)),r.append("text").attr("class","axis-label").style("font-size","16px").attr("transform",`translate(${e/2},${s+35})`).style("text-anchor","middle").text("Duration (minutes)"),r.selectAll(".bar-label").data(t).enter().append("text").attr("class","bar-label").attr("x",a=>l(a.quantity/2)+5).attr("y",a=>n(a.name)+n.bandwidth()/2).attr("dy","0.35em").style("font-size","14px").text(a=>a.formattedQuantity)}}};function $(t,e,s,c,i,r){return null}const N=p(T,[["render",$]]);const I={setup(){const t=y(),e=v();return{usersStore:t,teacherAnalyticsStore:e}},components:{TimePerSkillHorizontalBarChart:D,StudentDurationPerDayLineChart:w,StudentSkillActivityChart:N,DownloadCSVBtn:P},data(){return{studentId:this.$route.params.studentId,studentName:null,skillDurations:[],durationsPerDay:[],allSkillsDuration:0,totalTimeOnPlatformDownloadData:[],minutesPerSkillDownloadData:[]}},async created(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const t=this.usersStore.users.find(e=>e.id===this.studentId);t&&(this.studentName=t.username),await this.getStudentDurationPerDay(),await this.getStudentActivity()},methods:{async getStudentDurationPerDay(){fetch(`/student-analytics/student-duration-per-day/${this.studentId}`).then(t=>t.json()).then(t=>{for(let e=0;e<t.length;e++)t[e].formattedQuantity=t[e].quantity/(1e3*60),t[e].date=new Date(t[e].date);t.sort((e,s)=>e.date-s.date),this.durationsPerDay=t,this.totalTimeOnPlatformDownloadData=this.durationsPerDay.map(e=>({date:e.date,minutes:e.formattedQuantity}))}).catch(t=>{console.error("Error fetching student duration per day:",t)})},async getStudentActivity(){this.usersStore.users.length<1&&await this.usersStore.getUsers();const t=this.usersStore.users.find(e=>e.id===this.studentId);t&&(this.studentName=t.username),this.teacherAnalyticsStore.skillActivities.length==0&&await this.teacherAnalyticsStore.getSkillActivityReport(this.studentId),this.teacherAnalyticsStore.skillActivities=this.teacherAnalyticsStore.skillActivities.map(e=>({...e,formattedQuantity:this.millisToMinutesAndSeconds(e.quantity)})),this.$nextTick(()=>{this.$refs.activityChart&&this.$refs.activityChart.createChart(this.teacherAnalyticsStore.skillActivities)}),this.downloadData=this.teacherAnalyticsStore.skillActivities.map(e=>({skill:e.name,minutes:e.formattedQuantity}))},millisToMinutesAndSeconds(t){var e=Math.floor(t/6e4),s=(t%6e4/1e3).toFixed(0);return e+":"+(s<10?"0":"")+s}}},B=t=>(S("data-v-6729fc4a"),t=t(),g(),t),V={class:"container-fluid chart-page"},q={class:"d-flex justify-content-between w-100"},O=B(()=>o("h1",{class:"heading h4"},"Time spent",-1)),Q={class:"tertiary-heading h4"},j={class:"row h-100"},E={class:"col-lg chart-col position-relative"},L={id:"time-chart-container"},M={key:1},z={class:"col-lg chart-col position-relative"},R={id:"activity-chart-container"};function U(t,e,s,c,i,r){const n=d("DownloadCSVBtn"),l=d("StudentDurationPerDayLineChart"),a=d("StudentSkillActivityChart");return u(),m("div",V,[o("span",q,[O,o("h2",Q,f(i.studentName),1)]),o("div",j,[o("div",E,[o("div",L,[h(n,{data:i.totalTimeOnPlatformDownloadData,fileName:`Total time on platform - ${i.studentName}`,toolTip:"Download total time on platform data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),i.durationsPerDay.length>0?(u(),_(l,{key:0,data:i.durationsPerDay},null,8,["data"])):(u(),m("p",M,"There is no data to show yet."))])]),o("div",z,[o("div",R,[h(n,{data:i.minutesPerSkillDownloadData,fileName:`Minutes per skill - ${i.studentName}`,toolTip:"Download minutes per skill data as CSV",class:"position-absolute download-btn"},null,8,["data","fileName"]),h(a,{ref:"activityChart"},null,512)])])])])}const st=p(I,[["render",U],["__scopeId","data-v-6729fc4a"]]);export{st as default};
